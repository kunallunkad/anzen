import{r as g,d as G,j as e,X as ue,u as me,m as he,s as D,f as j,T as K,i as be,h as Q}from"./index-D377iWu2.js";import{L as Y,P as ge}from"./Layout-B5e6WOHT.js";import{M as fe}from"./Modal-XL444I2e.js";import{h as ye,E as je}from"./html2canvas.esm-Fmpx8z4e.js";import{P as Ne}from"./printer-CyDptLnp.js";import{D as ve}from"./download-Cw744MUe.js";import{S as Z}from"./SearchableSelect-B1o4KxTG.js";import{f as _e}from"./dateFormat-E6B5rKFz.js";import{P as we}from"./plus-BUV76DvH.js";import{S as Se}from"./search-C8aJjCFC.js";import{E as Pe}from"./eye-0GUlh4_A.js";import{S as De}from"./square-pen-Bq2ioL1R.js";import"./chevron-down-D_LZ1jaB.js";function ke({purchaseOrder:o,items:N,onClose:p}){const O=g.useRef(null),{t:B,language:E}=G(),A=s=>s==null?o.currency==="USD"?"$ 0.00":"Rp 0":o.currency==="USD"?`$ ${s.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`Rp ${s.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`,F=s=>{const d=new Date(s),m=E==="id"?["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agt","Sep","Okt","Nov","Des"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],w=d.getDate(),c=m[d.getMonth()],n=d.getFullYear();return`${w} ${c} ${n}`},W=s=>E==="id"?$(s):q(s),$=s=>{if(s===0)return"Nol";const d=["","Satu","Dua","Tiga","Empat","Lima","Enam","Tujuh","Delapan","Sembilan"],m=["Sepuluh","Sebelas","Dua Belas","Tiga Belas","Empat Belas","Lima Belas","Enam Belas","Tujuh Belas","Delapan Belas","Sembilan Belas"],w=["","","Dua Puluh","Tiga Puluh","Empat Puluh","Lima Puluh","Enam Puluh","Tujuh Puluh","Delapan Puluh","Sembilan Puluh"],c=n=>{if(n===0)return"";if(n<10)return d[n];if(n>=10&&n<20)return m[n-10];if(n<100){const f=Math.floor(n/10),C=n%10;return w[f]+(C>0?" "+d[C]:"")}const i=Math.floor(n/100),h=n%100;return(i===1?"Seratus":d[i]+" Ratus")+(h>0?" "+c(h):"")};if(s<1e3)return c(s);if(s<1e6){const n=Math.floor(s/1e3),i=s%1e3;return(n===1?"Seribu":c(n)+" Ribu")+(i>0?" "+c(i):"")}if(s<1e9){const n=Math.floor(s/1e6),i=s%1e6,h=c(n)+" Juta",v=i>=1e3?(Math.floor(i/1e3)===1?"Seribu":c(Math.floor(i/1e3))+" Ribu")+(i%1e3>0?" "+c(i%1e3):""):i>0?c(i):"";return h+(v?" "+v:"")}return s.toString()},q=s=>{if(s===0)return"Zero";const d=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],m=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],w=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],c=n=>{if(n===0)return"";if(n<10)return d[n];if(n>=10&&n<20)return m[n-10];if(n<100){const v=Math.floor(n/10),f=n%10;return w[v]+(f>0?" "+d[f]:"")}const i=Math.floor(n/100),h=n%100;return d[i]+" Hundred"+(h>0?" "+c(h):"")};if(s<1e3)return c(s);if(s<1e6){const n=Math.floor(s/1e3),i=s%1e3;return c(n)+" Thousand"+(i>0?" "+c(i):"")}if(s<1e9){const n=Math.floor(s/1e6),i=s%1e6,h=i>=1e3?c(Math.floor(i/1e3))+" Thousand"+(i%1e3>0?" "+c(i%1e3):""):i>0?c(i):"";return c(n)+" Million"+(h?" "+h:"")}return s.toString()},H=()=>{window.print()},z=async()=>{if(O.current)try{const s=await ye(O.current,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff"}),d=s.toDataURL("image/png"),m=new je("p","mm","a4"),w=m.internal.pageSize.getWidth(),c=m.internal.pageSize.getHeight(),n=s.width,i=s.height,h=w/n,v=i*h;if(v>c){let f=0,C=v;for(;C>0;)m.addImage(d,"PNG",0,f,w,v),C-=c,f-=c,C>0&&m.addPage()}else m.addImage(d,"PNG",0,0,w,v);m.save(`PO-${o.po_number}.pdf`)}catch(s){console.error("Error generating PDF:",s),alert("Failed to generate PDF. Please try again.")}},u=o.suppliers,k=o.currency==="USD"?"USD":"IDR";return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 print:static print:bg-white print:overflow-visible",children:[e.jsx("div",{className:"flex min-h-screen items-start justify-center p-4 pt-10 print:p-0 print:min-h-0 print:block",children:e.jsxs("div",{className:"relative w-full max-w-5xl bg-white shadow-xl print:shadow-none print:max-w-full",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-6 py-4 print:hidden",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Purchase Order ",o.po_number]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:H,className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Print"]}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:[e.jsx(ve,{className:"h-4 w-4"}),"PDF"]}),e.jsx("button",{onClick:p,className:"rounded-lg bg-gray-100 p-2 text-gray-600 hover:bg-gray-200",children:e.jsx(ue,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{id:"po-print-content",ref:O,className:"p-8",children:[e.jsxs("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-16 flex items-center justify-center print:h-12 print:w-12",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:"100%",height:"100%",viewBox:"0 0 15686.55 15480.24",style:{shapeRendering:"geometricPrecision",fillRule:"evenodd",clipRule:"evenodd"},children:e.jsxs("g",{children:[e.jsx("path",{fill:"#FDB763",d:"M69.94 10438.12l10353.39 0 0 -1798.67 1665.92 0 0 1868.6 0 320.44 0 4552.28c0,38.48 -31.45,69.94 -69.94,69.94l-11949.38 0c-38.48,0 -69.94,-31.45 -69.94,-69.94l0 -4872.72c0,-38.48 31.45,-69.94 69.94,-69.94zm1605.9 1710.15l8737.57 0c13.58,0 24.68,11.11 24.68,24.68l0 1719.84c0,13.58 -11.11,24.68 -24.68,24.68l-8737.57 0c-13.58,0 -24.68,-11.11 -24.68,-24.68l0 -1719.84c0,-13.58 11.11,-24.68 24.68,-24.68z"}),e.jsx("path",{fill:"#FDB763",d:"M15587.15 5136.67l-10353.49 0 0 1822.07 -1665.92 0 0 -1892.9 0 -324.61 0 -4611.43c0,-39 31.45,-70.87 69.94,-70.87l11949.47 0c38.48,0 69.94,31.87 69.94,70.87l0 4936.04c0,39 -31.45,70.83 -69.94,70.83zm-1605.9 -1732.36l-8737.67 0c-13.58,0 -24.68,-11.27 -24.68,-25l0 -1742.21c0,-13.74 11.11,-25 24.68,-25l8737.67 0c13.58,0 24.68,11.27 24.68,25l0 1742.21c0,13.74 -11.11,25 -24.68,25z"}),e.jsx("polygon",{fill:"#FD6D26",points:"-0,0 1651.16,0 1651.16,6929.27 15657.09,6929.27 15657.09,6958.74 15686.55,6958.74 15686.55,15480.24 14022.85,15480.24 14022.85,8639.45 1651.16,8639.45 -0,8639.45 -0,6929.27"})]})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold print:text-sm",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Komplek Ruko Metro Sunter Blok A1 NO.15, Jl. Metro Indah Raya,"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Kelurahan Papanggo, Kec. Tanjung Priok, Jakarta Utara - 14340"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Telp: (+62 21) 65832426"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("h2",{className:"text-3xl font-bold print:text-2xl",children:"PURCHASE ORDER"})})]}),e.jsxs("div",{className:"text-xs space-y-0.5 print:text-[10px] print:space-y-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No izin PBF"}),e.jsx("span",{className:"ml-16",children:": 27092400534390007"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No Sertifikasi CDOB"}),e.jsx("span",{className:"ml-4",children:": 270924005343900070001"})]})]})]}),e.jsx("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 flex-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Supplier:"}),e.jsxs("span",{className:"font-semibold",children:[" ",(u==null?void 0:u.company_name)||""]})]}),e.jsxs("div",{className:"pt-1 flex",children:[e.jsx("span",{className:"font-bold",style:{minWidth:"72px"},children:"Address:"}),e.jsxs("div",{children:[e.jsx("p",{children:(u==null?void 0:u.address)||""}),e.jsx("p",{children:(u==null?void 0:u.city)||""})]})]}),e.jsxs("div",{className:"flex pt-1",children:[e.jsx("span",{className:"font-bold",style:{minWidth:"72px"},children:"Phone:"}),e.jsx("span",{children:(u==null?void 0:u.phone)||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"font-bold",style:{minWidth:"72px"},children:"Contact:"}),e.jsx("span",{children:(u==null?void 0:u.contact_person)||""})]})]}),e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 text-right",style:{minWidth:"200px"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"PO No:"}),e.jsx("span",{className:"ml-2",children:o.po_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"PO Date:"}),e.jsx("span",{className:"ml-2",children:F(o.po_date)})]}),e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"font-bold",children:"Expected Delivery:"}),e.jsx("span",{className:"ml-2",children:o.expected_delivery_date?F(o.expected_delivery_date):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Payment Terms:"}),e.jsx("span",{className:"ml-2",children:o.payment_terms||"N/A"})]})]})]})}),e.jsx("div",{children:e.jsxs("table",{className:"w-full border-2 border-black text-xs print:text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black bg-white",children:[e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"No."}),e.jsx("th",{className:"border-r border-black p-1.5 text-left font-bold print:p-1",children:"Product Name"}),e.jsx("th",{className:"border-r border-black p-1.5 text-left font-bold print:p-1",children:"Specification"}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"COA No."}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"Quantity"}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"UOM"}),e.jsxs("th",{className:"border-r border-black p-1.5 text-right font-bold print:p-1",children:["Unit Price (",k,")"]}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"Disc%"}),e.jsxs("th",{className:"p-1.5 text-right font-bold print:p-1",children:["Sub Total (",k,")"]})]})}),e.jsxs("tbody",{children:[N.map((s,d)=>{var m;return e.jsxs("tr",{className:"border-b border-black",children:[e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:d+1}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:((m=s.products)==null?void 0:m.product_name)||"Unknown Product"}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:s.specification||"-"}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:s.coa_code||"-"}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:s.quantity.toLocaleString()}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:s.unit}),e.jsx("td",{className:"border-r border-black p-1.5 text-right print:p-1",children:A(s.unit_price)}),e.jsxs("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:[s.discount_percent,"%"]}),e.jsx("td",{className:"p-1.5 text-right print:p-1",children:A(s.line_total)})]},s.id||d)}),N.length<2&&Array.from({length:2-N.length}).map((s,d)=>e.jsxs("tr",{className:"border-b border-black",children:[e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:" "}),e.jsx("td",{className:"p-1.5 print:p-1",children:" "})]},`empty-${d}`))]})]})}),e.jsxs("div",{className:"border-2 border-black border-t-0",children:[e.jsxs("div",{className:"flex items-stretch border-b-2 border-black",children:[e.jsxs("div",{className:"flex-1 p-2 border-r-2 border-black print:p-1.5",children:[e.jsx("p",{className:"text-xs font-bold print:text-[10px]",children:"Amount in words:"}),e.jsxs("p",{className:"text-xs mt-0.5 font-bold uppercase print:text-[10px] print:mt-0",children:[k," ",W(Math.round(o.total_amount))," ",o.currency==="USD"?"DOLLARS":"RUPIAH"]})]}),e.jsx("div",{className:"w-80 text-xs p-2 print:text-[10px] print:p-1.5",children:e.jsxs("div",{className:"flex justify-between border-t-2 border-black py-1 print:py-0.5",children:[e.jsx("span",{className:"font-bold",children:"Total Amount"}),e.jsx("span",{className:"font-bold text-sm print:text-xs",children:A(o.total_amount)})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-0 text-xs print:text-[10px]",children:[e.jsxs("div",{className:"p-3 border-r-2 border-black print:p-2",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Delivery Address:"}),e.jsx("p",{className:"whitespace-pre-line",children:o.delivery_address||"Same as company address"})]}),e.jsxs("div",{className:"p-3 print:p-2",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Authorized By:"}),e.jsx("p",{className:"font-semibold mb-10 print:mb-8",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("div",{className:"w-4/5 border-t border-black pt-1",children:"Authorized Signatory"})]})]})]}),(o.notes||o.terms_conditions)&&e.jsxs("div",{className:"mt-3 border-2 border-black p-2 print:mt-2 print:p-1.5",children:[o.notes&&e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-xs print:text-[10px]",children:[e.jsx("span",{className:"font-bold",children:"Notes: "}),e.jsx("span",{children:o.notes})]})}),o.terms_conditions&&e.jsx("div",{children:e.jsxs("p",{className:"text-xs print:text-[10px]",children:[e.jsx("span",{className:"font-bold",children:"Terms & Conditions: "}),e.jsx("span",{children:o.terms_conditions})]})})]})]})]})}),e.jsx("style",{children:`
        @media print {
          @page {
            size: A4 portrait;
            margin: 8mm;
          }

          .print\\:hidden {
            display: none !important;
          }

          body {
            margin: 0;
            padding: 0;
          }

          body * {
            visibility: hidden;
          }

          #po-print-content,
          #po-print-content * {
            visibility: visible;
          }

          #po-print-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
        }
      `})]})}function We(){const{user:o,profile:N}=me(),{t:p}=G(),{dateRange:O}=he(),[B,E]=g.useState([]),[A,F]=g.useState([]),[W,$]=g.useState([]),[q,H]=g.useState([]),[z,u]=g.useState(!0),[k,s]=g.useState(""),[d,m]=g.useState("all"),[w,c]=g.useState(!1),[n,i]=g.useState(!1),[h,v]=g.useState(null),[f,C]=g.useState(null),[b,T]=g.useState({supplier_id:"",po_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",delivery_address:"",currency:"IDR",exchange_rate:1,payment_terms:"Net 30",notes:"",terms_conditions:""}),[x,S]=g.useState([{line_number:1,product_id:"",description:"",quantity:0,unit:"",unit_price:0,discount_percent:0,discount_amount:0,line_total:0,quantity_received:0,quantity_pending:0,coa_code:"",specification:""}]);g.useEffect(()=>{M(),X(),ee()},[O.startDate,O.endDate]),g.useEffect(()=>{te()},[k,d,B]);const M=async()=>{try{u(!0);const{data:t,error:r}=await D.from("purchase_orders").select(`
          *,
          suppliers (
            id,
            company_name,
            contact_person,
            email,
            phone,
            address
          ),
          purchase_order_items (
            *,
            products (
              id,
              product_name,
              product_code,
              unit
            )
          )
        `).gte("po_date",O.startDate).lte("po_date",O.endDate).order("created_at",{ascending:!1});if(r)throw r;E(t||[])}catch(t){console.error("Error fetching purchase orders:",t.message),j({type:"error",title:"Error",message:p("errors.failedToLoadPurchaseOrders")})}finally{u(!1)}},X=async()=>{try{const{data:t,error:r}=await D.from("suppliers").select("id, company_name, contact_person, email, phone").eq("is_active",!0).order("company_name");if(r)throw r;$(t||[])}catch(t){console.error("Error fetching suppliers:",t.message)}},ee=async()=>{try{const{data:t,error:r}=await D.from("products").select("id, product_name, product_code, unit").eq("is_active",!0).order("product_name");if(r)throw r;H(t||[])}catch(t){console.error("Error fetching products:",t.message)}},te=()=>{let t=B;k&&(t=t.filter(r=>{var a;return r.po_number.toLowerCase().includes(k.toLowerCase())||((a=r.suppliers)==null?void 0:a.company_name.toLowerCase().includes(k.toLowerCase()))})),d!=="all"&&(t=t.filter(r=>r.status===d)),F(t)},re=t=>{const r={draft:{color:"bg-gray-100 text-gray-800",label:p("common.draft")},pending_approval:{color:"bg-yellow-100 text-yellow-800",label:p("common.pending")},approved:{color:"bg-green-100 text-green-800",label:p("common.approved")},partially_received:{color:"bg-blue-100 text-blue-800",label:"Partially Received"},received:{color:"bg-purple-100 text-purple-800",label:"Received"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"}},a=r[t]||r.draft;return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${a.color}`,children:a.label})},J=(t,r)=>r==="USD"?`$ ${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`Rp ${t.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`,se=()=>{C(null),T({supplier_id:"",po_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",delivery_address:"",currency:"IDR",exchange_rate:1,payment_terms:"Net 30",notes:"",terms_conditions:""}),S([{line_number:1,product_id:"",description:"",quantity:0,unit:"",unit_price:0,discount_percent:0,discount_amount:0,line_total:0,quantity_received:0,quantity_pending:0}]),c(!0)},ae=t=>{C(t),T({supplier_id:t.supplier_id,po_date:t.po_date,expected_delivery_date:t.expected_delivery_date||"",delivery_address:t.delivery_address||"",currency:t.currency,exchange_rate:t.exchange_rate,payment_terms:t.payment_terms||"Net 30",notes:t.notes||"",terms_conditions:t.terms_conditions||""}),S(t.purchase_order_items||[]),c(!0)},ne=(t,r)=>{const a=q.find(l=>l.id===r);if(a){const l=[...x];l[t]={...l[t],product_id:r,description:a.product_name,unit:a.unit,unit_price:0},R(t,l),S(l)}},R=(t,r)=>{const a=r[t],l=a.quantity*a.unit_price,P=l*a.discount_percent/100;r[t].discount_amount=P,r[t].line_total=l-P},le=()=>{S([...x,{line_number:x.length+1,product_id:"",description:"",quantity:0,unit:"",unit_price:0,discount_percent:0,discount_amount:0,line_total:0,quantity_received:0,quantity_pending:0,coa_code:"",specification:""}])},ie=t=>{x.length>1&&S(x.filter((r,a)=>a!==t))},V=()=>{const t=x.reduce((l,P)=>l+P.line_total,0);return{subtotal:t,tax:0,total:t}},ce=async t=>{if(t.preventDefault(),!b.supplier_id){j({type:"error",title:"Error",message:p("validation.selectSupplier")});return}if(!b.po_date){j({type:"error",title:"Error",message:p("validation.selectDate")});return}if(x.length===0||!x[0].product_id){j({type:"error",title:"Error",message:p("validation.addAtLeastOneProduct")});return}for(let r=0;r<x.length;r++){const a=x[r];if(!a.product_id){j({type:"error",title:"Error",message:p("validation.selectProductForLine")+` ${r+1}`});return}if(a.quantity<=0){j({type:"error",title:"Error",message:p("validation.enterValidQuantityForLine")+` ${r+1}`});return}if(a.unit_price<=0){j({type:"error",title:"Error",message:p("validation.enterValidPriceForLine")+` ${r+1}`});return}}try{const{subtotal:r,tax:a,total:l}=V(),P={...b,subtotal:r,tax_amount:a,total_amount:l,status:"draft",created_by:o==null?void 0:o.id};if(f){const{error:L}=await D.from("purchase_orders").update(P).eq("id",f.id);if(L)throw L;await D.from("purchase_order_items").delete().eq("po_id",f.id);const I=x.map((y,_)=>({po_id:f.id,line_number:_+1,product_id:y.product_id,description:y.description,quantity:y.quantity,unit:y.unit,unit_price:y.unit_price,discount_percent:y.discount_percent||0,discount_amount:y.discount_amount||0,line_total:y.line_total,quantity_received:0,coa_code:y.coa_code||null,specification:y.specification||null,notes:y.notes||null})),{error:U}=await D.from("purchase_order_items").insert(I);if(U)throw U;j({type:"success",title:"Success",message:p("success.saved")})}else{const{data:L,error:I}=await D.from("purchase_orders").insert(P).select().single();if(I)throw I;const U=x.map((_,xe)=>({po_id:L.id,line_number:xe+1,product_id:_.product_id,description:_.description,quantity:_.quantity,unit:_.unit,unit_price:_.unit_price,discount_percent:_.discount_percent||0,discount_amount:_.discount_amount||0,line_total:_.line_total,quantity_received:0,coa_code:_.coa_code||null,specification:_.specification||null,notes:_.notes||null})),{error:y}=await D.from("purchase_order_items").insert(U);if(y)throw y;j({type:"success",title:"Success",message:p("success.saved")})}c(!1),M()}catch(r){console.error("Error saving purchase order:",r),j({type:"error",title:"Error",message:p("errors.failedToSave")+": "+r.message})}},oe=async t=>{if(await Q({title:"Confirm",message:"Approve this Purchase Order?",variant:"warning"}))try{const{error:r}=await D.from("purchase_orders").update({status:"approved",approved_by:o==null?void 0:o.id,approved_at:new Date().toISOString()}).eq("id",t);if(r)throw r;j({type:"success",title:"Success",message:p("success.saved")}),M()}catch(r){console.error("Error approving PO:",r),j({type:"error",title:"Error",message:p("errors.failedToSave")+": "+r.message})}},de=async t=>{if(await Q({title:"Confirm",message:"Are you sure you want to delete this Purchase Order?",variant:"danger",confirmLabel:"Delete"}))try{const{error:r}=await D.from("purchase_orders").delete().eq("id",t);if(r)throw r;j({type:"success",title:"Success",message:p("success.deleted")}),M()}catch(r){console.error("Error deleting PO:",r),j({type:"error",title:"Error",message:p("errors.failedToDelete")+": "+r.message})}},pe=t=>{v(t),i(!0)};return z?e.jsx(Y,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Loading..."})})}):e.jsx(Y,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Purchase Orders"}),e.jsx("p",{className:"text-gray-600",children:"Manage procurement from suppliers"})]}),(N==null?void 0:N.role)!=="auditor_ca"&&e.jsxs("button",{onClick:se,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(we,{className:"h-5 w-5"}),"New Purchase Order"]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Search PO number, supplier...",value:k,onChange:t=>s(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})}),e.jsxs("select",{value:d,onChange:t=>m(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"pending_approval",children:"Pending Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"partially_received",children:"Partially Received"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"PO Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Supplier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Products"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(t=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.po_number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:_e(t.po_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(r=t.suppliers)==null?void 0:r.company_name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.jsx("div",{className:"flex flex-col gap-1 max-w-xs",children:t.purchase_order_items&&t.purchase_order_items.length>0?e.jsxs(e.Fragment,{children:[t.purchase_order_items.slice(0,2).map((a,l)=>{var P;return e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(ge,{className:"w-3 h-3 text-blue-500 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[((P=a.products)==null?void 0:P.product_name)||a.description,e.jsxs("span",{className:"text-gray-400 ml-1",children:["×",a.quantity]})]})]},l)}),t.purchase_order_items.length>2&&e.jsxs("span",{className:"text-xs text-gray-400 italic",children:["+",t.purchase_order_items.length-2," more"]})]}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"No items"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:J(t.total_amount,t.currency)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:re(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>pe(t),className:"text-blue-600 hover:text-blue-800",title:"View",children:e.jsx(Pe,{className:"h-5 w-5"})}),t.status==="draft"&&(N==null?void 0:N.role)!=="auditor_ca"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ae(t),className:"text-green-600 hover:text-green-800",title:"Edit",children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>de(t.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(K,{className:"h-5 w-5"})})]}),t.status==="draft"&&(N==null?void 0:N.role)==="admin"&&e.jsx("button",{onClick:()=>oe(t.id),className:"text-purple-600 hover:text-purple-800",title:"Approve",children:e.jsx(be,{className:"h-5 w-5"})})]})})]},t.id)})})]})}),A.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No purchase orders found"})]}),w&&e.jsx(fe,{isOpen:w,onClose:()=>c(!1),title:f?"Edit Purchase Order":"New Purchase Order",maxWidth:"max-w-6xl",children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Supplier *"}),e.jsx(Z,{value:b.supplier_id,onChange:t=>T({...b,supplier_id:t}),options:W.map(t=>({value:t.id,label:t.company_name})),placeholder:"Select Supplier",className:"text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"PO Date"}),e.jsx("input",{type:"date",value:b.po_date,onChange:t=>T({...b,po_date:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:b.expected_delivery_date,onChange:t=>T({...b,expected_delivery_date:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{value:b.currency,onChange:t=>T({...b,currency:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"IDR",children:"IDR"}),e.jsx("option",{value:"USD",children:"USD"})]})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsxs("select",{value:b.payment_terms,onChange:t=>T({...b,payment_terms:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"Net 7",children:"Net 7"}),e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"}),e.jsx("option",{value:"Net 90",children:"Net 90"}),e.jsx("option",{value:"Advance",children:"Advance Payment"}),e.jsx("option",{value:"50-50",children:"50% Advance & 50% on Delivery"}),e.jsx("option",{value:"COD",children:"Cash on Delivery"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700",children:"Items"}),e.jsx("button",{type:"button",onClick:le,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"+ Add Item"})]}),e.jsx("div",{className:"border border-gray-300 rounded overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"180px"},children:"Product"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"120px"},children:"Specification"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"80px"},children:"COA No"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"60px"},children:"Qty"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"50px"},children:"Unit"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"90px"},children:"Price"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"50px"},children:"Disc%"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-xs font-medium text-gray-600 whitespace-nowrap",style:{width:"100px"},children:"Total"}),e.jsx("th",{className:"px-2 py-1.5 text-center text-xs font-medium text-gray-600",style:{width:"40px"}})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1",children:e.jsx(Z,{value:t.product_id,onChange:a=>ne(r,a),options:q.map(a=>({value:a.id,label:a.product_name})),placeholder:"Select",className:"text-xs",required:!0})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"text",value:t.specification||"",onChange:a=>{const l=[...x];l[r].specification=a.target.value,S(l)},className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Specs"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"text",value:t.coa_code||"",onChange:a=>{const l=[...x];l[r].coa_code=a.target.value,S(l)},className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"COA"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"number",value:t.quantity,onChange:a=>{const l=[...x];l[r].quantity=parseFloat(a.target.value)||0,R(r,l),S(l)},className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-right",required:!0})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"text",value:t.unit,className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded bg-gray-50",readOnly:!0})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"number",value:t.unit_price,onChange:a=>{const l=[...x];l[r].unit_price=parseFloat(a.target.value)||0,R(r,l),S(l)},className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-right",required:!0})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"number",value:t.discount_percent,onChange:a=>{const l=[...x];l[r].discount_percent=parseFloat(a.target.value)||0,R(r,l),S(l)},className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 text-right"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("input",{type:"text",value:J(t.line_total,b.currency),readOnly:!0,className:"w-full px-1.5 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-right font-medium"})}),e.jsx("td",{className:"px-2 py-1 text-center",children:x.length>1&&e.jsx("button",{type:"button",onClick:()=>ie(r),className:"text-red-600 hover:text-red-800 p-0.5",children:e.jsx(K,{className:"h-4 w-4"})})})]},r))})]})})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"w-56",children:e.jsxs("div",{className:"flex justify-between text-base font-bold bg-gray-50 px-3 py-2 rounded",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:J(V().total,b.currency)})]})})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:b.notes,onChange:t=>T({...b,notes:t.target.value}),rows:2,className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Additional notes or instructions..."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[f?"Update":"Create"," Purchase Order"]})]})]})}),n&&h&&e.jsx(ke,{purchaseOrder:h,items:h.purchase_order_items||[],onClose:()=>{i(!1),v(null)}})]})})}export{We as default};
