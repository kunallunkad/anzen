import{r as b,j as e,X as Ie,u as $e,a as Oe,m as Fe,s as u,F as Te,T as Be,i as de,h as pe,f as g}from"./index-D377iWu2.js";import{L as ze}from"./Layout-B5e6WOHT.js";import{D as Me}from"./DataTable-BXltp17L.js";import{M as me}from"./Modal-XL444I2e.js";import{h as Re,E as Ue}from"./html2canvas.esm-Fmpx8z4e.js";import{P as He}from"./printer-CyDptLnp.js";import{D as Le}from"./download-Cw744MUe.js";import{S as X}from"./SearchableSelect-B1o4KxTG.js";import{f as Je}from"./dateFormat-E6B5rKFz.js";import{P as Ye}from"./plus-BUV76DvH.js";import{E as Ke}from"./eye-0GUlh4_A.js";import{S as Qe}from"./square-pen-Bq2ioL1R.js";import{X as ue}from"./x-circle-BISlCpkj.js";import"./search-C8aJjCFC.js";import"./chevron-up-CjxuCjv5.js";import"./chevron-down-D_LZ1jaB.js";function We({challan:d,items:T,onClose:ee}){var S,H,L,J,Y,P,K;const C=b.useRef(null),z=()=>{window.print()},te=async()=>{if(C.current)try{const p=await Re(C.current,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",windowWidth:C.current.scrollWidth,windowHeight:C.current.scrollHeight,onclone:O=>{const D=O.getElementById("challan-print-content");D&&(D.style.width="210mm")}}),f=p.toDataURL("image/png",1),v=new Ue("p","mm","a4"),j=v.internal.pageSize.getWidth(),N=v.internal.pageSize.getHeight(),I=p.width,$=p.height,k=j/I,A=$*k;if(A>N){let O=0,D=A;for(;D>0;)v.addImage(f,"PNG",0,O,j,A),D-=N,O-=N,D>0&&v.addPage()}else v.addImage(f,"PNG",0,0,j,A);v.save(`Delivery-Challan-${d.challan_number}.pdf`)}catch(p){console.error("Error generating PDF:",p),alert("Failed to generate PDF. Please try again.")}},M=p=>{const f=new Date(p),v=f.getDate(),j=f.getMonth()+1,N=f.getFullYear();return`${v.toString().padStart(2,"0")}-${j.toString().padStart(2,"0")}-${N}`},re=p=>{const f=new Date(p),j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()],N=f.getFullYear();return`${j} ${N}`},R=T.reduce((p,f)=>p+f.quantity,0),U=((H=(S=T[0])==null?void 0:S.products)==null?void 0:H.unit)||"kg";return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 print:static print:bg-white print:overflow-visible",children:[e.jsx("div",{className:"flex min-h-screen items-start justify-center p-4 pt-10 print:p-0 print:min-h-0 print:block",children:e.jsxs("div",{className:"relative w-full max-w-5xl bg-white shadow-xl print:shadow-none print:max-w-full",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-6 py-4 print:hidden",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Surat Jalan ",d.challan_number]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e.jsx(He,{className:"h-4 w-4"}),"Cetak"]}),e.jsxs("button",{onClick:te,className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:[e.jsx(Le,{className:"h-4 w-4"}),"PDF"]}),e.jsx("button",{onClick:ee,className:"rounded-lg bg-gray-100 p-2 text-gray-600 hover:bg-gray-200",children:e.jsx(Ie,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{id:"challan-print-content",ref:C,className:"p-8",children:[e.jsxs("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-16 flex items-center justify-center print:h-12 print:w-12",style:{backgroundColor:"#fff"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:"100%",height:"100%",viewBox:"0 0 15686.55 15480.24",style:{shapeRendering:"geometricPrecision",fillRule:"evenodd",clipRule:"evenodd"},children:e.jsxs("g",{children:[e.jsx("path",{fill:"#FDB763",d:"M69.94 10438.12l10353.39 0 0 -1798.67 1665.92 0 0 1868.6 0 320.44 0 4552.28c0,38.48 -31.45,69.94 -69.94,69.94l-11949.38 0c-38.48,0 -69.94,-31.45 -69.94,-69.94l0 -4872.72c0,-38.48 31.45,-69.94 69.94,-69.94zm1605.9 1710.15l8737.57 0c13.58,0 24.68,11.11 24.68,24.68l0 1719.84c0,13.58 -11.11,24.68 -24.68,24.68l-8737.57 0c-13.58,0 -24.68,-11.11 -24.68,-24.68l0 -1719.84c0,-13.58 11.11,-24.68 24.68,-24.68z"}),e.jsx("path",{fill:"#FDB763",d:"M15587.15 5136.67l-10353.49 0 0 1822.07 -1665.92 0 0 -1892.9 0 -324.61 0 -4611.43c0,-39 31.45,-70.87 69.94,-70.87l11949.47 0c38.48,0 69.94,31.87 69.94,70.87l0 4936.04c0,39 -31.45,70.83 -69.94,70.83zm-1605.9 -1732.36l-8737.67 0c-13.58,0 -24.68,-11.27 -24.68,-25l0 -1742.21c0,-13.74 11.11,-25 24.68,-25l8737.67 0c13.58,0 24.68,11.27 24.68,25l0 1742.21c0,13.74 -11.11,25 -24.68,25z"}),e.jsx("polygon",{fill:"#FD6D26",points:"-0,0 1651.16,0 1651.16,6929.27 15657.09,6929.27 15657.09,6958.74 15686.55,6958.74 15686.55,15480.24 14022.85,15480.24 14022.85,8639.45 1651.16,8639.45 -0,8639.45 -0,6929.27"})]})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold print:text-sm",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Komplek Ruko Metro Sunter Blok A1 NO.15, Jl. Metro Indah Raya,"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Kelurahan Papanggo, Kec. Tanjung Priok, Jakarta Utara - 14340"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Telp: (+62 21) 65832426"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("h2",{className:"text-3xl font-bold print:text-2xl",children:"SURAT JALAN"})})]}),e.jsxs("div",{className:"text-xs space-y-0.5 print:text-[10px] print:space-y-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No izin PBF"}),e.jsx("span",{className:"ml-16",children:": 27092400534390007"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No Sertifikasi CDOB"}),e.jsx("span",{className:"ml-4",children:": 270924005343900070001"})]})]})]}),e.jsx("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 flex-1",children:[e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"font-bold",children:"Company Name:"})}),e.jsx("div",{className:"ml-4 mb-2",children:e.jsx("p",{className:"font-semibold",children:((L=d.customers)==null?void 0:L.company_name)||""})}),e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"font-bold",children:"Address:"})}),e.jsxs("div",{className:"ml-4 mb-2",children:[e.jsx("p",{children:d.delivery_address||""}),e.jsx("p",{children:((J=d.customers)==null?void 0:J.city)||""})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-bold",children:"Phone:"}),e.jsx("span",{className:"ml-2",children:((Y=d.customers)==null?void 0:Y.phone)||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"No.Izin PBF:"}),e.jsx("span",{className:"ml-2",children:((P=d.customers)==null?void 0:P.pbf_license)||"-"})]})]}),e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 text-right w-64",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-bold",children:"Challan No: "}),e.jsx("span",{children:d.challan_number})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-bold",children:"Challan Date: "}),e.jsx("span",{children:M(d.challan_date)})]}),d.vehicle_number&&e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Vehicle No: "}),e.jsx("span",{children:d.vehicle_number})]})]})]})}),e.jsx("div",{className:"mb-2 border-2 border-black print:mb-1.5",children:e.jsxs("table",{className:"w-full border-collapse text-[9px] print:text-[8px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black",children:[e.jsx("th",{className:"border-r border-black px-1 py-1.5 text-center font-bold print:px-0.5 print:py-1",style:{width:"3%"},children:"No"}),e.jsxs("th",{className:"border-r border-black px-1 py-1.5 text-left font-bold print:px-0.5 print:py-1",style:{width:"27%"},children:["Nama Produk",e.jsx("br",{}),"Product Name"]}),e.jsxs("th",{className:"border-r border-black px-1 py-1.5 text-center font-bold print:px-0.5 print:py-1",style:{width:"13%"},children:["No Batch",e.jsx("br",{}),"Batch No"]}),e.jsxs("th",{className:"border-r border-black px-1 py-1.5 text-center font-bold print:px-0.5 print:py-1",style:{width:"8%"},children:["Exp.",e.jsx("br",{}),"Date"]}),e.jsxs("th",{className:"border-r border-black px-1 py-1.5 text-center font-bold print:px-0.5 print:py-1",style:{width:"15%"},children:["Kemasan",e.jsx("br",{}),"Packaging"]}),e.jsxs("th",{className:"border-r border-black px-1 py-1.5 text-center font-bold print:px-0.5 print:py-1",style:{width:"6%"},children:["Jml",e.jsx("br",{}),"Packs"]}),e.jsxs("th",{className:"px-1 py-1.5 text-center font-bold print:px-0.5 print:py-1",style:{width:"10%"},children:["Kuantitas",e.jsx("br",{}),"Quantity"]})]})}),e.jsxs("tbody",{children:[T.map((p,f)=>{var v,j,N,I,$;return e.jsxs("tr",{className:"border-b border-black",children:[e.jsx("td",{className:"border-r border-black px-1 py-1 text-center print:px-0.5 print:py-0.5",children:f+1}),e.jsx("td",{className:"border-r border-black px-1 py-1 print:px-0.5 print:py-0.5",children:(v=p.products)==null?void 0:v.product_name}),e.jsx("td",{className:"border-r border-black px-1 py-1 text-center print:px-0.5 print:py-0.5",children:(j=p.batches)==null?void 0:j.batch_number}),e.jsx("td",{className:"border-r border-black px-1 py-1 text-center print:px-0.5 print:py-0.5",children:(N=p.batches)!=null&&N.expiry_date?re(p.batches.expiry_date):"-"}),e.jsx("td",{className:"border-r border-black px-1 py-1 text-center print:px-0.5 print:py-0.5",children:p.pack_type&&p.pack_size&&p.number_of_packs?`${p.pack_size} ${((I=p.products)==null?void 0:I.unit)||"kg"}/${p.pack_type}`:p.pack_type&&p.pack_size?`${p.pack_size} ${p.pack_type}`:"-"}),e.jsx("td",{className:"border-r border-black px-1 py-1 text-center print:px-0.5 print:py-0.5",children:p.number_of_packs||"-"}),e.jsxs("td",{className:"px-1 py-1 text-center print:px-0.5 print:py-0.5",children:[p.quantity.toLocaleString()," ",(($=p.products)==null?void 0:$.unit)||U]})]},p.id)}),e.jsxs("tr",{className:"border-t-2 border-black bg-gray-50 font-bold",children:[e.jsx("td",{colSpan:6,className:"border-r border-black px-1 py-1 text-right print:px-0.5 print:py-0.5",children:"Total Kuantitas / Total Quantity:"}),e.jsxs("td",{className:"px-1 py-1 text-center print:px-0.5 print:py-0.5",children:[R.toLocaleString()," ",U]})]})]})]})}),e.jsxs("div",{className:"mb-2 p-1.5 print:mb-1.5 print:p-1",children:[e.jsx("p",{className:"text-[9px] font-semibold print:text-[8px]",children:"Catatan / Notes:"}),d.notes?e.jsx("p",{className:"text-[9px] print:text-[8px] mt-0.5",children:d.notes}):e.jsx("p",{className:"text-[9px] print:text-[8px] mt-0.5",children:"Produk dikirim dalam kondisi sesuai persyaratan penyimpanan / Goods are delivered under controlled storage conditions."})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 print:gap-1.5",children:[e.jsxs("div",{className:"border-2 border-black p-1.5 text-center print:p-1",children:[e.jsxs("div",{className:"mb-1.5 text-[9px] font-semibold print:mb-1 print:text-[8px]",children:["Disiapkan Oleh",e.jsx("br",{}),"Prepared By"]}),e.jsx("div",{className:"mb-8 print:mb-6",children:e.jsx("div",{className:"h-10 print:h-8"})}),e.jsxs("div",{className:"border-t-2 border-black pt-1.5 print:pt-1",children:[e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Tanda Tangan & Tanggal"}),e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Signature & Date"}),e.jsx("p",{className:"text-[8px] font-semibold mt-0.5 print:text-[7px] print:mt-0",children:"PT. SHUBHAM ANZEN PHARMA JAYA"})]})]}),e.jsxs("div",{className:"border-2 border-black p-1.5 text-center print:p-1",children:[e.jsxs("div",{className:"mb-1.5 text-[9px] font-semibold print:mb-1 print:text-[8px]",children:["Dikirim Oleh",e.jsx("br",{}),"Delivered By"]}),e.jsx("div",{className:"mb-8 print:mb-6",children:e.jsx("div",{className:"h-10 print:h-8"})}),e.jsxs("div",{className:"border-t-2 border-black pt-1.5 print:pt-1",children:[e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Tanda Tangan & Tanggal"}),e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Signature & Date"}),e.jsx("p",{className:"text-[8px] font-semibold mt-0.5 print:text-[7px] print:mt-0",children:"PT. SHUBHAM ANZEN PHARMA JAYA"})]})]}),e.jsxs("div",{className:"border-2 border-black p-1.5 text-center print:p-1",children:[e.jsxs("div",{className:"mb-1.5 text-[9px] font-semibold print:mb-1 print:text-[8px]",children:["Farmasi",e.jsx("br",{}),"Pharmacist"]}),e.jsx("div",{className:"mb-8 print:mb-6",children:e.jsx("div",{className:"h-10 print:h-8"})}),e.jsxs("div",{className:"border-t-2 border-black pt-1.5 print:pt-1",children:[e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Tanda Tangan & Tanggal"}),e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Signature & Date"}),e.jsx("p",{className:"text-[8px] font-semibold mt-0.5 print:text-[7px] print:mt-0",children:"PT. SHUBHAM ANZEN PHARMA JAYA"})]})]}),e.jsxs("div",{className:"border-2 border-black p-1.5 text-center print:p-1",children:[e.jsxs("div",{className:"mb-1.5 text-[9px] font-semibold print:mb-1 print:text-[8px]",children:["Diterima Oleh",e.jsx("br",{}),"Received By"]}),e.jsx("div",{className:"mb-8 print:mb-6",children:e.jsx("div",{className:"h-10 print:h-8"})}),e.jsxs("div",{className:"border-t-2 border-black pt-1.5 print:pt-1",children:[e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Tanda Tangan & Tanggal"}),e.jsx("p",{className:"text-[9px] print:text-[8px]",children:"Signature & Date"}),e.jsx("p",{className:"text-[8px] font-semibold mt-0.5 print:text-[7px] print:mt-0",children:((K=d.customers)==null?void 0:K.company_name)||""})]})]})]})]})]})}),e.jsx("style",{children:`
        @media print {
          @page {
            size: A4 portrait;
            margin: 8mm;
          }

          .sticky {
            display: none !important;
          }

          body {
            margin: 0;
            padding: 0;
          }

          body * {
            visibility: hidden;
          }

          #challan-print-content,
          #challan-print-content * {
            visibility: visible;
          }

          #challan-print-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            page-break-inside: avoid;
            page-break-after: auto;
          }

          #challan-print-content > div {
            page-break-inside: avoid;
          }

          table {
            page-break-inside: auto;
          }

          tr {
            page-break-inside: avoid;
            page-break-after: auto;
          }

          thead {
            display: table-header-group;
          }

          tfoot {
            display: table-footer-group;
          }
        }
      `})]})}const Ve=d=>d?new Date(d)<new Date:!1;function ut(){const{profile:d}=$e(),{setCurrentPage:T,setNavigationData:ee}=Oe(),{dateRange:C}=Fe(),[z,te]=b.useState([]),[M,re]=b.useState([]),[R,U]=b.useState([]),[S,H]=b.useState([]),[L,J]=b.useState(!0),[Y,P]=b.useState(!1),[K,p]=b.useState(!1),[f,v]=b.useState(null),[j,N]=b.useState([]),[I,$]=b.useState(null),[k,A]=b.useState(null),[O,D]=b.useState([]),[le,Q]=b.useState(!1),[W,V]=b.useState(""),[ne,Z]=b.useState(null),[c,w]=b.useState({challan_number:"",customer_id:"",sales_order_id:"",challan_date:new Date().toISOString().split("T")[0],delivery_address:"",vehicle_number:"",driver_name:"",notes:""}),[ae,he]=b.useState([]),[_,E]=b.useState([{product_id:"",batch_id:"",quantity:0,pack_size:null,pack_type:null,number_of_packs:null}]);b.useEffect(()=>{B(),_e(),ye(),ie(),be()},[C.startDate,C.endDate]);const xe=async t=>{try{let r=u.from("sales_orders").select(`
          id,
          so_number,
          customer_id,
          status,
          customers(company_name)
        `).in("status",["approved","stock_reserved","shortage","pending_delivery"]).eq("is_archived",!1).order("so_date",{ascending:!1});t&&(r=r.eq("customer_id",t));const{data:s,error:i}=await r;if(i)throw i;he(s||[])}catch(r){console.error("Error loading sales orders:",r)}},be=async()=>{try{const{data:t,error:r}=await u.from("app_settings").select("*").limit(1).maybeSingle();if(r)throw r;$(t)}catch(t){console.error("Error loading company settings:",t)}},B=async()=>{try{const{data:t,error:r}=await u.from("delivery_challans").select("*, customers(company_name, address, city, phone, pbf_license)").gte("challan_date",C.startDate).lte("challan_date",C.endDate).order("challan_date",{ascending:!1});if(r)throw r;const{data:s,error:i}=await u.from("dc_invoicing_summary").select("*");i&&console.error("Error loading invoicing status:",i);const o=new Map;(s||[]).forEach(l=>{o.set(l.challan_id,{status:l.dc_status,total_items:l.total_items,not_invoiced_items:l.not_invoiced_items,partially_invoiced_items:l.partially_invoiced_items,fully_invoiced_items:l.fully_invoiced_items,linked_invoices:l.linked_invoice_numbers||[]})});const a=(t||[]).map(l=>{const n=o.get(l.id);return{...l,invoicing_status:(n==null?void 0:n.status)||"not_invoiced",total_items:(n==null?void 0:n.total_items)||0,invoiced_items:(n==null?void 0:n.fully_invoiced_items)+(n==null?void 0:n.partially_invoiced_items)||0,linked_invoices:(n==null?void 0:n.linked_invoices)||[]}});te(a)}catch(t){console.error("Error loading challans:",t)}finally{J(!1)}},ge=async()=>{try{const{data:t,error:r}=await u.rpc("get_current_financial_year");if(r)return console.error("Error getting financial year:",r),`DO-${new Date().getFullYear().toString().slice(-2)}-0001`;const s="DO",{data:i}=await u.from("delivery_challans").select("challan_number").or(`challan_number.like.DO-${t}%,challan_number.like.DC-${t}%`);let o=1;if(i&&i.length>0){const l=i.map(n=>{const h=n.challan_number.match(/(\d+)$/);return h?parseInt(h[1],10):0}).filter(n=>!isNaN(n));l.length>0&&(o=Math.max(...l)+1)}const a=String(o).padStart(4,"0");return`${s}-${t}-${a}`}catch(t){return console.error("Error generating challan number:",t),`DO-${new Date().getFullYear().toString().slice(-2)}-0001`}},_e=async()=>{try{const{data:t,error:r}=await u.from("customers").select("id, company_name, address, city").eq("is_active",!0).order("company_name");if(r)throw r;re(t||[])}catch(t){console.error("Error loading customers:",t)}},ye=async()=>{try{const{data:t,error:r}=await u.from("products").select("id, product_name, product_code, unit").eq("is_active",!0).order("product_name");if(r)throw r;U(t||[])}catch(t){console.error("Error loading products:",t)}},ie=async()=>{try{const{data:t,error:r}=await u.from("batches").select("id, batch_number, product_id, current_stock, reserved_stock, expiry_date, packaging_details, import_date").eq("is_active",!0).gt("current_stock",0).order("import_date",{ascending:!0});if(r)throw r;H(t||[])}catch(t){console.error("Error loading batches:",t)}},se=async t=>{try{const{data:r,error:s}=await u.from("delivery_challan_items").select("*, products(product_name, product_code, unit), batches(batch_number, expiry_date, packaging_details, current_stock)").eq("challan_id",t);if(s)throw s;return r||[]}catch(r){return console.error("Error loading challan items:",r),[]}},fe=t=>S.filter(s=>s.product_id===t&&!Ve(s.expiry_date)).sort((s,i)=>{const o=new Date(s.import_date).getTime(),a=new Date(i.import_date).getTime();return o-a})[0]||null,ve=t=>{const r=M.find(s=>s.id===t);r&&(w({...c,customer_id:t,sales_order_id:"",delivery_address:`${r.address}, ${r.city}`}),xe(t))},je=async t=>{if(w({...c,sales_order_id:t}),t){const r=ae.find(s=>s.id===t);if(r){w(s=>({...s,customer_id:r.customer_id}));try{const{data:s,error:i}=await u.from("sales_order_items").select(`
              id,
              product_id,
              quantity,
              products(product_name)
            `).eq("sales_order_id",t);if(i)throw i;if(s&&s.length>0){const o=s.map(a=>{const l=S.filter(x=>x.product_id===a.product_id&&x.current_stock-(x.reserved_stock||0)>0),n=l.length>0?l[0]:null;if(!n)return{product_id:a.product_id,batch_id:"",quantity:a.quantity,pack_size:null,pack_type:null,number_of_packs:null};let h=null,m=null,y=null;if(n.packaging_details){const x=n.packaging_details.match(/(\d+)\s+(\w+)s?\s+x\s+(\d+(?:\.\d+)?)kg/i);x&&(y=parseInt(x[1],10),m=x[2].toLowerCase(),h=parseFloat(x[3]))}return{product_id:a.product_id,batch_id:n.id,quantity:a.quantity,pack_size:h,pack_type:m,number_of_packs:y||1}});E(o)}}catch(s){console.error("Error loading SO items:",s),g({type:"error",title:"Error",message:"Failed to load Sales Order items. Please try again."})}}}else E([{product_id:"",batch_id:"",quantity:0,pack_size:null,pack_type:null,number_of_packs:null}])},ce=(t,r)=>{const s=S.find(i=>i.id===r);if(s){const i=[..._];let o=null,a=null,l=null;if(s.packaging_details){const h=s.packaging_details.match(/(\d+)\s+(\w+)s?\s+x\s+(\d+(?:\.\d+)?)kg/i);if(h){a=h[2].toLowerCase(),o=parseFloat(h[3]);const m=s.current_stock-(s.reserved_stock||0);o&&o>0?l=Math.floor(m/o)>=1?1:0:l=1}}const n=o&&l?o*l:0;i[t]={...i[t],batch_id:r,pack_size:o,pack_type:a,number_of_packs:l||1,quantity:n},E(i)}},Ne=(t,r)=>{const s=[..._],i=s[t];i.pack_size&&(s[t]={...i,number_of_packs:r,quantity:i.pack_size*r},E(s))},ke=()=>{E([..._,{product_id:"",batch_id:"",quantity:0,pack_size:null,pack_type:null,number_of_packs:null}])},we=t=>{_.length>1&&E(_.filter((r,s)=>s!==t))},Ce=async t=>{const{data:r}=await u.from("delivery_challans").select("*").eq("id",t.id).single();A(t),w({challan_number:t.challan_number,customer_id:t.customer_id,sales_order_id:(r==null?void 0:r.sales_order_id)||"",challan_date:t.challan_date,delivery_address:t.delivery_address,vehicle_number:t.vehicle_number||"",driver_name:t.driver_name||"",notes:t.notes||""});const s=await se(t.id);D(s),s.length>0&&E(s.map(i=>({product_id:i.product_id,batch_id:i.batch_id,quantity:i.quantity,pack_size:i.pack_size,pack_type:i.pack_type,number_of_packs:i.number_of_packs}))),P(!0)},Se=async t=>{if(t.preventDefault(),_.filter(a=>!a.product_id||!a.batch_id||a.quantity<=0).length>0){g({type:"error",title:"Error",message:"Please select product, batch, and enter quantity for all items before saving."});return}if(_.filter(a=>!a.batch_id||a.batch_id==="").length>0){g({type:"error",title:"Error",message:"Some items do not have a batch selected. Please select a batch for all items."});return}if(_.filter(a=>!a.product_id||a.product_id==="").length>0){g({type:"error",title:"Error",message:"Some items do not have a product selected. Please select a product for all items."});return}const o=new Map;for(const a of _){const l=o.get(a.batch_id)||0;o.set(a.batch_id,l+a.quantity)}for(const[a,l]of o.entries()){const n=S.find(h=>h.id===a);if(n){let h=n.current_stock-(n.reserved_stock||0);if(k){const m=O.filter(y=>y.batch_id===a).reduce((y,x)=>y+x.quantity,0);h+=m}if(l>h){const m=R.find(x=>{var F;return x.id===((F=_.find(q=>q.batch_id===a))==null?void 0:F.product_id)}),y=(m==null?void 0:m.unit)||"kg";g({type:"error",title:"Error",message:`Insufficient available stock for batch ${n.batch_number}!

Product: ${(m==null?void 0:m.product_name)||"Unknown"}
Batch: ${n.batch_number}
Available: ${h} ${y}
Total Requested (across all items): ${l} ${y}

You are using this batch in multiple items. Please reduce quantities or select different batches.`});return}}}try{const{data:{user:a}}=await u.auth.getUser();if(!a)throw new Error("Not authenticated");let l;if(k){const n={customer_id:c.customer_id,sales_order_id:c.sales_order_id||null,challan_date:c.challan_date,delivery_address:c.delivery_address,vehicle_number:c.vehicle_number||null,driver_name:c.driver_name||null,notes:c.notes||null},{data:h,error:m}=await u.from("delivery_challans").update(n).eq("id",k.id).select().single();if(m)throw m;const y=_.map(q=>({product_id:q.product_id,batch_id:q.batch_id,quantity:q.quantity,pack_size:q.pack_size,pack_type:q.pack_type,number_of_packs:q.number_of_packs})),{data:x,error:F}=await u.rpc("edit_delivery_challan",{p_challan_id:k.id,p_new_items:y});if(F)throw console.error("RPC Error:",F),new Error(`Failed to update DC: ${F.message}`);if(!(x!=null&&x.success))throw console.error("RPC Result Error:",x==null?void 0:x.error),new Error((x==null?void 0:x.error)||"Failed to update DC items");l=h.id}else{const n={challan_number:c.challan_number,customer_id:c.customer_id,sales_order_id:c.sales_order_id||null,challan_date:c.challan_date,delivery_address:c.delivery_address,vehicle_number:c.vehicle_number||null,driver_name:c.driver_name||null,notes:c.notes||null,approval_status:"pending_approval",created_by:a.id},{data:h,error:m}=await u.from("delivery_challans").insert([n]).select().single();if(m)throw m;l=h.id}if(!k){const n=_.map(m=>({challan_id:l,product_id:m.product_id,batch_id:m.batch_id,quantity:m.quantity,pack_size:m.pack_size,pack_type:m.pack_type,number_of_packs:m.number_of_packs})),{error:h}=await u.from("delivery_challan_items").insert(n);if(h)throw await u.from("delivery_challans").delete().eq("id",l),h}if(!k&&c.sales_order_id){const n=_.map(y=>({product_id:y.product_id,quantity:y.quantity})),{error:h}=await u.rpc("update_so_delivered_quantity_atomic",{p_sales_order_id:c.sales_order_id,p_dc_items:n});if(h)throw h;const{data:m}=await u.from("sales_orders").select("status").eq("id",c.sales_order_id).single();(m==null?void 0:m.status)==="delivered"&&await u.from("sales_orders").update({is_archived:!0,archived_at:new Date().toISOString(),archived_by:a.id,archive_reason:"Delivery Challan created and all items delivered"}).eq("id",c.sales_order_id)}P(!1),G(),B(),ie(),g({type:"success",title:"Success",message:`Delivery Challan ${k?"updated":"created"} successfully!`})}catch(a){console.error("Error saving challan:",a),console.error("Full error object:",JSON.stringify(a,null,2));const l=(a==null?void 0:a.message)||(a==null?void 0:a.error_description)||(a==null?void 0:a.msg)||"Unknown error occurred";l.toLowerCase().includes("insufficient stock")?g({type:"error",title:"Error",message:`Cannot save: ${l}

Please reduce quantities or select different batches with more stock.`}):l.includes("batch_id")?g({type:"error",title:"Error",message:`Error: Invalid batch selection.

${l}

Please ensure all items have a valid batch selected.`}):l.includes("foreign key")?g({type:"error",title:"Error",message:`Error: Invalid product or batch selection.

${l}

Please check your selections.`}):g({type:"error",title:"Error",message:`Failed to save challan:

${l}`})}},De=async t=>{if(await pe({title:"Confirm",message:"Are you sure you want to delete this delivery challan? This will revert the linked Sales Order status.",variant:"danger",confirmLabel:"Delete"}))try{const{data:r}=await u.from("delivery_challans").select("sales_order_id, id").eq("id",t).single(),{error:s}=await u.from("delivery_challans").delete().eq("id",t);if(s)throw s;r!=null&&r.sales_order_id&&await u.from("sales_orders").update({status:"pending_delivery",is_archived:!1,archived_at:null,archived_by:null,archive_reason:null}).eq("id",r.sales_order_id),B(),g({type:"success",title:"Success",message:"Delivery Challan deleted successfully. Sales Order status has been reverted."})}catch(r){console.error("Error deleting challan:",r),g({type:"error",title:"Error",message:"Failed to delete challan. Please try again."})}},Ee=async t=>{if(await pe({title:"Confirm",message:"Approve this Delivery Challan? Stock will be deducted and it will be available for invoice creation.",variant:"warning"}))try{const{data:{user:r}}=await u.auth.getUser();if(!r)throw new Error("Not authenticated");const{error:s}=await u.from("delivery_challans").update({approval_status:"approved",approved_by:r.id,approved_at:new Date().toISOString()}).eq("id",t);if(s){console.error("Approval error:",s);const i=s.message||s.hint||"Unknown error";throw new Error(i)}g({type:"success",title:"Success",message:"Delivery Challan approved successfully!"}),B()}catch(r){console.error("Error approving challan:",r);const s=(r==null?void 0:r.message)||"Unknown error";s.toLowerCase().includes("insufficient stock")?g({type:"error",title:"Error",message:`Cannot approve - Insufficient Stock!

${s}

Please edit the DC and reduce quantities or select different batches.`}):g({type:"error",title:"Error",message:`Failed to approve challan:

${s}`})}},Pe=async()=>{if(!ne||!W.trim()){g({type:"error",title:"Error",message:"Please enter a rejection reason"});return}try{const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:r}=await u.from("delivery_challans").update({approval_status:"rejected",rejected_by:t.id,rejected_at:new Date().toISOString(),rejection_reason:W}).eq("id",ne);if(r)throw r;g({type:"success",title:"Success",message:"Delivery Challan rejected"}),Q(!1),V(""),Z(null),B()}catch(t){console.error("Error rejecting challan:",t.message),g({type:"error",title:"Error",message:"Failed to reject challan"})}},G=()=>{A(null),D([]),w({challan_number:"",customer_id:"",sales_order_id:"",challan_date:new Date().toISOString().split("T")[0],delivery_address:"",vehicle_number:"",driver_name:"",notes:""}),E([{product_id:"",batch_id:"",quantity:0,pack_size:null,pack_type:null,number_of_packs:null}])},qe=[{key:"challan_number",label:"DO Number"},{key:"customer",label:"Customer",render:(t,r)=>{var s;return e.jsx("div",{className:"font-medium",children:(s=r.customers)==null?void 0:s.company_name})}},{key:"challan_date",label:"Date",render:(t,r)=>Je(r.challan_date)},{key:"approval_status",label:"Status / Approval",render:(t,r)=>{const s={pending_approval:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"},i={pending_approval:"Pending Approval",approved:"Approved",rejected:"Rejected"};return e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s[r.approval_status]}`,children:i[r.approval_status]}),r.approval_status==="pending_approval"&&(d==null?void 0:d.role)==="admin"&&e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),Ee(r.id)},className:"p-2 bg-green-100 hover:bg-green-200 rounded-lg transition-colors",title:"Approve Delivery Challan",children:e.jsx(de,{className:"w-6 h-6 text-green-600"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),Z(r.id),Q(!0)},className:"p-2 bg-red-100 hover:bg-red-200 rounded-lg transition-colors",title:"Reject Delivery Challan",children:e.jsx(ue,{className:"w-6 h-6 text-red-600"})})]}),r.approval_status==="approved"&&e.jsx(de,{className:"w-5 h-5 text-green-600 ml-2",title:"Approved"}),r.approval_status==="rejected"&&e.jsx(ue,{className:"w-5 h-5 text-red-600 ml-2",title:"Rejected"})]})}},{key:"invoicing_status",label:"Invoicing Status",render:(t,r)=>{const s={not_invoiced:"bg-gray-100 text-gray-700",partially_invoiced:"bg-yellow-100 text-yellow-700",fully_invoiced:"bg-blue-100 text-blue-700"},i={not_invoiced:"Not Invoiced",partially_invoiced:"Partially Invoiced",fully_invoiced:"Fully Invoiced"},o=r.invoicing_status||"not_invoiced";return e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s[o]}`,children:i[o]}),r.total_items>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:[r.invoiced_items||0,"/",r.total_items," items invoiced"]}),r.linked_invoices&&r.linked_invoices.length>0&&e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:r.linked_invoices.join(", ")})]})}}],oe=(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="accounts"||(d==null?void 0:d.role)==="sales"||(d==null?void 0:d.role)==="warehouse",Ae={total:z.length};return e.jsx(ze,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Delivery Challan (Surat Jalan)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage delivery orders and dispatch records"})]}),oe&&e.jsxs("button",{onClick:async()=>{G();const t=await ge();w(r=>({...r,challan_number:t})),P(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Create Delivery Challan"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Delivery Challans"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:Ae.total})]}),e.jsx(Me,{columns:qe,data:z,loading:L,actions:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const r=await se(t.id);v(t),N(r),p(!0)},className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"View Challan",children:e.jsx(Ke,{className:"w-4 h-4"})}),oe&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{const r=await se(t.id);ee({sourceType:"delivery_challan",customerId:t.customer_id,challanNumber:t.challan_number,challanId:t.id,items:r}),T("sales")},className:"p-1 text-purple-600 hover:bg-purple-50 rounded",title:"Create Invoice from DO",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ce(t),className:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Edit Challan",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>De(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete Challan",children:e.jsx(Be,{className:"w-4 h-4"})})]})]})}),e.jsx(me,{isOpen:Y,onClose:()=>{P(!1),G()},title:k?`Edit DC - ${c.challan_number}`:`Create DC - ${c.challan_number}`,size:"xl",children:e.jsxs("form",{onSubmit:Se,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsx(X,{value:c.customer_id,onChange:ve,options:M.map(t=>({value:t.id,label:t.company_name})),placeholder:"Select Customer",required:!0,disabled:!!c.sales_order_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Linked Sales Order"}),e.jsx(X,{value:c.sales_order_id,onChange:je,options:[{value:"",label:"No Sales Order / Manual Entry"},...ae.map(t=>({value:t.id,label:`${t.so_number} (${t.status})`}))],placeholder:"Select Sales Order",disabled:!c.customer_id}),c.customer_id&&ae.length===0&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"âš  No active sales orders for this customer"}),!c.customer_id&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a customer first"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle Number"}),e.jsx("input",{type:"text",value:c.vehicle_number,onChange:t=>w({...c,vehicle_number:t.target.value}),className:"w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"B 1234 XYZ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driver Name"}),e.jsx("input",{type:"text",value:c.driver_name,onChange:t=>w({...c,driver_name:t.target.value}),className:"w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Driver name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",value:c.challan_date,onChange:t=>w({...c,challan_date:t.target.value}),className:"w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Address *"}),e.jsx("textarea",{value:c.delivery_address,onChange:t=>w({...c,delivery_address:t.target.value}),className:"w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:2,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:t=>w({...c,notes:t.target.value}),className:"w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"Additional notes..."})]})]}),e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Items to Dispatch"}),e.jsx("button",{type:"button",onClick:ke,className:"text-sm px-3 py-1 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg font-medium transition-colors",children:"+ Add Item"})]}),e.jsx("div",{className:"space-y-2",children:_.map((t,r)=>{const s=new Map;_.forEach((a,l)=>{if(l!==r&&a.batch_id){const n=s.get(a.batch_id)||0;s.set(a.batch_id,n+a.quantity)}});const i=S.filter(a=>{const l=a.current_stock-(a.reserved_stock||0),n=s.get(a.id)||0;return a.product_id===t.product_id&&l-n>0}),o=S.find(a=>a.id===t.batch_id);return e.jsxs("div",{className:"relative p-2 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-0.5",children:"Product *"}),e.jsx(X,{value:t.product_id,onChange:a=>{const l=[..._];l[r]={...l[r],product_id:a,batch_id:""},E(l)},options:R.map(a=>({value:a.id,label:a.product_name})),placeholder:"Select Product",className:"text-xs",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("label",{className:"block text-xs text-gray-600",children:"Batch *"}),t.product_id&&i.length>0&&e.jsx("button",{type:"button",onClick:()=>{const a=fe(t.product_id);a&&ce(r,a.id)},className:"text-[10px] text-blue-600 hover:text-blue-700 font-medium",title:"Select oldest batch (FIFO)",children:"Use FIFO"})]}),t.product_id?i.length>0?e.jsx(X,{value:t.batch_id,onChange:a=>ce(r,a),options:i.map((a,l)=>{const n=l===0?" ðŸ”„":"",h=a.current_stock-(a.reserved_stock||0),m=s.get(a.id)||0,y=h-m;return{value:a.id,label:`${a.batch_number} (Avl: ${y}kg)${n}`}}),placeholder:"Select Batch",className:"text-xs",required:!0}):e.jsxs("div",{className:"w-full px-2 py-1 text-xs border border-red-300 rounded bg-red-50 text-red-700 flex items-center gap-1",children:[e.jsx("span",{children:"âš "}),e.jsx("span",{children:"No stock available"})]}):e.jsx("div",{className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100 text-gray-400",children:"Select product first"})]})]}),o&&e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-[10px] border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5 text-left border-r border-gray-300",children:"Batch"}),e.jsx("th",{className:"px-1 py-0.5 text-left border-r border-gray-300",children:"Expiry"}),e.jsx("th",{className:"px-1 py-0.5 text-left border-r border-gray-300",children:"Packaging"}),e.jsx("th",{className:"px-1 py-0.5 text-right border-r border-gray-300",children:"Total"}),e.jsx("th",{className:"px-1 py-0.5 text-right font-semibold",children:"Available"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"bg-white",children:[e.jsx("td",{className:"px-1 py-0.5 border-r border-gray-300",children:o.batch_number}),e.jsx("td",{className:"px-1 py-0.5 border-r border-gray-300",children:o.expiry_date?new Date(o.expiry_date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"}):"-"}),e.jsx("td",{className:"px-1 py-0.5 border-r border-gray-300",children:o.packaging_details||"-"}),e.jsxs("td",{className:"px-1 py-0.5 text-right border-r border-gray-300",children:[o.current_stock,"kg"]}),e.jsxs("td",{className:"px-1 py-0.5 text-right font-bold text-green-600",children:[(()=>{const a=o.current_stock-(o.reserved_stock||0),l=s.get(o.id)||0;return a-l})(),"kg"]})]})})]})})}),t.pack_size&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-0.5",children:"No. of Packs *"}),e.jsx("input",{type:"number",value:t.number_of_packs||"",onChange:a=>Ne(r,Number(a.target.value)),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-0.5",children:"Pack Size"}),e.jsx("input",{type:"text",value:`${t.pack_size} kg`,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-0.5",children:"Total Qty (Kg)"}),e.jsx("input",{type:"text",value:`${t.quantity} kg`,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100",disabled:!0})]})]}),_.length>1&&e.jsx("button",{type:"button",onClick:()=>we(r),className:"absolute top-1 right-1 text-xs text-red-600 hover:text-red-800 bg-white px-2 py-0.5 rounded border border-red-300 shadow-sm",children:"Remove"})]},r)})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-3 border-t mt-3",children:[e.jsx("button",{type:"button",onClick:()=>{P(!1),G()},className:"px-5 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm",children:k?"Update Challan":"Create Challan"})]})]})}),K&&f&&e.jsx(We,{challan:f,items:j,onClose:()=>p(!1),companySettings:I}),le&&e.jsx(me,{isOpen:le,onClose:()=>{Q(!1),V(""),Z(null)},title:"Reject Delivery Challan",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:W,onChange:t=>V(t.target.value),rows:4,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"Enter reason for rejecting this delivery challan..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{Q(!1),V(""),Z(null)},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Pe,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",disabled:!W.trim(),children:"Reject Challan"})]})]})})]})})}export{ut as DeliveryChallan};
