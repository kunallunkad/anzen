import{d as w,r as o,s as v,j as e,A as D}from"./index-D377iWu2.js";import{T as S,U as O}from"./Layout-B5e6WOHT.js";import{D as k}from"./download-Cw744MUe.js";import{B as T}from"./building-2-D6r6vIE5.js";import"./dateFormat-E6B5rKFz.js";function P(){const{t:s}=w(),[c,m]=o.useState("customer"),[l,p]=o.useState([]),[u,g]=o.useState(!1);o.useEffect(()=>{h()},[c]);const h=async()=>{g(!0);try{const t=c==="customer"?"get_customer_outstanding_summary":"get_supplier_outstanding_summary",{data:n,error:d}=await v.rpc(t);if(d)throw d;p((n||[]).map(i=>({id:i.id,name:i.name,email:i.email,total_outstanding:Number(i.total_outstanding)||0,age_0_30:Number(i.age_0_30)||0,age_31_60:Number(i.age_31_60)||0,age_61_90:Number(i.age_61_90)||0,age_90_plus:Number(i.age_90_plus)||0,oldest_invoice_date:i.oldest_invoice_date})))}catch(t){console.error("Error loading outstanding:",t)}finally{g(!1)}},a=t=>`Rp ${t.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`,_=()=>{const t=["Party","Email","Total Outstanding","0-30 Days","31-60 Days","61-90 Days",">90 Days","Oldest Invoice"],n=l.map(r=>[r.name,r.email||"",a(r.total_outstanding),a(r.age_0_30),a(r.age_31_60),a(r.age_61_90),a(r.age_90_plus),r.oldest_invoice_date?new Date(r.oldest_invoice_date).toLocaleDateString("id-ID"):""]),d=[`${c==="customer"?"Customer":"Supplier"} Outstanding Summary`,`Generated: ${new Date().toLocaleString("id-ID")}`,"",t.join(","),...n.map(r=>r.join(","))].join(`
`),i=new Blob([d],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a");x.href=URL.createObjectURL(i),x.download=`outstanding_${c}_${new Date().toISOString().split("T")[0]}.csv`,x.click()},y=l.reduce((t,n)=>t+n.total_outstanding,0),f=l.reduce((t,n)=>t+n.age_0_30,0),j=l.reduce((t,n)=>t+n.age_31_60,0),N=l.reduce((t,n)=>t+n.age_61_90,0),b=l.reduce((t,n)=>t+n.age_90_plus,0);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[c==="customer"?e.jsx(S,{className:"w-4 h-4 text-orange-600"}):e.jsx(D,{className:"w-4 h-4 text-red-600"}),e.jsxs("h2",{className:"text-sm font-semibold text-gray-800",children:[c==="customer"?s("finance.receivables")||"Receivables":s("finance.payables")||"Payables"," ",s("finance.outstanding")||"Outstanding"]})]}),e.jsxs("button",{onClick:_,disabled:l.length===0,className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-xs",children:[e.jsx(k,{className:"w-3.5 h-3.5"}),s("common.export")||"Export"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700",children:[s("finance.partyType")||"Party Type",":"]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("button",{onClick:()=>m("customer"),className:`px-2.5 py-1.5 rounded-lg font-medium text-xs ${c==="customer"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(O,{className:"w-3.5 h-3.5 inline mr-1"}),s("finance.customers")||"Customers"]}),e.jsxs("button",{onClick:()=>m("supplier"),className:`px-2.5 py-1.5 rounded-lg font-medium text-xs ${c==="supplier"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(T,{className:"w-3.5 h-3.5 inline mr-1"}),s("finance.suppliers")||"Suppliers"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 p-2 bg-gradient-to-r from-orange-50 to-red-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-medium text-gray-600 uppercase",children:s("finance.totalOutstanding")||"Total Outstanding"}),e.jsx("p",{className:"text-sm font-bold text-orange-600",children:a(y)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-medium text-gray-600 uppercase",children:["0-30 ",s("finance.days")||"Days"]}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:a(f)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-medium text-gray-600 uppercase",children:["31-60 ",s("finance.days")||"Days"]}),e.jsx("p",{className:"text-sm font-bold text-yellow-600",children:a(j)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-medium text-gray-600 uppercase",children:["61-90 ",s("finance.days")||"Days"]}),e.jsx("p",{className:"text-sm font-bold text-orange-600",children:a(N)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-medium text-gray-600 uppercase",children:[">90 ",s("finance.days")||"Days"]}),e.jsx("p",{className:"text-sm font-bold text-red-600",children:a(b)})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1.5 text-left text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:c==="customer"?s("common.customer")||"Customer":s("common.supplier")||"Supplier"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:s("common.email")||"Email"}),e.jsx("th",{className:"px-2 py-1.5 text-right text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:s("finance.totalOutstanding")||"Total"}),e.jsx("th",{className:"px-2 py-1.5 text-right text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:"0-30"}),e.jsx("th",{className:"px-2 py-1.5 text-right text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:"31-60"}),e.jsx("th",{className:"px-2 py-1.5 text-right text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:"61-90"}),e.jsx("th",{className:"px-2 py-1.5 text-right text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:">90"}),e.jsx("th",{className:"px-2 py-1.5 text-left text-[10px] font-medium text-gray-700 uppercase tracking-wider",children:s("finance.oldestInvoice")||"Oldest"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-2 py-4 text-center text-gray-500 text-xs",children:s("common.loading")||"Loading outstanding data..."})}):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-2 py-4 text-center text-gray-500 text-xs",children:s("finance.noOutstanding")||"No outstanding amounts found"})}):l.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1 text-xs font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-2 py-1 text-xs text-gray-600",children:t.email||"-"}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-xs text-orange-600 text-right font-bold",children:a(t.total_outstanding)}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-xs text-green-600 text-right",children:t.age_0_30>0?a(t.age_0_30):"-"}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-xs text-yellow-600 text-right",children:t.age_31_60>0?a(t.age_31_60):"-"}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-xs text-orange-600 text-right",children:t.age_61_90>0?a(t.age_61_90):"-"}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-xs text-red-600 text-right font-semibold",children:t.age_90_plus>0?a(t.age_90_plus):"-"}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-xs text-gray-600",children:t.oldest_invoice_date?new Date(t.oldest_invoice_date).toLocaleDateString("id-ID"):"-"})]},t.id))})]})})})]})}export{P as default};
