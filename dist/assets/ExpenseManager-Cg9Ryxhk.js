import{c as Oe,r as x,m as Ue,s as m,f as y,n as D,F as T,j as e,T as Be,X as ue,h as pe}from"./index-D377iWu2.js";import{M as xe}from"./Modal-XL444I2e.js";import{B as k}from"./building-2-D6r6vIE5.js";import{D as w,P as q}from"./Layout-B5e6WOHT.js";import{P as Xe}from"./plus-BUV76DvH.js";import{D as $e}from"./download-Cw744MUe.js";import{E as Me}from"./eye-0GUlh4_A.js";import{E as he}from"./external-link-CbTQ6Fgm.js";import{U as be}from"./upload-B0u4dWaP.js";import{C as Ze}from"./clipboard-4R3bkPrW.js";import"./dateFormat-E6B5rKFz.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Oe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),g=[{value:"duty_customs",label:"Duty & Customs (BM)",type:"import",icon:k,description:"Import duties and customs charges - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"ppn_import",label:"PPN Import",type:"operations",icon:w,description:"Import VAT - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"pph_import",label:"PPh Import",type:"import",icon:k,description:"Import withholding tax - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"freight_import",label:"Freight (Import)",type:"import",icon:q,description:"International freight charges - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"clearing_forwarding",label:"Clearing & Forwarding",type:"import",icon:k,description:"Customs clearance - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"port_charges",label:"Port Charges",type:"import",icon:k,description:"Port handling charges - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"container_handling",label:"Container Handling",type:"import",icon:q,description:"Container unloading - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"transport_import",label:"Transportation (Import)",type:"import",icon:D,description:"Port to godown transport - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"loading_import",label:"Loading / Unloading (Import)",type:"import",icon:D,description:"Import container loading/unloading - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"bpom_ski_fees",label:"BPOM / SKI Fees",type:"import",icon:T,description:"BPOM/SKI regulatory fees - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"other_import",label:"Other (Import)",type:"import",icon:w,description:"Other import-related expenses - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"delivery_sales",label:"Delivery / Dispatch (Sales)",type:"sales",icon:D,description:"Customer delivery - EXPENSED to P&L",requiresContainer:!1,group:"Sales & Distribution"},{value:"loading_sales",label:"Loading / Unloading (Sales)",type:"sales",icon:D,description:"Sales loading charges - EXPENSED to P&L",requiresContainer:!1,group:"Sales & Distribution"},{value:"other_sales",label:"Other (Sales)",type:"sales",icon:w,description:"Other sales-related expenses - EXPENSED to P&L",requiresContainer:!1,group:"Sales & Distribution"},{value:"salary",label:"Salary",type:"staff",icon:w,description:"Staff salaries - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"staff_overtime",label:"Staff Overtime",type:"staff",icon:w,description:"Overtime payments - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"staff_welfare",label:"Staff Welfare / Allowances",type:"staff",icon:w,description:"Driver food, snacks, overtime meals, welfare - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"travel_conveyance",label:"Travel & Conveyance",type:"staff",icon:D,description:"Local travel, taxi, fuel reimbursements, tolls - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"warehouse_rent",label:"Warehouse Rent",type:"operations",icon:k,description:"Rent expense - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"utilities",label:"Utilities",type:"operations",icon:k,description:"Electricity, water, etc - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"bank_charges",label:"Bank Charges",type:"operations",icon:w,description:"Bank fees, charges, and transaction costs - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"office_admin",label:"Office & Admin",type:"admin",icon:k,description:"General admin expenses - EXPENSED to P&L",requiresContainer:!1,group:"Administrative"},{value:"office_shifting_renovation",label:"Office Shifting & Renovation",type:"admin",icon:k,description:"Office shifting, partition work, electrical, cabling, interior renovation - EXPENSED to P&L",requiresContainer:!1,group:"Administrative"},{value:"other",label:"Other",type:"admin",icon:w,description:"Miscellaneous expenses - EXPENSED to P&L",requiresContainer:!1,group:"Administrative"}];function nt({canManage:E}){var de,me;const[M,P]=x.useState([]),[We,ge]=x.useState([]),[_e,fe]=x.useState([]),[ye,je]=x.useState([]),[ve,Ne]=x.useState([]),[Z,V]=x.useState(new Set),[R,O]=x.useState([]),[C,W]=x.useState(""),[se,ae]=x.useState(!0),[U,I]=x.useState(!1),[h,z]=x.useState(null),[d,ne]=x.useState(null),[re,ie]=x.useState(!1),[G,ke]=x.useState("all"),[K,we]=x.useState("all"),[H,Ee]=x.useState("all"),[j,B]=x.useState([]),[Ce,X]=x.useState(!1),[u,Se]=x.useState(null),{dateRange:J}=Ue(),Y=J.startDate,Q=J.endDate,[l,_]=x.useState({expense_category:"other",amount:0,expense_date:new Date().toISOString().split("T")[0],description:"",batch_id:"",import_container_id:"",delivery_challan_id:"",payment_method:"bank_transfer",bank_account_id:"",payment_reference:"",document_urls:[]});x.useEffect(()=>{ee();const t=m.channel("expense-changes").on("postgres_changes",{event:"*",schema:"public",table:"finance_expenses"},()=>{ee()}).subscribe(),s=m.channel("bank-statement-changes").on("postgres_changes",{event:"*",schema:"public",table:"bank_statement_lines"},()=>{ee()}).subscribe();return()=>{t.unsubscribe(),s.unsubscribe()}},[J]),x.useEffect(()=>{const t=s=>{var r;if(!U)return;const a=(r=s.clipboardData)==null?void 0:r.items;if(!a)return;const i=[];for(let n=0;n<a.length;n++){const o=a[n];if(o.type.indexOf("image")!==-1){s.preventDefault();const c=o.getAsFile();if(c){const b=`pasted-image-${Date.now()}.png`,p=new File([c],b,{type:c.type});i.push(p)}}}i.length>0&&(B([...j,...i]),X(!0),setTimeout(()=>X(!1),2e3))};return document.addEventListener("paste",t),()=>document.removeEventListener("paste",t)},[U,j]);const ee=async()=>{try{ae(!0);const[t,s,a,i,r,n]=await Promise.all([m.from("finance_expenses").select(`
            *,
            batches(batch_number),
            import_containers(container_ref),
            delivery_challans(challan_number),
            bank_accounts(bank_name, account_number, alias, currency),
            bank_statement_lines(
              id,
              transaction_date,
              description,
              debit_amount,
              credit_amount,
              bank_account_id,
              bank_accounts(bank_name, account_number, alias, currency)
            )
          `).order("expense_date",{ascending:!1}).order("created_at",{ascending:!1}),m.from("batches").select("id, batch_number").order("batch_number"),m.from("import_containers").select("id, container_ref").order("container_ref"),m.from("delivery_challans").select("id, challan_number, challan_date, customers(company_name)").order("challan_number",{ascending:!1}).limit(50),m.from("bank_accounts").select("id, bank_name, account_number, alias, currency").order("bank_name"),m.from("bank_statement_lines").select("matched_expense_id").not("matched_expense_id","is",null)]);if(t.error)throw t.error;P(t.data||[]),ge(s.data||[]),fe(a.data||[]),je(i.data||[]),Ne(r.data||[]);const o=new Set;n.data&&n.data.forEach(c=>{c.matched_expense_id&&o.add(c.matched_expense_id)}),V(o)}catch(t){console.error("Error loading data:",t.message),y({type:"error",title:"Error",message:"Failed to load expenses"})}finally{ae(!1)}},le=async(t,s)=>{try{let a=m.from("bank_statement_lines").select(`
          id,
          transaction_date,
          description,
          debit_amount,
          credit_amount,
          bank_account_id,
          bank_accounts(bank_name, account_number, alias, currency)
        `).or(`matched_expense_id.is.null,matched_expense_id.eq.${s||"NULL"}`).is("matched_receipt_id",null).is("matched_petty_cash_id",null).is("matched_entry_id",null).is("matched_fund_transfer_id",null).order("transaction_date",{ascending:!1});t&&(a=a.eq("bank_account_id",t));const{data:i,error:r}=await a;if(r)throw r;const n=(i||[]).filter(o=>o.debit_amount&&o.debit_amount>0);O(n)}catch(a){console.error("Error loading unlinked transactions:",a)}},De=async t=>{t.preventDefault(),console.log("=== EXPENSE FORM SUBMIT ==="),console.log("Editing:",!!h),console.log("Files to upload:",j.length),console.log("Existing URLs:",l.document_urls);try{const s=g.find(n=>n.value===l.expense_category),a=[];if(j.length>0){console.log("=== UPLOADING",j.length,"FILES ===");for(const n of j){console.log("Uploading file:",n.name,"(",n.size,"bytes)");const o=`${Date.now()}_${n.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,c=`${l.expense_category}/${o}`;console.log("Storage path:",c);const{data:b,error:p}=await m.storage.from("expense-documents").upload(c,n,{cacheControl:"3600",upsert:!1});if(p)throw console.error("Upload error:",p),new Error(`Failed to upload ${n.name}: ${p.message}`);console.log("Upload successful:",b);const{data:{publicUrl:f}}=m.storage.from("expense-documents").getPublicUrl(c);console.log("Public URL:",f),a.push(f)}console.log("All uploads complete. Uploaded URLs:",a)}else console.log("No new files to upload");const i=[...l.document_urls,...a];console.log("Combined document URLs:",i);const r={expense_category:l.expense_category,expense_type:(s==null?void 0:s.type)||"admin",amount:l.amount,expense_date:l.expense_date,description:l.description||null,batch_id:l.batch_id||null,import_container_id:l.import_container_id||null,delivery_challan_id:l.delivery_challan_id||null,payment_method:l.payment_method,bank_account_id:l.bank_account_id||null,payment_reference:l.payment_reference||null,paid_by:"bank",document_urls:i.length>0?i:null};if(console.log("=== EXPENSE DATA TO SAVE ==="),console.log("document_urls:",r.document_urls),console.log("Full expense data:",r),h){console.log("=== UPDATING EXPENSE ==="),console.log("Expense ID:",h.id);const{error:n}=await m.from("finance_expenses").update(r).eq("id",h.id);if(n)throw console.error("Update error:",n),n;console.log("Update successful! Fetching updated data...");const{data:o,error:c}=await m.from("finance_expenses").select(`
            *,
            batches (batch_number),
            import_containers (container_ref),
            delivery_challans (challan_number),
            bank_accounts (bank_name, account_number, alias, currency),
            bank_statement_lines (
              id,
              transaction_date,
              description,
              debit_amount,
              credit_amount,
              bank_account_id,
              bank_accounts (bank_name, account_number)
            )
          `).eq("id",h.id).single();if(c)throw console.error("Fetch error:",c),c;if(console.log("=== FETCHED UPDATED EXPENSE ==="),console.log("document_urls from DB:",o.document_urls),console.log("Full updated expense:",o),P(b=>b.map(p=>p.id===h.id?o:p)),C){const{data:{user:b}}=await m.auth.getUser(),{error:p}=await m.from("bank_statement_lines").update({matched_expense_id:h.id,reconciliation_status:"matched",matched_at:new Date().toISOString(),matched_by:b==null?void 0:b.id}).eq("id",C);if(p)console.error("Error linking to bank transaction:",p),y({type:"warning",title:"Warning",message:"Expense updated but failed to link to bank transaction. Please link manually from Bank Reconciliation."});else{const{data:f,error:te}=await m.from("finance_expenses").select(`
                *,
                batches (batch_number),
                import_containers (container_ref),
                delivery_challans (challan_number),
                bank_accounts (bank_name, account_number, alias, currency),
                bank_statement_lines (
                  id,
                  transaction_date,
                  description,
                  debit_amount,
                  credit_amount,
                  bank_account_id,
                  bank_accounts (bank_name, account_number)
                )
              `).eq("id",h.id).single();!te&&f&&(P(N=>N.map(A=>A.id===h.id?f:A)),O(N=>N.filter(A=>A.id!==C)),V(N=>new Set(N).add(h.id)))}}y({type:"success",title:"Success",message:"Expense updated successfully"})}else{const{data:{user:n}}=await m.auth.getUser();if(!n)throw new Error("Not authenticated");console.log("=== CREATING NEW EXPENSE ===");const{data:o,error:c}=await m.from("finance_expenses").insert([{...r,created_by:n.id}]).select(`
            *,
            batches (batch_number),
            import_containers (container_ref),
            delivery_challans (challan_number),
            bank_accounts (bank_name, account_number, alias, currency),
            bank_statement_lines (
              id,
              transaction_date,
              description,
              debit_amount,
              credit_amount,
              bank_account_id,
              bank_accounts (bank_name, account_number)
            )
          `).single();if(c)throw console.error("Insert error:",c),c;console.log("=== NEW EXPENSE CREATED ==="),console.log("document_urls from DB:",o==null?void 0:o.document_urls),console.log("Full new expense:",o);let b=o;if(C&&o){const{error:p}=await m.from("bank_statement_lines").update({matched_expense_id:o.id,reconciliation_status:"matched",matched_at:new Date().toISOString(),matched_by:n.id}).eq("id",C);if(p)console.error("Error linking to bank transaction:",p),y({type:"warning",title:"Warning",message:"Expense created but failed to link to bank transaction. Please link manually from Bank Reconciliation."});else{const{data:f,error:te}=await m.from("finance_expenses").select(`
                *,
                batches (batch_number),
                import_containers (container_ref),
                delivery_challans (challan_number),
                bank_accounts (bank_name, account_number, alias, currency),
                bank_statement_lines (
                  id,
                  transaction_date,
                  description,
                  debit_amount,
                  credit_amount,
                  bank_account_id,
                  bank_accounts (bank_name, account_number)
                )
              `).eq("id",o.id).single();!te&&f&&(b=f,O(N=>N.filter(A=>A.id!==C)),V(N=>new Set(N).add(o.id)))}}P(p=>[b,...p]),y({type:"success",title:"Success",message:"Expense recorded successfully"})}I(!1),F()}catch(s){console.error("Error saving expense:",s.message);const a=s.message||"Unknown error occurred";a.includes("Import expenses must be linked")?y({type:"error",title:"Error",message:"Context Required: Import expenses must be linked to an Import Container. Please select a container before saving."}):y({type:"error",title:"Error",message:"Failed to save expense: "+a})}},Pe=async t=>{z(t);const s=t.bank_statement_lines&&t.bank_statement_lines.length>0?t.bank_statement_lines[0]:null,a=(s==null?void 0:s.bank_account_id)||t.bank_account_id||"",i=s!=null&&s.bank_account_id?"bank_transfer":t.payment_method||"bank_transfer";_({expense_category:t.expense_category,amount:t.amount,expense_date:t.expense_date,description:t.description||"",batch_id:t.batch_id||"",import_container_id:t.import_container_id||"",delivery_challan_id:t.delivery_challan_id||"",payment_method:i,bank_account_id:a,payment_reference:t.payment_reference||"",document_urls:t.document_urls||[]}),W((s==null?void 0:s.id)||""),a&&await le(a,t.id),I(!0)},Ie=async t=>{if(await pe({title:"Confirm",message:"Are you sure you want to delete this expense?",variant:"danger",confirmLabel:"Delete"}))try{const{data:s,error:a}=await m.from("bank_statement_lines").select("id").eq("matched_expense_id",t);if(a)throw a;if(s&&s.length>0){const{error:n}=await m.from("bank_statement_lines").update({matched_expense_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null,notes:null}).eq("matched_expense_id",t);if(n)throw n}const{data:i}=await m.from("journal_entries").select("id").eq("source_module","expenses").eq("reference_number",`EXP-${t}`);if(i&&i.length>0){const n=i.map(c=>c.id),{data:o}=await m.from("bank_statement_lines").select("id").in("matched_entry_id",n);o&&o.length>0&&await m.from("bank_statement_lines").update({matched_entry_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null}).in("matched_entry_id",n);for(const c of n)await m.from("journal_entry_lines").delete().eq("journal_entry_id",c),await m.from("journal_entries").delete().eq("id",c)}const{error:r}=await m.from("finance_expenses").delete().eq("id",t);if(r)throw r;P(n=>n.filter(o=>o.id!==t)),y({type:"success",title:"Success",message:"Expense deleted successfully"})}catch(s){console.error("Error deleting expense:",s.message),y({type:"error",title:"Error",message:"Failed to delete expense: "+s.message})}},Le=async t=>{if(await pe({title:"Confirm",message:`Are you sure you want to unlink this expense from the bank statement?

The bank statement line will be set back to "Unmatched" status.`,variant:"warning"}))try{const{error:s}=await m.from("bank_statement_lines").update({matched_expense_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null,notes:null}).eq("matched_expense_id",t);if(s)throw s;const{data:a,error:i}=await m.from("finance_expenses").select(`
          *,
          batches (batch_number),
          import_containers (container_ref),
          delivery_challans (challan_number),
          bank_accounts (bank_name, account_number),
          bank_statement_lines (
            id,
            transaction_date,
            description,
            debit_amount,
            credit_amount,
            bank_account_id,
            bank_accounts (bank_name, account_number)
          )
        `).eq("id",t).single();if(i)throw i;P(r=>r.map(n=>n.id===t?a:n)),y({type:"success",title:"Success",message:"Expense unlinked from bank statement successfully"}),I(!1),z(null),F()}catch(s){console.error("Error unlinking expense:",s.message),y({type:"error",title:"Error",message:"Failed to unlink expense: "+s.message})}},Ae=t=>{_({...l,document_urls:l.document_urls.filter(s=>s!==t)})},Te=t=>{B(j.filter((s,a)=>a!==t))},F=()=>{z(null),B([]),_({expense_category:"other",amount:0,expense_date:new Date().toISOString().split("T")[0],description:"",batch_id:"",import_container_id:"",delivery_challan_id:"",payment_method:"bank_transfer",bank_account_id:"",payment_reference:"",document_urls:[]})},v=g.find(t=>t.value===l.expense_category),oe=(v==null?void 0:v.type)==="import",qe=(v==null?void 0:v.type)==="sales",S=M.filter(t=>{if(G!=="all"){const s=g.find(a=>a.value===t.expense_category);if((s==null?void 0:s.type)!==G)return!1}if(H!=="all"&&t.expense_category!==H)return!1;if(K==="reconciled"){if(!Z.has(t.id))return!1}else if(K==="not_reconciled"&&Z.has(t.id))return!1;return!(Y&&t.expense_date<Y||Q&&t.expense_date>Q)}),L=t=>{let s="asc";u&&u.key===t&&u.direction==="asc"&&(s="desc"),Se({key:t,direction:s})},$=[...S].sort((t,s)=>{var o,c;if(!u)return 0;const{key:a,direction:i}=u;let r,n;if(a==="date")r=new Date(t.expense_date).getTime(),n=new Date(s.expense_date).getTime();else if(a==="category"){const b=g.find(f=>f.value===t.expense_category),p=g.find(f=>f.value===s.expense_category);r=((o=b==null?void 0:b.label)==null?void 0:o.toLowerCase())||"",n=((c=p==null?void 0:p.label)==null?void 0:c.toLowerCase())||""}else if(a==="amount")r=Number(t.amount)||0,n=Number(s.amount)||0;else if(a==="description")r=(t.description||"").toLowerCase(),n=(s.description||"").toLowerCase();else if(a==="payment_method")r=(t.payment_method||"unknown").toLowerCase(),n=(s.payment_method||"unknown").toLowerCase();else if(a==="reconciliation"){const b=t.bank_statement_lines&&t.bank_statement_lines.length>0,p=s.bank_statement_lines&&s.bank_statement_lines.length>0;r=b?1:0,n=p?1:0}else r=t[a],n=s[a],typeof r=="string"&&(r=r.toLowerCase()),typeof n=="string"&&(n=n.toLowerCase());return r<n?i==="asc"?-1:1:r>n?i==="asc"?1:-1:0}),Fe=()=>{if(S.length===0){y({type:"info",title:"Notice",message:"No expenses to export"});return}const t=["Date","Category","Description","Amount"],s=S.map(o=>{const c=g.find(b=>b.value===o.expense_category);return[o.expense_date,(c==null?void 0:c.label)||o.expense_category,o.description||"",o.amount.toString()]}),a=[t.join(","),...s.map(o=>o.map(c=>`"${c}"`).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),n=URL.createObjectURL(i);r.setAttribute("href",n),r.setAttribute("download",`expenses_${Y||"all"}_to_${Q||"all"}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},ce=t=>{switch(t){case"import":return"bg-blue-100 text-blue-800 border-blue-300";case"sales":return"bg-green-100 text-green-800 border-green-300";case"staff":return"bg-purple-100 text-purple-800 border-purple-300";case"operations":return"bg-orange-100 text-orange-800 border-orange-300";case"admin":return"bg-gray-100 text-gray-800 border-gray-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},Re=t=>{const s=new Date(t),a=String(s.getDate()).padStart(2,"0"),i=String(s.getMonth()+1).padStart(2,"0"),r=s.getFullYear();return`${a}/${i}/${r}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg p-2.5 text-white shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-sm font-bold",children:"Expense Tracker"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"bg-white/20 rounded px-2.5 py-1",children:[e.jsx("div",{className:"text-blue-100 text-[9px] leading-tight",children:"Total"}),e.jsxs("div",{className:"text-xs font-bold",children:["Rp ",S.reduce((t,s)=>t+s.amount,0).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"bg-white/20 rounded px-2.5 py-1",children:[e.jsx("div",{className:"text-blue-100 text-[9px] leading-tight",children:"Reconciled"}),e.jsxs("div",{className:"text-xs font-bold",children:[M.filter(t=>Z.has(t.id)).length," / ",M.length]})]})]})]}),E&&e.jsxs("button",{onClick:()=>{F(),I(!0)},className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-white text-blue-600 rounded hover:bg-blue-50 font-medium transition-all shadow-sm text-xs",children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),"New"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-2",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"flex gap-1",children:[{value:"all",label:"All",icon:"ðŸ“‹"},{value:"import",label:"Import",icon:"ðŸ“¦"},{value:"sales",label:"Sales",icon:"ðŸšš"},{value:"staff",label:"Staff",icon:"ðŸ‘¥"},{value:"operations",label:"Ops",icon:"ðŸ¢"},{value:"admin",label:"Admin",icon:"ðŸ“„"}].map(t=>e.jsxs("button",{onClick:()=>ke(t.value),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${G===t.value?"bg-blue-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[t.icon," ",t.label]},t.value))}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsx("div",{className:"flex gap-1",children:[{value:"all",label:"All"},{value:"reconciled",label:"âœ“ Linked"},{value:"not_reconciled",label:"âš  Unlinked"}].map(t=>e.jsx("button",{onClick:()=>we(t.value),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${K===t.value?"bg-green-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.label},t.value))}),e.jsxs("select",{value:H,onChange:t=>Ee(t.target.value),className:"px-2 py-1 border border-gray-300 rounded-md text-xs",children:[e.jsx("option",{value:"all",children:"All Categories"}),g.sort((t,s)=>{const a={"Import Costs":1,"Sales & Distribution":2,"Staff Costs":3,Operations:4,Administrative:5},i=a[t.group]||999,r=a[s.group]||999;return i!==r?i-r:t.label.localeCompare(s.label)}).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsxs("button",{onClick:Fe,disabled:S.length===0,className:"ml-auto px-3 py-1.5 bg-green-600 text-white rounded-md text-xs hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-1.5 font-medium",children:[e.jsx($e,{className:"w-3.5 h-3.5"}),"Export (",S.length,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>L("date"),className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Date",(u==null?void 0:u.key)==="date"&&e.jsx("span",{className:"text-blue-600 text-sm",children:u.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{onClick:()=>L("category"),className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Category",(u==null?void 0:u.key)==="category"&&e.jsx("span",{className:"text-blue-600 text-sm",children:u.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600",children:"Context"}),e.jsx("th",{onClick:()=>L("description"),className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Description",(u==null?void 0:u.key)==="description"&&e.jsx("span",{className:"text-blue-600 text-sm",children:u.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{onClick:()=>L("amount"),className:"px-4 py-2.5 text-right text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Amount",(u==null?void 0:u.key)==="amount"&&e.jsx("span",{className:"text-blue-600 text-sm",children:u.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{onClick:()=>L("payment_method"),className:"px-4 py-2.5 text-center text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Payment",(u==null?void 0:u.key)==="payment_method"&&e.jsx("span",{className:"text-blue-600 text-sm",children:u.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-4 py-2.5 text-center text-xs font-semibold text-gray-600",children:"Type"}),e.jsx("th",{onClick:()=>L("reconciliation"),className:"px-4 py-2.5 text-center text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Status",(u==null?void 0:u.key)==="reconciliation"&&e.jsx("span",{className:"text-blue-600 text-sm",children:u.direction==="asc"?"â†‘":"â†“"})]})}),E&&e.jsx("th",{className:"px-4 py-2.5 text-center text-xs font-semibold text-gray-600",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[se?e.jsx("tr",{children:e.jsx("td",{colSpan:E?9:8,className:"px-6 py-8 text-center text-gray-500",children:"Loading..."})}):S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:E?9:8,className:"px-6 py-8 text-center text-gray-500",children:"No expenses found"})}):$.map(t=>{var r;const s=g.find(n=>n.value===t.expense_category),a=t.bank_statement_lines&&t.bank_statement_lines.length>0,i=a?t.bank_statement_lines[0].bank_accounts:null;return e.jsxs("tr",{className:"hover:bg-blue-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap",children:e.jsx("div",{className:"text-xs text-gray-900 font-medium",children:Re(t.expense_date)})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("div",{className:"text-xs font-medium text-gray-900",children:(s==null?void 0:s.label)||t.expense_category})}),e.jsx("td",{className:"px-4 py-2.5",children:t.import_container_id&&t.import_containers?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(q,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}),e.jsx("span",{className:"text-blue-700 font-medium",children:t.import_containers.container_ref})]}):t.delivery_challan_id&&t.delivery_challans?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(D,{className:"w-3.5 h-3.5 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-green-700 font-medium",children:t.delivery_challans.challan_number})]}):s!=null&&s.requiresContainer?e.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-medium text-red-700 bg-red-50 border border-red-200 rounded",children:"âš ï¸ Missing"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"â€”"})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("div",{className:"text-xs text-gray-700 line-clamp-1",children:t.description||"â€”"})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-right",children:e.jsxs("div",{className:"text-xs font-semibold text-gray-900",children:[((r=t.bank_accounts)==null?void 0:r.currency)==="USD"?"$":"Rp"," ",t.amount.toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})]})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-center",children:a&&i?e.jsx("div",{className:"text-xs",children:e.jsx("div",{className:"font-medium text-blue-700",children:i.alias||i.bank_name})}):t.bank_account_id&&t.bank_accounts?e.jsx("div",{className:"text-xs",children:e.jsx("div",{className:"font-medium text-gray-700",children:t.bank_accounts.alias||t.bank_accounts.bank_name})}):e.jsx("span",{className:"text-xs text-gray-600",children:t.payment_method?t.payment_method.replace("_"," "):"â€”"})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-center",children:e.jsxs("span",{className:`inline-flex px-1.5 py-0.5 text-[10px] font-bold rounded ${ce((s==null?void 0:s.type)||"admin")}`,children:[(s==null?void 0:s.type)==="import"&&"CAP",(s==null?void 0:s.type)==="sales"&&"EXP",(s==null?void 0:s.type)==="staff"&&"EXP",(s==null?void 0:s.type)==="operations"&&"EXP",(s==null?void 0:s.type)==="admin"&&"EXP"]})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-center",children:a?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-[10px] font-bold text-green-700 bg-green-50 border border-green-300 rounded",children:"âœ“ LINKED"}):e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-[10px] font-bold text-orange-700 bg-orange-50 border border-orange-300 rounded",children:"âš  UNLINKED"})}),E&&e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("button",{onClick:()=>{ne(t),ie(!0)},className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"View",children:e.jsx(Me,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Pe(t),className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors",title:"Edit",children:e.jsx(Ve,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Ie(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete",children:e.jsx(Be,{className:"w-3.5 h-3.5"})})]})})]},t.id)}),!se&&$.length>0&&e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsxs("td",{colSpan:4,className:"px-4 py-2.5 text-right text-xs text-gray-900",children:["TOTAL (",$.length," expenses):"]}),e.jsxs("td",{className:"px-4 py-2.5 text-right text-sm text-blue-900 font-bold",children:["Rp ",$.reduce((t,s)=>t+s.amount,0).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("td",{colSpan:E?4:3})]})]})]})}),U&&e.jsx(xe,{isOpen:U,onClose:()=>{I(!1),F()},title:h?"Edit Expense":"Record New Expense",maxWidth:"max-w-2xl",children:e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Expense Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.expense_category,onChange:t=>{const s=t.target.value,a=g.find(i=>i.value===s);_({...l,expense_category:s,import_container_id:(a==null?void 0:a.type)==="import"?l.import_container_id:"",delivery_challan_id:(a==null?void 0:a.type)==="sales"?l.delivery_challan_id:""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),e.jsx("optgroup",{label:"â•â•â• IMPORT COSTS (Capitalized to Inventory) â•â•â•",children:g.filter(t=>t.group==="Import Costs").map(t=>e.jsxs("option",{value:t.value,children:[t.label," [Requires Container]"]},t.value))}),e.jsx("optgroup",{label:"â•â•â• SALES & DISTRIBUTION (P&L Expense) â•â•â•",children:g.filter(t=>t.group==="Sales & Distribution").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"â•â•â• STAFF COSTS (P&L Expense) â•â•â•",children:g.filter(t=>t.group==="Staff Costs").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"â•â•â• OPERATIONS (P&L Expense) â•â•â•",children:g.filter(t=>t.group==="Operations").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"â•â•â• ADMINISTRATIVE (P&L Expense) â•â•â•",children:g.filter(t=>t.group==="Administrative").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),v&&e.jsxs("div",{className:`mt-2 p-3 rounded-lg border ${ce(v.type)}`,children:[e.jsx("p",{className:"text-sm font-medium",children:v.description}),v.requiresContainer&&e.jsx("p",{className:"text-xs font-semibold text-red-600 mt-1",children:"âš ï¸ Must be linked to Import Container"})]})]}),oe&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"Import Container ",e.jsx("span",{className:"text-red-500",children:"* REQUIRED"})]}),e.jsxs("select",{value:l.import_container_id,onChange:t=>_({...l,import_container_id:t.target.value}),className:"w-full px-3 py-2 border border-blue-300 rounded-lg bg-white",required:oe,children:[e.jsx("option",{value:"",children:"Select Container (Required)"}),_e.map(t=>e.jsx("option",{value:t.id,children:t.container_ref},t.id))]}),e.jsx("p",{className:"mt-2 text-xs text-blue-800 font-medium",children:"âœ“ This expense will be CAPITALIZED to inventory and allocated to batches"}),e.jsx("p",{className:"mt-1 text-xs text-red-700 font-semibold",children:"âš ï¸ Backend will block saving without a container selection"})]}),qe&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-green-900 mb-2",children:"Delivery Challan (Optional)"}),e.jsxs("select",{value:l.delivery_challan_id,onChange:t=>_({...l,delivery_challan_id:t.target.value}),className:"w-full px-3 py-2 border border-green-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Select DC (Optional)"}),ye.map(t=>{var s;return e.jsxs("option",{value:t.id,children:[t.challan_number," - ",new Date(t.challan_date).toLocaleDateString("en-GB")," - ",((s=t.customers)==null?void 0:s.company_name)||"No Customer"]},t.id)})]}),e.jsx("p",{className:"mt-2 text-xs text-green-700",children:"This expense will be EXPENSED to P&L (not capitalized)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:l.expense_date,onChange:t=>_({...l,expense_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Amount (Rp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:l.amount,onChange:t=>_({...l,amount:parseFloat(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]})]}),e.jsxs("div",{className:"border-2 border-blue-200 rounded-lg p-4 bg-blue-50",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Payment Method ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.payment_method,onChange:t=>_({...l,payment_method:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"bank_transfer",children:"ðŸ¦ Bank Transfer"}),e.jsx("option",{value:"check",children:"ðŸ“ Check"}),e.jsx("option",{value:"giro",children:"ðŸ“‹ Giro"}),e.jsx("option",{value:"other",children:"ðŸ“Œ Other"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"âœ“ Will appear in Bank Reconciliation"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"ðŸ’¡ For cash expenses, use Petty Cash Manager"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Bank Account ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.bank_account_id,onChange:t=>{_({...l,bank_account_id:t.target.value}),t.target.value?le(t.target.value,h==null?void 0:h.id):O([]),W("")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select Bank Account"}),ve.map(t=>e.jsxs("option",{value:t.id,children:[t.bank_name," - ",t.alias||t.account_number]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link to Bank Transaction"}),l.bank_account_id&&R.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:C,onChange:t=>W(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Choose a transaction..."}),R.map(t=>{var o,c;const s=new Date(t.transaction_date),a=String(s.getDate()).padStart(2,"0"),i=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getFullYear()).slice(-2),n=`${a}/${i}/${r}`;return e.jsxs("option",{value:t.id,children:[n," - ",((o=t.description)==null?void 0:o.substring(0,50))||"No description"," - Rp ",(c=t.debit_amount)==null?void 0:c.toLocaleString()]},t.id)})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[R.length," unreconciled transaction",R.length!==1?"s":""]})]}):l.bank_account_id?e.jsx("div",{className:"text-sm text-gray-500 italic py-2 px-3 bg-gray-50 rounded-lg border border-gray-200",children:"No unreconciled transactions"}):e.jsx("input",{type:"text",value:l.payment_reference,onChange:t=>_({...l,payment_reference:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Enter reference number"})]})]})]}),h&&h.bank_statement_lines&&h.bank_statement_lines.length>0&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-semibold text-green-900",children:"Linked Bank Transaction"})]}),E&&e.jsx("button",{type:"button",onClick:()=>Le(h.id),className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Unlink"})]}),h.bank_statement_lines.map(t=>{var s,a,i;return e.jsxs("div",{className:"space-y-2 text-sm bg-white p-3 rounded border border-green-200",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bank:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[((s=t.bank_accounts)==null?void 0:s.alias)||((a=t.bank_accounts)==null?void 0:a.bank_name)," - ",(i=t.bank_accounts)==null?void 0:i.account_number]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Transaction Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(t.transaction_date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["Rp ",(t.debit_amount||t.credit_amount||0).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),t.description&&e.jsxs("div",{className:"pt-2 border-t border-green-200",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Bank Description:"}),e.jsx("div",{className:"text-gray-900 font-medium",children:t.description})]})]},t.id)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:l.description,onChange:t=>_({...l,description:t.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(T,{className:"w-4 h-4 inline mr-1"}),"Supporting Documents (Invoices, Receipts, Bills)"]}),l.document_urls.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-600 font-medium mb-2",children:["Existing Documents (",l.document_urls.length,"):"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:l.document_urls.map((t,s)=>{const a=/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(t),i=t.split("/").pop()||`Document ${s+1}`;return e.jsxs("div",{className:"group relative border border-gray-200 rounded-lg overflow-hidden hover:border-red-500 transition-colors",children:[a?e.jsx("div",{className:"aspect-square bg-gray-100 relative",children:e.jsx("img",{src:t,alt:i,className:"w-full h-full object-cover"})}):e.jsxs("div",{className:"aspect-square bg-red-50 flex flex-col items-center justify-center p-3",children:[e.jsx(T,{className:"h-10 w-10 text-red-600 mb-2"}),e.jsx("p",{className:"text-xs text-center text-gray-700 line-clamp-2 px-2",children:i})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-2 py-1.5 flex items-center justify-between",children:[e.jsxs("span",{children:["Doc ",s+1]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",onClick:r=>r.stopPropagation(),children:e.jsx(he,{className:"h-3.5 w-3.5"})}),e.jsx("button",{type:"button",onClick:()=>Ae(t),className:"p-1 hover:bg-red-500 rounded",children:e.jsx(ue,{className:"h-3.5 w-3.5"})})]})]})]},s)})})]}),j.length>0&&e.jsxs("div",{className:"mb-3 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Files to Upload:"}),j.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 border border-blue-200 rounded",children:[e.jsx(be,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-sm text-blue-700 truncate",children:t.name}),e.jsxs("span",{className:"text-xs text-blue-600",children:[(t.size/1024).toFixed(1)," KB"]}),e.jsx("button",{type:"button",onClick:()=>Te(s),className:"p-1 text-red-600 hover:bg-red-100 rounded",children:e.jsx(ue,{className:"w-3 h-3"})})]},s))]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors",onMouseEnter:()=>X(!0),onMouseLeave:()=>X(!1),children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",onChange:t=>{const s=t.target.files;s&&s.length>0&&B([...j,...Array.from(s)])},className:"hidden",id:"expense-file-upload"}),e.jsxs("label",{htmlFor:"expense-file-upload",className:"cursor-pointer flex flex-col items-center",children:[e.jsx(be,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:h&&l.document_urls.length>0?"Click to upload additional files":"Click to upload files"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"PDF, images, or documents (max 10MB each)"})]}),Ce&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-green-600 font-medium animate-pulse mt-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{children:"Press Ctrl+V to paste images from clipboard"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{I(!1),F()},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[h?"Update":"Record"," Expense"]})]})]})}),re&&d&&e.jsx(xe,{isOpen:re,onClose:()=>{ie(!1),ne(null)},title:"Expense Receipt",maxWidth:"max-w-lg",children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-2 rounded -mt-1 -mx-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs opacity-90",children:"Category"}),e.jsx("p",{className:"text-base font-bold",children:((de=g.find(t=>t.value===d.expense_category))==null?void 0:de.label)||d.expense_category})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs opacity-90",children:"Date"}),e.jsx("p",{className:"text-base font-semibold",children:new Date(d.expense_date).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"})})]})]})}),e.jsx("div",{className:"py-2 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[d.expense_type&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Type"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:d.expense_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Category"}),e.jsx("div",{className:"flex items-center gap-1.5",children:(()=>{const t=g.find(a=>a.value===d.expense_category),s=t==null?void 0:t.icon;return e.jsxs(e.Fragment,{children:[s&&e.jsx(s,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t==null?void 0:t.label})]})})()})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Amount"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Rp ",d.amount.toLocaleString("id-ID")]})]})]})}),d.description&&e.jsxs("div",{className:"py-2 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d.description})]}),e.jsxs("div",{className:"py-2 border-b border-gray-200 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Payment Method:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:(me=d.payment_method)==null?void 0:me.replace("_"," ")})]}),d.payment_reference&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Reference:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:d.payment_reference})]})]}),d.bank_accounts&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Bank Account:"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[d.bank_accounts.alias||d.bank_accounts.bank_name," - ",d.bank_accounts.account_number]})]})]}),(d.batches||d.import_containers||d.delivery_challans)&&e.jsxs("div",{className:"py-2 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Linked To"}),e.jsxs("div",{className:"space-y-1",children:[d.batches&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(q,{className:"h-3.5 w-3.5 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Batch:"}),e.jsx("span",{className:"font-medium text-gray-900",children:d.batches.batch_number})]}),d.import_containers&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(q,{className:"h-3.5 w-3.5 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Container:"}),e.jsx("span",{className:"font-medium text-gray-900",children:d.import_containers.container_ref})]}),d.delivery_challans&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(D,{className:"h-3.5 w-3.5 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Challan:"}),e.jsx("span",{className:"font-medium text-gray-900",children:d.delivery_challans.challan_number})]})]})]}),d.bank_statement_lines&&d.bank_statement_lines.length>0&&e.jsxs("div",{className:"py-2 border-b border-gray-200",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(T,{className:"h-3.5 w-3.5"}),"Bank Reconciliation"]}),e.jsx("div",{className:"space-y-2",children:d.bank_statement_lines.map(t=>{var s,a;return e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-semibold text-green-700 bg-green-200 rounded",children:"âœ“ LINKED"}),e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:((s=t.bank_accounts)==null?void 0:s.alias)||((a=t.bank_accounts)==null?void 0:a.bank_name)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bank Amount:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["Rp ",(t.debit_amount||t.credit_amount||0).toLocaleString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900 ml-1",children:new Date(t.transaction_date).toLocaleDateString("id-ID")})]})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-700 mt-2 pt-2 border-t border-green-200 font-medium",children:t.description})]},t.id)})})]}),d.document_urls&&d.document_urls.length>0&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Attachments (",d.document_urls.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:d.document_urls.map((t,s)=>{const a=/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(t),i=t.split("/").pop()||`Document ${s+1}`;return e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"group relative border border-gray-200 rounded overflow-hidden hover:border-blue-500 transition-colors",children:[a?e.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[e.jsx("img",{src:t,alt:i,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-opacity flex items-center justify-center",children:e.jsx(he,{className:"h-5 w-5 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}):e.jsxs("div",{className:"aspect-square bg-red-50 flex flex-col items-center justify-center p-3",children:[e.jsx(T,{className:"h-8 w-8 text-red-600 mb-2"}),e.jsx("p",{className:"text-xs text-center text-gray-700 line-clamp-2",children:i})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-2 py-0.5",children:["Doc ",s+1]})]},s)})})]})]})})]})}export{nt as ExpenseManager};
