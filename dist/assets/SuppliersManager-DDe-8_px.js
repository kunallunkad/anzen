import{r as n,s as l,j as e,T as S}from"./index-05MON0zc.js";import{M as P}from"./Modal-DojL8f5j.js";import{S as E}from"./search-CGgsAlNq.js";import{P as A}from"./plus-C8ciBmA_.js";import{B as D}from"./building-2-DBQXKMe1.js";import{S as T}from"./square-pen-pND7Nsfd.js";function O({canManage:i}){const[g,b]=n.useState([]),[j,f]=n.useState(!0),[N,c]=n.useState(!1),[d,x]=n.useState(null),[m,_]=n.useState(""),[t,s]=n.useState({supplier_code:"",company_name:"",contact_person:"",email:"",phone:"",address:"",city:"",country:"Indonesia",npwp:"",pkp_status:!1,payment_terms_days:30,bank_name:"",bank_account_number:"",bank_account_name:""});n.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:a,error:r}=await l.from("suppliers").select("*").order("company_name");if(r)throw r;b(a||[])}catch(a){console.error("Error loading suppliers:",a)}finally{f(!1)}},v=async()=>{const a=new Date().getFullYear().toString().slice(-2),{count:r}=await l.from("suppliers").select("*",{count:"exact",head:!0});return`SUP${a}-${String((r||0)+1).padStart(4,"0")}`},w=async a=>{a.preventDefault();try{const{data:{user:r}}=await l.auth.getUser();if(!r)throw new Error("Not authenticated");const h={...t,supplier_code:t.supplier_code||await v(),contact_person:t.contact_person||null,email:t.email||null,phone:t.phone||null,address:t.address||null,city:t.city||null,npwp:t.npwp||null,bank_name:t.bank_name||null,bank_account_number:t.bank_account_number||null,bank_account_name:t.bank_account_name||null};if(d){const{error:o}=await l.from("suppliers").update(h).eq("id",d.id);if(o)throw o}else{const{error:o}=await l.from("suppliers").insert([{...h,created_by:r.id}]);if(o)throw o}c(!1),u(),p()}catch(r){console.error("Error saving supplier:",r),alert("Failed to save supplier: "+r.message)}},k=a=>{x(a),s({supplier_code:a.supplier_code||"",company_name:a.company_name,contact_person:a.contact_person||"",email:a.email||"",phone:a.phone||"",address:a.address||"",city:a.city||"",country:a.country,npwp:a.npwp||"",pkp_status:a.pkp_status,payment_terms_days:a.payment_terms_days,bank_name:a.bank_name||"",bank_account_number:a.bank_account_number||"",bank_account_name:a.bank_account_name||""}),c(!0)},C=async a=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:r}=await l.from("suppliers").delete().eq("id",a);if(r)throw r;p()}catch(r){console.error("Error deleting supplier:",r),alert("Failed to delete supplier: "+r.message)}},u=()=>{x(null),s({supplier_code:"",company_name:"",contact_person:"",email:"",phone:"",address:"",city:"",country:"Indonesia",npwp:"",pkp_status:!1,payment_terms_days:30,bank_name:"",bank_account_number:"",bank_account_name:""})},y=g.filter(a=>a.company_name.toLowerCase().includes(m.toLowerCase())||a.supplier_code&&a.supplier_code.toLowerCase().includes(m.toLowerCase())||a.npwp&&a.npwp.includes(m));return j?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:m,onChange:a=>_(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]}),i&&e.jsxs("button",{onClick:()=>{u(),c(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(A,{className:"w-5 h-5"}),"Add Supplier"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Company Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPWP"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PKP"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Terms"}),i&&e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[y.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm",children:a.supplier_code||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.company_name}),a.city&&e.jsx("div",{className:"text-sm text-gray-500",children:a.city})]})]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm",children:a.contact_person||"-"}),a.phone&&e.jsx("div",{className:"text-sm text-gray-500",children:a.phone})]}),e.jsx("td",{className:"px-4 py-3 font-mono text-sm",children:a.npwp||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:a.pkp_status?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded",children:"PKP"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:"Non-PKP"})}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.payment_terms_days," days"]}),i&&e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>k(a),className:"text-blue-600 hover:text-blue-800 mr-2",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(a.id),className:"text-red-600 hover:text-red-800",children:e.jsx(S,{className:"w-4 h-4"})})]})]},a.id)),y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"No suppliers found"})})]})]})}),e.jsx(P,{isOpen:N,onClose:()=>c(!1),title:d?"Edit Supplier":"Add Supplier",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Code"}),e.jsx("input",{type:"text",value:t.supplier_code,onChange:a=>s({...t,supplier_code:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Auto-generated if empty"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",required:!0,value:t.company_name,onChange:a=>s({...t,company_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",value:t.contact_person,onChange:a=>s({...t,contact_person:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"text",value:t.phone,onChange:a=>s({...t,phone:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:a=>s({...t,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:t.address,onChange:a=>s({...t,address:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:t.city,onChange:a=>s({...t,city:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:t.country,onChange:a=>s({...t,country:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"Tax Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NPWP"}),e.jsx("input",{type:"text",value:t.npwp,onChange:a=>s({...t,npwp:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"00.000.000.0-000.000"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:"pkp_status",checked:t.pkp_status,onChange:a=>s({...t,pkp_status:a.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"pkp_status",className:"text-sm text-gray-700",children:"PKP (Pengusaha Kena Pajak)"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"Bank Details"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",value:t.bank_name,onChange:a=>s({...t,bank_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",value:t.bank_account_number,onChange:a=>s({...t,bank_account_number:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name"}),e.jsx("input",{type:"text",value:t.bank_account_name,onChange:a=>s({...t,bank_account_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms (Days)"}),e.jsx("input",{type:"number",value:t.payment_terms_days,onChange:a=>s({...t,payment_terms_days:parseInt(a.target.value)||30}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 text-gray-700 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d?"Update":"Create"," Supplier"]})]})]})})]})}export{O as SuppliersManager};
