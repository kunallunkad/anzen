import{m as T,r as c,s as g,j as e}from"./index-05MON0zc.js";import{S as k}from"./search-CGgsAlNq.js";import{P as A}from"./printer-DeVD-0IS.js";function J(){const{dateRange:n}=T(),[b,w]=c.useState([]),[a,_]=c.useState(null),[o,D]=c.useState([]),[l,v]=c.useState(0),[y,m]=c.useState(!0),[x,S]=c.useState("");c.useEffect(()=>{L()},[]),c.useEffect(()=>{a&&C()},[a,n]);const L=async()=>{try{const{data:t,error:s}=await g.from("chart_of_accounts").select("*").eq("is_active",!0).eq("is_header",!1).order("code");if(s)throw s;w(t||[])}catch(t){console.error("Error loading accounts:",t)}finally{m(!1)}},C=async()=>{if(a)try{m(!0);const{data:t,error:s}=await g.from("journal_entry_lines").select("debit, credit, journal_entries!inner(entry_date)").eq("account_id",a.id).lt("journal_entries.entry_date",n.startDate);if(s)throw s;let d=0;t==null||t.forEach(r=>{a.normal_balance==="debit"?d+=r.debit-r.credit:d+=r.credit-r.debit}),v(d);const{data:I,error:p}=await g.from("journal_entry_lines").select(`
          *,
          journal_entries!inner(
            id,
            entry_number,
            entry_date,
            source_module,
            reference_number
          )
        `).eq("account_id",a.id).gte("journal_entries.entry_date",n.startDate).lte("journal_entries.entry_date",n.endDate).order("line_number");if(p)throw console.error("Error loading ledger:",p),p;const R=(I||[]).sort((r,i)=>{const f=new Date(r.journal_entries.entry_date).getTime(),N=new Date(i.journal_entries.entry_date).getTime();return f!==N?f-N:r.line_number-i.line_number});let h=d;const E=R.map(r=>{const i=r.journal_entries;return a.normal_balance==="debit"?h+=r.debit-r.credit:h+=r.credit-r.debit,{id:r.id,line_number:r.line_number,journal_entry_id:i.id,entry_date:i.entry_date,entry_number:i.entry_number,source_module:i.source_module,reference_number:i.reference_number,description:r.description,debit:r.debit,credit:r.credit,balance:h}});D(E)}catch(t){console.error("Error loading ledger:",t)}finally{m(!1)}},F=()=>{window.print()},B=b.filter(t=>t.code.toLowerCase().includes(x.toLowerCase())||t.name.toLowerCase().includes(x.toLowerCase())),u=o.length>0?o[o.length-1].balance:l,j=o.reduce((t,s)=>({debit:t.debit+s.debit,credit:t.credit+s.credit}),{debit:0,credit:0});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search account by code or name...",value:x,onChange:t=>S(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("select",{value:(a==null?void 0:a.id)||"",onChange:t=>{const s=b.find(d=>d.id===t.target.value);_(s||null)},className:"px-4 py-2 border border-gray-300 rounded-lg min-w-[300px]",children:[e.jsx("option",{value:"",children:"Select Account..."}),B.map(t=>e.jsxs("option",{value:t.id,children:[t.code," - ",t.name]},t.id))]}),a&&e.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[e.jsx(A,{className:"w-4 h-4"}),"Print"]})]}),!a&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-blue-800 font-medium mb-2",children:"Select an account to view its ledger"}),e.jsx("p",{className:"text-blue-600 text-sm mb-4",children:"Use the dropdown above to choose an account, or search by code or name."}),e.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3 text-left max-w-md mx-auto",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Tip:"})," To view all journal entries across all accounts:"]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Go to ",e.jsx("span",{className:"font-mono bg-blue-100 px-2 py-0.5 rounded",children:"Journal Register"})," in the Books menu (Ctrl+J)"]})]})]}),a&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-white border rounded-lg p-4 print:border-0",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Account Ledger"}),e.jsxs("h3",{className:"text-lg font-medium mt-1",children:[a.code," - ",a.name]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Period: ",new Date(n.startDate).toLocaleDateString("id-ID")," to ",new Date(n.endDate).toLocaleDateString("id-ID")]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-t border-b font-medium bg-gray-50 px-3",children:[e.jsx("span",{children:"Opening Balance:"}),e.jsxs("span",{className:l>=0?"text-green-600":"text-red-600",children:["Rp ",Math.abs(l).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}),l<0&&" (Cr)"]})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b-2 border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Voucher No"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-700 uppercase",children:"Debit"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-700 uppercase",children:"Credit"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-700 uppercase",children:"Balance"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase",children:"Narration"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:new Date(t.entry_date).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap font-mono text-blue-600",children:t.entry_number}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 rounded",children:t.source_module||"Manual"})}),e.jsx("td",{className:"px-3 py-2 text-right whitespace-nowrap text-blue-600",children:t.debit>0?`Rp ${t.debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`:""}),e.jsx("td",{className:"px-3 py-2 text-right whitespace-nowrap text-green-600",children:t.credit>0?`Rp ${t.credit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`:""}),e.jsx("td",{className:"px-3 py-2 text-right whitespace-nowrap font-medium",children:e.jsxs("span",{className:t.balance>=0?"text-green-600":"text-red-600",children:["Rp ",Math.abs(t.balance).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"px-3 py-2 text-gray-600 text-xs max-w-xs truncate",children:t.description||t.reference_number||"-"})]},t.id))}),e.jsxs("tfoot",{className:"bg-gray-50 border-t-2 border-gray-200 font-bold",children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-3 py-2 text-right",children:"Total:"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-700",children:["Rp ",j.debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("td",{className:"px-3 py-2 text-right text-green-700",children:["Rp ",j.credit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{colSpan:2})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-3 py-2 text-right",children:"Closing Balance:"}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("span",{className:u>=0?"text-green-700":"text-red-700",children:["Rp ",Math.abs(u).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}),u<0&&" (Cr)"]})}),e.jsx("td",{})]})]})]})}),o.length===0&&!y&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No transactions found for this account in the selected period."})]})}),!a&&!y&&e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-lg border",children:[e.jsx(M,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{children:"Select an account to view its ledger"})]})]})}function M(n){return e.jsx("svg",{...n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}export{J as AccountLedger};
