import{c as We,r as b,d as je,j as e,X as Je,u as Ue,a as ze,m as He,s as j,T as le,h as Ge,f as oe}from"./index-DvtEbx4A.js";import{L as Ve}from"./Layout-B_Kx8kGP.js";import{D as Ye}from"./DataTable-C-riE1av.js";import{P as Ke,M as Qe}from"./Modal-BV7rDng6.js";import{P as Ze,h as Xe,E as et}from"./html2canvas.esm-DiWwnxg4.js";import{D as tt}from"./download-CxXm7ySC.js";import{f as Ne}from"./dateFormat-E6B5rKFz.js";import{C as st}from"./chevron-down-CgafNpCv.js";import{S as at}from"./search-Do2F0vlo.js";import{C as ve}from"./check-D7PNqnd3.js";import{S as rt}from"./SearchableSelect-1QvNirE6.js";import{E as nt}from"./eye-RI7-6vtf.js";import{S as it}from"./square-pen-BZK9yoKc.js";import"./chevron-up-BtuUn4j2.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=We("FileX",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]]);function ot({invoice:n,items:f,onClose:T}){const $=b.useRef(null),{t:U,language:c}=je(),_=r=>r==null?"Rp 0,00":`Rp ${r.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`,G=r=>{const h=new Date(r),g=c==="id"?["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agt","Sep","Okt","Nov","Des"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],v=h.getDate(),u=g[h.getMonth()],l=h.getFullYear();return`${v} ${u} ${l}`},B=r=>{const h=new Date(r),v=(c==="id"?["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agt","Sep","Okt","Nov","Des"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"])[h.getMonth()],u=h.getFullYear();return`${v} ${u}`},O=r=>c==="id"?V(r):Y(r),V=r=>{if(r===0)return"Nol";const h=["","Satu","Dua","Tiga","Empat","Lima","Enam","Tujuh","Delapan","Sembilan"],g=["Sepuluh","Sebelas","Dua Belas","Tiga Belas","Empat Belas","Lima Belas","Enam Belas","Tujuh Belas","Delapan Belas","Sembilan Belas"],v=["","","Dua Puluh","Tiga Puluh","Empat Puluh","Lima Puluh","Enam Puluh","Tujuh Puluh","Delapan Puluh","Sembilan Puluh"],u=l=>{if(l===0)return"";if(l<10)return h[l];if(l>=10&&l<20)return g[l-10];if(l<100){const P=Math.floor(l/10),R=l%10;return v[P]+(R>0?" "+h[R]:"")}const m=Math.floor(l/100),w=l%100;return(m===1?"Seratus":h[m]+" Ratus")+(w>0?" "+u(w):"")};if(r<1e3)return u(r);if(r<1e6){const l=Math.floor(r/1e3),m=r%1e3;return(l===1?"Seribu":u(l)+" Ribu")+(m>0?" "+u(m):"")}if(r<1e9){const l=Math.floor(r/1e6),m=r%1e6,w=u(l)+" Juta",S=m>=1e3?(Math.floor(m/1e3)===1?"Seribu":u(Math.floor(m/1e3))+" Ribu")+(m%1e3>0?" "+u(m%1e3):""):m>0?u(m):"";return w+(S?" "+S:"")}return r.toString()},Y=r=>{if(r===0)return"Zero";const h=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],g=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],v=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],u=l=>{if(l===0)return"";if(l<10)return h[l];if(l>=10&&l<20)return g[l-10];if(l<100){const S=Math.floor(l/10),P=l%10;return v[S]+(P>0?" "+h[P]:"")}const m=Math.floor(l/100),w=l%100;return h[m]+" Hundred"+(w>0?" "+u(w):"")};if(r<1e3)return u(r);if(r<1e6){const l=Math.floor(r/1e3),m=r%1e3;return u(l)+" Thousand"+(m>0?" "+u(m):"")}if(r<1e9){const l=Math.floor(r/1e6),m=r%1e6,w=m>=1e3?u(Math.floor(m/1e3))+" Thousand"+(m%1e3>0?" "+u(m%1e3):""):m>0?u(m):"";return u(l)+" Million"+(w?" "+w:"")}return r.toString()},F=()=>{window.print()},K=async()=>{if($.current)try{const r=await Xe($.current,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",windowWidth:$.current.scrollWidth,windowHeight:$.current.scrollHeight,onclone:P=>{const R=P.getElementById("invoice-print-content");R&&(R.style.width="210mm")}}),h=r.toDataURL("image/png",1),g=new et("p","mm","a4"),v=g.internal.pageSize.getWidth(),u=g.internal.pageSize.getHeight(),l=r.width,m=r.height,w=v/l,S=m*w;if(S>u){let P=0,R=S;for(;R>0;)g.addImage(h,"PNG",0,P,v,S),R-=u,P-=u,R>0&&g.addPage()}else g.addImage(h,"PNG",0,0,v,S);g.save(`Invoice-${n.invoice_number}.pdf`)}catch(r){console.error("Error generating PDF:",r),alert("Failed to generate PDF. Please try again.")}},k=n.customers,p=n.payment_terms_days||30,E=()=>p===0?"Advance / Immediate":`${p} ${c==="id"?"Hari":"Days"}`;return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 print:static print:bg-white print:overflow-visible",children:[e.jsx("div",{className:"flex min-h-screen items-start justify-center p-4 pt-10 print:p-0 print:min-h-0 print:block",children:e.jsxs("div",{className:"relative w-full max-w-5xl bg-white shadow-xl print:shadow-none print:max-w-full",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-6 py-4",style:{printColorAdjust:"exact",WebkitPrintColorAdjust:"exact"},children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[c==="id"?"Faktur":"Invoice"," ",n.invoice_number]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:F,className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e.jsx(Ze,{className:"h-4 w-4"}),c==="id"?"Cetak":"Print"]}),e.jsxs("button",{onClick:K,className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:[e.jsx(tt,{className:"h-4 w-4"}),"PDF"]}),e.jsx("button",{onClick:T,className:"rounded-lg bg-gray-100 p-2 text-gray-600 hover:bg-gray-200",children:e.jsx(Je,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{id:"invoice-print-content",ref:$,className:"p-8",children:[e.jsxs("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-16 flex items-center justify-center print:h-12 print:w-12",style:{backgroundColor:"#fff"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:"100%",height:"100%",viewBox:"0 0 15686.55 15480.24",style:{shapeRendering:"geometricPrecision",fillRule:"evenodd",clipRule:"evenodd"},children:e.jsxs("g",{children:[e.jsx("path",{fill:"#FDB763",d:"M69.94 10438.12l10353.39 0 0 -1798.67 1665.92 0 0 1868.6 0 320.44 0 4552.28c0,38.48 -31.45,69.94 -69.94,69.94l-11949.38 0c-38.48,0 -69.94,-31.45 -69.94,-69.94l0 -4872.72c0,-38.48 31.45,-69.94 69.94,-69.94zm1605.9 1710.15l8737.57 0c13.58,0 24.68,11.11 24.68,24.68l0 1719.84c0,13.58 -11.11,24.68 -24.68,24.68l-8737.57 0c-13.58,0 -24.68,-11.11 -24.68,-24.68l0 -1719.84c0,-13.58 11.11,-24.68 24.68,-24.68z"}),e.jsx("path",{fill:"#FDB763",d:"M15587.15 5136.67l-10353.49 0 0 1822.07 -1665.92 0 0 -1892.9 0 -324.61 0 -4611.43c0,-39 31.45,-70.87 69.94,-70.87l11949.47 0c38.48,0 69.94,31.87 69.94,70.87l0 4936.04c0,39 -31.45,70.83 -69.94,70.83zm-1605.9 -1732.36l-8737.67 0c-13.58,0 -24.68,-11.27 -24.68,-25l0 -1742.21c0,-13.74 11.11,-25 24.68,-25l8737.67 0c13.58,0 24.68,11.27 24.68,25l0 1742.21c0,13.74 -11.11,25 -24.68,25z"}),e.jsx("polygon",{fill:"#FD6D26",points:"-0,0 1651.16,0 1651.16,6929.27 15657.09,6929.27 15657.09,6958.74 15686.55,6958.74 15686.55,15480.24 14022.85,15480.24 14022.85,8639.45 1651.16,8639.45 -0,8639.45 -0,6929.27"})]})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold print:text-sm",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Komplek Ruko Metro Sunter Blok A1 NO.15, Jl. Metro Indah Raya,"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Kelurahan Papanggo, Kec. Tanjung Priok, Jakarta Utara - 14340"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Telp: (+62 21) 65832426"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("h2",{className:"text-3xl font-bold print:text-2xl",children:"INVOICE"})})]}),e.jsxs("div",{className:"text-xs space-y-0.5 print:text-[10px] print:space-y-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No izin PBF"}),e.jsx("span",{className:"ml-16",children:": 27092400534390007"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No Sertifikasi CDOB"}),e.jsx("span",{className:"ml-4",children:": 270924005343900070001"})]})]})]}),e.jsx("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 flex-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Company Name:"}),e.jsxs("span",{className:"font-semibold",children:[" ",(k==null?void 0:k.company_name)||""]})]}),e.jsxs("div",{className:"pt-1 flex",children:[e.jsx("span",{className:"font-bold",style:{minWidth:"72px"},children:"Address:"}),e.jsxs("div",{children:[e.jsx("p",{children:(k==null?void 0:k.address)||""}),e.jsx("p",{children:(k==null?void 0:k.city)||""})]})]}),e.jsxs("div",{className:"flex pt-1",children:[e.jsx("span",{className:"font-bold",style:{minWidth:"72px"},children:"Phone:"}),e.jsx("span",{children:(k==null?void 0:k.phone)||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"font-bold",style:{minWidth:"72px"},children:"NPWP:"}),e.jsx("span",{children:(k==null?void 0:k.npwp)||""})]})]}),e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 text-right",style:{minWidth:"200px"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Invoice No:"}),e.jsx("span",{className:"ml-2",children:n.invoice_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Invoice Date:"}),e.jsx("span",{className:"ml-2",children:G(n.invoice_date)})]}),e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"font-bold",children:"Po No:"}),e.jsx("span",{className:"ml-2",children:n.po_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Payment Terms:"}),e.jsx("span",{className:"ml-2",children:E()})]})]})]})}),e.jsx("div",{children:e.jsxs("table",{className:"w-full border-2 border-black text-xs print:text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black bg-white",children:[e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"No."}),e.jsx("th",{className:"border-r border-black p-1.5 text-left font-bold print:p-1",children:"Product Name"}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"Batch No."}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"Exp. Date"}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"Total Qty"}),e.jsx("th",{className:"border-r border-black p-1.5 text-center font-bold print:p-1",children:"UOM"}),e.jsx("th",{className:"border-r border-black p-1.5 text-right font-bold print:p-1",children:"Unit Price (IDR)"}),e.jsx("th",{className:"p-1.5 text-right font-bold print:p-1",children:"Sub Total (IDR)"})]})}),e.jsxs("tbody",{children:[f.map((r,h)=>{var m,w,S,P;const g=r.quantity||0,v=r.unit_price||0,u=g*v,l=(m=r.batches)!=null&&m.expiry_date?B(r.batches.expiry_date):"-";return e.jsxs("tr",{className:"border-b border-black",children:[e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:h+1}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:((w=r.products)==null?void 0:w.product_name)||"Unknown Product"}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:((S=r.batches)==null?void 0:S.batch_number)||"N/A"}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:l}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:g.toLocaleString()}),e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:((P=r.products)==null?void 0:P.unit)||"Kg"}),e.jsx("td",{className:"border-r border-black p-1.5 text-right print:p-1",children:_(v)}),e.jsx("td",{className:"p-1.5 text-right print:p-1",children:_(u)})]},r.id||h)}),f.length<2&&Array.from({length:2-f.length}).map((r,h)=>e.jsxs("tr",{className:"border-b border-black",children:[e.jsx("td",{className:"border-r border-black p-1.5 text-center print:p-1",children:"Â "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:"Â "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:"Â "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:"Â "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:"Â "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:"Â "}),e.jsx("td",{className:"border-r border-black p-1.5 print:p-1",children:"Â "}),e.jsx("td",{className:"p-1.5 print:p-1",children:"Â "})]},`empty-${h}`))]})]})}),e.jsxs("div",{className:"border-2 border-black border-t-0",children:[e.jsxs("div",{className:"flex items-stretch border-b-2 border-black",children:[e.jsxs("div",{className:"flex-1 p-2 border-r-2 border-black print:p-1.5",children:[e.jsx("p",{className:"text-xs font-bold print:text-[10px]",children:c==="id"?"Amount In words:":"Amount in words:"}),e.jsxs("p",{className:"text-xs mt-0.5 font-bold uppercase print:text-[10px] print:mt-0",children:["IDR ",O(Math.round(n.total_amount))," RUPIAH"]})]}),e.jsxs("div",{className:"w-80 text-xs p-2 print:text-[10px] print:p-1.5",children:[e.jsxs("div",{className:"flex justify-between py-1 print:py-0.5",children:[e.jsx("span",{className:"font-bold",children:"Sub Total"}),e.jsx("span",{className:"font-bold",children:_(n.subtotal)})]}),e.jsxs("div",{className:"flex justify-between border-t border-black py-1 print:py-0.5",children:[e.jsx("span",{className:"font-bold",children:"VAT (PPN) 11%"}),e.jsx("span",{className:"font-bold",children:_(n.tax_amount)})]}),e.jsxs("div",{className:"flex justify-between border-t-2 border-black py-1 print:py-0.5",children:[e.jsx("span",{className:"font-bold",children:"Grand Total"}),e.jsx("span",{className:"font-bold text-sm print:text-xs",children:_(n.total_amount)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-0 text-xs print:text-[10px]",children:[e.jsxs("div",{className:"p-3 border-r-2 border-black print:p-2",children:[e.jsx("p",{className:"font-semibold mb-2 print:mb-1",children:"Bank Details:"}),e.jsxs("div",{className:"space-y-0.5 print:space-y-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"font-semibold",style:{minWidth:"95px"},children:"Bank Name"}),e.jsx("span",{className:"mr-2",children:":"}),e.jsx("span",{children:"BCA"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"font-semibold",style:{minWidth:"95px"},children:"Branch"}),e.jsx("span",{className:"mr-2",children:":"}),e.jsx("span",{children:"Sunter Mall, Jakarta"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"font-semibold",style:{minWidth:"95px"},children:"Account Name"}),e.jsx("span",{className:"mr-2",children:":"}),e.jsx("span",{className:"whitespace-nowrap",children:"PT. Shubham Anzen Pharma Jaya"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"font-semibold",style:{minWidth:"95px"},children:"Account No."}),e.jsx("span",{className:"mr-2",children:":"}),e.jsx("span",{children:"0930 2010 14 (IDR)"})]})]})]}),e.jsxs("div",{className:"p-3 print:p-2",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Authorized Signatory:"}),e.jsx("p",{className:"font-semibold mb-10 print:mb-8",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("div",{className:"w-4/5 border-t border-black pt-1",children:"Pharmacist"})]})]})]}),e.jsx("div",{className:"border-2 border-black border-t-0 p-2.5 print:p-2",children:e.jsx("p",{className:"text-xs font-semibold text-center print:text-[10px]",children:c==="id"?`Pembayaran jatuh tempo dalam ${E()} sejak tanggal barang dikirim.`:`Payment is due within ${E()} from the date on which the goods are delivered.`})}),n.notes&&e.jsx("div",{className:"mt-3 border-2 border-black p-2 print:mt-2 print:p-1.5",children:e.jsxs("p",{className:"text-xs print:text-[10px]",children:[e.jsx("span",{className:"font-bold",children:"Notes: "}),e.jsx("span",{children:n.notes})]})})]}),e.jsxs("div",{className:"mt-6 p-6 bg-blue-50 border-2 border-blue-200 rounded-lg print:hidden",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-4",children:"Cost Analysis & Profitability (Internal Use Only)"}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"Selling Price"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"Revenue"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"COGS/Unit"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"Total COGS"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"Gross Profit"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-700",children:"Margin %"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:f.map((r,h)=>{var P;const g=r.quantity||0,v=r.unit_price||0,u=g*v,l=0,m=l*g,w=u-m,S=u>0?w/u*100:0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[e.jsx("div",{className:"font-medium",children:(P=r.products)==null?void 0:P.product_name}),r.batches&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Batch: ",r.batches.batch_number]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:g}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:_(v)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium text-gray-900",children:_(u)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-600",children:e.jsx("span",{className:"text-orange-600 font-medium",children:_(l)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium text-orange-600",children:_(m)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:_(w)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("span",{className:`font-semibold ${S>=20?"text-green-600":S>=10?"text-yellow-600":"text-red-600"}`,children:[S.toFixed(1),"%"]})})]},h)})}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-sm font-bold text-gray-900 text-right",children:"TOTALS:"}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-gray-900 text-right",children:_(n.subtotal)}),e.jsx("td",{}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-orange-600 text-right",children:_(0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-600 text-right",children:_(n.subtotal-0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-right",children:e.jsxs("span",{className:`${(n.subtotal>0?(n.subtotal-0)/n.subtotal*100:0)>=20?"text-green-600":"text-yellow-600"}`,children:[(n.subtotal>0?(n.subtotal-0)/n.subtotal*100:0).toFixed(1),"%"]})})]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 mb-1",children:"Total Revenue (excl. Tax)"}),e.jsx("div",{className:"text-xl font-bold text-blue-900",children:_(n.subtotal)})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 mb-1",children:"Total COGS"}),e.jsx("div",{className:"text-xl font-bold text-orange-900",children:_(0)}),e.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"Cost of goods sold"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs font-medium text-green-700 mb-1",children:"Gross Profit"}),e.jsx("div",{className:"text-xl font-bold text-green-900",children:_(n.subtotal-0)}),e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Margin: ",(n.subtotal>0?(n.subtotal-0)/n.subtotal*100:0).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-xs text-yellow-800",children:[e.jsx("p",{className:"font-semibold",children:"Note:"}),e.jsx("p",{className:"mt-1",children:"This cost analysis is for internal management use only. COGS data is pulled from batch landed costs (including import costs). This section will NOT appear when printing the invoice."})]})]})})]})]})]})}),e.jsx("style",{children:`
        @media print {
          @page {
            size: A4 portrait;
            margin: 8mm;
          }

          .sticky {
            display: none !important;
          }

          body {
            margin: 0;
            padding: 0;
          }

          body * {
            visibility: hidden;
          }

          #invoice-print-content,
          #invoice-print-content * {
            visibility: visible;
          }

          #invoice-print-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            page-break-inside: avoid;
            page-break-after: auto;
          }

          #invoice-print-content > div {
            page-break-inside: avoid;
          }

          table {
            page-break-inside: auto;
          }

          tr {
            page-break-inside: avoid;
            page-break-after: auto;
          }

          thead {
            display: table-header-group;
          }

          tfoot {
            display: table-footer-group;
          }
        }
      `})]})}function ct({options:n,selectedDCIds:f,onChange:T,placeholder:$="Select Delivery Challans"}){var k;const[U,c]=b.useState(!1),[_,G]=b.useState(""),B=b.useRef(null);b.useEffect(()=>{function p(E){B.current&&!B.current.contains(E.target)&&c(!1)}return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const O=n.filter(p=>p.challan_number.toLowerCase().includes(_.toLowerCase())),V=p=>{f.includes(p)?T(f.filter(E=>E!==p)):T([...f,p])},Y=()=>{f.length===O.length?T([]):T(O.map(p=>p.challan_id))},F=f.length,K=F===0?$:F===1?((k=n.find(p=>p.challan_id===f[0]))==null?void 0:k.challan_number)||`${F} DCs selected`:`${F} DCs selected`;return e.jsxs("div",{className:"relative",ref:B,children:[e.jsxs("button",{type:"button",onClick:()=>c(!U),className:"w-full px-2 py-1.5 text-sm text-left bg-white border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent flex items-center justify-between",children:[e.jsx("span",{className:F===0?"text-gray-400":"text-gray-900",children:K}),e.jsx(st,{className:`w-3 h-3 transition-transform ${U?"transform rotate-180":""}`})]}),U&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-96 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-2 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:_,onChange:p=>G(p.target.value),placeholder:"Search...",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",onClick:p=>p.stopPropagation()})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-80",children:[O.length>1&&e.jsx("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-200 sticky top-0 bg-white",onClick:Y,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${f.length===O.length?"bg-green-600 border-green-600":f.length>0?"bg-gray-300 border-gray-300":"border-gray-300"}`,children:f.length>0&&e.jsx(ve,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900",children:"(Select All)"})]})}),O.length===0?e.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"No delivery challans found"}):O.map(p=>{const E=f.includes(p.challan_id);return e.jsx("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer",onClick:()=>V(p.challan_id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${E?"bg-green-600 border-green-600":"border-gray-300"}`,children:E&&e.jsx(ve,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:p.challan_number}),e.jsxs("div",{className:"text-xs text-gray-500",children:[Ne(p.challan_date)," â€¢ ",p.item_count," items pending"]})]})]})},p.challan_id)})]})]})]})}function Pt(){const{t:n}=je(),{profile:f}=Ue(),{navigationData:T,clearNavigationData:$,setCurrentPage:U}=ze(),{dateRange:c}=He(),[_,G]=b.useState([]),[B,O]=b.useState([]),[V,Y]=b.useState([]),[F,K]=b.useState([]),[k,p]=b.useState([]),[E,r]=b.useState([]),[h,g]=b.useState([]),[v,u]=b.useState(""),[l,m]=b.useState([]),[w,S]=b.useState(""),[P,R]=b.useState([]),[dt,mt]=b.useState(new Map),[ut,xt]=b.useState(new Set),[we,Se]=b.useState(!0),[ke,z]=b.useState(!1),[De,ce]=b.useState(!1),[W,de]=b.useState(null),[me,ue]=b.useState(null),[Pe,xe]=b.useState([]),[x,q]=b.useState({invoice_number:"",customer_id:"",invoice_date:new Date().toISOString().split("T")[0],payment_terms:"30",discount:0,delivery_challan_number:"",po_number:"",notes:""}),[A,L]=b.useState([{product_id:"",batch_id:null,quantity:1,unit_price:0,tax_rate:11,total:0}]);b.useEffect(()=>{ne(),Ce(),Te(),pe()},[c.startDate,c.endDate]),b.useEffect(()=>{(T==null?void 0:T.sourceType)==="delivery_challan"&&(qe(T),$())},[T]),b.useEffect(()=>{l.length>0&&x.customer_id&&!W&&Ie()},[l]);const Ie=async()=>{try{const{data:t,error:s}=await j.from("pending_dc_items_by_customer").select("*").eq("customer_id",x.customer_id).in("challan_id",l);if(s)throw s;const o=await Promise.all((t||[]).map(async a=>{const d=a.selling_price||a.unit_price||0;return{product_id:a.product_id,batch_id:a.batch_id,quantity:a.remaining_quantity,unit_price:d,tax_rate:11,total:0,delivery_challan_item_id:a.dc_item_id,dc_number:a.challan_number,max_quantity:a.remaining_quantity}}));o.length>0?L(o.map(a=>({...a,total:ee(a)}))):L([{product_id:"",batch_id:null,quantity:1,unit_price:0,tax_rate:11,total:0}])}catch(t){console.error("Error loading DC items:",t)}},ne=async()=>{try{const{data:t,error:s}=await j.from("sales_invoices").select("*, customers(company_name, address, city, phone, npwp, pharmacy_license, gst_vat_type)").gte("invoice_date",c.startDate).lte("invoice_date",c.endDate).order("invoice_date",{ascending:!1});if(s)throw s;const o=await Promise.all((t||[]).map(async a=>{const{data:d}=await j.rpc("get_invoice_paid_amount",{p_invoice_id:a.id}),N=d||0,y=a.total_amount-N;return{...a,paid_amount:N,balance_amount:y}}));G(o)}catch(t){console.error("Error loading invoices:",t)}finally{Se(!1)}},ie=async()=>{try{const{data:t}=await j.from("app_settings").select("invoice_prefix, invoice_start_number").limit(1).maybeSingle(),s=(t==null?void 0:t.invoice_prefix)||"SAPJ",o=(t==null?void 0:t.invoice_start_number)||1,{data:a,error:d}=await j.rpc("get_current_financial_year");if(d){console.error("Error getting financial year:",d);const i=new Date().getFullYear().toString().slice(-2);return`${s}-${i}-001`}const{data:N}=await j.from("sales_invoices").select("invoice_number").like("invoice_number",`${s}-${a}%`);let y=o;if(N&&N.length>0){const i=N.map(C=>{const J=C.invoice_number.match(/(\d+)$/);return J?parseInt(J[1],10):0}).filter(C=>!isNaN(C));i.length>0&&(y=Math.max(...i)+1)}const I=String(y).padStart(3,"0");return`${s}-${a}-${I}`}catch(t){return console.error("Error generating invoice number:",t),`SAPJ-${new Date().getFullYear().toString().slice(-2)}-001`}},Ce=async()=>{try{const{data:t,error:s}=await j.from("customers").select("id, company_name, gst_vat_type").eq("is_active",!0).order("company_name");if(s)throw s;O(t||[])}catch(t){console.error("Error loading customers:",t)}},Te=async()=>{try{const{data:t,error:s}=await j.from("products").select("id, product_name, product_code").eq("is_active",!0).order("product_name");if(s)throw s;Y(t||[])}catch(t){console.error("Error loading products:",t)}},pe=async()=>{try{const{data:t,error:s}=await j.from("batches").select("id, batch_number, product_id, current_stock, import_price, duty_charges, freight_charges, other_charges, import_quantity, import_date, expiry_date").eq("is_active",!0).order("import_date",{ascending:!0});if(s)throw s;K(t||[])}catch(t){console.error("Error loading batches:",t)}},Ee=async t=>{try{const{data:s,error:o}=await j.from("delivery_challans").select("id, challan_number, challan_date, delivery_address, vehicle_number, notes").eq("customer_id",t).order("challan_date",{ascending:!1});if(o)throw o;const{data:a,error:d}=await j.from("sales_invoices").select("linked_challan_ids").not("linked_challan_ids","is",null);if(d)throw d;const N=new Set;a==null||a.forEach(I=>{var i;(i=I.linked_challan_ids)==null||i.forEach(C=>N.add(C))});const y=(s==null?void 0:s.filter(I=>!N.has(I.id)))||[];p(y)}catch(s){console.error("Error loading pending challans:",s),p([])}},Ae=async t=>{try{const{data:s,error:o}=await j.from("sales_orders").select("id, so_number, total_amount, advance_payment_amount, advance_payment_status, status").eq("customer_id",t).eq("is_archived",!1).in("status",["approved","stock_reserved","shortage","pending_delivery","partially_delivered","delivered"]).order("created_at",{ascending:!1});if(o)throw o;g(s||[])}catch(s){console.error("Error loading customer sales orders:",s),g([])}},he=async t=>{try{const{data:s,error:o}=await j.from("dc_invoicing_summary").select("challan_id, challan_number, challan_date, total_quantity, total_remaining_quantity").eq("customer_id",t).gt("total_remaining_quantity",0).order("challan_date",{ascending:!1});if(o)throw o;const a=(s||[]).map(d=>({challan_id:d.challan_id,challan_number:d.challan_number,challan_date:d.challan_date,item_count:d.total_remaining_quantity}));r(a)}catch(s){console.error("Error loading pending DC options:",s),r([])}},Fe=()=>{L([...A,{product_id:"",batch_id:null,quantity:1,unit_price:0,tax_rate:11,total:0,delivery_challan_item_id:null}])},qe=async t=>{const s=await ie();q({invoice_number:s,customer_id:t.customerId,invoice_date:new Date().toISOString().split("T")[0],payment_terms:"30",discount:0,delivery_challan_number:t.challanNumber,po_number:"",notes:`Created from Delivery Challan: ${t.challanNumber}`}),t.customerId&&await Ee(t.customerId);const o=t.items.map(a=>{const d=F.find(I=>I.id===a.batch_id),y=(d?(d.import_price+d.duty_charges+d.freight_charges+d.other_charges)/d.import_quantity:0)*1.25;return{product_id:a.product_id,batch_id:a.batch_id,quantity:a.quantity,unit_price:Math.round(y),tax_rate:11,total:0,delivery_challan_item_id:a.id||null}});L(o.map(a=>({...a,total:ee(a)}))),z(!0)},be=async t=>{try{const{data:s,error:o}=await j.from("sales_invoice_items").select(`
          *,
          products(product_name, product_code, unit),
          batches(batch_number, expiry_date),
          delivery_challan_item_id
        `).eq("invoice_id",t);if(o)throw o;const a=await Promise.all((s||[]).map(async d=>{var N;if(d.delivery_challan_item_id){const{data:y}=await j.from("delivery_challan_items").select("challan_id, delivery_challans(challan_number)").eq("id",d.delivery_challan_item_id).maybeSingle();return{...d,dc_number:(N=y==null?void 0:y.delivery_challans)==null?void 0:N.challan_number}}return d}));return xe(a||[]),a||[]}catch(s){return console.error("Error loading invoice items:",s),[]}},ee=t=>{const s=t.quantity*t.unit_price,o=s*(t.tax_rate/100);return s+o},ge=t=>{if(!t)return 0;const s=F.find(a=>a.id===t);return!s||!s.import_quantity?0:(s.import_price+s.duty_charges+s.freight_charges+s.other_charges)/s.import_quantity},Me=(t,s)=>s===0?0:(t-s)/t*100,ye=(t,s=25)=>{const o=ge(t);return Math.round(o*(1+s/100))},Q=(t,s)=>{const o=ee(s),a=[...A];a[t]={...s,total:o},L(a)},fe=t=>{A.length>1&&L(A.filter((s,o)=>o!==t))},te=()=>{const t=A.reduce((a,d)=>a+d.quantity*d.unit_price,0),s=A.reduce((a,d)=>{const N=d.quantity*d.unit_price;return a+N*(d.tax_rate/100)},0),o=t+s-x.discount;return{subtotal:t,taxAmount:s,total:o}},Oe=async t=>{t.preventDefault();try{const{data:{user:s}}=await j.auth.getUser();if(!s)throw new Error("Not authenticated");if(A.filter(i=>i.product_id&&i.product_id.trim()!=="").length===0){oe({type:"error",title:"Error",message:"Please add at least one product to the invoice before saving."});return}const a=te(),d=new Date(x.invoice_date);let N=new Date(d),y=30;x.payment_terms==="advance"||x.payment_terms==="50-50"?y=0:(y=parseInt(x.payment_terms),isNaN(y)||N.setDate(N.getDate()+y));let I;if(W){const i=new Map;A.filter(D=>D.product_id&&D.product_id.trim()!=="").forEach(D=>{const X=`${D.product_id}-${D.batch_id}-${D.delivery_challan_item_id||"manual"}`;i.has(X)||i.set(X,{product_id:D.product_id,batch_id:D.batch_id,quantity:D.quantity,unit_price:D.unit_price,tax_rate:D.tax_rate,total_amount:D.total,delivery_challan_item_id:D.delivery_challan_item_id||null,max_quantity:D.max_quantity||null})});const C=Array.from(i.values()),{data:J,error:Z}=await j.rpc("update_sales_invoice_atomic",{p_invoice_id:W.id,p_invoice_updates:{invoice_date:x.invoice_date,due_date:N.toISOString().split("T")[0],customer_id:x.customer_id,subtotal:a.subtotal,tax_amount:a.taxAmount,total_amount:a.total,discount_amount:x.discount,po_number:x.po_number||null,payment_terms_days:y,notes:x.notes||null},p_new_items:C});if(Z)throw Z;const{data:re,error:H}=await j.from("sales_invoices").select().eq("id",W.id).single();if(H)throw H;I=re}else{let i=x.invoice_number;const{data:C}=await j.from("sales_invoices").select("invoice_number").eq("invoice_number",i).maybeSingle();C&&(i=await ie(),q(M=>({...M,invoice_number:i})));const{data:J,error:Z}=await j.from("sales_invoices").insert([{invoice_number:i,customer_id:x.customer_id,sales_order_id:v||null,invoice_date:x.invoice_date,due_date:N.toISOString().split("T")[0],discount_amount:x.discount,delivery_challan_number:null,po_number:x.po_number||null,payment_terms_days:y,notes:x.notes||null,subtotal:a.subtotal,tax_amount:a.taxAmount,total_amount:a.total,payment_status:"pending",created_by:s.id,linked_challan_ids:l.length>0?l:null}]).select().single();if(Z)throw Z;I=J;const re=A.filter(M=>M.product_id&&M.product_id.trim()!=="").map(M=>({invoice_id:I.id,product_id:M.product_id,batch_id:M.batch_id,quantity:M.quantity,unit_price:M.unit_price,tax_rate:M.tax_rate,delivery_challan_item_id:M.delivery_challan_item_id||null})),{error:H}=await j.from("sales_invoice_items").insert(re);if(H)throw console.error("Error inserting invoice items:",H),console.error("Invoice items data:",re),new Error(`Failed to save invoice items: ${H.message}`);const{data:D,error:X}=await j.from("sales_invoice_items").select("id").eq("invoice_id",I.id);if(X)console.error("Error verifying items:",X);else if(!D||D.length===0)throw new Error("Invoice items were not saved. Please try again.")}await ne(),await pe(),z(!1),se()}catch(s){console.error("Error saving invoice:",s),oe({type:"error",title:"Error",message:`Failed to save invoice: ${s.message||"Unknown error"}. Please check console for details.`})}},Re=async t=>{ue(t),await be(t.id),ce(!0)},$e=async t=>{de(t),q({invoice_number:t.invoice_number,customer_id:t.customer_id,invoice_date:t.invoice_date,payment_terms:String(t.payment_terms_days||30),discount:t.discount_amount,delivery_challan_number:t.delivery_challan_number||"",po_number:t.po_number||"",notes:t.notes||""});const s=await be(t.id);s.length>0&&L(s.map(o=>{const a={product_id:o.product_id,batch_id:o.batch_id,quantity:o.quantity,unit_price:o.unit_price,tax_rate:o.tax_rate,total:0,delivery_challan_item_id:o.delivery_challan_item_id,dc_number:o.dc_number};return{...a,total:ee(a)}})),await he(t.customer_id),t.linked_challan_ids&&t.linked_challan_ids.length>0&&m(t.linked_challan_ids),z(!0)},Le=async t=>{if(await Ge({title:"Confirm",message:"Are you sure you want to delete this invoice?",variant:"danger",confirmLabel:"Delete"}))try{const{error:s}=await j.from("sales_invoices").delete().eq("id",t);if(s)throw s;ne()}catch(s){console.error("Error deleting invoice:",s),oe({type:"error",title:"Error",message:"Failed to delete invoice. Please try again."})}},se=()=>{de(null),S(""),p([]),r([]),m([]),u(""),g([]),q({invoice_number:"",customer_id:"",invoice_date:new Date().toISOString().split("T")[0],payment_terms:"30",discount:0,delivery_challan_number:"",po_number:"",notes:""}),L([{product_id:"",batch_id:null,quantity:1,unit_price:0,tax_rate:11,total:0}])},Be=[{key:"invoice_number",label:n("sales.invoiceNumber")},{key:"customer",label:n("sales.customer"),render:(t,s)=>{var o;return e.jsx("div",{className:"font-medium",children:(o=s.customers)==null?void 0:o.company_name})}},{key:"invoice_date",label:n("common.date"),render:(t,s)=>Ne(s.invoice_date)},{key:"total_amount",label:n("common.total"),render:(t,s)=>e.jsxs("span",{className:"font-medium",children:["Rp ",s.total_amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})},{key:"paid_amount",label:n("sales.paidAmount"),render:(t,s)=>e.jsxs("span",{className:"text-green-600 font-medium",children:["Rp ",(s.paid_amount||0).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})},{key:"balance_amount",label:n("sales.balance"),render:(t,s)=>e.jsxs("span",{className:`font-medium ${(s.balance_amount||0)===0?"text-gray-400":"text-orange-600"}`,children:["Rp ",(s.balance_amount||0).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})},{key:"payment_status",label:n("sales.paymentStatus"),render:(t,s)=>e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s.payment_status==="paid"?"bg-green-100 text-green-800":s.payment_status==="partial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.payment_status==="pending"?n("common.unpaid"):s.payment_status==="partial"?n("common.partial"):n("common.paid")})}],_e=(f==null?void 0:f.role)==="admin"||(f==null?void 0:f.role)==="accounts"||(f==null?void 0:f.role)==="sales",ae={total:_.length,totalRevenue:_.reduce((t,s)=>t+s.total_amount,0),pending:_.filter(t=>t.payment_status==="pending").length,paid:_.filter(t=>t.payment_status==="paid").length};return e.jsx(Ve,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n("sales.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:n("sales.invoices")})]}),_e&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:async()=>{se();const t=await ie();q(s=>({...s,invoice_number:t})),z(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Ke,{className:"w-5 h-5"}),n("sales.createInvoice")]}),e.jsxs("button",{onClick:()=>{U("credit-notes")},className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition",children:[e.jsx(lt,{className:"w-5 h-5"}),n("nav.creditNotes")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:n("sales.invoices")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:ae.total})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm text-blue-600",children:n("common.total")}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:["Rp ",ae.totalRevenue.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm text-red-600",children:n("common.pending")}),e.jsx("p",{className:"text-2xl font-bold text-red-600 mt-1",children:ae.pending})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm text-green-600",children:n("common.paid")}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:ae.paid})]})]}),e.jsx(Ye,{columns:Be,data:_,loading:we,actions:_e?t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Re(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:n("common.view"),children:e.jsx(nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$e(t),className:"p-1 text-green-600 hover:bg-green-50 rounded",title:n("common.edit"),children:e.jsx(it,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Le(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:n("common.delete"),children:e.jsx(le,{className:"w-4 h-4"})})]}):void 0}),e.jsx(Qe,{isOpen:ke,onClose:()=>{z(!1),se()},title:n(W?"sales.editInvoice":"sales.createInvoice"),size:"xl",children:e.jsxs("form",{onSubmit:Oe,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[n("sales.invoiceNumber")," *"]}),e.jsx("input",{type:"text",value:x.invoice_number,className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded bg-gray-100",required:!0,readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Date *"}),e.jsx("input",{type:"date",value:x.invoice_date,onChange:t=>q({...x,invoice_date:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Payment Terms *"}),e.jsxs("select",{value:x.payment_terms,onChange:t=>q({...x,payment_terms:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"0",children:"Immediate"}),e.jsx("option",{value:"15",children:"15 Days"}),e.jsx("option",{value:"30",children:"30 Days"}),e.jsx("option",{value:"45",children:"45 Days"}),e.jsx("option",{value:"60",children:"60 Days"}),e.jsx("option",{value:"advance",children:"Advance"}),e.jsx("option",{value:"50-50",children:"50% Adv & 50% on Delivery"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsx(rt,{value:x.customer_id,onChange:t=>{q({...x,customer_id:t}),S(""),p([]),m([]),u(""),g([]),L([{product_id:"",batch_id:null,quantity:1,unit_price:0,tax_rate:11,total:0}]),t?(he(t),Ae(t)):(r([]),g([]))},options:B.map(t=>({value:t.id,label:t.company_name})),placeholder:"Select Customer",className:"text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Delivery Challans"}),e.jsx(ct,{options:E,selectedDCIds:l,onChange:m,placeholder:"Select DCs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"PO Number"}),e.jsx("input",{type:"text",value:x.po_number,onChange:t=>q({...x,po_number:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Customer PO Number"})]})]}),h.length>0&&!W&&e.jsxs("div",{className:"p-3 bg-blue-50 border-2 border-blue-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-bold text-blue-900 mb-2",children:"ðŸ”— Link to Sales Order (for advance payment tracking)"}),e.jsxs("select",{value:v,onChange:t=>u(t.target.value),className:"w-full px-3 py-2 text-sm border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white font-medium",children:[e.jsx("option",{value:"",children:"-- Select Sales Order (if this invoice is from an SO) --"}),h.map(t=>e.jsxs("option",{value:t.id,children:[t.so_number," - Rp ",t.total_amount.toLocaleString("id-ID"),t.advance_payment_amount>0?` ðŸ’° ADVANCE PAID: Rp ${t.advance_payment_amount.toLocaleString("id-ID")}`:" (No advance)"]},t.id))]}),v&&(()=>{const t=h.find(s=>s.id===v);return t&&t.advance_payment_amount>0?e.jsxs("div",{className:"mt-2 p-2 bg-green-100 border border-green-300 rounded",children:[e.jsxs("p",{className:"text-sm font-bold text-green-800",children:["âœ… Advance Payment: Rp ",t.advance_payment_amount.toLocaleString("id-ID")," will be automatically applied to this invoice"]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"The invoice payment status will be updated automatically after saving."})]}):v?e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"â„¹ï¸ This SO has no advance payment recorded."}):null})(),h.some(t=>t.advance_payment_amount>0)&&!v&&e.jsx("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-300 rounded",children:e.jsx("p",{className:"text-xs font-medium text-amber-800",children:"âš ï¸ IMPORTANT: This customer has Sales Orders with advance payments. Select the correct SO above to apply advance payment to this invoice!"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:x.notes,onChange:t=>q({...x,notes:t.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Additional notes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Discount (Rp)"}),e.jsx("input",{type:"number",value:x.discount===0?"":x.discount,onChange:t=>q({...x,discount:t.target.value===""?0:Number(t.target.value)}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",min:"0",placeholder:"0"})]})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-900",children:"Line Items"}),e.jsx("button",{type:"button",onClick:Fe,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Manual Item"})]}),e.jsx("div",{className:"space-y-1.5",children:A.map((t,s)=>{var I;const o=F.filter(i=>i.product_id===t.product_id),a=ge(t.batch_id),d=Me(t.unit_price,a),N=ye(t.batch_id),y=!!t.delivery_challan_item_id;return e.jsxs("div",{className:"p-2 bg-gray-50 rounded space-y-1 border-l-2",style:{borderLeftColor:y?"#3b82f6":"#10b981"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-blue-100 text-blue-700 rounded",children:["From DC: ",t.dc_number]}):e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-green-100 text-green-700 rounded",children:"Manual Item"}),y&&t.max_quantity&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:["Max: ",t.max_quantity," units"]})]}),!y&&A.length>1&&e.jsx("button",{type:"button",onClick:()=>fe(s),className:"text-red-600 hover:text-red-700",children:e.jsx(le,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end min-w-[700px]",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Product *"}),e.jsxs("select",{value:t.product_id,onChange:i=>Q(s,{...t,product_id:i.target.value,batch_id:null}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",disabled:y,required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),V.map(i=>e.jsx("option",{value:i.id,children:i.product_name},i.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Batch"}),e.jsxs("select",{value:t.batch_id||"",onChange:i=>{const C=i.target.value||null,J=ye(C);Q(s,{...t,batch_id:C,unit_price:J})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",disabled:!t.product_id||w!==""||y,children:[e.jsx("option",{value:"",children:"Select Batch"}),o.filter(i=>i.current_stock>0).map(i=>e.jsxs("option",{value:i.id,children:[i.batch_number," (",i.current_stock," stock)"]},i.id)),t.batch_id&&o.find(i=>i.id===t.batch_id&&i.current_stock===0)&&e.jsxs("option",{value:t.batch_id,children:[(I=o.find(i=>i.id===t.batch_id))==null?void 0:I.batch_number," (from challan)"]},t.batch_id)]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Quantity *"}),e.jsx("input",{type:"number",value:t.quantity===0?"":t.quantity,onChange:i=>Q(s,{...t,quantity:i.target.value===""?1:Number(i.target.value)}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",required:!0,min:"0.001",step:"0.001",placeholder:"0.25"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Unit Price *"}),e.jsx("input",{type:"number",step:"0.01",value:t.unit_price===0?"":t.unit_price,onChange:i=>Q(s,{...t,unit_price:i.target.value===""?0:parseFloat(i.target.value)||0}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",required:!0,min:"0",placeholder:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Tax %"}),e.jsx("input",{type:"number",value:t.tax_rate===0?"":t.tax_rate,onChange:i=>Q(s,{...t,tax_rate:i.target.value===""?0:Number(i.target.value)}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",min:"0",placeholder:"11"})]}),e.jsxs("div",{className:"col-span-2 flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Total"}),e.jsx("input",{type:"text",value:(t.total||0).toFixed(2),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded bg-gray-100",disabled:!0})]}),A.length>1&&e.jsx("button",{type:"button",onClick:()=>fe(s),className:"p-1.5 text-red-600 hover:bg-red-50 rounded",title:"Remove Item",children:e.jsx(le,{className:"w-4 h-4"})})]})]})}),t.batch_id&&a>0&&e.jsxs("div",{className:"flex items-center gap-2 text-[10px] px-2 py-1 bg-white rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Cost/Unit:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Rp ",a.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx("div",{className:"h-3 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Suggested Price (25%):"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["Rp ",N.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx("div",{className:"h-3 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-gray-600",children:["Margin ",e.jsx("span",{className:"text-xs italic",children:"(Provisional)"}),":"]}),e.jsxs("span",{className:`font-semibold ${d>=20?"text-green-600":d>=10?"text-yellow-600":"text-red-600"}`,children:[d.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-3 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-gray-600",children:["Profit/Unit ",e.jsx("span",{className:"text-xs italic",children:"(Provisional)"}),":"]}),e.jsxs("span",{className:`font-semibold ${t.unit_price>a?"text-green-600":"text-red-600"}`,children:["Rp ",(t.unit_price-a).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]},s)})}),e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"font-medium",children:["Rp ",te().subtotal.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax:"}),e.jsxs("span",{className:"font-medium",children:["Rp ",te().taxAmount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{className:"font-medium",children:["-Rp ",x.discount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-bold border-t pt-1",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-blue-600",children:["Rp ",te().total.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{z(!1),se()},className:"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:W?"Update Invoice":"Create Invoice"})]})]})}),De&&me&&e.jsx(ot,{invoice:me,items:Pe,onClose:()=>{ce(!1),ue(null),xe([])}})]})})}export{Pt as Sales};
