import{r as s,s as u,j as e}from"./index-05MON0zc.js";import{D as v}from"./DataTable-DghMVdqP.js";import{M as N}from"./Modal-DojL8f5j.js";import{P as k}from"./plus-C8ciBmA_.js";import{S as w}from"./square-pen-pND7Nsfd.js";import"./search-CGgsAlNq.js";import"./chevron-up-TszMf-vQ.js";import"./chevron-down-C44n7mhs.js";function R({canManage:d}){const[g,p]=s.useState([]),[x,y]=s.useState(!0),[h,c]=s.useState(!1),[o,m]=s.useState(null),[n,r]=s.useState({account_name:"",bank_name:"",account_number:"",account_type:"current",currency:"IDR",opening_balance:0,opening_balance_date:"2025-01-01",alias:""});s.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:a,error:t}=await u.from("bank_accounts").select("*").order("created_at",{ascending:!1});if(t)throw t;p(a||[])}catch(a){console.error("Error loading bank accounts:",a)}finally{y(!1)}},f=async a=>{a.preventDefault();try{const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Not authenticated");if(o){const{error:l}=await u.from("bank_accounts").update(n).eq("id",o.id);if(l)throw l}else{const{error:l}=await u.from("bank_accounts").insert([{...n,current_balance:n.opening_balance,created_by:t.id}]);if(l)throw l}c(!1),i(),b()}catch(t){console.error("Error saving bank account:",t),alert(`Failed to save bank account: ${t.message}`)}},_=a=>{m(a),r({account_name:a.account_name,bank_name:a.bank_name,account_number:a.account_number,account_type:a.account_type,currency:a.currency,opening_balance:a.opening_balance,opening_balance_date:a.opening_balance_date||"2025-01-01",alias:a.alias||""}),c(!0)},i=()=>{m(null),r({account_name:"",bank_name:"",account_number:"",account_type:"current",currency:"IDR",opening_balance:0,opening_balance_date:"2025-01-01",alias:""})},j=[{key:"account_name",label:"Account Name"},{key:"bank_name",label:"Bank"},{key:"account_number",label:"Account #"},{key:"type",label:"Type",render:(a,t)=>e.jsx("span",{className:"capitalize",children:t.account_type||"current"})},{key:"balance",label:"Balance",render:(a,t)=>e.jsxs("span",{className:"font-semibold",children:["Rp ",(t.current_balance||0).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})},{key:"status",label:"Status",render:(a,t)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.is_active?"Active":"Inactive"})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Bank Accounts"}),d&&e.jsxs("button",{onClick:()=>{i(),c(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(k,{className:"w-5 h-5"}),"Add Bank Account"]})]}),e.jsx(v,{columns:j,data:g,loading:x,actions:d?a=>e.jsx("button",{onClick:()=>_(a),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(w,{className:"w-4 h-4"})}):void 0}),e.jsx(N,{isOpen:h,onClose:()=>{c(!1),i()},title:o?"Edit Bank Account":"Add Bank Account",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name *"}),e.jsx("input",{type:"text",value:n.account_name,onChange:a=>r({...n,account_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name *"}),e.jsx("input",{type:"text",value:n.bank_name,onChange:a=>r({...n,bank_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Alias"}),e.jsx("input",{type:"text",value:n.alias,onChange:a=>r({...n,alias:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., BCA IDR, Mandiri USD"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Short name for easier identification in lists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number *"}),e.jsx("input",{type:"text",value:n.account_number,onChange:a=>r({...n,account_number:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Type *"}),e.jsxs("select",{value:n.account_type,onChange:a=>r({...n,account_type:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"savings",children:"Savings"}),e.jsx("option",{value:"current",children:"Current"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency *"}),e.jsxs("select",{value:n.currency,onChange:a=>r({...n,currency:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"IDR",children:"IDR (Indonesian Rupiah)"}),e.jsx("option",{value:"USD",children:"USD (US Dollar)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opening Balance"}),e.jsx("input",{type:"number",value:n.opening_balance===0?"":n.opening_balance,onChange:a=>r({...n,opening_balance:a.target.value===""?0:Number(a.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",step:"0.01",placeholder:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank if opening balance is zero"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opening Balance Date *"}),e.jsx("input",{type:"date",value:n.opening_balance_date,onChange:a=>r({...n,opening_balance_date:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Date when the opening balance is effective"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),i()},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[o?"Update":"Add"," Account"]})]})]})})]})}export{R as BankAccountsManager};
