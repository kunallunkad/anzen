import{c as Ut,r as y,m as qt,s as d,j as e,C as Bt,A as at,F as Pt}from"./index-D377iWu2.js";import{r as Vt,u as Wt}from"./xlsx-CKN5doRT.js";import{M as fe}from"./Modal-XL444I2e.js";import{S as Yt}from"./SearchableSelect-B1o4KxTG.js";import{R as st}from"./refresh-cw-BlA-hMpC.js";import{X as Te}from"./x-circle-BISlCpkj.js";import{U as nt}from"./upload-B0u4dWaP.js";import{C as Le}from"./check-circle-2-CKhQbbpp.js";import{P as Jt}from"./plus-BUV76DvH.js";import{S as Kt}from"./square-pen-Bq2ioL1R.js";import"./chevron-down-D_LZ1jaB.js";import"./search-C8aJjCFC.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Ut("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]);function ca({canManage:le}){var Qe,Ze,et,tt;const[Oe,rt]=y.useState([]),[w,qe]=y.useState(""),[g,it]=y.useState(null),[de,te]=y.useState([]),[ct,Be]=y.useState(!1),[ae,J]=y.useState(!1),[se,be]=y.useState("unmatched"),[S,ot]=y.useState(null),{dateRange:Me}=qt(),P={start:Me.startDate,end:Me.endDate},[D,H]=y.useState(null),[lt,X]=y.useState(!1),[me,dt]=y.useState([]),[Ae,ue]=y.useState(!1),pe=y.useRef(null),[ye,ne]=y.useState(null),[z,_e]=y.useState(null),[je,Ne]=y.useState(null),[x,xe]=y.useState(null),[mt,he]=y.useState(!1),[V,ve]=y.useState({debit:0,credit:0,description:""}),[A,we]=y.useState(null),[ut,Se]=y.useState(!1),[pt,xt]=y.useState([]),[De,Ue]=y.useState(""),[Pe,Ce]=y.useState([]),[Q,re]=y.useState({}),[ht,Ve]=y.useState(!1),[We,Ye]=y.useState([]),[ke,Ee]=y.useState(!1),[K,Z]=y.useState(!1),[Re,Ie]=y.useState([]),ie=[{value:"duty_customs",label:"Duty & Customs (BM)",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"ppn_import",label:"PPN Import",type:"operations",requiresContainer:!1,group:"Operations"},{value:"pph_import",label:"PPh Import",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"freight_import",label:"Freight (Import)",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"clearing_forwarding",label:"Clearing & Forwarding",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"port_charges",label:"Port Charges",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"container_handling",label:"Container Handling",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"transport_import",label:"Transportation (Import)",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"loading_import",label:"Loading / Unloading (Import)",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"bpom_ski_fees",label:"BPOM / SKI Fees",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"other_import",label:"Other (Import)",type:"import",requiresContainer:!0,group:"Import Costs"},{value:"delivery_sales",label:"Delivery / Dispatch (Sales)",type:"sales",requiresContainer:!1,group:"Sales & Distribution"},{value:"loading_sales",label:"Loading / Unloading (Sales)",type:"sales",requiresContainer:!1,group:"Sales & Distribution"},{value:"other_sales",label:"Other (Sales)",type:"sales",requiresContainer:!1,group:"Sales & Distribution"},{value:"salary",label:"Salary",type:"staff",requiresContainer:!1,group:"Staff Costs"},{value:"staff_overtime",label:"Staff Overtime",type:"staff",requiresContainer:!1,group:"Staff Costs"},{value:"staff_welfare",label:"Staff Welfare / Allowances",type:"staff",requiresContainer:!1,group:"Staff Costs"},{value:"travel_conveyance",label:"Travel & Conveyance",type:"staff",requiresContainer:!1,group:"Staff Costs"},{value:"warehouse_rent",label:"Warehouse Rent",type:"operations",requiresContainer:!1,group:"Operations"},{value:"utilities",label:"Utilities",type:"operations",requiresContainer:!1,group:"Operations"},{value:"bank_charges",label:"Bank Charges",type:"operations",requiresContainer:!1,group:"Operations"},{value:"office_admin",label:"Office & Admin",type:"admin",requiresContainer:!1,group:"Administrative"},{value:"office_shifting_renovation",label:"Office Shifting & Renovation",type:"admin",requiresContainer:!1,group:"Administrative"},{value:"other",label:"Other",type:"admin",requiresContainer:!1,group:"Administrative"}];y.useEffect(()=>{ft(),Je(),gt();const t=d.channel("bank-statement-recon-changes").on("postgres_changes",{event:"*",schema:"public",table:"bank_statement_lines"},()=>{w&&B()}).subscribe(),a=d.channel("expense-recon-changes").on("postgres_changes",{event:"*",schema:"public",table:"finance_expenses"},()=>{Je(),w&&B()}).subscribe();return()=>{t.unsubscribe(),a.unsubscribe()}},[]);const gt=async()=>{const{data:t}=await d.from("customers").select("id, company_name").order("company_name");t&&xt(t)};y.useEffect(()=>{if(w){const t=Oe.find(a=>a.id===w);it(t||null),B()}},[w,Oe,Me]);const ft=async()=>{try{const{data:t,error:a}=await d.from("bank_accounts").select("id, account_name, bank_name, account_number, currency, alias").eq("is_active",!0).order("account_name");if(a)throw a;if(rt(t||[]),t&&t.length>0){const s=t.find(n=>n.bank_name==="BCA Bank"&&n.account_number==="0930 2010 22"&&n.currency==="IDR");qe((s==null?void 0:s.id)||t[0].id)}}catch(t){console.error("Error loading bank accounts:",t)}},Je=async()=>{try{const{data:t,error:a}=await d.from("finance_expenses").select(`
          id,
          expense_date,
          description,
          amount,
          expense_category,
          voucher_number
        `).order("expense_date",{ascending:!1});if(a)throw a;const{data:s}=await d.from("bank_statement_lines").select("matched_expense_id").not("matched_expense_id","is",null),n=new Set((s||[]).map(i=>i.matched_expense_id)),l=(t||[]).filter(i=>!n.has(i.id));dt(l)}catch(t){console.error("Error loading expenses:",t)}},B=async()=>{if(w){Be(!0);try{const t=new Date(P.end);t.setDate(t.getDate()+1);const a=t.toISOString().split("T")[0],{data:s,error:n}=await d.from("bank_statement_lines").select("*").eq("bank_account_id",w).gte("transaction_date",P.start).lt("transaction_date",a).order("transaction_date",{ascending:!1});if(n)throw n;const l=(s||[]).map(r=>r.matched_expense_id).filter(Boolean),i=(s||[]).map(r=>r.matched_receipt_id).filter(Boolean),u=(s||[]).map(r=>r.matched_fund_transfer_id).filter(Boolean),R=new Map;if(l.length>0){const{data:r}=await d.from("finance_expenses").select("id, expense_category, amount, description, expense_date, voucher_number").in("id",l);r==null||r.forEach(_=>R.set(_.id,_))}const C=new Map;if(i.length>0){const{data:r}=await d.from("receipt_vouchers").select("id, amount, voucher_date, voucher_number, customer_id, customers(company_name)").in("id",i);r==null||r.forEach(_=>{var W;C.set(_.id,{id:_.id,amount:_.amount,payment_date:_.voucher_date,payment_number:_.voucher_number,customer_name:(W=_.customers)==null?void 0:W.company_name})})}const k=new Map;if(u.length>0){const{data:r}=await d.from("fund_transfers").select("id, transfer_number, amount, description, transfer_date, from_account_type, to_account_type").in("id",u);r==null||r.forEach(_=>k.set(_.id,_))}const m=(s||[]).map(r=>({id:r.id,date:r.transaction_date,description:r.description||"",reference:r.reference||"",debit:r.debit_amount||0,credit:r.credit_amount||0,balance:r.running_balance||0,currency:r.currency||"IDR",status:r.reconciliation_status||"unmatched",matchedEntry:r.matched_entry_id,matchedExpenseId:r.matched_expense_id,matchedReceiptId:r.matched_receipt_id,matchedFundTransferId:r.matched_fund_transfer_id,matchedExpense:r.matched_expense_id?R.get(r.matched_expense_id):null,matchedReceipt:r.matched_receipt_id?C.get(r.matched_receipt_id):null,matchedFundTransfer:r.matched_fund_transfer_id?k.get(r.matched_fund_transfer_id):null,notes:r.notes}));te(m)}catch(t){console.error("Error loading statement lines:",t),te([])}finally{Be(!1)}}},G=t=>{if(!t)return 0;const a=t.replace(/[^\d,\.]/g,"");if(a.includes(",")&&a.includes(".")){const s=a.lastIndexOf(","),n=a.lastIndexOf(".");return s>n?parseFloat(a.replace(/\./g,"").replace(/,/g,"."))||0:parseFloat(a.replace(/,/g,""))||0}else return a.includes(",")?parseFloat(a.replace(/,/g,"."))||0:parseFloat(a.replace(/,/g,""))||0},Ke=(t,a=";")=>{const s=[];let n="",l=!1;for(let i=0;i<t.length;i++){const u=t[i];u==='"'?l=!l:u===a&&!l?(s.push(n.trim()),n=""):n+=u}return s.push(n.trim()),s},bt=async t=>{try{const a=new FileReader;a.onload=async s=>{var n,l;try{const i=(n=s.target)==null?void 0:n.result,u=i.split(`
`).slice(0,5).join(`
`),R=(u.match(/,/g)||[]).length,C=(u.match(/;/g)||[]).length,k=R>C?",":";";console.log(`üìä Detected delimiter: "${k}" (commas: ${R}, semicolons: ${C})`);const m=[];let r="",_=!1;for(let h=0;h<i.length;h++){const v=i[h];if(v==='"')_=!_,r+=v;else if(v===`
`&&!_){if(r.trim()){const F=Ke(r,k);m.push(F)}r=""}else v!=="\r"&&(r+=v)}if(r.trim()){const h=Ke(r,k);m.push(h)}console.log("üìä CSV rows parsed:",m.length),console.log("üìã First 10 rows:"),m.slice(0,10).forEach((h,v)=>{console.log(`Row ${v}:`,h)});const W=new Date().getFullYear(),Y=prompt(`CSV contains dates without year (e.g., 01/12).
Which year is this statement for?`,String(W));if(!Y){alert("‚ùå Year is required to process the CSV");return}const p=parseInt(Y);if(isNaN(p)||p<2e3||p>2100){alert("‚ùå Invalid year provided");return}const{lines:c,metadata:o}=Ge(m,p);if(console.log("‚úÖ Parsed lines:",c.length),console.log("üìà Metadata:",o),c.length===0){alert("‚ùå No transactions found in the CSV file. Check browser console for details.");return}const{data:b,error:j}=await d.from("bank_statement_uploads").insert({bank_account_id:w,statement_period:o.period||`${new Date().toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,statement_start_date:o.startDate||P.start,statement_end_date:o.endDate||P.end,currency:(g==null?void 0:g.currency)||"IDR",opening_balance:o.openingBalance||0,closing_balance:o.closingBalance||((l=c[c.length-1])==null?void 0:l.balance)||0,total_debits:o.totalDebits||c.reduce((h,v)=>h+v.debit,0),total_credits:o.totalCredits||c.reduce((h,v)=>h+v.credit,0),transaction_count:c.length,status:"completed"}).select().single();if(j)throw j;const{data:{user:L}}=await d.auth.getUser(),$=c.map(h=>({upload_id:b.id,bank_account_id:w,transaction_date:h.date,description:h.description,reference:h.reference,debit_amount:h.debit,credit_amount:h.credit,running_balance:h.balance,statement_balance:h.balance,currency:(g==null?void 0:g.currency)||"IDR",reconciliation_status:"unmatched",created_by:L==null?void 0:L.id})),{data:O}=await d.from("bank_statement_lines").select("transaction_date, description, debit_amount, credit_amount, running_balance").eq("bank_account_id",w),T=$.filter(h=>O==null?void 0:O.some(v=>v.transaction_date===h.transaction_date&&v.description===h.description&&v.debit_amount===h.debit_amount&&v.credit_amount===h.credit_amount&&v.running_balance===h.running_balance));let f=$;if(T.length>0){let h=`‚ö†Ô∏è Found ${T.length} potential duplicate transaction(s):

`;T.slice(0,5).forEach((F,q)=>{const Mt=new Date(F.transaction_date).toLocaleDateString("en-GB"),At=F.debit_amount||F.credit_amount;h+=`${q+1}. ${Mt} - ${F.description.substring(0,40)} - Rp ${At.toLocaleString()}
`}),T.length>5&&(h+=`... and ${T.length-5} more
`),h+=`
Do you want to ADD them anyway?
(Click OK to add, Cancel to skip duplicates)`,confirm(h)||(f=$.filter(F=>!(O!=null&&O.some(q=>q.transaction_date===F.transaction_date&&q.description===F.description&&q.debit_amount===F.debit_amount&&q.credit_amount===F.credit_amount&&q.running_balance===F.running_balance))))}if(f.length===0){alert("‚ÑπÔ∏è No new transactions to import (all were duplicates and skipped)");return}const{data:E,error:M}=await d.from("bank_statement_lines").insert(f).select();if(M)throw console.error("Insert error:",M),M;const N=(E==null?void 0:E.length)||0,I=$.length-f.length;let U=`‚úÖ CSV Import complete!
`;U+=`   Total processed: ${$.length} transaction(s)
`,U+=`   New transactions added: ${N}
`,I>0&&(U+=`   Duplicates skipped: ${I}`),alert(U);try{await B()}catch(h){console.error("Load statement lines error:",h)}if(N>0)try{await $e()}catch(h){console.error("Auto-match error:",h)}}catch(i){console.error("CSV parsing error:",i),alert(`‚ùå Error parsing CSV: ${i.message}`)}},a.onerror=()=>{console.error("FileReader error"),alert("‚ùå Failed to read CSV file")},a.readAsText(t)}catch(a){console.error("CSV upload error:",a),alert(`‚ùå Failed to read CSV: ${a.message}`)}},yt=async t=>{var s;const a=(s=t.target.files)==null?void 0:s[0];if(!a){alert("‚ùå No file selected");return}if(!w){alert("‚ùå Please select a bank account first");return}if(!g){alert("‚ùå Bank account not loaded. Please refresh the page.");return}J(!0);try{const n=a.type==="application/pdf"||a.name.toLowerCase().endsWith(".pdf"),l=a.type.startsWith("image/")||a.name.match(/\.(png|jpg|jpeg)$/i),i=a.name.toLowerCase().endsWith(".csv");n?await Fe(a):l?await Fe(a,!0):i?await bt(a):await Nt(a)}catch(n){console.error("File upload error:",n)}finally{J(!1),pe.current&&(pe.current.value="")}},Fe=async(t,a=!1,s=!1)=>{try{J(!0),ne(null);const n=new FormData;n.append("file",t),n.append("bankAccountId",w),a&&n.append("useOCR","true"),s&&n.append("previewOnly","true");const{data:{session:l}}=await d.auth.getSession();if(!l)throw new Error("Not authenticated");const i=await fetch("https://dkrtsqienlhpouohmfki.supabase.co/functions/v1/parse-bca-statement",{method:"POST",headers:{Authorization:`Bearer ${l.access_token}`},body:n}),u=await i.json();if(!i.ok){if(u.canUseOCR)ne({message:u.error,canUseOCR:!0,suggestions:u.suggestions}),Ne(t);else throw new Error(u.error||"Failed to parse PDF");return}if(u.preview){_e(u);return}const R=u.usedOCR?" (via OCR)":"";let C=`‚úÖ Import complete from ${u.period}${R}
`;C+=`   Imported: ${u.insertedCount||u.transactionCount} transaction(s)`,u.duplicateCount>0&&(C+=`
   Skipped (duplicates): ${u.duplicateCount} transaction(s)`),alert(C),ne(null),Ne(null);try{await B()}catch(m){console.error("Load statement lines error:",m)}if((u.insertedCount||u.transactionCount||0)>0)try{await $e()}catch(m){console.error("Auto-match error:",m)}}catch(n){console.error("PDF upload error:",n),alert(`‚ùå Failed to parse PDF: ${n.message}`)}finally{J(!1)}},_t=async()=>{if(je){J(!0),ne(null);try{await Fe(je,!0,!0)}catch(t){alert(`‚ùå OCR failed: ${t.message}`),J(!1)}}},jt=async()=>{if(je){_e(null),J(!0);try{await Fe(je,!0,!1)}catch(t){alert(`‚ùå Failed to save: ${t.message}`)}finally{J(!1)}}},Nt=async t=>{try{const a=new FileReader;a.onload=async s=>{var n,l;try{const i=(n=s.target)==null?void 0:n.result,u=Vt(i,{type:"binary"}),R=u.SheetNames[0],C=u.Sheets[R],k=Wt.sheet_to_json(C,{header:1});console.log("üìä Raw Excel data rows:",k.length),console.log("üìã First 10 rows:"),k.slice(0,10).forEach((f,E)=>{console.log(`Row ${E}:`,f)});const{lines:m,metadata:r}=Ge(k);if(console.log("‚úÖ Parsed lines:",m.length),console.log("üìà Metadata:",r),m.length>0&&console.log("üîç First 3 transactions:",m.slice(0,3)),m.length===0){alert("‚ùå No valid transactions found in the file. Check browser console (F12) for details.");return}const{data:_,error:W}=await d.from("bank_statement_uploads").insert({bank_account_id:w,statement_period:r.period||`${new Date().toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,statement_start_date:r.startDate||P.start,statement_end_date:r.endDate||P.end,currency:(g==null?void 0:g.currency)||"IDR",opening_balance:r.openingBalance||0,closing_balance:r.closingBalance||((l=m[m.length-1])==null?void 0:l.balance)||0,total_debits:r.totalDebits||m.reduce((f,E)=>f+E.debit,0),total_credits:r.totalCredits||m.reduce((f,E)=>f+E.credit,0),transaction_count:m.length,status:"completed"}).select().single();if(W)throw W;const{data:{user:Y}}=await d.auth.getUser(),p=m.map(f=>({upload_id:_.id,bank_account_id:w,transaction_date:f.date,description:f.description,reference:f.reference,debit_amount:f.debit,credit_amount:f.credit,running_balance:f.balance,statement_balance:f.balance,currency:(g==null?void 0:g.currency)||"IDR",reconciliation_status:"unmatched",created_by:Y==null?void 0:Y.id})),{data:c}=await d.from("bank_statement_lines").select("transaction_date, description, debit_amount, credit_amount, running_balance").eq("bank_account_id",w),o=p.filter(f=>c==null?void 0:c.some(E=>E.transaction_date===f.transaction_date&&E.description===f.description&&E.debit_amount===f.debit_amount&&E.credit_amount===f.credit_amount&&E.running_balance===f.running_balance));let b=p;if(o.length>0){let f=`‚ö†Ô∏è Found ${o.length} potential duplicate transaction(s):

`;o.slice(0,5).forEach((M,N)=>{const I=new Date(M.transaction_date).toLocaleDateString("en-GB"),U=M.debit_amount||M.credit_amount;f+=`${N+1}. ${I} - ${M.description.substring(0,40)} - Rp ${U.toLocaleString()}
`}),o.length>5&&(f+=`... and ${o.length-5} more
`),f+=`
Do you want to ADD them anyway?
(Click OK to add, Cancel to skip duplicates)`,confirm(f)||(b=p.filter(M=>!(c!=null&&c.some(N=>N.transaction_date===M.transaction_date&&N.description===M.description&&N.debit_amount===M.debit_amount&&N.credit_amount===M.credit_amount&&N.running_balance===M.running_balance))))}if(b.length===0){alert("‚ÑπÔ∏è No new transactions to import (all were duplicates and skipped)");return}const{data:j,error:L}=await d.from("bank_statement_lines").insert(b).select();if(L)throw console.error("Insert error:",L),L;const $=(j==null?void 0:j.length)||0,O=p.length-b.length;let T=`‚úÖ Excel Import complete!
`;T+=`   Total processed: ${p.length} transaction(s)
`,T+=`   New transactions added: ${$}
`,O>0&&(T+=`   Duplicates skipped: ${O}`),alert(T);try{await B()}catch(f){console.error("Load statement lines error:",f)}if($>0)try{await $e()}catch(f){console.error("Auto-match error:",f)}}catch(i){console.error("Error parsing file:",i),alert("‚ùå Failed to parse file: "+i.message)}},a.readAsBinaryString(t)}catch(a){console.error("Excel upload error:",a),alert(`‚ùå Failed to process file: ${a.message}`)}},Ge=(t,a)=>{const s=[],n={period:"",startDate:"",endDate:"",openingBalance:0,closingBalance:0,totalDebits:0,totalCredits:0};let l=a||new Date().getFullYear();new Date().getMonth()+1;for(let p=0;p<Math.min(10,t.length);p++){const c=t[p];if(!c||c.length===0)continue;const o=String(c[0]||"");if(o.includes("Periode")){const b=o.match(/(\d{2})\/(\d{2})\/(\d{4})\s*-\s*(\d{2})\/(\d{2})\/(\d{4})/);if(b){const j=parseInt(b[1]),L=parseInt(b[2]),$=parseInt(b[3]),O=parseInt(b[4]),T=parseInt(b[5]),f=parseInt(b[6]);l=$,n.startDate=`${$}-${String(L).padStart(2,"0")}-${String(j).padStart(2,"0")}`,n.endDate=`${f}-${String(T).padStart(2,"0")}-${String(O).padStart(2,"0")}`;const E=["","JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"];n.period=`${E[L]} ${$}`}}}let i=-1;for(let p=0;p<Math.min(20,t.length);p++){const c=t[p];if(!c||c.length===0)continue;const o=c.map(b=>String(b||"").toLowerCase()).join("|");if((o.includes("tanggal")||o.includes("date")||o.includes("tgl"))&&(o.includes("keterangan")||o.includes("description")||o.includes("desc")||o.includes("mutasi")||o.includes("amount")||o.includes("saldo")||o.includes("balance"))){i=p,console.log(`‚úÖ Found header at row ${p}:`,c);break}}if(console.log("üîç Header row index:",i),i===-1)return console.error("‚ùå Could not find column headers"),console.log("üìã All rows checked:"),t.slice(0,20).forEach((p,c)=>{console.log(`  Row ${c}:`,p)}),{lines:s,metadata:n};const u=t[i];let R=-1,C=-1,k=-1,m=-1,r=-1,_=-1,W=-1;if(u.forEach((p,c)=>{const o=String(p||"").toLowerCase();(o.includes("tanggal")||o.includes("date")||o.includes("tgl"))&&(R=c),(o.includes("keterangan")||o.includes("description")||o.includes("desc"))&&(C=c),(o.includes("cabang")||o.includes("branch"))&&(k=c),o.includes("mutasi")&&!o.includes("debet")&&!o.includes("kredit")&&(m=c),(o.includes("debet")||o.includes("debit")||o.includes("db"))&&(_=c),(o.includes("kredit")||o.includes("credit")||o.includes("cr"))&&(W=c),(o.includes("saldo")||o.includes("balance"))&&(r=c)}),console.log("üìç Column positions:",{dateCol:R,descCol:C,branchCol:k,amountCol:m,debitCol:_,creditCol:W,balanceCol:r}),console.log("üìã Header row cells:",u.map((p,c)=>`[${c}]: "${p}"`)),R===-1)return console.error("‚ùå Missing date column"),console.log("üìã Header row:",u),{lines:s,metadata:n};let Y=0;for(let p=i+1;p<t.length;p++){const c=t[p];if(!c||c.length===0){Y++;continue}const o=String(c[0]||""),b=String(c[1]||""),j=`${o} ${b}`.toUpperCase();if(j.includes("SALDO AWAL")){Y++;continue}if(j.includes("MUTASI DEBET")||j.includes("MUTASI KREDIT")||j.includes("SALDO AKHIR")){console.log(`‚èπÔ∏è Stopped at footer row ${p}: ${o}`);break}const L=c[R];if(!L){Y++,p<i+5&&console.log(`‚è≠Ô∏è Row ${p}: No date value`);continue}let $="";if(typeof L=="number"){const N=new Date(1900,0,1),I=L-2,U=new Date(N.getTime()+I*24*60*60*1e3);$=`${U.getFullYear()}-${String(U.getMonth()+1).padStart(2,"0")}-${String(U.getDate()).padStart(2,"0")}`,p<i+5&&console.log(`‚úÖ Row ${p}: Excel serial ${L} ‚Üí ${$}`)}else{const N=String(L).trim(),I=N.match(/^(\d{1,2})\/(\d{1,2})$/),U={jan:1,feb:2,mar:3,apr:4,may:5,mei:5,jun:6,jul:7,aug:8,agu:8,ags:8,sep:9,oct:10,okt:10,nov:11,dec:12,des:12},h=N.match(/^(\d{1,2})[-\s](jan|feb|mar|apr|may|mei|jun|jul|aug|agu|ags|sep|oct|okt|nov|dec|des)/i),v=N.match(/^(\d{1,2})[\/-](\d{1,2})[\/-](\d{2,4})$/);let F=0,q=0;if(v?(F=parseInt(v[1]),q=parseInt(v[2])):I?(F=parseInt(I[1]),q=parseInt(I[2])):h&&(F=parseInt(h[1]),q=U[h[2].toLowerCase()]||0),F<1||F>31||q<1||q>12){Y++,p<i+5&&console.log(`‚è≠Ô∏è Row ${p}: Date doesn't match pattern: "${N}"`);continue}$=`${l}-${String(q).padStart(2,"0")}-${String(F).padStart(2,"0")}`}let O=0,T=0;if(_>=0&&W>=0){const N=String(c[_]||"").trim(),I=String(c[W]||"").trim();O=G(N),T=G(I)}else if(m>=0){const N=String(c[m]||"").trim(),I=c[m+1]?String(c[m+1]).trim().toUpperCase():"",U=I==="CR"||N.includes(" CR"),h=I==="DB"||N.includes(" DB"),v=G(N);p<i+3&&console.log(`üí∞ Row ${p} amount parsing:`,{amountStr:N,dbCrIndicator:I,isCR:U,isDB:h,amount:v}),U?T=v:(h||v>0)&&(O=v)}let f=0;if(r>=0){const N=String(c[r]||"").trim();f=G(N)}let E="";if(C>=0){const N=String(c[C]||"").trim(),I=String(c[C+1]||"").trim();E=N+(I?"; "+I:"")}const M=k>=0?String(c[k]||"").trim():"";p<i+3&&console.log(`üîç Row ${p} parsed:`,{date:$,debit:O,credit:T,balance:f,description:E.substring(0,50)}),s.push({id:`temp-${p}`,date:$,description:E,reference:M,debit:O,credit:T,balance:f,currency:(g==null?void 0:g.currency)||"IDR",status:"unmatched"})}console.log(`‚úÖ Parsing complete: ${s.length} transactions, ${Y} rows skipped`);for(let p=0;p<t.length;p++){const c=t[p];if(!c||c.length===0)continue;const o=String(c[0]||"");if(o.includes("Saldo Awal")||o.includes("SALDO AWAL"))for(let b=0;b<c.length;b++){const j=String(c[b]||"");if(j&&/[\d,\.]+/.test(j)){n.openingBalance=G(j);break}}if(o.includes("Mutasi Debet")||o.includes("MUTASI DB")||o.includes("Mutasi DB"))for(let b=0;b<c.length;b++){const j=String(c[b]||"");if(j&&/[\d,\.]+/.test(j)){n.totalDebits=G(j);break}}if(o.includes("Mutasi Kredit")||o.includes("MUTASI CR")||o.includes("Mutasi CR"))for(let b=0;b<c.length;b++){const j=String(c[b]||"");if(j&&/[\d,\.]+/.test(j)){n.totalCredits=G(j);break}}if(o.includes("Saldo Akhir")||o.includes("SALDO AKHIR"))for(let b=0;b<c.length;b++){const j=String(c[b]||"");if(j&&/[\d,\.]+/.test(j)){n.closingBalance=G(j);break}}}return{lines:s,metadata:n}},$e=async()=>{if(w)try{const{data:t,error:a}=await d.rpc("auto_match_smart");if(a)throw a;const s=t==null?void 0:t[0],n=(s==null?void 0:s.matched_count)||0,l=(s==null?void 0:s.suggested_count)||0,i=(s==null?void 0:s.skipped_count)||0;await B();let u=`‚úÖ Auto-match complete!

`;u+=`‚úì Matched (85%+ confidence): ${n}
`,u+=`‚ö† Needs Review (70-84%): ${l}
`,i>0&&(u+=`‚è≠ Skipped (already matched): ${i}
`),u+=`
üîí Date tolerance: ¬±7 days maximum`,alert(u)}catch(t){console.error("Error auto-matching:",t),alert("‚ùå Auto-match failed: "+t.message)}},vt=async()=>{if(w)try{const{data:t,error:a}=await d.rpc("preview_bank_statement_delete",{p_bank_account_id:w,p_start_date:P.start,p_end_date:P.end});if(a)throw a;we(t),Se(!0)}catch(t){console.error("Error previewing delete:",t),alert("‚ùå Failed to preview: "+t.message)}},wt=async()=>{if(!(!w||!A))try{const{data:t,error:a}=await d.rpc("safe_delete_bank_statement_lines",{p_bank_account_id:w,p_start_date:P.start,p_end_date:P.end});if(a)throw a;t.success?(alert(`‚úÖ Successfully deleted ${t.deleted_count} unmatched transaction(s)`),Se(!1),we(null),await B()):alert(`‚ùå ${t.error}`)}catch(t){console.error("Error clearing data:",t),alert("‚ùå Failed to clear data: "+t.message)}},St=async t=>{try{await d.from("bank_statement_lines").update({reconciliation_status:"matched"}).eq("id",t),te(a=>a.map(s=>s.id===t?{...s,status:"matched"}:s))}catch(a){console.error("Error confirming match:",a)}},Dt=async t=>{try{await d.from("bank_statement_lines").update({reconciliation_status:"unmatched",matched_entry_id:null}).eq("id",t),te(a=>a.map(s=>s.id===t?{...s,status:"unmatched",matchedEntry:void 0,matched_entry_id:void 0}:s))}catch(a){console.error("Error rejecting match:",a)}},Ct=t=>{H(t),X(!0)},kt=async(t,a,s)=>{try{const{data:{user:n}}=await d.auth.getUser();if(!n)throw new Error("Not authenticated");const{data:l,error:i}=await d.from("finance_expenses").insert({expense_category:a,amount:t.debit,expense_date:t.date,description:s||t.description,created_by:n.id}).select().single();if(i)throw i;const{error:u}=await d.from("bank_statement_lines").update({reconciliation_status:"recorded",matched_expense_id:l.id,matched_at:new Date().toISOString(),matched_by:n.id}).eq("id",t.id).select().single();if(u)throw u;X(!1),H(null),await B(),alert("‚úÖ Expense recorded and linked successfully")}catch(n){console.error("Error recording expense:",n),alert("‚ùå "+n.message)}},Et=async(t,a)=>{try{const{data:{user:s}}=await d.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:n}=await d.from("bank_statement_lines").update({reconciliation_status:"matched",matched_expense_id:a,matched_at:new Date().toISOString(),matched_by:s.id}).eq("id",t.id).select().single();if(n)throw n;X(!1),H(null),ue(!1),await B(),alert("‚úÖ Linked to expense successfully")}catch(s){console.error("Error linking to expense:",s),alert("‚ùå "+s.message)}},Rt=async t=>{Ve(!0);try{const{data:a}=await d.rpc("get_invoices_with_balance",{customer_uuid:t}),s=(a||[]).filter(n=>n.balance_amount>0);Ce(s)}catch(a){console.error("Error loading invoices:",a)}finally{Ve(!1)}},It=async t=>{try{const{data:a}=await d.from("receipt_vouchers").select("id, voucher_number, voucher_date, amount, customers(company_name)").is("journal_entry_id",null).order("voucher_date",{ascending:!1}).limit(50),{data:s}=await d.from("receipt_vouchers").select("id, voucher_number, voucher_date, amount, customers(company_name)").order("voucher_date",{ascending:!1}).limit(100);Ye(s||[])}catch(a){console.error("Error loading receipts:",a)}},Ft=async(t,a,s,n)=>{try{const{data:{user:l}}=await d.auth.getUser();if(!l)throw new Error("Not authenticated");if(a==="customer_payment"){if(!s)throw new Error("Please select a customer");const{data:i,error:u}=await d.rpc("generate_voucher_number",{p_prefix:"RV"});if(u)throw u;const{data:R,error:C}=await d.from("receipt_vouchers").insert({voucher_number:i,voucher_date:t.date,customer_id:s,payment_method:"bank_transfer",bank_account_id:w,reference_number:t.reference,amount:t.credit,description:n||t.description,created_by:l.id}).select().single();if(C)throw C;for(const[r,_]of Object.entries(Q))_<=0||await d.from("voucher_allocations").insert({voucher_type:"receipt",receipt_voucher_id:R.id,sales_invoice_id:r,allocated_amount:_});const{error:k}=await d.from("bank_statement_lines").update({reconciliation_status:"recorded",matched_receipt_id:R.id,matched_at:new Date().toISOString(),matched_by:l.id}).eq("id",t.id);if(k)throw k;const m=Object.values(Q).filter(r=>r>0).length;alert(`Receipt Voucher ${i} created${m>0?` and allocated to ${m} invoice(s)`:""}`)}else{const{error:i}=await d.from("bank_statement_lines").update({reconciliation_status:"recorded",notes:`${a}: ${n}`,matched_at:new Date().toISOString(),matched_by:l.id}).eq("id",t.id);if(i)throw i;alert("Receipt recorded successfully")}X(!1),H(null),Ue(""),Ce([]),re({}),Ee(!1),B()}catch(l){console.error("Error recording receipt:",l),alert("Error: "+l.message)}},$t=async(t,a)=>{try{const{data:{user:s}}=await d.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:n}=await d.from("bank_statement_lines").update({reconciliation_status:"recorded",matched_receipt_id:a,matched_at:new Date().toISOString(),matched_by:s.id}).eq("id",t.id);if(n)throw n;X(!1),H(null),Ee(!1),Ye([]),B(),alert("Linked to existing receipt successfully")}catch(s){console.error("Error linking receipt:",s),alert("Error: "+s.message)}},He=async t=>{try{const a=t.debit>0?t.debit:t.credit,s=new Date(t.date),n=new Date(s);n.setDate(n.getDate()-7);const l=new Date(s);l.setDate(l.getDate()+7);const{data:i,error:u}=await d.from("journal_entries").select(`
          id,
          entry_number,
          entry_date,
          description,
          total_debit,
          total_credit,
          source_module,
          reference_number
        `).eq("is_posted",!0).eq("is_reversed",!1).gte("entry_date",n.toISOString().split("T")[0]).lte("entry_date",l.toISOString().split("T")[0]).or(`total_debit.eq.${a},total_credit.eq.${a}`).order("entry_date",{ascending:!1}).limit(100);if(u)throw u;const{data:R}=await d.from("bank_statement_lines").select("matched_entry_id").not("matched_entry_id","is",null).neq("id",t.id),C=new Set((R||[]).map(m=>m.matched_entry_id)),k=[];for(const m of i||[])if(!C.has(m.id)){if(m.source_module==="expenses"&&m.reference_number){const r=m.reference_number.replace("EXP-",""),{data:_}=await d.from("finance_expenses").select("id").eq("id",r).maybeSingle();if(!_)continue}if(m.source_module==="receipt"&&m.reference_number){const{data:r}=await d.from("receipt_vouchers").select("id").eq("journal_entry_id",m.id).maybeSingle();if(!r)continue}if(m.source_module==="payment"&&m.reference_number){const{data:r}=await d.from("payment_vouchers").select("id").eq("journal_entry_id",m.id).maybeSingle();if(!r)continue}if(m.source_module==="petty_cash"&&m.reference_number){const r=m.reference_number.replace("PC-",""),{data:_}=await d.from("petty_cash_transactions").select("id").eq("id",r).maybeSingle();if(!_)continue}k.push(m)}Ie(k)}catch(a){console.error("Error loading journals:",a),Ie([])}},Xe=async(t,a)=>{try{const{data:{user:s}}=await d.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:n}=await d.from("bank_statement_lines").update({reconciliation_status:"matched",matched_entry_id:a,matched_at:new Date().toISOString(),matched_by:s.id}).eq("id",t.id);if(n)throw n;X(!1),H(null),Z(!1),Ie([]),B(),alert("Successfully linked to journal entry")}catch(s){console.error("Error linking journal:",s),alert("Error: "+s.message)}},ze=de.filter(t=>se==="all"?!0:t.status===se),ge=t=>{let a="asc";S&&S.key===t&&S.direction==="asc"&&(a="desc"),ot({key:t,direction:a})},ce=[...ze].sort((t,a)=>{if(!S)return 0;const{key:s,direction:n}=S;let l=t[s],i=a[s];return s==="date"&&(l=new Date(l).getTime(),i=new Date(i).getTime()),(s==="debit"||s==="credit")&&(l=Number(l)||0,i=Number(i)||0),typeof l=="string"&&(l=l.toLowerCase(),i=i.toLowerCase()),l<i?n==="asc"?-1:1:l>i?n==="asc"?1:-1:0}),oe={total:de.length,matched:de.filter(t=>t.status==="matched"||t.status==="recorded").length,suggested:de.filter(t=>t.status==="suggested").length,unmatched:de.filter(t=>t.status==="unmatched").length},ee=t=>t==="USD"?"$":"Rp",Tt=t=>{xe(t),ve({debit:t.debit,credit:t.credit,description:t.description}),he(!0)},Lt=async t=>{if(t.preventDefault(),!!x)try{const{error:a}=await d.from("bank_statement_lines").update({debit_amount:V.debit,credit_amount:V.credit,description:V.description}).eq("id",x.id);if(a)throw a;te(s=>s.map(n=>n.id===x.id?{...n,debit:V.debit,credit:V.credit,description:V.description}:n)),he(!1),xe(null),alert("‚úÖ Bank statement line updated successfully")}catch(a){console.error("Error updating line:",a),alert("‚ùå "+a.message)}},Ot=async()=>{if(!(!x||!window.confirm(`Are you sure you want to unlink this transaction?

This will set its status back to "Unmatched" and remove the link to the expense/receipt.`)))try{const{error:a}=await d.from("bank_statement_lines").update({matched_expense_id:null,matched_receipt_id:null,matched_fund_transfer_id:null,matched_entry_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null,notes:null}).eq("id",x.id);if(a)throw a;te(s=>s.map(n=>n.id===x.id?{...n,status:"unmatched",matchedExpenseId:void 0,matchedReceiptId:void 0,matchedFundTransferId:void 0,matchedExpense:null,matchedReceipt:null,matchedFundTransfer:null,notes:void 0}:n)),he(!1),xe(null),alert("‚úÖ Transaction unlinked successfully")}catch(a){console.error("Error unlinking transaction:",a),alert("‚ùå "+a.message)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-700 to-slate-800 rounded-lg p-2.5 text-white shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Bank Reconciliation"}),g&&e.jsx("span",{className:"text-slate-300 text-xs",children:g.alias?`${g.alias} (${g.account_number})`:`${g.bank_name} - ${g.account_number}`}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"bg-white/20 rounded px-2.5 py-1",children:[e.jsx("div",{className:"text-slate-200 text-[9px] leading-tight",children:"Matched"}),e.jsx("div",{className:"text-xs font-bold text-green-400",children:oe.matched})]}),e.jsxs("div",{className:"bg-white/20 rounded px-2.5 py-1",children:[e.jsx("div",{className:"text-slate-200 text-[9px] leading-tight",children:"Unmatched"}),e.jsx("div",{className:"text-xs font-bold text-red-400",children:oe.unmatched})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>{$e()},disabled:!w,className:"flex items-center gap-1.5 px-2.5 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 font-medium shadow-sm",title:"Auto-match",children:[e.jsx(st,{className:"w-3.5 h-3.5"}),"Match"]}),le&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:vt,disabled:!w,className:"p-1.5 bg-white/20 rounded hover:bg-white/30 disabled:opacity-50",title:"Clear",children:e.jsx(Te,{className:"w-3.5 h-3.5"})}),e.jsx("input",{ref:pe,type:"file",accept:".pdf,.xlsx,.xls,.csv,.png,.jpg,.jpeg",onChange:yt,className:"hidden"}),e.jsxs("button",{onClick:()=>{var t;return(t=pe.current)==null?void 0:t.click()},disabled:ae||!w,className:"flex items-center gap-1.5 px-2.5 py-1.5 text-xs bg-white text-slate-700 rounded hover:bg-slate-50 disabled:opacity-50 font-medium shadow-sm",title:"Upload",children:[e.jsx(nt,{className:"w-3.5 h-3.5"}),ae?"Uploading":"Upload"]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-2",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("select",{value:w,onChange:t=>qe(t.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium",children:Oe.map(t=>e.jsx("option",{value:t.id,children:t.alias?`${t.alias} (${t.account_number})`:`${t.bank_name} - ${t.account_number} (${t.currency})`},t.id))}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Bt,{className:"w-3 h-3"}),e.jsxs("span",{children:[new Date(P.start).toLocaleDateString("en-GB")," ‚Üí ",new Date(P.end).toLocaleDateString("en-GB")]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>be("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${se==="all"?"bg-slate-700 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["All (",oe.total,")"]}),e.jsxs("button",{onClick:()=>be("matched"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${se==="matched"?"bg-green-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["‚úì Matched (",oe.matched,")"]}),e.jsxs("button",{onClick:()=>be("suggested"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${se==="suggested"?"bg-yellow-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["‚ö† Review (",oe.suggested,")"]}),e.jsxs("button",{onClick:()=>be("unmatched"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${se==="unmatched"?"bg-red-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["‚úï Unmatched (",oe.unmatched,")"]})]})]})}),ct?e.jsx("div",{className:"flex items-center justify-center py-12 bg-white rounded-lg",children:e.jsx(st,{className:"w-6 h-6 animate-spin text-blue-600"})}):ze.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border-2 border-dashed",children:[e.jsx(Gt,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-1",children:"No Bank Transactions"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Upload a BCA PDF statement or Excel/CSV file to start reconciling"}),le&&e.jsxs("button",{onClick:()=>{var t;return(t=pe.current)==null?void 0:t.click()},className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(nt,{className:"w-4 h-4"}),"Upload Statement"]})]}):e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>ge("date"),className:"px-3 py-2 text-left font-medium text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Date",(S==null?void 0:S.key)==="date"&&e.jsx("span",{className:"text-blue-600",children:S.direction==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{onClick:()=>ge("description"),className:"px-3 py-2 text-left font-medium text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Description",(S==null?void 0:S.key)==="description"&&e.jsx("span",{className:"text-blue-600",children:S.direction==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{onClick:()=>ge("debit"),className:"px-3 py-2 text-right font-medium text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Debit",(S==null?void 0:S.key)==="debit"&&e.jsx("span",{className:"text-blue-600",children:S.direction==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{onClick:()=>ge("credit"),className:"px-3 py-2 text-right font-medium text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Credit",(S==null?void 0:S.key)==="credit"&&e.jsx("span",{className:"text-blue-600",children:S.direction==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{onClick:()=>ge("status"),className:"px-3 py-2 text-center font-medium text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Status",(S==null?void 0:S.key)==="status"&&e.jsx("span",{className:"text-blue-600",children:S.direction==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{className:"px-3 py-2 text-center font-medium text-gray-600",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[ce.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-gray-700 whitespace-nowrap",children:new Date(t.date).toLocaleDateString("id-ID")}),e.jsxs("td",{className:"px-3 py-2 text-gray-700 max-w-md",children:[e.jsx("div",{className:"whitespace-pre-wrap text-sm leading-tight",children:t.description}),t.reference&&e.jsx("div",{className:"text-xs text-gray-500 font-mono mt-1",children:t.reference})]}),e.jsx("td",{className:"px-3 py-2 text-right text-red-600 font-medium whitespace-nowrap",children:t.debit>0?`${ee(t.currency)} ${t.debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-green-600 font-medium whitespace-nowrap",children:t.credit>0?`${ee(t.currency)} ${t.credit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[(t.status==="matched"||t.status==="recorded")&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700",children:[e.jsx(Le,{className:"w-3 h-3"})," Recorded"]}),t.matchedExpense&&e.jsxs("span",{className:"text-xs text-gray-600",children:["‚Üí Expense: ",t.matchedExpense.expense_category]}),t.matchedReceipt&&e.jsxs("span",{className:"text-xs text-gray-600",children:["‚Üí Receipt: ",t.matchedReceipt.customer_name||"Customer"]}),t.matchedFundTransfer&&e.jsxs("span",{className:"text-xs text-gray-600",children:["‚Üí Fund Transfer: ",t.matchedFundTransfer.from_account_type," ‚Üí ",t.matchedFundTransfer.to_account_type]}),!t.matchedExpense&&!t.matchedReceipt&&!t.matchedFundTransfer&&!t.matchedEntry&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è No link found"})]}),t.status==="suggested"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700",children:[e.jsx(at,{className:"w-3 h-3"})," Review"]}),t.status==="unmatched"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e.jsx(Te,{className:"w-3 h-3"})," Unrecorded"]})]})}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.status==="suggested"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>St(t.id),className:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Confirm Match",children:e.jsx(Le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Dt(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Reject Match",children:e.jsx(Te,{className:"w-4 h-4"})})]}),t.status==="unmatched"&&le&&e.jsxs("button",{onClick:()=>Ct(t),className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700",title:"Record transaction",children:[e.jsx(Jt,{className:"w-3 h-3"}),"Record"]}),le&&e.jsx("button",{onClick:()=>Tt(t),className:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"Edit debit/credit",children:e.jsx(Kt,{className:"w-4 h-4"})})]})})]},t.id)),e.jsxs("tr",{className:"bg-blue-50 border-t-2 border-blue-200 font-bold",children:[e.jsxs("td",{colSpan:2,className:"px-3 py-3 text-right text-gray-900",children:["TOTAL (",ce.length," transactions):"]}),e.jsxs("td",{className:"px-3 py-3 text-right text-red-700 font-bold whitespace-nowrap",children:[ee((g==null?void 0:g.currency)||"IDR")," ",ce.reduce((t,a)=>t+a.debit,0).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("td",{className:"px-3 py-3 text-right text-green-700 font-bold whitespace-nowrap",children:[ee((g==null?void 0:g.currency)||"IDR")," ",ce.reduce((t,a)=>t+a.credit,0).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("td",{colSpan:2,className:"px-3 py-3 text-center text-gray-600 text-sm",children:["Net: ",ee((g==null?void 0:g.currency)||"IDR")," ",(ce.reduce((t,a)=>t+a.credit,0)-ce.reduce((t,a)=>t+a.debit,0)).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})}),e.jsx(fe,{isOpen:lt,onClose:()=>{X(!1),H(null),ue(!1),Z(!1),Ie([])},title:"Record Transaction",children:D&&e.jsxs("div",{className:"space-y-4 pb-32",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:new Date(D.date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Description:"}),e.jsx("p",{className:"font-medium mt-1",children:D.description})]}),D.debit>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:[ee(D.currency)," ",D.debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),D.credit>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[ee(D.currency)," ",D.credit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),D.debit>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>{ue(!1),Z(!1)},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium ${!Ae&&!K?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"}`,children:"Create New Expense"}),e.jsx("button",{onClick:()=>{ue(!0),Z(!1)},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium ${Ae&&!K?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"}`,children:"Link Expense"}),e.jsx("button",{onClick:()=>{Z(!0),ue(!1),He(D)},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium ${K?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"}`,children:"Link Journal"})]}),K?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select a journal entry to link to this bank transaction (matching amount, +/-7 days)."}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-lg divide-y",children:Re.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No matching journal entries found"}):Re.map(t=>e.jsxs("button",{onClick:()=>Xe(D,t.id),className:"w-full p-2 text-left hover:bg-blue-50 text-sm flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono font-medium text-blue-600",children:t.entry_number}),e.jsx("span",{className:"text-xs ml-2 px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded",children:t.source_module==="manual"?"Manual":t.source_module}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.description}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(t.entry_date).toLocaleDateString("id-ID")})]}),e.jsxs("span",{className:"font-medium text-green-600",children:["Rp ",(t.total_debit||t.total_credit).toLocaleString("id-ID",{minimumFractionDigits:2})]})]},t.id))})]}):Ae?e.jsxs("form",{onSubmit:t=>{t.preventDefault();const s=new FormData(t.currentTarget).get("expense_id");if(!s){alert("Please select an expense");return}Et(D,s)},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Expense *"}),e.jsxs("select",{name:"expense_id",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",disabled:me.length===0,children:[e.jsx("option",{value:"",children:me.length===0?"No expenses found":"Choose an expense..."}),me.map(t=>{const a=new Date(t.expense_date),s=String(a.getDate()).padStart(2,"0"),n=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getFullYear()).slice(-2),i=`${s}/${n}/${l}`;return e.jsxs("option",{value:t.id,children:[i," - ",t.voucher_number?`[${t.voucher_number}] `:"",t.description," - Rp ",t.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]},t.id)})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Showing ",me.length," unlinked expense",me.length!==1?"s":"",". Match by voucher number or amount."]})]}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Link to Expense"})]}):e.jsxs("form",{onSubmit:t=>{t.preventDefault();const a=new FormData(t.currentTarget),s=a.get("category"),n=a.get("description");kt(D,s,n)},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsxs("select",{name:"category",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select category..."}),e.jsx("optgroup",{label:"‚ïê‚ïê‚ïê IMPORT COSTS (Capitalized to Inventory) ‚ïê‚ïê‚ïê",children:ie.filter(t=>t.group==="Import Costs").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"‚ïê‚ïê‚ïê SALES & DISTRIBUTION (P&L Expense) ‚ïê‚ïê‚ïê",children:ie.filter(t=>t.group==="Sales & Distribution").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"‚ïê‚ïê‚ïê STAFF COSTS (P&L Expense) ‚ïê‚ïê‚ïê",children:ie.filter(t=>t.group==="Staff Costs").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"‚ïê‚ïê‚ïê OPERATIONS (P&L Expense) ‚ïê‚ïê‚ïê",children:ie.filter(t=>t.group==="Operations").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("optgroup",{label:"‚ïê‚ïê‚ïê ADMINISTRATIVE (P&L Expense) ‚ïê‚ïê‚ïê",children:ie.filter(t=>t.group==="Administrative").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",name:"description",defaultValue:D.description,className:"w-full px-3 py-2 border rounded-lg",placeholder:"Optional: Override description"})]}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create & Link Expense"})]})]}),D.credit>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Record as Receipt"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{Ee(!ke),Z(!1),ke||It()},className:"text-xs text-blue-600 hover:underline",children:ke?"Create New Receipt":"Link Existing Receipt"}),e.jsx("button",{type:"button",onClick:()=>{Z(!K),Ee(!1),K||He(D)},className:"text-xs text-blue-600 hover:underline",children:K?"Create New Receipt":"Link Journal Entry"})]})]}),ke?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select an existing receipt voucher to link to this bank statement line."}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-lg divide-y",children:We.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No receipt vouchers found"}):We.map(t=>{var a,s;return e.jsxs("button",{onClick:()=>$t(D,t.id),className:"w-full p-2 text-left hover:bg-blue-50 text-sm flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono font-medium",children:t.voucher_number}),e.jsx("span",{className:"text-gray-500 ml-2",children:(a=t.customers)==null?void 0:a.company_name}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(t.voucher_date).toLocaleDateString("id-ID")})]}),e.jsxs("span",{className:"font-medium text-green-600",children:["Rp ",(s=t.amount)==null?void 0:s.toLocaleString("id-ID",{minimumFractionDigits:2})]})]},t.id)})})]}):K?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Select a journal entry to link to this bank transaction (matching amount, +/-7 days)."}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-lg divide-y",children:Re.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No matching journal entries found"}):Re.map(t=>e.jsxs("button",{onClick:()=>Xe(D,t.id),className:"w-full p-2 text-left hover:bg-blue-50 text-sm flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono font-medium text-blue-600",children:t.entry_number}),e.jsx("span",{className:"text-xs ml-2 px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded",children:t.source_module==="manual"?"Manual":t.source_module}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.description}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(t.entry_date).toLocaleDateString("id-ID")})]}),e.jsxs("span",{className:"font-medium text-green-600",children:["Rp ",(t.total_debit||t.total_credit).toLocaleString("id-ID",{minimumFractionDigits:2})]})]},t.id))})]}):e.jsxs("form",{onSubmit:t=>{t.preventDefault();const a=new FormData(t.currentTarget),s=a.get("type"),n=a.get("description");Ft(D,s,De,n)},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),e.jsxs("select",{name:"type",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",onChange:t=>{t.target.value!=="customer_payment"&&(Ue(""),Ce([]),re({}))},children:[e.jsx("option",{value:"",children:"Select type..."}),e.jsx("option",{value:"customer_payment",children:"Customer Payment"}),e.jsx("option",{value:"capital",children:"Capital Injection"}),e.jsx("option",{value:"other_income",children:"Other Income"}),e.jsx("option",{value:"loan",children:"Loan/Financing"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsx(Yt,{value:De,onChange:t=>{Ue(t),re({}),t?Rt(t):Ce([])},options:pt.map(t=>({value:t.id,label:t.company_name})),placeholder:"Select customer..."})]}),De&&Pe.length>0&&e.jsxs("div",{className:"border rounded-lg p-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Allocate to Invoices (optional)"}),e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-1",children:Pe.map(t=>{var s;const a=Q[t.id]!==void 0;return e.jsxs("div",{className:"flex items-center gap-2 text-xs p-1 hover:bg-gray-50 rounded",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:n=>{if(n.target.checked){const l=D.credit-Object.values(Q).reduce((i,u)=>i+u,0);re(i=>({...i,[t.id]:Math.min(t.balance_amount,l)}))}else{const l={...Q};delete l[t.id],re(l)}}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-mono",children:t.invoice_number}),e.jsxs("span",{className:"text-red-500 ml-1",children:["Bal: Rp ",(s=t.balance_amount)==null?void 0:s.toLocaleString("id-ID")]})]}),a&&e.jsx("input",{type:"number",value:Q[t.id]||"",onChange:n=>{const l=parseFloat(n.target.value)||0;re(i=>({...i,[t.id]:Math.min(l,t.balance_amount)}))},className:"w-24 px-1 py-0.5 border rounded text-right text-xs",min:0,max:t.balance_amount})]},t.id)})}),e.jsxs("div",{className:"mt-2 pt-2 border-t text-xs flex justify-between",children:[e.jsx("span",{children:"Allocated:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["Rp ",Object.values(Q).reduce((t,a)=>t+a,0).toLocaleString("id-ID",{minimumFractionDigits:2})]})]})]}),De&&ht&&e.jsx("div",{className:"text-xs text-gray-500 text-center py-2",children:"Loading invoices..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",name:"description",defaultValue:D.description,className:"w-full px-3 py-2 border rounded-lg",placeholder:"Optional: Override description"})]}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Record Receipt"})]})]})]})}),ye&&e.jsx(fe,{isOpen:!0,onClose:()=>{ne(null),Ne(null)},title:"PDF Extraction Failed",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-yellow-800 text-sm font-medium mb-2",children:ye.message}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Recommended options:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-yellow-700",children:ye.suggestions.map((t,a)=>e.jsx("li",{children:t},a))})]})]}),ye.canUseOCR&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-blue-800 text-sm font-medium mb-2",children:"Advanced Option: OCR Processing"}),e.jsx("p",{className:"text-blue-700 text-xs mb-3",children:"Optical Character Recognition (OCR) can extract text from image-based or encrypted PDFs. This process takes 30-60 seconds and requires Google Vision API configuration. You'll be able to preview the results before saving."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:_t,disabled:ae,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm font-medium",children:ae?"Processing with OCR...":"Run OCR Anyway"}),e.jsx("button",{onClick:()=>{ne(null),Ne(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium",children:"Cancel"})]})]})]})}),z&&e.jsx(fe,{isOpen:!0,onClose:()=>_e(null),title:"OCR Preview - Confirm Before Saving",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-green-800 text-sm font-medium mb-2",children:["‚úÖ OCR extracted ",z.transactionCount," transactions"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Period:"}),e.jsx("span",{className:"ml-2 font-medium text-gray-900",children:z.period})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Opening Balance:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[g==null?void 0:g.currency," ",z.openingBalance.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Closing Balance:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[g==null?void 0:g.currency," ",z.closingBalance.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Transactions:"}),e.jsx("span",{className:"ml-2 font-medium text-gray-900",children:z.transactionCount})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Sample Transactions (First 10):"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"Date"}),e.jsx("th",{className:"px-2 py-1 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Amount"})]})}),e.jsx("tbody",{children:z.transactions.map((t,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-2 py-1",children:t.date}),e.jsx("td",{className:"px-2 py-1 truncate max-w-xs",children:t.description}),e.jsxs("td",{className:"px-2 py-1 text-right",children:[g==null?void 0:g.currency," ",(t.debitAmount||t.creditAmount).toLocaleString()]})]},a))})]})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-yellow-800 text-xs",children:"‚ö†Ô∏è Please verify the extracted data looks correct before confirming. OCR may have minor errors in dates, amounts, or descriptions."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:jt,disabled:ae,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium",children:ae?"Saving...":"Confirm & Save"}),e.jsx("button",{onClick:()=>_e(null),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"Cancel"})]})]})}),e.jsx(fe,{isOpen:ut,onClose:()=>{Se(!1),we(null)},title:"Confirm Clear Data",children:A&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Warning: Data Deletion"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"You are about to clear bank statement data. This action cannot be undone."})]}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Bank Account"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[(Qe=A.bank_info)==null?void 0:Qe.bank_name," - ",(Ze=A.bank_info)==null?void 0:Ze.account_number,e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs",children:(et=A.bank_info)==null?void 0:et.currency})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Date Range"}),e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[new Date(A.start_date).toLocaleDateString("id-ID")," -"," ",new Date(A.end_date).toLocaleDateString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Transactions"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:A.total_count})]})]}),e.jsxs("div",{className:"border-t pt-3 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-red-600 font-medium mb-1",children:"Reconciled (Protected)"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:A.reconciled_count}),e.jsx("div",{className:"text-xs text-gray-500",children:"Cannot be deleted"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 font-medium mb-1",children:"Unmatched (Deletable)"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:A.unmatched_count}),e.jsx("div",{className:"text-xs text-gray-500",children:"Will be deleted"})]})]})]}),A.warning&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:A.warning})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{Se(!1),we(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:wt,disabled:!A.can_delete,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:A.can_delete?`Delete ${A.unmatched_count} Transaction(s)`:"Cannot Delete"})]})]})}),e.jsx(fe,{isOpen:mt,onClose:()=>{he(!1),xe(null)},title:"Edit Bank Statement Line",children:x&&e.jsxs("form",{onSubmit:Lt,className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Date:"}),e.jsx("div",{className:"font-medium",children:new Date(x.date).toLocaleDateString("id-ID")}),x.reference&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-600 mt-2 mb-1",children:"Reference:"}),e.jsx("div",{className:"font-medium font-mono text-sm",children:x.reference})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-2 mb-1",children:"Status:"}),e.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[x.status==="matched"&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Matched"})]}),x.status==="recorded"&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Recorded"})]}),x.status==="suggested"&&e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-yellow-700 font-medium",children:"Suggested"})]}),x.status==="unmatched"&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"Unmatched"})]})]})]}),(x.matchedExpense||x.matchedReceipt||x.matchedFundTransfer)&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Linked Transaction"})]}),le&&e.jsx("button",{type:"button",onClick:Ot,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Unlink"})]}),x.matchedExpense&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Expense"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"font-medium text-gray-900",children:((tt=ie.find(t=>{var a;return t.value===((a=x.matchedExpense)==null?void 0:a.expense_category)}))==null?void 0:tt.label)||x.matchedExpense.expense_category})]}),x.matchedExpense.voucher_number&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Voucher:"}),e.jsx("span",{className:"font-medium text-gray-900 font-mono",children:x.matchedExpense.voucher_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[x.currency==="USD"?"$":"Rp"," ",x.matchedExpense.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(x.matchedExpense.expense_date).toLocaleDateString("id-ID")})]}),x.matchedExpense.description&&e.jsxs("div",{className:"pt-2 border-t border-blue-200",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Description:"}),e.jsx("div",{className:"text-gray-900",children:x.matchedExpense.description})]})]}),x.matchedReceipt&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Receipt"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Number:"}),e.jsx("span",{className:"font-medium text-gray-900 font-mono",children:x.matchedReceipt.payment_number})]}),x.matchedReceipt.customer_name&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Customer:"}),e.jsx("span",{className:"font-medium text-gray-900",children:x.matchedReceipt.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[x.currency==="USD"?"$":"Rp"," ",x.matchedReceipt.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(x.matchedReceipt.payment_date).toLocaleDateString("id-ID")})]})]}),x.matchedFundTransfer&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Fund Transfer"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Transfer No:"}),e.jsx("span",{className:"font-medium text-gray-900 font-mono",children:x.matchedFundTransfer.transfer_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"From:"}),e.jsx("span",{className:"font-medium text-gray-900",children:x.matchedFundTransfer.from_account_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"To:"}),e.jsx("span",{className:"font-medium text-gray-900",children:x.matchedFundTransfer.to_account_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[x.currency==="USD"?"$":"Rp"," ",x.matchedFundTransfer.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(x.matchedFundTransfer.transfer_date).toLocaleDateString("id-ID")})]}),x.matchedFundTransfer.description&&e.jsxs("div",{className:"pt-2 border-t border-blue-200",children:[e.jsx("div",{className:"text-gray-600 mb-1",children:"Description:"}),e.jsx("div",{className:"text-gray-900",children:x.matchedFundTransfer.description})]})]}),x.notes&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Match Notes:"}),e.jsx("div",{className:"text-sm text-gray-700 italic",children:x.notes})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:V.description,onChange:t=>ve({...V,description:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-red-700 mb-1",children:"Debit Amount"}),e.jsx("input",{type:"number",step:"0.01",value:V.debit,onChange:t=>ve({...V,debit:parseFloat(t.target.value)||0,credit:0}),className:"w-full px-3 py-2 border border-red-300 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Money OUT (expenses)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-green-700 mb-1",children:"Credit Amount"}),e.jsx("input",{type:"number",step:"0.01",value:V.credit,onChange:t=>ve({...V,credit:parseFloat(t.target.value)||0,debit:0}),className:"w-full px-3 py-2 border border-green-300 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Money IN (receipts)"})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Note:"})," Each transaction should have either a Debit OR a Credit amount, not both. When you enter one, the other will be cleared."]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{he(!1),xe(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Update"})]})]})})]})}export{ca as BankReconciliationEnhanced};
