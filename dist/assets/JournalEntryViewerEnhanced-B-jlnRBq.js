import{m as k,r as n,s as c,j as e,F,T as R,f as T}from"./index-05MON0zc.js";import{M as I}from"./Modal-DojL8f5j.js";import{S as M}from"./search-CGgsAlNq.js";import{S as V}from"./square-pen-pND7Nsfd.js";const q={sales_invoice:"Sales Invoice",sales_invoice_cogs:"COGS Entry",purchase_invoice:"Purchase Invoice",receipt:"Receipt Voucher",payment:"Payment Voucher",petty_cash:"Petty Cash",fund_transfer:"Fund Transfer",manual:"Manual Entry"};function G({canManage:y}){const{dateRange:d}=k(),[g,j]=n.useState([]),[f,x]=n.useState(!0),[i,N]=n.useState(""),[a,b]=n.useState(null),[_,w]=n.useState([]),[v,m]=n.useState(!1),[l,D]=n.useState("all");n.useEffect(()=>{u()},[d,l]);const u=async()=>{try{x(!0);let t=c.from("journal_voucher_view").select("*").gte("date",d.startDate).lte("date",d.endDate);l!=="all"&&(t=t.eq("source_module",l));const{data:r,error:s}=await t;if(s)throw s;j(r||[])}catch(t){console.error("Error loading voucher journal:",t)}finally{x(!1)}},S=async t=>{try{const{data:r,error:s}=await c.from("journal_entry_lines").select("*, chart_of_accounts(code, name), customers(company_name), suppliers(company_name)").eq("journal_entry_id",t).order("line_number");if(s)throw s;w(r||[])}catch(r){console.error("Error loading lines:",r)}},L=async t=>{try{const{data:r,error:s}=await c.from("journal_entries").select("*").eq("id",t.journal_entry_id).single();if(s)throw s;b(r),await S(t.journal_entry_id),m(!0)}catch(r){console.error("Error loading voucher details:",r)}},C=async t=>{if(confirm("Are you sure you want to delete this manual journal entry? This action cannot be undone."))try{const{data:r,error:s}=await c.from("bank_statement_lines").select("id").eq("matched_entry_id",t).limit(1);if(s)throw s;if(r&&r.length>0){alert("Cannot delete this journal entry because it is linked to a bank statement. Please unlink it first from Bank Reconciliation.");return}const{error:h}=await c.from("journal_entry_lines").delete().eq("journal_entry_id",t);if(h)throw h;const{error:p}=await c.from("journal_entries").delete().eq("id",t).eq("source_module","manual");if(p)throw p;T("Journal entry deleted successfully","success"),u()}catch(r){console.error("Error deleting journal:",r),alert("Error deleting journal entry: "+r.message)}},o=g.filter(t=>t.voucher_no.toLowerCase().includes(i.toLowerCase())||t.debit_account&&t.debit_account.toLowerCase().includes(i.toLowerCase())||t.credit_account&&t.credit_account.toLowerCase().includes(i.toLowerCase())||t.narration&&t.narration.toLowerCase().includes(i.toLowerCase())||t.reference_number&&t.reference_number.toLowerCase().includes(i.toLowerCase())),E={debit:o.reduce((t,r)=>t+r.amount,0),credit:o.reduce((t,r)=>t+r.amount,0)};return f?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search voucher, accounts, narration...",value:i,onChange:t=>N(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("select",{value:l,onChange:t=>D(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Sources"}),e.jsx("option",{value:"sales_invoice",children:"Sales Invoices"}),e.jsx("option",{value:"sales_invoice_cogs",children:"COGS"}),e.jsx("option",{value:"purchase_invoice",children:"Purchase Invoices"}),e.jsx("option",{value:"receipt",children:"Receipts"}),e.jsx("option",{value:"payment",children:"Payments"}),e.jsx("option",{value:"petty_cash",children:"Petty Cash"}),e.jsx("option",{value:"fund_transfer",children:"Fund Transfers"}),e.jsx("option",{value:"manual",children:"Manual"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Debit Account"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Credit Account"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r",children:"Narration"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-gray-900 border-r",children:e.jsx("div",{className:"text-xs",children:new Date(t.date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"})})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap border-r",children:e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded",children:t.voucher_type})}),e.jsx("td",{className:"px-3 py-2 border-r",children:e.jsx("div",{className:"text-xs text-gray-900 max-w-xs truncate",children:t.debit_account||"-"})}),e.jsx("td",{className:"px-3 py-2 border-r",children:e.jsx("div",{className:"text-xs text-gray-900 max-w-xs truncate",children:t.credit_account||"-"})}),e.jsx("td",{className:"px-3 py-2 text-right whitespace-nowrap border-r",children:e.jsxs("span",{className:"text-gray-900 font-medium text-xs",children:["Rp ",t.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"px-3 py-2 text-gray-600 text-xs border-r",children:e.jsx("div",{className:"max-w-md truncate",children:t.narration||"-"})}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>L(t),className:"text-blue-600 hover:text-blue-800",title:"View detailed breakdown",children:e.jsx(F,{className:"w-4 h-4"})}),y&&t.source_module==="manual"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>alert("Edit functionality will redirect to Journal Entry form"),className:"text-gray-600 hover:text-gray-800",title:"Edit manual entry",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(t.journal_entry_id),className:"text-red-600 hover:text-red-800",title:"Delete manual entry",children:e.jsx(R,{className:"w-4 h-4"})})]})]})})]},t.journal_entry_id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:"No journal entries found"})})]}),e.jsx("tfoot",{className:"bg-gray-50 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"px-3 py-2 text-right",children:"Total:"}),e.jsxs("td",{className:"px-3 py-2 text-right text-gray-900 border-r",children:["Rp ",E.debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{colSpan:2})]})})]})})}),e.jsx(I,{isOpen:v,onClose:()=>m(!1),title:`Journal Entry: ${a==null?void 0:a.entry_number}`,children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Date:"}),e.jsx("span",{className:"ml-2 font-medium",children:new Date(a.entry_date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Source:"}),e.jsx("span",{className:"ml-2",children:a.source_module?q[a.source_module]:"Manual"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reference:"}),e.jsx("span",{className:"ml-2 font-mono",children:a.reference_number||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Posted:"}),e.jsx("span",{className:"ml-2",children:new Date(a.posted_at).toLocaleString("id-ID")})]})]}),a.description&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:a.description}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Account"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Debit"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Credit"})]})}),e.jsx("tbody",{className:"divide-y",children:_.map(t=>{var r,s;return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-3 py-2",children:[e.jsx("div",{className:"font-mono text-xs text-gray-500",children:(r=t.chart_of_accounts)==null?void 0:r.code}),e.jsx("div",{children:(s=t.chart_of_accounts)==null?void 0:s.name}),t.customers&&e.jsx("div",{className:"text-xs text-blue-600",children:t.customers.company_name}),t.suppliers&&e.jsx("div",{className:"text-xs text-purple-600",children:t.suppliers.company_name})]}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:t.description||"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-blue-600",children:t.debit>0?`Rp ${t.debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`:""}),e.jsx("td",{className:"px-3 py-2 text-right text-green-600",children:t.credit>0?`Rp ${t.credit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`:""})]},t.id)})}),e.jsx("tfoot",{className:"bg-gray-50 font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-3 py-2 text-right",children:"Total:"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-700",children:["Rp ",a.total_debit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("td",{className:"px-3 py-2 text-right text-green-700",children:["Rp ",a.total_credit.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})}),a.total_debit!==a.total_credit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:"Warning: Debit and Credit totals do not match!"})]})})]})}export{G as JournalEntryViewerEnhanced};
