import{r as m,j as r,A as O,X,F as $,s as b}from"./index-D377iWu2.js";import{U as R}from"./upload-B0u4dWaP.js";import{C as z}from"./clipboard-4R3bkPrW.js";import{F as N}from"./file-BzewGIPn.js";import{I as B}from"./image-D11Hy8GW.js";const G=["application/pdf","image/jpeg","image/jpg","image/png","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"],U=10*1024*1024,H=[{value:"invoice",label:"Invoice"},{value:"bill_of_lading",label:"Bill of Lading"},{value:"coa",label:"Certificate of Analysis"},{value:"packing_list",label:"Packing List"},{value:"other",label:"Other"}];function V({batchId:h,existingFiles:y=[],onFilesChange:u,disabled:n=!1}){const[o,w]=m.useState(y),[v,p]=m.useState(!1),[_,d]=m.useState(!1),j=m.useRef(null),D=m.useRef(null),f=e=>{w(e),u==null||u(e)};m.useEffect(()=>{const e=s=>{var i;if(n)return;const t=(i=s.clipboardData)==null?void 0:i.items;if(!t)return;const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(c.type.indexOf("image")!==-1){s.preventDefault();const g=c.getAsFile();if(g){const A=`pasted-image-${Date.now()}.png`,I=new N([g],A,{type:g.type});a.push(I)}}}if(a.length>0){const l=new DataTransfer;a.forEach(c=>l.items.add(c)),x(l.files),d(!0),setTimeout(()=>d(!1),2e3)}};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[n,o]);const P=()=>{n||d(!0)},F=()=>{d(!1)},x=e=>{if(!e||e.length===0)return;const s=[];Array.from(e).forEach(t=>{if(!G.includes(t.type)){alert(`File ${t.name} is not a supported format. Please upload PDF, JPG, PNG, XLSX, or DOCX files.`);return}if(t.size>U){alert(`File ${t.name} exceeds the 10MB size limit.`);return}s.push({file:t,file_name:t.name,file_type:"other",file_size:t.size,uploading:!1})}),f([...o,...s])},E=e=>{e.preventDefault(),p(!1),x(e.dataTransfer.files)},L=e=>{e.preventDefault(),p(!0)},k=()=>{p(!1)},C=async e=>{const s=o[e];if(s.id&&h){if(!confirm("Are you sure you want to delete this document?"))return;try{const{error:a}=await b.from("batch_documents").delete().eq("id",s.id);if(a)throw a;if(s.file_url){const i=s.file_url.split("/"),l=i[i.length-1],c=`${h}/${l}`;await b.storage.from("batch-documents").remove([c])}}catch(a){console.error("Error deleting file:",a),alert("Failed to delete file. Please try again.");return}}const t=o.filter((a,i)=>i!==e);f(t)},S=(e,s)=>{const t=[...o];t[e].file_type=s,f(t)},M=e=>{var t;const s=(t=e.split(".").pop())==null?void 0:t.toLowerCase();return["jpg","jpeg","png"].includes(s||"")?r.jsx(B,{className:"w-5 h-5 text-blue-600"}):s==="pdf"?r.jsx($,{className:"w-5 h-5 text-red-600"}):r.jsx(N,{className:"w-5 h-5 text-gray-600"})},T=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB";return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{ref:D,onDrop:E,onDragOver:L,onDragLeave:k,onMouseEnter:P,onMouseLeave:F,className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors relative ${v?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>{var e;return!n&&((e=j.current)==null?void 0:e.click())},children:[r.jsx(R,{className:`w-12 h-12 mx-auto mb-3 ${v?"text-blue-500":"text-gray-400"}`}),r.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[r.jsx("span",{className:"font-medium text-blue-600",children:"Click to upload"})," or drag and drop"]}),r.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"PDF, JPG, PNG, XLSX, DOCX (max 10MB)"}),_&&r.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-green-600 font-medium animate-pulse",children:[r.jsx(z,{className:"w-4 h-4"}),r.jsx("span",{children:"Press Ctrl+V to paste images from clipboard"})]}),r.jsx("input",{ref:j,type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.xlsx,.xls,.docx,.doc",onChange:e=>x(e.target.files),className:"hidden",disabled:n})]}),o.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Documents (",o.length,")"]}),o.map((e,s)=>r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[r.jsx("div",{className:"flex-shrink-0",children:M(e.file_name)}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-center gap-2",children:e.file_url?r.jsx("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-blue-600 hover:text-blue-700 truncate",onClick:t=>t.stopPropagation(),children:e.file_name}):r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.file_name})}),r.jsx("p",{className:"text-xs text-gray-500",children:T(e.file_size)})]}),r.jsx("select",{value:e.file_type,onChange:t=>S(s,t.target.value),className:"text-xs px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n,onClick:t=>t.stopPropagation(),children:H.map(t=>r.jsx("option",{value:t.value,children:t.label},t.value))}),e.uploading&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}),e.error&&r.jsx("div",{className:"flex-shrink-0",title:e.error,children:r.jsx(O,{className:"w-5 h-5 text-red-600"})}),!n&&!e.uploading&&r.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),C(s)},className:"flex-shrink-0 p-1 text-red-600 hover:bg-red-50 rounded transition",children:r.jsx(X,{className:"w-4 h-4"})})]},s))]})]})}export{V as F};
