import{c as pe,r as i,j as e,X as me,u as ie,d as ce,s as d,f as x,e as X,T as xe,h as he,i as ne}from"./index-D377iWu2.js";import{C as ge,T as be,L as je,P as fe}from"./Layout-B5e6WOHT.js";import{D as ye}from"./DataTable-BXltp17L.js";import{M as le}from"./Modal-XL444I2e.js";import ve from"./MaterialReturns-D-uoNFb-.js";import{h as _e,E as Ne}from"./html2canvas.esm-Fmpx8z4e.js";import{P as we}from"./printer-CyDptLnp.js";import{D as ke}from"./download-Cw744MUe.js";import{f as de}from"./dateFormat-E6B5rKFz.js";import{S as Se}from"./search-C8aJjCFC.js";import{E as Re}from"./eye-0GUlh4_A.js";import{S as Ce}from"./square-pen-Bq2ioL1R.js";import{X as oe}from"./x-circle-BISlCpkj.js";import{T as qe}from"./trending-down-DzuVIicJ.js";import{R as De}from"./refresh-cw-BlA-hMpC.js";import{P as Pe}from"./plus-BUV76DvH.js";import{R as Ee}from"./rotate-ccw-CMYlImAs.js";import"./chevron-up-CjxuCjv5.js";import"./chevron-down-D_LZ1jaB.js";import"./SearchableSelect-B1o4KxTG.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=pe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);function Ae({rejection:o,onClose:_}){const s=i.useRef(null),A=u=>{const f=new Date(u),h=f.getDate(),R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()],C=f.getFullYear();return`${h} ${R} ${C}`},I=u=>u==null?"Rp 0,00":`Rp ${u.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`,L=()=>{window.print()},z=async()=>{if(s.current)try{const u=await _e(s.current,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",windowWidth:s.current.scrollWidth,windowHeight:s.current.scrollHeight,onclone:T=>{const k=T.getElementById("rejection-print-content");k&&(k.style.width="210mm")}}),f=u.toDataURL("image/png",1),h=new Ne("p","mm","a4"),R=h.internal.pageSize.getWidth(),C=h.internal.pageSize.getHeight(),P=u.width,U=u.height,O=R/P,E=U*O;if(E>C){let T=0,k=E;for(;k>0;)h.addImage(f,"PNG",0,T,R,E),k-=C,T-=C,k>0&&h.addPage()}else h.addImage(f,"PNG",0,0,R,E);h.save(`StockRejection-${o.rejection_number}.pdf`)}catch(u){console.error("Error generating PDF:",u),alert("Failed to generate PDF. Please try again.")}};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 print:static print:bg-white print:overflow-visible",children:[e.jsx("div",{className:"flex min-h-screen items-start justify-center p-4 pt-10 print:p-0 print:min-h-0 print:block",children:e.jsxs("div",{className:"relative w-full max-w-5xl bg-white shadow-xl print:shadow-none print:max-w-full",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-6 py-4 print:hidden",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Stock Rejection ",o.rejection_number]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e.jsx(we,{className:"h-4 w-4"}),"Print"]}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:[e.jsx(ke,{className:"h-4 w-4"}),"PDF"]}),e.jsx("button",{onClick:_,className:"rounded-lg bg-gray-100 p-2 text-gray-600 hover:bg-gray-200",children:e.jsx(me,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{id:"rejection-print-content",ref:s,className:"p-8",children:[e.jsxs("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-16 w-16 flex items-center justify-center print:h-12 print:w-12",style:{backgroundColor:"#fff"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:"100%",height:"100%",viewBox:"0 0 15686.55 15480.24",style:{shapeRendering:"geometricPrecision",fillRule:"evenodd",clipRule:"evenodd"},children:e.jsxs("g",{children:[e.jsx("path",{fill:"#FDB763",d:"M69.94 10438.12l10353.39 0 0 -1798.67 1665.92 0 0 1868.6 0 320.44 0 4552.28c0,38.48 -31.45,69.94 -69.94,69.94l-11949.38 0c-38.48,0 -69.94,-31.45 -69.94,-69.94l0 -4872.72c0,-38.48 31.45,-69.94 69.94,-69.94zm1605.9 1710.15l8737.57 0c13.58,0 24.68,11.11 24.68,24.68l0 1719.84c0,13.58 -11.11,24.68 -24.68,24.68l-8737.57 0c-13.58,0 -24.68,-11.11 -24.68,-24.68l0 -1719.84c0,-13.58 11.11,-24.68 24.68,-24.68z"}),e.jsx("path",{fill:"#FDB763",d:"M15587.15 5136.67l-10353.49 0 0 1822.07 -1665.92 0 0 -1892.9 0 -324.61 0 -4611.43c0,-39 31.45,-70.87 69.94,-70.87l11949.47 0c38.48,0 69.94,31.87 69.94,70.87l0 4936.04c0,39 -31.45,70.83 -69.94,70.83zm-1605.9 -1732.36l-8737.67 0c-13.58,0 -24.68,-11.27 -24.68,-25l0 -1742.21c0,-13.74 11.11,-25 24.68,-25l8737.67 0c13.58,0 24.68,11.27 24.68,25l0 1742.21c0,13.74 -11.11,25 -24.68,25z"}),e.jsx("polygon",{fill:"#FD6D26",points:"-0,0 1651.16,0 1651.16,6929.27 15657.09,6929.27 15657.09,6958.74 15686.55,6958.74 15686.55,15480.24 14022.85,15480.24 14022.85,8639.45 1651.16,8639.45 -0,8639.45 -0,6929.27"})]})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold print:text-sm",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Komplek Ruko Metro Sunter Blok A1 NO.15, Jl. Metro Indah Raya,"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Kelurahan Papanggo, Kec. Tanjung Priok, Jakarta Utara - 14340"}),e.jsx("p",{className:"text-xs print:text-[10px]",children:"Telp: (+62 21) 65832426"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("h2",{className:"text-3xl font-bold text-red-600 print:text-2xl",children:"STOCK REJECTION"})})]}),e.jsxs("div",{className:"text-xs space-y-0.5 print:text-[10px] print:space-y-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No izin PBF"}),e.jsx("span",{className:"ml-16",children:": 27092400534390007"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"No Sertifikasi CDOB"}),e.jsx("span",{className:"ml-4",children:": 270924005343900070001"})]})]})]}),e.jsx("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 flex-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Product:"}),e.jsxs("span",{className:"font-semibold",children:[" ",o.product.product_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Product Code:"}),e.jsx("span",{className:"ml-2",children:o.product.product_code})]}),e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"font-bold",children:"Batch Number:"}),e.jsx("span",{className:"ml-2",children:o.batch.batch_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Batch Stock:"}),e.jsxs("span",{className:"ml-2",children:[o.batch.current_stock.toLocaleString()," ",o.product.unit]})]})]}),e.jsxs("div",{className:"space-y-1 text-xs print:text-[10px] print:space-y-0 text-right",style:{minWidth:"220px"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Rejection No:"}),e.jsx("span",{className:"ml-2",children:o.rejection_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Date:"}),e.jsx("span",{className:"ml-2",children:A(o.rejection_date)})]}),e.jsxs("div",{className:"pt-1",children:[e.jsx("span",{className:"font-bold",children:"Qty Rejected:"}),e.jsxs("span",{className:"ml-2 text-red-600 font-semibold",children:[o.quantity_rejected.toLocaleString()," ",o.product.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs font-semibold ${o.status==="approved"?"bg-green-100 text-green-800":o.status==="rejected"?"bg-red-100 text-red-800":o.status==="disposed"?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"}`,children:o.status.replace("_"," ").toUpperCase()})]})]})]})}),e.jsx("div",{className:"mb-3 border-2 border-black print:mb-2",children:e.jsxs("table",{className:"w-full text-xs print:text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black bg-white",children:[e.jsx("th",{className:"border-r border-black p-2 text-left font-bold print:p-1",children:"Rejection Details"}),e.jsx("th",{className:"p-2 text-left font-bold print:p-1",children:"Financial Impact"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"border-r border-black p-2 print:p-1 align-top",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Reason: "}),e.jsx("span",{className:"uppercase",children:o.rejection_reason.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Details: "}),e.jsx("p",{className:"mt-1",children:o.rejection_details})]}),o.inspection_report&&e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Inspection Report: "}),e.jsx("p",{className:"mt-1",children:o.inspection_report})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Disposition: "}),e.jsx("span",{className:"uppercase",children:o.disposition.replace("_"," ")})]})]})}),e.jsx("td",{className:"p-2 print:p-1 align-top",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Unit Cost:"}),e.jsx("span",{className:"font-semibold",children:I(o.unit_cost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quantity:"}),e.jsxs("span",{className:"font-semibold",children:[o.quantity_rejected.toLocaleString()," ",o.product.unit]})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t-2 border-black",children:[e.jsx("span",{className:"font-bold",children:"Total Loss:"}),e.jsx("span",{className:"font-bold text-red-600",children:I(o.financial_loss)})]})]})})]})})]})}),o.photos&&o.photos.length>0&&e.jsxs("div",{className:"mb-3 border-2 border-black p-3 print:mb-2 print:p-2 print:hidden",children:[e.jsx("h3",{className:"text-sm font-bold mb-2",children:"Rejection Photos"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.photos.map((u,f)=>e.jsxs("div",{className:"border border-gray-300 rounded overflow-hidden",children:[e.jsx("img",{src:u.url,alt:`Rejection photo ${f+1}`,className:"w-full h-32 object-cover"}),e.jsxs("div",{className:"text-xs p-1 bg-gray-50 text-center",children:["Photo ",f+1]})]},f))})]}),e.jsx("div",{className:"border-2 border-black",children:e.jsxs("div",{className:"grid grid-cols-3 gap-0 text-xs print:text-[10px]",children:[e.jsxs("div",{className:"p-3 border-r-2 border-black print:p-2 text-center",children:[e.jsx("p",{className:"font-semibold mb-12 print:mb-10",children:"Inspected By"}),e.jsx("div",{className:"border-t border-black pt-1 mx-4",children:"QC Inspector"})]}),e.jsxs("div",{className:"p-3 border-r-2 border-black print:p-2 text-center",children:[e.jsx("p",{className:"font-semibold mb-12 print:mb-10",children:"Reviewed By"}),e.jsx("div",{className:"border-t border-black pt-1 mx-4",children:"QC Manager"})]}),e.jsxs("div",{className:"p-3 print:p-2 text-center",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Approved By"}),e.jsx("p",{className:"font-semibold mb-9 print:mb-7",children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("div",{className:"border-t border-black pt-1 mx-4",children:"Management"})]})]})})]})]})}),e.jsx("style",{children:`
        @media print {
          @page {
            size: A4 portrait;
            margin: 8mm;
          }

          .sticky {
            display: none !important;
          }

          body {
            margin: 0;
            padding: 0;
          }

          body * {
            visibility: hidden;
          }

          #rejection-print-content,
          #rejection-print-content * {
            visibility: visible;
          }

          #rejection-print-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            page-break-inside: avoid;
            page-break-after: auto;
          }

          #rejection-print-content > div {
            page-break-inside: avoid;
          }

          table {
            page-break-inside: auto;
          }

          tr {
            page-break-inside: avoid;
            page-break-after: auto;
          }

          thead {
            display: table-header-group;
          }

          tfoot {
            display: table-footer-group;
          }
        }
      `})]})}function Fe(){const{user:o,userProfile:_}=ie(),{t:s}=ce(),[A,I]=i.useState([]),[L,z]=i.useState([]),[u,f]=i.useState(""),[h,R]=i.useState("all"),[C,P]=i.useState(!1),[U,O]=i.useState(!1),[E,T]=i.useState(null),[k,H]=i.useState(!0),[$,J]=i.useState(!1),[b,F]=i.useState(null),[Y,l]=i.useState([]),[S,y]=i.useState([]),[v,m]=i.useState([]),[N,q]=i.useState([]),[c,w]=i.useState({product_id:"",batch_id:"",rejection_date:new Date().toISOString().split("T")[0],quantity_rejected:0,rejection_reason:"quality_failed",rejection_details:"",disposition:"pending",inspection_report:""});i.useEffect(()=>{Q(),G()},[]),i.useEffect(()=>{Z()},[u,h,A]);const Q=async()=>{try{H(!0);const{data:t,error:n}=await d.from("stock_rejections").select(`
          *,
          product:products(product_name, product_code, unit),
          batch:batches(batch_number, current_stock)
        `).order("created_at",{ascending:!1});if(n)throw n;I(t||[])}catch(t){console.error("Error fetching rejections:",t),x({type:"error",title:"Error",message:s("errorFetchingRejections")||"Error fetching rejections"})}finally{H(!1)}},G=async()=>{const{data:t}=await d.from("products").select("id, product_name, product_code").eq("is_active",!0).order("product_name");l(t||[])},W=async t=>{const{data:n}=await d.from("batches").select("id, batch_number, current_stock, import_price").eq("product_id",t).gt("current_stock",0).order("batch_number");y(n||[])},Z=()=>{let t=A;h!=="all"&&(t=t.filter(n=>n.status===h)),u&&(t=t.filter(n=>n.rejection_number.toLowerCase().includes(u.toLowerCase())||n.product.product_name.toLowerCase().includes(u.toLowerCase())||n.batch.batch_number.toLowerCase().includes(u.toLowerCase())||n.rejection_details.toLowerCase().includes(u.toLowerCase()))),z(t)},ee=t=>{w({...c,product_id:t,batch_id:""}),t&&W(t)},te=t=>{if(t.target.files){const n=Array.from(t.target.files);m([...v,...n]),n.forEach(p=>{const g=new FileReader;g.onloadend=()=>{q(j=>[...j,g.result])},g.readAsDataURL(p)})}},re=t=>{m(v.filter((n,p)=>p!==t)),q(N.filter((n,p)=>p!==t))},D=async t=>{try{if(w({product_id:t.product_id,batch_id:t.batch_id,rejection_date:t.rejection_date,quantity_rejected:t.quantity_rejected,rejection_reason:t.rejection_reason,rejection_details:t.rejection_details,disposition:t.disposition,inspection_report:t.inspection_report||""}),await W(t.product_id),t.photos&&Array.isArray(t.photos)){const n=t.photos.map(p=>p.url);q(n)}J(!0),F(t.id),P(!0)}catch(n){console.error("Error loading rejection for edit:",n),x({type:"error",title:"Error",message:"Failed to load rejection for editing"})}},se=async(t,n)=>{if(await he({title:"Confirm",message:"Are you sure you want to delete this stock rejection? This action cannot be undone.",variant:"danger",confirmLabel:"Delete"}))try{if(n&&Array.isArray(n)&&n.length>0){for(const g of n)if(g.url){const j=g.url.split("/").pop();j&&await d.storage.from("rejection_photos").remove([`${t}/${j}`])}}const{error:p}=await d.from("stock_rejections").delete().eq("id",t).eq("status","pending_approval");if(p)throw p;x({type:"success",title:"Success",message:"Stock rejection deleted successfully"}),Q()}catch(p){console.error("Error deleting rejection:",p),x({type:"error",title:"Error",message:p.message||"Failed to delete stock rejection"})}},K=async t=>{const n=[];for(const p of v){const g=`${t}/${Date.now()}_${p.name}`,{data:j,error:B}=await d.storage.from("rejection_photos").upload(g,p);if(B){console.error("Error uploading photo:",B);continue}const{data:M}=d.storage.from("rejection_photos").getPublicUrl(g);n.push({url:M.publicUrl,filename:p.name,uploaded_at:new Date().toISOString()})}return n},V=async t=>{if(t.preventDefault(),!c.product_id||!c.batch_id||!c.rejection_details){x({type:"error",title:"Error",message:s("pleaseCompleteAllFields")||"Please complete all required fields"});return}try{const n=S.find(j=>j.id===c.batch_id);if(!n){x({type:"error",title:"Error",message:s("invalidBatch")||"Invalid batch selected"});return}if(c.quantity_rejected>n.current_stock){x({type:"error",title:"Error",message:s("quantityExceedsStock")||`Rejection quantity cannot exceed available stock (${n.current_stock})`});return}const p=n.import_price||0,g=c.quantity_rejected*p;if($&&b){const{error:j}=await d.from("stock_rejections").update({...c,unit_cost:p,financial_loss:g,inspected_by:o==null?void 0:o.id}).eq("id",b).eq("status","pending_approval");if(j)throw j;let B=[];if(v.length>0){B=await K(b);const{data:M}=await d.from("stock_rejections").select("photos").eq("id",b).single(),ue=[...(M==null?void 0:M.photos)||[],...B];await d.from("stock_rejections").update({photos:ue}).eq("id",b)}x({type:"success",title:"Success",message:"Stock rejection updated successfully"})}else{const{data:j,error:B}=await d.from("stock_rejections").insert({...c,unit_cost:p,financial_loss:g,created_by:o==null?void 0:o.id,inspected_by:o==null?void 0:o.id}).select().single();if(B)throw B;let M=[];if(v.length>0&&(M=await K(j.id),await d.from("stock_rejections").update({photos:M}).eq("id",j.id)),g>=100){const ae=g>=1e3?"admin":"manager";await d.from("approval_workflows").insert({transaction_type:"stock_rejection",transaction_id:j.id,requested_by:o==null?void 0:o.id,amount:g,quantity:c.quantity_rejected,status:"pending",metadata:{required_role:ae}})}x({type:"success",title:"Success",message:s("rejectionCreatedSuccessfully")||"Stock rejection created successfully"})}P(!1),r(),Q()}catch(n){console.error("Error saving rejection:",n),x({type:"error",title:"Error",message:n.message||s("errorCreatingRejection")||"Error saving stock rejection"})}},r=()=>{w({product_id:"",batch_id:"",rejection_date:new Date().toISOString().split("T")[0],quantity_rejected:0,rejection_reason:"quality_failed",rejection_details:"",disposition:"pending",inspection_report:""}),m([]),q([]),J(!1),F(null)},a=t=>{const n={pending_approval:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",disposed:"bg-gray-100 text-gray-800"},p={pending_approval:e.jsx(ge,{className:"w-3 h-3 mr-1"}),approved:e.jsx(ne,{className:"w-3 h-3 mr-1"}),rejected:e.jsx(oe,{className:"w-3 h-3 mr-1"}),disposed:e.jsx(ne,{className:"w-3 h-3 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n[t]||"bg-gray-100 text-gray-800"}`,children:[p[t],t.replace("_"," ").toUpperCase()]})};return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:s("loading")||"Loading..."})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:s("stockRejections")||"Stock Rejections"}),e.jsxs("button",{onClick:()=>P(!0),className:"inline-flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),s("newRejection")||"New Rejection"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:s("searchRejections")||"Search rejections...",value:u,onChange:t=>f(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:h,onChange:t=>R(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:s("allStatuses")||"All Statuses"}),e.jsx("option",{value:"pending_approval",children:s("pendingApproval")||"Pending Approval"}),e.jsx("option",{value:"approved",children:s("approved")||"Approved"}),e.jsx("option",{value:"rejected",children:s("rejected")||"Rejected"}),e.jsx("option",{value:"disposed",children:s("disposed")||"Disposed"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("rejectionNumber")||"Rejection #"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("date")||"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("product")||"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("batch")||"Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("quantity")||"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("reason")||"Reason"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("loss")||"Loss"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("status")||"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("actions")||"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map(t=>{var n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.rejection_number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:de(t.rejection_date)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[e.jsx("div",{children:t.product.product_name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.product.product_code})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.batch.batch_number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.quantity_rejected}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.rejection_reason.replace("_"," ")}),e.jsxs("td",{className:"px-4 py-3 text-sm text-red-600 font-medium",children:["$",((n=t.financial_loss)==null?void 0:n.toFixed(2))||"0.00"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:a(t.status)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{T(t),O(!0)},className:"text-blue-600 hover:text-blue-800 inline-flex items-center",children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),s("view")||"View"]}),t.status==="pending_approval"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(t),className:"text-yellow-600 hover:text-yellow-800 inline-flex items-center",title:"Edit Rejection",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>se(t.id,t.photos),className:"text-red-600 hover:text-red-800 inline-flex items-center",title:"Delete Rejection",children:e.jsx(xe,{className:"w-4 h-4"})})]})]})})]},t.id)})})]}),L.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:s("noRejectionsFound")||"No rejections found"})]})]}),C&&e.jsx(le,{isOpen:C,onClose:()=>{P(!1),r()},title:$?s("editStockRejection")||"Edit Stock Rejection":s("createStockRejection")||"Create Stock Rejection",children:e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("product")||"Product"," *"]}),e.jsxs("select",{value:c.product_id,onChange:t=>ee(t.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:s("selectProduct")||"Select Product"}),Y.map(t=>e.jsxs("option",{value:t.id,children:[t.product_name," (",t.product_code,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("batch")||"Batch"," *"]}),e.jsxs("select",{value:c.batch_id,onChange:t=>w({...c,batch_id:t.target.value}),required:!0,disabled:!c.product_id,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:s("selectBatch")||"Select Batch"}),S.map(t=>e.jsxs("option",{value:t.id,children:[t.batch_number," (Stock: ",t.current_stock,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("rejectionDate")||"Rejection Date"," *"]}),e.jsx("input",{type:"date",value:c.rejection_date,onChange:t=>w({...c,rejection_date:t.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("quantityRejected")||"Quantity Rejected (Kg)"," *"]}),e.jsx("input",{type:"number",step:"0.01",value:c.quantity_rejected||"",onChange:t=>w({...c,quantity_rejected:parseFloat(t.target.value)}),required:!0,min:"0.01",placeholder:"Enter quantity in Kg",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("rejectionReason")||"Rejection Reason"," *"]}),e.jsxs("select",{value:c.rejection_reason,onChange:t=>w({...c,rejection_reason:t.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"quality_failed",children:s("qualityFailed")||"Quality Failed"}),e.jsx("option",{value:"expired",children:s("expired")||"Expired"}),e.jsx("option",{value:"damaged",children:s("damaged")||"Damaged"}),e.jsx("option",{value:"contaminated",children:s("contaminated")||"Contaminated"}),e.jsx("option",{value:"other",children:s("other")||"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("disposition")||"Disposition"}),e.jsxs("select",{value:c.disposition,onChange:t=>w({...c,disposition:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"pending",children:s("pending")||"Pending"}),e.jsx("option",{value:"scrap",children:s("scrap")||"Scrap"}),e.jsx("option",{value:"return_to_supplier",children:s("returnToSupplier")||"Return to Supplier"}),e.jsx("option",{value:"rework",children:s("rework")||"Rework"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("rejectionDetails")||"Rejection Details"," *"]}),e.jsx("textarea",{value:c.rejection_details,onChange:t=>w({...c,rejection_details:t.target.value}),required:!0,rows:3,placeholder:s("describeRejectionReason")||"Describe the reason for rejection in detail...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("inspectionReport")||"Inspection Report"," (Optional)"]}),e.jsx("textarea",{value:c.inspection_report,onChange:t=>w({...c,inspection_report:t.target.value}),rows:3,placeholder:s("enterInspectionReport")||"Enter inspection report details...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("photos")||"Photos"," (",v.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 transition-colors",children:[e.jsx(Te,{className:"w-5 h-5 mr-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:s("uploadPhotos")||"Upload Photos"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:te,className:"hidden"})]}),N.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.map((t,n)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:`Photo ${n+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>re(n),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 hover:bg-red-700",children:e.jsx(oe,{className:"w-4 h-4"})})]},n))})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start",children:[e.jsx(X,{className:"w-5 h-5 text-yellow-600 mr-2 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:s("approvalRequired")||"Approval Required"}),e.jsx("p",{className:"mt-1",children:s("rejectionApprovalNote")||"Rejections under $100 require manager approval. Over $100 require manager approval. Over $1000 require admin approval."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{P(!1),r()},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:s("cancel")||"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:$?s("updateRejection")||"Update Rejection":s("createRejection")||"Create Rejection"})]})]})}),U&&E&&e.jsx(Ae,{rejection:E,onClose:()=>{O(!1),T(null)}})]})}function rt(){const{t:o}=ce(),{profile:_}=ie(),[s,A]=i.useState("transactions"),[I,L]=i.useState([]),[z,u]=i.useState([]),[f,h]=i.useState([]),[R,C]=i.useState([]),[P,U]=i.useState([]),[O,E]=i.useState([]),[T,k]=i.useState(!0),[H,$]=i.useState(null),[J,b]=i.useState(!1),[F,Y]=i.useState("transaction"),[l,S]=i.useState({transaction_type:"adjustment",product_id:"",batch_id:"",quantity:0,reference_number:"",notes:"",transaction_date:new Date().toISOString().split("T")[0]}),[y,v]=i.useState({customer_id:"",return_date:new Date().toISOString().split("T")[0],return_type:"quality_issue",return_reason:"",notes:""}),[m,N]=i.useState({product_id:"",batch_id:"",rejection_date:new Date().toISOString().split("T")[0],quantity_rejected:0,rejection_reason:"quality_failed",rejection_details:"",unit_cost:0});i.useEffect(()=>{q()},[s]);const q=async()=>{k(!0),$(null);try{await G(),await W(),await Z(),s==="transactions"?await c():s==="returns"?await w():s==="rejections"&&await Q()}catch{$(o("errors.failedToLoadInventory"))}k(!1)},c=async()=>{const{data:r,error:a}=await d.from("inventory_transactions").select(`
        *,
        products(product_name, product_code),
        batches(batch_number),
        user_profiles(full_name)
      `).order("transaction_date",{ascending:!1}).order("created_at",{ascending:!1});if(a)throw a;L(r||[])},w=async()=>{const{data:r,error:a}=await d.from("material_returns").select(`
        *,
        customer:customers(company_name)
      `).order("return_date",{ascending:!1});if(a)throw a;u(r||[])},Q=async()=>{const{data:r,error:a}=await d.from("stock_rejections").select(`
        *,
        product:products(product_name, product_code),
        batch:batches(batch_number)
      `).order("rejection_date",{ascending:!1});if(a)throw a;h(r||[])},G=async()=>{const{data:r,error:a}=await d.from("products").select("id, product_name, product_code").eq("is_active",!0).order("product_name");if(a)throw a;C(r||[])},W=async()=>{const{data:r,error:a}=await d.from("batches").select("id, batch_number, product_id, current_stock").eq("is_active",!0).gt("current_stock",0).order("import_date",{ascending:!1});if(a)throw a;U(r||[])},Z=async()=>{const{data:r,error:a}=await d.from("customers").select("id, company_name").eq("is_active",!0).order("company_name");if(a)throw a;E(r||[])},ee=async r=>{r.preventDefault();try{const{data:{user:a}}=await d.auth.getUser();if(!a)throw new Error("Not authenticated");if(l.batch_id){let t=l.quantity;l.transaction_type==="sale"&&(t=-t);const{error:n}=await d.rpc("adjust_batch_stock_atomic",{p_batch_id:l.batch_id,p_quantity_change:t,p_transaction_type:l.transaction_type,p_reference_id:null,p_notes:l.notes||null,p_created_by:a.id});if(n)throw n}else{const{error:t}=await d.from("inventory_transactions").insert([{...l,batch_id:null,reference_number:l.reference_number||null,notes:l.notes||null,created_by:a.id}]);if(t)throw t}b(!1),D(),q(),x({type:"success",title:"Success",message:"Transaction added successfully"})}catch(a){console.error("Error saving transaction:",a),x({type:"error",title:"Error",message:o("errors.failedToSaveTransaction")})}},te=async r=>{r.preventDefault();try{const{data:{user:a}}=await d.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:t}=await d.from("material_returns").insert([{...y,created_by:a.id}]);if(t)throw t;b(!1),D(),q(),x({type:"success",title:"Success",message:"Material return created successfully. Awaiting approval."})}catch(a){console.error("Error creating return:",a),x({type:"error",title:"Error",message:"Failed to create return. Please try again."})}},re=async r=>{r.preventDefault();try{const{data:{user:a}}=await d.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:t}=await d.from("stock_rejections").insert([{...m,created_by:a.id}]);if(t)throw t;b(!1),D(),q(),x({type:"success",title:"Success",message:"Stock rejection created successfully. Awaiting approval."})}catch(a){console.error("Error creating rejection:",a),x({type:"error",title:"Error",message:"Failed to create rejection. Please try again."})}},D=()=>{S({transaction_type:"adjustment",product_id:"",batch_id:"",quantity:0,reference_number:"",notes:"",transaction_date:new Date().toISOString().split("T")[0]}),v({customer_id:"",return_date:new Date().toISOString().split("T")[0],return_type:"quality_issue",return_reason:"",notes:""}),N({product_id:"",batch_id:"",rejection_date:new Date().toISOString().split("T")[0],quantity_rejected:0,rejection_reason:"quality_failed",rejection_details:"",unit_cost:0})},se=(_==null?void 0:_.role)==="admin"||(_==null?void 0:_.role)==="warehouse"||(_==null?void 0:_.role)==="manager",K=[{key:"transaction_date",label:o("common.date"),render:(r,a)=>de(a.transaction_date)},{key:"transaction_type",label:o("common.type"),render:(r,a)=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.transaction_type==="purchase"?"bg-green-100 text-green-800":a.transaction_type==="sale"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[a.transaction_type==="purchase"&&e.jsx(be,{className:"w-3 h-3"}),a.transaction_type==="sale"&&e.jsx(qe,{className:"w-3 h-3"}),a.transaction_type==="adjustment"&&e.jsx(De,{className:"w-3 h-3"}),a.transaction_type.charAt(0).toUpperCase()+a.transaction_type.slice(1)]})},{key:"product",label:o("common.product"),render:(r,a)=>{var t,n;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(t=a.products)==null?void 0:t.product_name}),e.jsx("div",{className:"text-xs text-gray-500",children:(n=a.products)==null?void 0:n.product_code})]})}},{key:"batch_number",label:o("common.batch"),render:(r,a)=>{var t;return((t=a.batches)==null?void 0:t.batch_number)||"N/A"}},{key:"quantity",label:o("common.quantity"),render:(r,a)=>e.jsxs("span",{className:`font-semibold ${a.transaction_type==="purchase"?"text-green-600":a.transaction_type==="sale"?"text-red-600":"text-blue-600"}`,children:[a.transaction_type==="purchase"?"+":a.transaction_type==="sale"?"-":"",a.quantity]})},{key:"reference_number",label:"Reference",render:(r,a)=>a.reference_number||(a.transaction_type==="purchase"?"Batch Import":"-")}],V=P.filter(r=>s==="transactions"?r.product_id===l.product_id:s==="rejections"?r.product_id===m.product_id:!1);return e.jsx(je,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:o("inventory.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track transactions, returns, and rejections"})]}),se&&s==="transactions"&&e.jsxs("button",{onClick:()=>{D(),Y("transaction"),b(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Add Transaction"]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-8",children:[e.jsxs("button",{onClick:()=>A("transactions"),className:`flex items-center gap-2 pb-4 border-b-2 transition ${s==="transactions"?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(fe,{className:"w-5 h-5"}),"Transactions"]}),e.jsxs("button",{onClick:()=>A("returns"),className:`flex items-center gap-2 pb-4 border-b-2 transition ${s==="returns"?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Ee,{className:"w-5 h-5"}),"Material Returns"]}),e.jsxs("button",{onClick:()=>A("rejections"),className:`flex items-center gap-2 pb-4 border-b-2 transition ${s==="rejections"?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(X,{className:"w-5 h-5"}),"Stock Rejections"]})]})}),H&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-red-700",children:H})]}),e.jsx("button",{onClick:q,className:"px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm",children:"Retry"})]}),s==="transactions"&&e.jsx(ye,{columns:K,data:I,loading:T}),s==="returns"&&e.jsx(ve,{}),s==="rejections"&&e.jsx(Fe,{}),e.jsxs(le,{isOpen:J,onClose:()=>{b(!1),D()},title:F==="transaction"?"Add Inventory Transaction":F==="return"?"Create Material Return":"Report Stock Rejection",children:[F==="transaction"&&e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction Type *"}),e.jsxs("select",{value:l.transaction_type,onChange:r=>S({...l,transaction_type:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"purchase",children:"Purchase"}),e.jsx("option",{value:"sale",children:"Sale"}),e.jsx("option",{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product *"}),e.jsxs("select",{value:l.product_id,onChange:r=>S({...l,product_id:r.target.value,batch_id:""}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),R.map(r=>e.jsxs("option",{value:r.id,children:[r.product_name," (",r.product_code,")"]},r.id))]})]}),l.product_id&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch (Optional)"}),e.jsxs("select",{value:l.batch_id,onChange:r=>S({...l,batch_id:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Batch"}),V.map(r=>e.jsxs("option",{value:r.id,children:[r.batch_number," (Stock: ",r.current_stock,")"]},r.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity *"}),e.jsx("input",{type:"number",value:l.quantity,onChange:r=>S({...l,quantity:Number(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction Date *"}),e.jsx("input",{type:"date",value:l.transaction_date,onChange:r=>S({...l,transaction_date:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number"}),e.jsx("input",{type:"text",value:l.reference_number,onChange:r=>S({...l,reference_number:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., SAPJ-001, PO-002"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:l.notes,onChange:r=>S({...l,notes:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),D()},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Add Transaction"})]})]}),F==="return"&&e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsxs("select",{value:y.customer_id,onChange:r=>v({...y,customer_id:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),O.map(r=>e.jsx("option",{value:r.id,children:r.company_name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Return Type *"}),e.jsxs("select",{value:y.return_type,onChange:r=>v({...y,return_type:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"quality_issue",children:"Quality Issue"}),e.jsx("option",{value:"wrong_product",children:"Wrong Product"}),e.jsx("option",{value:"excess_quantity",children:"Excess Quantity"}),e.jsx("option",{value:"damaged",children:"Damaged"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Return Date *"}),e.jsx("input",{type:"date",value:y.return_date,onChange:r=>v({...y,return_date:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Return Reason *"}),e.jsx("textarea",{value:y.return_reason,onChange:r=>v({...y,return_reason:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes"}),e.jsx("textarea",{value:y.notes,onChange:r=>v({...y,notes:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),D()},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Create Return"})]})]}),F==="rejection"&&e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product *"}),e.jsxs("select",{value:m.product_id,onChange:r=>N({...m,product_id:r.target.value,batch_id:""}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),R.map(r=>e.jsxs("option",{value:r.id,children:[r.product_name," (",r.product_code,")"]},r.id))]})]}),m.product_id&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch *"}),e.jsxs("select",{value:m.batch_id,onChange:r=>N({...m,batch_id:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Batch"}),V.map(r=>e.jsxs("option",{value:r.id,children:[r.batch_number," (Stock: ",r.current_stock,")"]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason *"}),e.jsxs("select",{value:m.rejection_reason,onChange:r=>N({...m,rejection_reason:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"quality_failed",children:"Quality Failed"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"damaged",children:"Damaged"}),e.jsx("option",{value:"contaminated",children:"Contaminated"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity Rejected *"}),e.jsx("input",{type:"number",value:m.quantity_rejected,onChange:r=>N({...m,quantity_rejected:Number(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit Cost *"}),e.jsx("input",{type:"number",step:"0.01",value:m.unit_cost,onChange:r=>N({...m,unit_cost:Number(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Date *"}),e.jsx("input",{type:"date",value:m.rejection_date,onChange:r=>N({...m,rejection_date:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Detailed Description *"}),e.jsx("textarea",{value:m.rejection_details,onChange:r=>N({...m,rejection_details:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),D()},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Report Rejection"})]})]})]})]})})}export{rt as Inventory};
