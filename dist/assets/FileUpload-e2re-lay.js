import{c as O,r as d,j as a,A as X,X as $,F as R,s as b}from"./index-B8TvHX1I.js";import{U as z}from"./upload-enp0Sh2C.js";import{F as N,I as B}from"./image-SE6C2W8x.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=O("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),U=["application/pdf","image/jpeg","image/jpg","image/png","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"],H=10*1024*1024,J=[{value:"invoice",label:"Invoice"},{value:"bill_of_lading",label:"Bill of Lading"},{value:"coa",label:"Certificate of Analysis"},{value:"packing_list",label:"Packing List"},{value:"other",label:"Other"}];function q({batchId:h,existingFiles:y=[],onFilesChange:u,disabled:n=!1}){const[o,w]=d.useState(y),[v,p]=d.useState(!1),[_,m]=d.useState(!1),j=d.useRef(null),D=d.useRef(null),f=e=>{w(e),u==null||u(e)};d.useEffect(()=>{const e=r=>{var i;if(n)return;const t=(i=r.clipboardData)==null?void 0:i.items;if(!t)return;const s=[];for(let l=0;l<t.length;l++){const c=t[l];if(c.type.indexOf("image")!==-1){r.preventDefault();const g=c.getAsFile();if(g){const T=`pasted-image-${Date.now()}.png`,A=new N([g],T,{type:g.type});s.push(A)}}}if(s.length>0){const l=new DataTransfer;s.forEach(c=>l.items.add(c)),x(l.files),m(!0),setTimeout(()=>m(!1),2e3)}};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[n,o]);const P=()=>{n||m(!0)},F=()=>{m(!1)},x=e=>{if(!e||e.length===0)return;const r=[];Array.from(e).forEach(t=>{if(!U.includes(t.type)){alert(`File ${t.name} is not a supported format. Please upload PDF, JPG, PNG, XLSX, or DOCX files.`);return}if(t.size>H){alert(`File ${t.name} exceeds the 10MB size limit.`);return}r.push({file:t,file_name:t.name,file_type:"other",file_size:t.size,uploading:!1})}),f([...o,...r])},E=e=>{e.preventDefault(),p(!1),x(e.dataTransfer.files)},L=e=>{e.preventDefault(),p(!0)},k=()=>{p(!1)},C=async e=>{const r=o[e];if(r.id&&h){if(!confirm("Are you sure you want to delete this document?"))return;try{const{error:s}=await b.from("batch_documents").delete().eq("id",r.id);if(s)throw s;if(r.file_url){const i=r.file_url.split("/"),l=i[i.length-1],c=`${h}/${l}`;await b.storage.from("batch-documents").remove([c])}}catch(s){console.error("Error deleting file:",s),alert("Failed to delete file. Please try again.");return}}const t=o.filter((s,i)=>i!==e);f(t)},S=(e,r)=>{const t=[...o];t[e].file_type=r,f(t)},M=e=>{var t;const r=(t=e.split(".").pop())==null?void 0:t.toLowerCase();return["jpg","jpeg","png"].includes(r||"")?a.jsx(B,{className:"w-5 h-5 text-blue-600"}):r==="pdf"?a.jsx(R,{className:"w-5 h-5 text-red-600"}):a.jsx(N,{className:"w-5 h-5 text-gray-600"})},I=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB";return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{ref:D,onDrop:E,onDragOver:L,onDragLeave:k,onMouseEnter:P,onMouseLeave:F,className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors relative ${v?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>{var e;return!n&&((e=j.current)==null?void 0:e.click())},children:[a.jsx(z,{className:`w-12 h-12 mx-auto mb-3 ${v?"text-blue-500":"text-gray-400"}`}),a.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[a.jsx("span",{className:"font-medium text-blue-600",children:"Click to upload"})," or drag and drop"]}),a.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"PDF, JPG, PNG, XLSX, DOCX (max 10MB)"}),_&&a.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-green-600 font-medium animate-pulse",children:[a.jsx(G,{className:"w-4 h-4"}),a.jsx("span",{children:"Press Ctrl+V to paste images from clipboard"})]}),a.jsx("input",{ref:j,type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.xlsx,.xls,.docx,.doc",onChange:e=>x(e.target.files),className:"hidden",disabled:n})]}),o.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Documents (",o.length,")"]}),o.map((e,r)=>a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("div",{className:"flex-shrink-0",children:M(e.file_name)}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2",children:e.file_url?a.jsx("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-blue-600 hover:text-blue-700 truncate",onClick:t=>t.stopPropagation(),children:e.file_name}):a.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.file_name})}),a.jsx("p",{className:"text-xs text-gray-500",children:I(e.file_size)})]}),a.jsx("select",{value:e.file_type,onChange:t=>S(r,t.target.value),className:"text-xs px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n,onClick:t=>t.stopPropagation(),children:J.map(t=>a.jsx("option",{value:t.value,children:t.label},t.value))}),e.uploading&&a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})}),e.error&&a.jsx("div",{className:"flex-shrink-0",title:e.error,children:a.jsx(X,{className:"w-5 h-5 text-red-600"})}),!n&&!e.uploading&&a.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),C(r)},className:"flex-shrink-0 p-1 text-red-600 hover:bg-red-50 rounded transition",children:a.jsx($,{className:"w-4 h-4"})})]},r))]})]})}export{G as C,q as F};
