import{c as se,r as m,s as h,j as e,i as z,A as te,h as O,f as P,T as Y,F as X,X as ie,d as oe,u as ce,C as Z}from"./index-D377iWu2.js";import{S as de,e as me,U as ae,L as W,P as J,D as ue}from"./Layout-B5e6WOHT.js";import{M as $}from"./mail-BeoD5I2O.js";import{R as M}from"./refresh-cw-BlA-hMpC.js";import{M as G}from"./Modal-XL444I2e.js";import{f as H}from"./dateFormat-E6B5rKFz.js";import{U as q}from"./user-chv8yRr8.js";import{U as K}from"./user-plus-CRFQRH5H.js";import{P as V}from"./pen-DY6gec_b.js";import{L}from"./lock-CGS2egPw.js";import{X as re}from"./x-circle-BISlCpkj.js";import{P as le}from"./plus-BUV76DvH.js";import{u as B,w as xe}from"./xlsx-CKN5doRT.js";import{D as ne}from"./download-Cw744MUe.js";import{U as ge}from"./upload-B0u4dWaP.js";import{S as he}from"./search-C8aJjCFC.js";import{S as pe}from"./square-pen-Bq2ioL1R.js";import{S as R}from"./save-BsVpeKdG.js";import{B as ee}from"./building-2-D6r6vIE5.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=se("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=se("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function ye(){const[f,d]=m.useState(null),[I,y]=m.useState(!0),[_,v]=m.useState(!1);m.useEffect(()=>{j();const g=setInterval(()=>{j()},5e3);return()=>clearInterval(g)},[]);const j=async()=>{try{console.log("[GmailSettings] === LOADING CONNECTION ===");const{data:{user:g}}=await h.auth.getUser();if(console.log("[GmailSettings] Current user:",g==null?void 0:g.id),!g)return;const{data:r,error:l}=await h.from("gmail_connections").select("*").eq("user_id",g.id).eq("is_connected",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(console.log("[GmailSettings] Query result - data:",r),console.log("[GmailSettings] Query result - error:",l),l&&l.code!=="PGRST116")throw l;d(r),console.log("[GmailSettings] Connection set:",r==null?void 0:r.email_address)}catch(g){console.error("[GmailSettings] Error loading Gmail connection:",g)}finally{y(!1)}},S=async()=>{const g="90568246766-durgkfgje103589m6cuk99sv8kim69ec.apps.googleusercontent.com",r=`${window.location.origin}/auth/gmail/callback`;if(console.log("ðŸ”‘ Gmail OAuth Configuration:"),console.log("Redirect URI:",r),console.log(`
ðŸ“‹ Add this to Google Cloud Console:`),console.log("   https://console.cloud.google.com/apis/credentials"),!await O({title:"Confirm",message:`IMPORTANT: Before connecting Gmail

You must add this redirect URI to Google Cloud Console:

${r}

Steps:
1. Go to: https://console.cloud.google.com/apis/credentials
2. Click your OAuth Client ID
3. Under "Authorized redirect URIs", add:
   ${r}
4. Click "Save"
5. Wait 5 minutes for changes to propagate

Have you completed these steps?`,variant:"warning"}))return;const p=["https://www.googleapis.com/auth/gmail.readonly","https://www.googleapis.com/auth/gmail.modify","https://www.googleapis.com/auth/gmail.send","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"].join(" "),A=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${g}&redirect_uri=${encodeURIComponent(r)}&response_type=code&scope=${encodeURIComponent(p)}&access_type=offline&prompt=consent`,c=600,b=700,k=window.screenX+(window.outerWidth-c)/2,T=window.screenY+(window.outerHeight-b)/2;window.open(A,"Gmail OAuth",`width=${c},height=${b},left=${k},top=${T},toolbar=no,menubar=no`)},u=async()=>{if(await O({title:"Confirm",message:"Are you sure you want to disconnect your Gmail account? Email syncing will stop.",variant:"warning"}))try{const{data:{user:g}}=await h.auth.getUser();if(!g)return;const{error:r}=await h.from("gmail_connections").delete().eq("user_id",g.id);if(r)throw r;P({type:"success",title:"Success",message:"Gmail account disconnected successfully"}),j()}catch(g){console.error("Error disconnecting Gmail:",g),P({type:"error",title:"Error",message:"Failed to disconnect Gmail account"})}},w=async()=>{if(f)try{const{error:g}=await h.from("gmail_connections").update({sync_enabled:!f.sync_enabled}).eq("id",f.id);if(g)throw g;j()}catch(g){console.error("Error toggling sync:",g),P({type:"error",title:"Error",message:"Failed to update sync settings"})}},N=async()=>{if(_)return;v(!0),console.log({title:"Email Sync Started",message:"Syncing emails in background. You can continue using the app."});try{const{data:{session:r}}=await h.auth.getSession();if(!r){P({type:"error",title:"Error",message:"Please sign in to sync emails"}),v(!1);return}const l="https://dkrtsqienlhpouohmfki.supabase.co/functions/v1/sync-gmail-emails",p=new AbortController,A=setTimeout(()=>p.abort(),12e4),c=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${r.access_token}`,"Content-Type":"application/json"},signal:p.signal});if(clearTimeout(A),!c.ok){const k=await c.text();throw new Error(`Server error (${c.status}): ${k}`)}const b=await c.json();if(b.success)P({type:"success",title:"Success",message:`Email sync completed!

Total messages found: ${b.totalMessages}
New emails processed: ${b.processedCount}
New inquiries: ${b.newInquiriesCount}`}),j();else throw new Error(b.error||"Sync failed")}catch(r){console.error("Error syncing emails:",r),r instanceof Error&&r.name==="AbortError"?P({type:"warning",title:"Warning",message:"Sync is taking longer than expected. It will continue in the background. Check back in a few minutes."}):P({type:"error",title:"Error",message:`Failed to sync emails: ${r instanceof Error?r.message:"Unknown error"}`})}finally{v(!1)}};return I?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Gmail Integration"})]}),f!=null&&f.is_connected?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Connected"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Not Connected"})]})]}),f!=null&&f.is_connected?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsx(z,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Gmail Connected"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:f.email_address}),f.last_sync&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last synced: ",new Date(f.last_sync).toLocaleString()]}),f.access_token_expires_at&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Token expires: ",new Date(f.access_token_expires_at).toLocaleString()]})]})]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition",children:[e.jsx(me,{className:"w-4 h-4"}),"Disconnect"]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Sync Settings"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Automatic Email Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Fetch new emails every 10 minutes"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.sync_enabled,onChange:w,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("button",{onClick:N,disabled:_,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm font-medium disabled:opacity-50",children:[e.jsx(M,{className:`w-4 h-4 ${_?"animate-spin":""}`}),_?"Syncing...":"Sync Now"]})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Important Security Information"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Your Gmail password is never stored or accessed by this app"}),e.jsx("li",{children:"â€¢ Access tokens are encrypted in the database"}),e.jsx("li",{children:"â€¢ You can revoke access anytime from Google Account settings"}),e.jsx("li",{children:"â€¢ Only emails marked as inquiry-related are processed"})]})]})]})})]}):e.jsx("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsx($,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Connect Your Gmail Account"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Securely connect your Gmail account to automatically fetch pharmaceutical inquiry emails. Your password is never stored - we use Google's OAuth2 for maximum security."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"What you'll get:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Automatic email fetching every 10 minutes"}),e.jsx("li",{children:"â€¢ AI-powered inquiry extraction from emails"}),e.jsx("li",{children:"â€¢ Send emails directly from CRM"}),e.jsx("li",{children:"â€¢ Complete email activity tracking"})]})]}),e.jsxs("button",{onClick:S,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-medium",children:[e.jsx($,{className:"w-5 h-5"}),"Connect Gmail Account"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["By connecting, you authorize this app to read and send emails on your behalf. You can revoke access anytime from your ",e.jsx("a",{href:"https://myaccount.google.com/permissions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Account settings"}),"."]})]})]})}),!1]})}function fe({users:f,onRefresh:d}){const[I,y]=m.useState(!1),[_,v]=m.useState(!1),[j,S]=m.useState(!1),[u,w]=m.useState(null),[N,g]=m.useState(null),[r,l]=m.useState(!1),[p,A]=m.useState(""),[c,b]=m.useState({username:"",email:"",password:"",full_name:"",role:"sales"}),k=async t=>{t.preventDefault(),l(!0);try{const{data:o,error:C}=await h.auth.signUp({email:c.email,password:c.password,options:{data:{username:c.username.toLowerCase(),full_name:c.full_name,role:c.role,email_verified:!0}}});if(C)throw C;if(!o.user)throw new Error("Failed to create user");await new Promise(U=>setTimeout(U,500));const{error:F}=await h.from("user_profiles").update({is_active:!0}).eq("id",o.user.id);F&&console.warn("Profile update warning:",F),P({type:"success",title:"Success",message:`User ${c.full_name} created successfully! Username: ${c.username}`}),y(!1),b({username:"",email:"",password:"",full_name:"",role:"sales"}),d()}catch(o){console.error("Error creating user:",o),P({type:"error",title:"Error",message:o.message||"Failed to create user. Please try again."})}finally{l(!1)}},T=async t=>{if(t.preventDefault(),!!u){l(!0);try{const{data:{session:o}}=await h.auth.getSession();if(!o)throw new Error("Not authenticated");const F=await fetch("https://dkrtsqienlhpouohmfki.supabase.co/functions/v1/admin-update-user",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({user_id:u.id,email:c.email,username:c.username,full_name:c.full_name,role:c.role})}),U=await F.json();if(!F.ok)throw new Error(U.error||"Failed to update user");P({type:"success",title:"Success",message:`User ${c.full_name} updated successfully!`}),v(!1),w(null),b({username:"",email:"",password:"",full_name:"",role:"sales"}),d()}catch(o){console.error("Error updating user:",o),P({type:"error",title:"Error",message:o.message||"Failed to update user. Please try again."})}finally{l(!1)}}},n=t=>{w(t),b({username:t.username,email:t.email,password:"",full_name:t.full_name,role:t.role}),v(!0)},a=async(t,o)=>{const C=o?"deactivate":"activate";if(await O({title:"Confirm",message:`Are you sure you want to ${C} this user?`,variant:"warning",confirmLabel:C.charAt(0).toUpperCase()+C.slice(1)}))try{const{error:F}=await h.from("user_profiles").update({is_active:!o}).eq("id",t);if(F)throw F;P({type:"success",title:"Success",message:`User ${o?"deactivated":"activated"} successfully!`}),d()}catch(F){console.error("Error updating user status:",F),P({type:"error",title:"Error",message:"Failed to update user status."})}},s=async(t,o)=>{if(await O({title:"Confirm",message:`Are you sure you want to permanently delete user "${o}"? This action cannot be undone.`,variant:"danger",confirmLabel:"Delete"}))try{const{error:C}=await h.from("user_profiles").delete().eq("id",t);if(C)throw C;P({type:"success",title:"Success",message:"User deleted successfully!"}),d()}catch(C){console.error("Error deleting user:",C),P({type:"error",title:"Error",message:"Failed to delete user. The user may have associated records."})}},i=t=>{g(t),A(""),S(!0)},x=async t=>{if(t.preventDefault(),!!N){if(p.length<6){P({type:"error",title:"Error",message:"Password must be at least 6 characters long"});return}l(!0);try{const{data:{session:o}}=await h.auth.getSession();if(!o)throw new Error("Not authenticated");const C=await fetch("https://dkrtsqienlhpouohmfki.supabase.co/functions/v1/admin-update-password",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({user_id:N.id,new_password:p})}),F=await C.json();if(!C.ok)throw new Error(F.error||"Failed to update password");P({type:"success",title:"Success",message:`Password updated successfully for ${N.full_name}!`}),S(!1),g(null),A("")}catch(o){console.error("Error changing password:",o),P({type:"error",title:"Error",message:o.message||"Failed to change password. Please try again."})}finally{l(!1)}}},E=t=>{switch(t){case"admin":return"bg-purple-100 text-purple-800 border-purple-300";case"sales":return"bg-blue-100 text-blue-800 border-blue-300";case"accounts":return"bg-green-100 text-green-800 border-green-300";case"warehouse":return"bg-orange-100 text-orange-800 border-orange-300";case"auditor_ca":return"bg-gray-100 text-gray-800 border-gray-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},D=t=>t==="auditor_ca"?"Auditor CA":t.charAt(0).toUpperCase()+t.slice(1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"User Management"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage system users, roles, and access permissions"})]}),e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Add New User"]})]}),e.jsx("div",{className:"space-y-3",children:f.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No users found"}),e.jsx("button",{onClick:()=>y(!0),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Add your first user"})]}):f.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white font-bold text-lg",children:t.full_name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.full_name}),e.jsxs("p",{className:"text-sm text-gray-600 font-mono",children:["@",t.username]}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1 mt-0.5",children:[e.jsx($,{className:"w-3 h-3"}),t.email]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Created: ",H(t.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`px-3 py-1 border rounded-full text-xs font-medium flex items-center gap-1.5 ${E(t.role)}`,children:[e.jsx(Q,{className:"w-3 h-3"}),D(t.role)]}),e.jsx("button",{onClick:()=>n(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition",title:"Edit user",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(t),className:"p-2 text-orange-600 hover:bg-orange-50 rounded-lg transition",title:"Change password",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a(t.id,t.is_active),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-1.5 ${t.is_active?"bg-green-100 text-green-800 hover:bg-green-200 border border-green-300":"bg-red-100 text-red-800 hover:bg-red-200 border border-red-300"}`,title:t.is_active?"Click to deactivate":"Click to activate",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-3.5 h-3.5"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-3.5 h-3.5"}),"Inactive"]})}),e.jsx("button",{onClick:()=>s(t.id,t.username),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition",title:"Delete user",children:e.jsx(Y,{className:"w-4 h-4"})})]})]},t.id))}),e.jsx(G,{isOpen:I,onClose:()=>{y(!1),b({username:"",email:"",password:"",full_name:"",role:"sales"})},title:"Add New User",children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Create a new user account. The user will be able to log in with their username and password."})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(q,{className:"w-4 h-4"}),"Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.full_name,onChange:t=>b({...c,full_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(q,{className:"w-4 h-4"}),"Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.username,onChange:t=>b({...c,username:t.target.value.toLowerCase().replace(/[^a-z0-9]/g,"")}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono",placeholder:"johndoe",pattern:"[a-z0-9]+",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Lowercase letters and numbers only. This will be used to log in."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx($,{className:"w-4 h-4"}),"Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:c.email,onChange:t=>b({...c,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"user@company.com",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For system notifications only. Login uses username."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(L,{className:"w-4 h-4"}),"Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:c.password,onChange:t=>b({...c,password:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Minimum 6 characters",minLength:6,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 6 characters. User can change this after logging in."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(Q,{className:"w-4 h-4"}),"Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:c.role,onChange:t=>b({...c,role:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"sales",children:"Sales - CRM, customers, and sales invoices"}),e.jsx("option",{value:"accounts",children:"Accounts - Finance and invoicing"}),e.jsx("option",{value:"warehouse",children:"Warehouse - Inventory management"}),e.jsx("option",{value:"auditor_ca",children:"Auditor CA - Read-only financial access"}),e.jsx("option",{value:"admin",children:"Admin - Full system access"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Role determines which modules the user can access"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{y(!1),b({username:"",email:"",password:"",full_name:"",role:"sales"})},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition",disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4"}),"Create User"]})})]})]})}),e.jsx(G,{isOpen:_,onClose:()=>{v(!1),w(null),b({username:"",email:"",password:"",full_name:"",role:"sales"})},title:"Edit User",children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"You can edit all user details including email. To reset password, use the password reset button from the user list."})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(q,{className:"w-4 h-4"}),"Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.full_name,onChange:t=>b({...c,full_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(q,{className:"w-4 h-4"}),"Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.username,onChange:t=>b({...c,username:t.target.value.toLowerCase().replace(/[^a-z0-9]/g,"")}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono",placeholder:"johndoe",pattern:"[a-z0-9]+",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Lowercase letters and numbers only. This will be used to log in."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx($,{className:"w-4 h-4"}),"Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:c.email,onChange:t=>b({...c,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"john@example.com",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email address can now be updated"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(Q,{className:"w-4 h-4"}),"Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:c.role,onChange:t=>b({...c,role:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"sales",children:"Sales - CRM, customers, and sales invoices"}),e.jsx("option",{value:"accounts",children:"Accounts - Finance and invoicing"}),e.jsx("option",{value:"warehouse",children:"Warehouse - Inventory management"}),e.jsx("option",{value:"auditor_ca",children:"Auditor CA - Read-only financial access"}),e.jsx("option",{value:"admin",children:"Admin - Full system access"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Role determines which modules the user can access"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),w(null),b({username:"",email:"",password:"",full_name:"",role:"sales"})},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition",disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),"Save Changes"]})})]})]})}),e.jsx(G,{isOpen:j,onClose:()=>{S(!1),g(null),A("")},title:"Change User Password",children:e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-sm text-orange-800 font-medium mb-2",children:"Admin Password Reset"}),e.jsxs("p",{className:"text-sm text-orange-800",children:["You are about to change the password for ",e.jsx("strong",{children:N==null?void 0:N.full_name})," (",N==null?void 0:N.username,"). The user will be able to log in immediately with the new password."]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1.5",children:[e.jsx(L,{className:"w-4 h-4"}),"New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:p,onChange:t=>A(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"Enter new password (minimum 6 characters)",minLength:6,required:!0,autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 6 characters. Make sure to communicate the new password to the user securely."})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Security Note:"})," After changing the password, communicate it to the user through a secure channel. Encourage them to change it after logging in."]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{S(!1),g(null),A("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition",disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4"}),"Change Password"]})})]})]})})]})}function je(){const[f,d]=m.useState([]),[I,y]=m.useState(!0),[_,v]=m.useState(!1),[j,S]=m.useState(null),[u,w]=m.useState({template_name:"",subject:"",body:"",category:"custom",variables:[]}),N=[{value:"price_quote",label:"Price Quote"},{value:"coa_msds",label:"COA/MSDS"},{value:"follow_up",label:"Follow-up"},{value:"thank_you",label:"Thank You"},{value:"custom",label:"Custom"}],g=["{{contact_person}}","{{company_name}}","{{product_name}}","{{specification}}","{{quantity}}","{{supplier_name}}","{{supplier_country}}","{{inquiry_number}}","{{user_name}}"];m.useEffect(()=>{r()},[]);const r=async()=>{try{const{data:n,error:a}=await h.from("crm_email_templates").select("*").order("created_at",{ascending:!1});if(a)throw a;d(n||[])}catch(n){console.error("Error loading templates:",n)}finally{y(!1)}},l=async n=>{n.preventDefault();try{const{data:{user:a}}=await h.auth.getUser();if(!a)throw new Error("Not authenticated");if(j){const{error:s}=await h.from("crm_email_templates").update({template_name:u.template_name,subject:u.subject,body:u.body,category:u.category,variables:u.variables,updated_at:new Date().toISOString()}).eq("id",j.id);if(s)throw s;alert("Template updated successfully!")}else{const{error:s}=await h.from("crm_email_templates").insert([{...u,created_by:a.id,is_active:!0,use_count:0}]);if(s)throw s;alert("Template created successfully!")}T(),v(!1),r()}catch(a){console.error("Error saving template:",a),alert(a.message||"Failed to save template")}},p=n=>{S(n),w({template_name:n.template_name,subject:n.subject,body:n.body,category:n.category,variables:n.variables||[]}),v(!0)},A=async n=>{try{const{data:{user:a}}=await h.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:s}=await h.from("crm_email_templates").insert([{template_name:`${n.template_name} (Copy)`,subject:n.subject,body:n.body,category:n.category,variables:n.variables,created_by:a.id,is_active:!0,use_count:0}]);if(s)throw s;alert("Template duplicated successfully!"),r()}catch(a){console.error("Error duplicating template:",a),alert("Failed to duplicate template")}},c=async(n,a)=>{if(confirm(`Are you sure you want to delete "${a}"?`))try{const{error:s}=await h.from("crm_email_templates").delete().eq("id",n);if(s)throw s;alert("Template deleted successfully!"),r()}catch(s){console.error("Error deleting template:",s),alert("Failed to delete template")}},b=async(n,a)=>{try{const{error:s}=await h.from("crm_email_templates").update({is_active:!a}).eq("id",n);if(s)throw s;r()}catch(s){console.error("Error updating template:",s),alert("Failed to update template status")}},k=n=>{w(a=>({...a,body:a.body+" "+n,variables:a.variables.includes(n)?a.variables:[...a.variables,n]}))},T=()=>{S(null),w({template_name:"",subject:"",body:"",category:"custom",variables:[]})};return I?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Email Templates"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage reusable email templates with variable placeholders"})]}),e.jsxs("button",{onClick:()=>{T(),v(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"New Template"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:f.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(X,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No templates found"}),e.jsx("button",{onClick:()=>v(!0),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Create your first template"})]}):f.map(n=>{var a,s;return e.jsx("div",{className:"p-4 bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:n.template_name}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-700 rounded",children:((a=N.find(i=>i.value===n.category))==null?void 0:a.label)||n.category})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Subject:"})," ",n.subject]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Used ",n.use_count," times"]}),((s=n.variables)==null?void 0:s.length)>0&&e.jsxs("span",{children:["Variables: ",n.variables.length]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b(n.id,n.is_active),className:`p-2 rounded-lg transition ${n.is_active?"text-green-600 hover:bg-green-50":"text-gray-400 hover:bg-gray-50"}`,title:n.is_active?"Active":"Inactive",children:n.is_active?e.jsx(z,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(n),className:"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition",title:"Duplicate",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(n),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition",title:"Edit",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(n.id,n.template_name),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})},n.id)})}),e.jsx(G,{isOpen:_,onClose:()=>{v(!1),T()},title:j?"Edit Template":"Create New Template",children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name *"}),e.jsx("input",{type:"text",value:u.template_name,onChange:n=>w({...u,template_name:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"e.g., Price Quote - English"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsx("select",{value:u.category,onChange:n=>w({...u,category:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:N.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Subject *"}),e.jsx("input",{type:"text",value:u.subject,onChange:n=>w({...u,subject:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"Use variables like {{product_name}}"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Body (HTML) *"}),e.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:g.map(n=>e.jsx("button",{type:"button",onClick:()=>k(n),className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:n},n))}),e.jsx("textarea",{value:u.body,onChange:n=>w({...u,body:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:15,placeholder:"Enter email template body..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),T()},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:j?"Update Template":"Create Template"})]})]})})]})}function we(){const[f,d]=m.useState(!1),[I,y]=m.useState(!1),[_,v]=m.useState(!1),[j,S]=m.useState(!0),[u,w]=m.useState([]),[N,g]=m.useState(null),[r,l]=m.useState(new Set),[p,A]=m.useState(100);m.useEffect(()=>{c()},[]);const c=async()=>{S(!0);try{const{data:{user:i}}=await h.auth.getUser();if(!i)return;const{data:x,error:E}=await h.from("extracted_contacts").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});if(E)throw E;if(x){const D=x.map(t=>({id:t.id,companyName:t.company_name,customerName:t.customer_name,emailIds:t.email_ids,phone:t.phone,mobile:t.mobile,website:t.website,address:t.address,source:t.source,confidence:t.confidence,extracted_at:t.extracted_at}));w(D),l(new Set(D.map((t,o)=>o)))}}catch(i){console.error("Error loading contacts:",i)}finally{S(!1)}},b=async()=>{d(!0);try{const{data:{user:i}}=await h.auth.getUser();if(!i){alert("Please log in to extract contacts.");return}const{data:x,error:E}=await h.from("gmail_connections").select("*").eq("user_id",i.id).eq("is_connected",!0).maybeSingle();if(E&&E.code!=="PGRST116"){console.error("Error fetching Gmail connection:",E),alert(`Database error: ${E.message}. Please contact support.`);return}if(!x||!x.access_token||!x.refresh_token){alert("Gmail is not connected properly. Please reconnect Gmail in Settings â†’ Gmail tab.");return}const D="https://dkrtsqienlhpouohmfki.supabase.co/functions/v1/extract-gmail-contacts";console.log("Calling edge function:",D);const t=await fetch(D,{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRrcnRzcWllbmxocG91b2htZmtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MTQxNzQsImV4cCI6MjA3NzQ5MDE3NH0.Kjo9RU0WAfQSSEm2vTWmuN5BIYk_hvanKDQkm5qdCGY","Content-Type":"application/json"},body:JSON.stringify({access_token:x.access_token,refresh_token:x.refresh_token,max_emails:p,user_id:i.id,connection_id:x.id})});console.log("Response status:",t.status);const o=await t.json();if(console.log("Response data:",o),!t.ok)throw new Error(o.error||`HTTP ${t.status}: ${t.statusText}`);if(o.success){if(o.contacts&&o.contacts.length>0){const C=o.contacts.map(U=>({user_id:i.id,company_name:U.companyName||"",customer_name:U.customerName||"",email_ids:U.emailIds||"",phone:U.phone||"",mobile:U.mobile||"",website:U.website||"",address:U.address||"",source:U.source||"Gmail",confidence:U.confidence||.5,extracted_at:new Date().toISOString()})),{error:F}=await h.from("extracted_contacts").insert(C);if(F){console.error("Error saving contacts:",F),alert("Contacts extracted but failed to save to database. Please try again.");return}await c()}g({total_emails:o.total_emails_scanned||o.total_emails,total_contacts:o.total_contacts}),o.message&&alert(`Success! ${o.message}

Contacts saved to database and will persist across refreshes.`)}else throw new Error(o.error||"Failed to extract contacts")}catch(i){console.error("Error extracting contacts:",i);const x=i.message||"Unknown error occurred";alert(`Failed to extract contacts: ${x}

Please check:
1. Gmail is connected in Settings â†’ Gmail tab
2. Your Gmail connection hasn't expired
3. Try reconnecting Gmail if issues persist`)}finally{d(!1)}},k=()=>{if(u.length===0){alert("No contacts to export");return}const i=u.filter((t,o)=>r.has(o)),x=B.json_to_sheet(i.map(t=>({"Company Name":t.companyName,"Customer Name":t.customerName,"Email IDs":t.emailIds,Phone:t.phone,Mobile:t.mobile,Website:t.website,Address:t.address,Source:t.source}))),E=B.book_new();B.book_append_sheet(E,x,"Clients");const D=[{wch:30},{wch:25},{wch:40},{wch:18},{wch:18},{wch:30},{wch:40},{wch:12}];x["!cols"]=D,xe(E,`Extracted_Contacts_${new Date().toISOString().split("T")[0]}.xlsx`)},T=async()=>{if(r.size===0){alert("Please select contacts to import");return}if(confirm(`Are you sure you want to import ${r.size} contact(s) to the Customers database?

This will create new customer records for selected contacts.`)){y(!0);try{const E=u.filter((o,C)=>r.has(C)).map(o=>{var C;return{company_name:o.companyName||"Unknown Company",contact_person:o.customerName||"",email:((C=o.emailIds.split(";")[0])==null?void 0:C.trim())||"",phone:o.phone||o.mobile||"",website:o.website||"",address:o.address||"",country:"Indonesia",city:"Jakarta Pusat",is_active:!0}}),{data:D,error:t}=await h.from("customers").upsert(E,{onConflict:"email",ignoreDuplicates:!1}).select();if(t)throw t;alert(`Successfully imported ${(D==null?void 0:D.length)||r.size} customer(s)!`)}catch(x){console.error("Error importing customers:",x),alert("Failed to import some customers. They may already exist in the database.")}finally{y(!1)}}},n=async()=>{if(u.length===0){alert("No contacts to clear");return}if(confirm(`Are you sure you want to PERMANENTLY DELETE all ${u.length} extracted contact(s)?

This action cannot be undone!`)){v(!0);try{const{data:{user:x}}=await h.auth.getUser();if(!x)return;const{error:E}=await h.from("extracted_contacts").delete().eq("user_id",x.id);if(E)throw E;w([]),l(new Set),g(null),alert("All extracted contacts have been cleared successfully!")}catch(x){console.error("Error clearing contacts:",x),alert("Failed to clear contacts. Please try again.")}finally{v(!1)}}},a=()=>{r.size===u.length?l(new Set):l(new Set(u.map((i,x)=>x)))},s=i=>{const x=new Set(r);x.has(i)?x.delete(i):x.add(i),l(x)};return j?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading extracted contacts..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Extract Data from Gmail"}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(ae,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-900",children:[u.length," Total Contacts Saved"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI-powered extraction of contact information from Gmail using OpenAI. The system intelligently extracts company names, contacts, phone numbers, and websites from email signatures. All extracted data is saved to database and persists across page refreshes."}),e.jsxs("div",{className:"mt-2 bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-900 font-medium",children:"AI-Powered Features:"}),e.jsxs("ul",{className:"text-xs text-blue-700 mt-1 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:'AI extracts REAL company names from signatures (e.g., "PT Genero Pharmaceuticals")'}),e.jsx("li",{children:"Filters out email greetings, body text, and system emails"}),e.jsx("li",{children:"Tracks processed emails - click again to get NEXT batch of NEW emails"}),e.jsx("li",{children:"All extracted contacts are saved permanently in database"}),e.jsx("li",{children:"High-quality extraction - processes 100-500 emails (takes time for AI quality)"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Emails to Scan"}),e.jsx("input",{type:"number",value:p,onChange:i=>A(Math.max(50,Math.min(500,parseInt(i.target.value)||100))),min:"50",max:"500",step:"50",className:"w-48 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Range: 50 - 500 emails. Recommended: 100-200 for quality"})]}),e.jsx("div",{className:"flex-shrink-0 pt-6",children:e.jsx("button",{onClick:b,disabled:f,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-5 w-5 animate-spin"}),"Extracting..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5"}),"Extract Contacts"]})})})]}),N&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(z,{className:"h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium",children:"AI Extraction completed successfully!"}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["AI processed ",N.total_emails," NEW unprocessed emails and extracted ",N.total_contacts," high-quality contacts"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:'Click "Extract Contacts" again to process the next batch of NEW emails'})]})]})})]}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-900",children:["Extracted Contacts (",r.size," selected)"]}),e.jsx("button",{onClick:a,className:"text-sm text-blue-600 hover:text-blue-700",children:r.size===u.length?"Deselect All":"Select All"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:k,disabled:r.size===0,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ne,{className:"h-4 w-4"}),"Export to Excel"]}),e.jsx("button",{onClick:T,disabled:I||r.size===0,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:I?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),"Import to Customers"]})}),e.jsx("button",{onClick:n,disabled:_||u.length===0,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:_?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4"}),"Clear All Data"]})})]})]}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:r.size===u.length,onChange:a,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Company"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Contact Person"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email IDs"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Mobile"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Website"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map((i,x)=>e.jsxs("tr",{className:`hover:bg-gray-50 ${r.has(x)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:r.has(x),onChange:()=>s(x),className:"rounded border-gray-300"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:i.companyName||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:i.customerName||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 max-w-xs truncate",title:i.emailIds,children:i.emailIds||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:i.phone||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:i.mobile||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-blue-600 max-w-xs truncate",title:i.website,children:i.website||"-"})]},x))})]})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(te,{className:"h-5 w-5 text-yellow-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-900 font-medium",children:"Review before importing"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Please review the extracted contacts carefully. The system attempts to deduplicate and merge contacts from the same company, but you should verify the data before importing to your customer database."})]})]})})]})]})}function Ne(){const[f,d]=m.useState([]),[I,y]=m.useState([]),[_,v]=m.useState(!0),[j,S]=m.useState(""),[u,w]=m.useState(!1),[N,g]=m.useState(null),[r,l]=m.useState({company_name:"",contact_person:"",email:"",phone:"",address:"",city:"",postal_code:"",npwp:"",payment_terms_days:30,is_active:!0});m.useEffect(()=>{p()},[]),m.useEffect(()=>{A()},[j,f]);const p=async()=>{try{v(!0);const{data:a,error:s}=await h.from("suppliers").select("*").order("company_name");if(s)throw s;d(a||[])}catch(a){console.error("Error fetching suppliers:",a.message),alert("Failed to load suppliers")}finally{v(!1)}},A=()=>{if(!j){y(f);return}const a=f.filter(s=>{var i,x,E;return s.company_name.toLowerCase().includes(j.toLowerCase())||((i=s.contact_person)==null?void 0:i.toLowerCase().includes(j.toLowerCase()))||((x=s.email)==null?void 0:x.toLowerCase().includes(j.toLowerCase()))||((E=s.phone)==null?void 0:E.toLowerCase().includes(j.toLowerCase()))});y(a)},c=()=>{g(null),l({company_name:"",contact_person:"",email:"",phone:"",address:"",city:"",postal_code:"",npwp:"",payment_terms_days:30,is_active:!0}),w(!0)},b=a=>{g(a),l({company_name:a.company_name,contact_person:a.contact_person||"",email:a.email||"",phone:a.phone||"",address:a.address||"",city:a.city||"",postal_code:a.postal_code||"",npwp:a.npwp||"",payment_terms_days:a.payment_terms_days||30,is_active:a.is_active}),w(!0)},k=async a=>{if(a.preventDefault(),!r.company_name.trim()){alert("Company name is required");return}try{if(N){const{error:s}=await h.from("suppliers").update(r).eq("id",N.id);if(s)throw s;alert("Supplier updated successfully!")}else{const{error:s}=await h.from("suppliers").insert([r]);if(s)throw s;alert("Supplier created successfully!")}w(!1),p()}catch(s){console.error("Error saving supplier:",s.message),alert("Failed to save supplier: "+s.message)}},T=async a=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:s}=await h.from("suppliers").delete().eq("id",a);if(s)throw s;alert("Supplier deleted successfully!"),p()}catch(s){console.error("Error deleting supplier:",s.message),alert("Failed to delete supplier: "+s.message)}},n=async a=>{try{const{error:s}=await h.from("suppliers").update({is_active:!a.is_active}).eq("id",a.id);if(s)throw s;p()}catch(s){console.error("Error updating supplier status:",s.message),alert("Failed to update supplier status")}};return _?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Loading suppliers..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Suppliers Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your suppliers and vendors"})]}),e.jsxs("button",{onClick:c,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Supplier"]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:j,onChange:a=>S(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Person"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:"No suppliers found"})}):I.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.company_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:a.contact_person||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:a.email||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:a.phone||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>n(a),className:`px-2 py-1 text-xs font-medium rounded-full ${a.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(a),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(a.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(Y,{className:"w-4 h-4"})})]})})]},a.id))})]})}),u&&e.jsx(G,{isOpen:u,onClose:()=>w(!1),title:N?"Edit Supplier":"Add New Supplier",maxWidth:"max-w-4xl",children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.company_name,onChange:a=>l({...r,company_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",value:r.contact_person,onChange:a=>l({...r,contact_person:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"text",value:r.phone,onChange:a=>l({...r,phone:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:a=>l({...r,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NPWP"}),e.jsx("input",{type:"text",value:r.npwp,onChange:a=>l({...r,npwp:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:r.address,onChange:a=>l({...r,address:a.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:r.city,onChange:a=>l({...r,city:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Postal Code"}),e.jsx("input",{type:"text",value:r.postal_code,onChange:a=>l({...r,postal_code:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms (Days)"}),e.jsx("input",{type:"number",value:r.payment_terms_days,onChange:a=>l({...r,payment_terms_days:parseInt(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:r.is_active,onChange:a=>l({...r,is_active:a.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-700",children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsxs("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),N?"Update":"Create"," Supplier"]})]})]})})]})}function Oe(){const{t:f}=oe(),{profile:d}=ce(),I=()=>(d==null?void 0:d.role)==="sales"?"gmail":(d==null?void 0:d.role)==="warehouse"?"suppliers":((d==null?void 0:d.role)==="accounts","company"),[y,_]=m.useState(I()),[v,j]=m.useState(!0),[S,u]=m.useState(!1),[w,N]=m.useState(null),[g,r]=m.useState([]),[l,p]=m.useState({company_name:"",company_address:"",company_phone:"",company_email:"",tax_rate:11,invoice_prefix:"SAPJ",invoice_start_number:1,email_host:"",email_port:587,email_username:"",low_stock_threshold:100,expiry_alert_days:30,default_language:"en",financial_year_start:"2024-01-01",financial_year_end:"2024-12-31",current_financial_year:"2024"});m.useEffect(()=>{(d==null?void 0:d.role)==="admin"?(A(),c()):(d==null?void 0:d.role)==="accounts"?A():(d==null||d.role,j(!1))},[d]);const A=async()=>{try{const{data:s,error:i}=await h.from("app_settings").select("*").limit(1).maybeSingle();if(i)throw i;s&&(N(s),p({company_name:s.company_name||"",company_address:s.company_address||"",company_phone:s.company_phone||"",company_email:s.company_email||"",tax_rate:s.tax_rate||11,invoice_prefix:s.invoice_prefix||"SAPJ",invoice_start_number:s.invoice_start_number||1,email_host:s.email_host||"",email_port:s.email_port||587,email_username:s.email_username||"",low_stock_threshold:s.low_stock_threshold||100,expiry_alert_days:s.expiry_alert_days||30,default_language:s.default_language||"en",financial_year_start:s.financial_year_start||"2024-01-01",financial_year_end:s.financial_year_end||"2024-12-31",current_financial_year:s.current_financial_year||"2024"}))}catch(s){console.error("Error loading settings:",s)}finally{j(!1)}},c=async()=>{try{const{data:s,error:i}=await h.from("user_profiles").select("id, email, full_name, role, is_active, created_at, username").order("created_at",{ascending:!1});if(i)throw i;r(s||[])}catch(s){console.error("Error loading users:",s),r([])}},b=async s=>{s.preventDefault(),u(!0);try{if(w){const{error:i}=await h.from("app_settings").update({...l,email_host:l.email_host||null,email_username:l.email_username||null}).eq("id",w.id);if(i)throw i}else{const{error:i}=await h.from("app_settings").insert([{...l,email_host:l.email_host||null,email_username:l.email_username||null}]);if(i)throw i}alert("Settings saved successfully!"),A()}catch(i){console.error("Error saving settings:",i),alert("Failed to save settings. Please try again.")}finally{u(!1)}},k=(d==null?void 0:d.role)==="admin",T=(d==null?void 0:d.role)==="sales",n=(d==null?void 0:d.role)==="accounts",a=(d==null?void 0:d.role)==="warehouse";return!k&&!T&&!n&&!a?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-gray-600",children:"You do not have permission to access settings."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Only administrators can view and modify system settings."})]})}):v?e.jsx(W,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(W,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure system settings and manage users"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[(k||n)&&e.jsx("button",{onClick:()=>_("company"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="company"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Company Profile"]})}),k&&e.jsx("button",{onClick:()=>_("users"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="users"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Users"]})}),(k||n||T||a)&&e.jsx("button",{onClick:()=>_("suppliers"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="suppliers"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Suppliers"]})}),k&&e.jsx("button",{onClick:()=>_("financial"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="financial"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Financial Year"]})}),k&&e.jsx("button",{onClick:()=>_("system"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="system"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"System"]})}),(k||T)&&e.jsx("button",{onClick:()=>_("gmail"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="gmail"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Gmail"]})}),(k||T)&&e.jsx("button",{onClick:()=>_("templates"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="templates"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Email Templates"]})}),(k||T)&&e.jsx("button",{onClick:()=>_("extract"),className:`px-6 py-3 text-sm font-medium border-b-2 transition ${y==="extract"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Extract Data"]})})]})}),e.jsxs("div",{className:"p-6",children:[y==="gmail"&&e.jsx(ye,{}),y==="templates"&&e.jsx(je,{}),y==="extract"&&e.jsx(we,{}),y==="suppliers"&&e.jsx(Ne,{}),y==="company"&&e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Company Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",value:l.company_name,onChange:s=>p({...l,company_name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:l.company_address,onChange:s=>p({...l,company_address:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"text",value:l.company_phone,onChange:s=>p({...l,company_phone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:l.company_email,onChange:s=>p({...l,company_email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"Financial Settings"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Tax Rate (%)"}),e.jsx("input",{type:"number",value:l.tax_rate,onChange:s=>p({...l,tax_rate:Number(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0",max:"100",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Prefix"}),e.jsx("input",{type:"text",value:l.invoice_prefix,onChange:s=>p({...l,invoice_prefix:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Start Number"}),e.jsx("input",{type:"number",value:l.invoice_start_number,onChange:s=>p({...l,invoice_start_number:Number(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"1"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:S,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:[e.jsx(R,{className:"w-5 h-5"}),S?"Saving...":"Save Settings"]})})]}),y==="users"&&e.jsx(fe,{users:g,onRefresh:c}),y==="financial"&&e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Financial Year Configuration"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Configure your company's financial year period. This will be used to filter reports and dashboard statistics. The system will automatically organize data based on the selected financial year."})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Financial Year *"}),e.jsxs("select",{value:l.current_financial_year,onChange:s=>{const i=s.target.value;p({...l,current_financial_year:i,financial_year_start:`${i}-01-01`,financial_year_end:`${i}-12-31`})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"2023",children:"2023"}),e.jsx("option",{value:"2024",children:"2024"}),e.jsx("option",{value:"2025",children:"2025"}),e.jsx("option",{value:"2026",children:"2026"}),e.jsx("option",{value:"2027",children:"2027"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the active financial year"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date *"}),e.jsx("input",{type:"date",value:l.financial_year_start,onChange:s=>p({...l,financial_year_start:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Financial year start date"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date *"}),e.jsx("input",{type:"date",value:l.financial_year_end,onChange:s=>p({...l,financial_year_end:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Financial year end date"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-green-800 mb-2",children:"Active Financial Year Period:"}),e.jsxs("p",{className:"text-lg font-bold text-green-900",children:[H(l.financial_year_start)," - ",H(l.financial_year_end)]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:S,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:[e.jsx(R,{className:"w-5 h-5"}),S?"Saving...":"Save Financial Year"]})})]}),y==="system"&&e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Inventory Alerts"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",value:l.low_stock_threshold,onChange:s=>p({...l,low_stock_threshold:Number(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert when stock falls below this quantity"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Alert Days"}),e.jsx("input",{type:"number",value:l.expiry_alert_days,onChange:s=>p({...l,expiry_alert_days:Number(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert when products will expire within this many days"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Email Configuration (Optional)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SMTP Host"}),e.jsx("input",{type:"text",value:l.email_host,onChange:s=>p({...l,email_host:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"smtp.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SMTP Port"}),e.jsx("input",{type:"number",value:l.email_port,onChange:s=>p({...l,email_port:Number(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Username"}),e.jsx("input",{type:"text",value:l.email_username,onChange:s=>p({...l,email_username:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"user@example.com"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Language Preference"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Language"}),e.jsxs("select",{value:l.default_language,onChange:s=>p({...l,default_language:s.target.value}),className:"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"id",children:"Indonesian"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:S,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:[e.jsx(R,{className:"w-5 h-5"}),S?"Saving...":"Save Settings"]})})]})]})]})]})})}export{Oe as Settings};
