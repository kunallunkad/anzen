import{r as p,m as Le,u as Fe,s as d,f as h,n as j,F as S,j as e,T as Oe,X as K,h as H}from"./index-D377iWu2.js";import{M as G}from"./Modal-XL444I2e.js";import{f as J}from"./dateFormat-E6B5rKFz.js";import{B as g}from"./building-2-D6r6vIE5.js";import{D as b,P as w}from"./Layout-B5e6WOHT.js";import{P as Re}from"./plus-BUV76DvH.js";import{D as Be}from"./download-Cw744MUe.js";import{A as Y}from"./arrow-down-circle-DVwWjUsN.js";import{A as Q}from"./arrow-up-circle-K6XcFrXA.js";import{E as Ue}from"./eye-0GUlh4_A.js";import{P as Xe}from"./pen-DY6gec_b.js";import{E as ee}from"./external-link-CbTQ6Fgm.js";import{U as $e}from"./upload-B0u4dWaP.js";import{I as We}from"./image-D11Hy8GW.js";const k=[{value:"duty_customs",label:"Duty & Customs (BM)",type:"import",icon:g,description:"Import duties and customs charges - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"ppn_import",label:"PPN Import",type:"operations",icon:b,description:"Import VAT - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"pph_import",label:"PPh Import",type:"import",icon:g,description:"Import withholding tax - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"freight_import",label:"Freight (Import)",type:"import",icon:w,description:"International freight charges - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"clearing_forwarding",label:"Clearing & Forwarding",type:"import",icon:g,description:"Customs clearance - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"port_charges",label:"Port Charges",type:"import",icon:g,description:"Port handling charges - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"container_handling",label:"Container Handling",type:"import",icon:w,description:"Container unloading - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"transport_import",label:"Transportation (Import)",type:"import",icon:j,description:"Port to godown transport - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"loading_import",label:"Loading / Unloading (Import)",type:"import",icon:j,description:"Import container loading/unloading - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"bpom_ski_fees",label:"BPOM / SKI Fees",type:"import",icon:S,description:"BPOM/SKI regulatory fees - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"other_import",label:"Other (Import)",type:"import",icon:b,description:"Other import-related expenses - CAPITALIZED to inventory",requiresContainer:!0,group:"Import Costs"},{value:"delivery_sales",label:"Delivery / Dispatch (Sales)",type:"sales",icon:j,description:"Customer delivery - EXPENSED to P&L",requiresContainer:!1,group:"Sales & Distribution"},{value:"loading_sales",label:"Loading / Unloading (Sales)",type:"sales",icon:j,description:"Sales loading charges - EXPENSED to P&L",requiresContainer:!1,group:"Sales & Distribution"},{value:"other_sales",label:"Other (Sales)",type:"sales",icon:b,description:"Other sales-related expenses - EXPENSED to P&L",requiresContainer:!1,group:"Sales & Distribution"},{value:"salary",label:"Salary",type:"staff",icon:b,description:"Staff salaries - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"staff_overtime",label:"Staff Overtime",type:"staff",icon:b,description:"Overtime payments - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"staff_welfare",label:"Staff Welfare / Allowances",type:"staff",icon:b,description:"Driver food, snacks, overtime meals, welfare - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"travel_conveyance",label:"Travel & Conveyance",type:"staff",icon:j,description:"Local travel, taxi, fuel reimbursements, tolls - EXPENSED to P&L",requiresContainer:!1,group:"Staff Costs"},{value:"warehouse_rent",label:"Warehouse Rent",type:"operations",icon:g,description:"Rent expense - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"utilities",label:"Utilities",type:"operations",icon:g,description:"Electricity, water, etc - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"bank_charges",label:"Bank Charges",type:"operations",icon:b,description:"Bank fees, charges, and transaction costs - EXPENSED to P&L",requiresContainer:!1,group:"Operations"},{value:"office_admin",label:"Office & Admin",type:"admin",icon:g,description:"General admin expenses - EXPENSED to P&L",requiresContainer:!1,group:"Administrative"},{value:"office_shifting_renovation",label:"Office Shifting & Renovation",type:"admin",icon:g,description:"Office shifting, partition work, electrical, cabling, interior renovation - EXPENSED to P&L",requiresContainer:!1,group:"Administrative"},{value:"fixed_assets",label:"Fixed Assets / Equipment",type:"assets",icon:w,description:"Purchase of fixed assets - CAPITALIZED (see Asset Guide)",requiresContainer:!1,group:"Assets"},{value:"other",label:"Other",type:"admin",icon:b,description:"Miscellaneous expenses - EXPENSED to P&L",requiresContainer:!1,group:"Administrative"}];function lt({canManage:C,onNavigateToFundTransfer:Ze}){const[te,se]=p.useState([]),[ae,re]=p.useState([]),[ne,ie]=p.useState([]),[le,oe]=p.useState([]),[W,ce]=p.useState(!0),[de,A]=p.useState(!1),[me,Z]=p.useState(!1),[n,pe]=p.useState(null),[y,I]=p.useState(null),[xe,ue]=p.useState(0),[Me,he]=p.useState(!1),[v,N]=p.useState([]),[T,P]=p.useState([]),[m,ge]=p.useState(null),[ye,fe]=p.useState(!1),[q,be]=p.useState("all"),[L,_e]=p.useState("all"),{dateRange:M}=Le(),{profile:F}=Fe(),O=M.startDate,R=M.endDate,[a,x]=p.useState({transaction_type:"expense",transaction_date:new Date().toISOString().split("T")[0],amount:0,description:"",expense_category:"",bank_account_id:"",paid_to:"",paid_by_staff_name:"",paid_by:"cash",source:"",received_by_staff_name:"",import_container_id:"",delivery_challan_id:""}),E=p.useCallback(async()=>{try{const[t,s,r,i,c]=await Promise.all([d.from("petty_cash_transactions").select(`
            *,
            bank_accounts:bank_account_id (
              account_name,
              bank_name,
              alias,
              currency
            ),
            import_containers:import_container_id (
              container_ref
            ),
            delivery_challans:delivery_challan_id (
              challan_number
            ),
            petty_cash_documents (*)
          `).gte("transaction_date",O).lte("transaction_date",R).order("transaction_date",{ascending:!1}).order("transaction_number",{ascending:!1}),d.rpc("get_petty_cash_balance"),d.from("import_containers").select("id, container_ref").order("container_ref",{ascending:!1}),d.from("delivery_challans").select(`
            id,
            challan_number,
            challan_date,
            customers:customer_id (
              company_name
            )
          `).order("challan_date",{ascending:!1}),d.from("bank_accounts").select("*").order("bank_name",{ascending:!0})]);if(t.error)throw t.error;if(s.error)throw s.error;se(t.data||[]),ue(s.data||0),re(r.data||[]),ie(i.data||[]),oe(c.data||[])}catch(t){console.error("Error loading petty cash data:",t),h({type:"error",title:"Error",message:"Failed to load petty cash data: "+t.message})}finally{ce(!1),he(!1)}},[O,R]);p.useEffect(()=>{E();const t=d.channel("petty-cash-changes").on("postgres_changes",{event:"*",schema:"public",table:"petty_cash_transactions"},()=>{E()}).subscribe();return()=>{t.unsubscribe()}},[E]);const je=async t=>{const s=Array.from(t.target.files||[]);s.length!==0&&N(s)},ve=async t=>{const r=Array.from(t.clipboardData.items).filter(i=>i.type.startsWith("image/"));if(r.length>0){t.preventDefault();const c=(await Promise.all(r.map(l=>{const o=l.getAsFile();return o?new File([o],`pasted-image-${Date.now()}.png`,{type:o.type}):null}))).filter(l=>l!==null);c.length>0&&N(l=>[...l,...c])}},Ne=t=>{N(s=>s.filter((r,i)=>i!==t))},we=async t=>{if(await H({title:"Confirm",message:"Are you sure you want to delete this document?",variant:"danger",confirmLabel:"Delete"}))try{const{error:s}=await d.from("petty_cash_documents").delete().eq("id",t);if(s)throw s;P(r=>r.filter(i=>i.id!==t)),h({type:"success",title:"Success",message:"Document deleted successfully!"})}catch(s){console.error("Error deleting document:",s),h({type:"error",title:"Error",message:"Failed to delete document"})}},B=()=>{A(!1),I(null),P([]),N([])},Ce=()=>{I(null),x({transaction_type:"expense",transaction_date:new Date().toISOString().split("T")[0],amount:0,description:"",expense_category:"",bank_account_id:"",paid_to:"",paid_by_staff_name:"",paid_by:"cash",source:"",received_by_staff_name:"",import_container_id:"",delivery_challan_id:""}),P([]),N([]),A(!0)},Ee=t=>{I(t),x({transaction_type:t.transaction_type,transaction_date:t.transaction_date,amount:t.amount,description:t.description,expense_category:t.expense_category||"",bank_account_id:t.bank_account_id||"",paid_to:t.paid_to||"",paid_by_staff_name:t.paid_by_staff_name||"",paid_by:"cash",source:t.source||"",received_by_staff_name:t.received_by_staff_name||"",import_container_id:t.import_container_id||"",delivery_challan_id:t.delivery_challan_id||""}),P(t.petty_cash_documents||[]),N([]),A(!0)},ke=async t=>{if(t.preventDefault(),a.transaction_type==="expense"&&!a.expense_category){h({type:"error",title:"Error",message:"Please select an expense category"});return}const s=k.find(r=>r.value===a.expense_category);if(s!=null&&s.requiresContainer&&!a.import_container_id){h({type:"error",title:"Error",message:`${s.label} requires linking to an import container`});return}try{const r={transaction_type:a.transaction_type,transaction_date:a.transaction_date,amount:a.amount,description:a.description,expense_category:a.transaction_type==="expense"?a.expense_category:null,bank_account_id:a.transaction_type==="withdraw"?a.bank_account_id:null,paid_to:a.transaction_type==="expense"?a.paid_to:null,paid_by_staff_name:a.transaction_type==="expense"?a.paid_by_staff_name:null,source:a.transaction_type==="withdraw"?a.source:null,received_by_staff_name:a.transaction_type==="withdraw"?a.received_by_staff_name:null,import_container_id:a.import_container_id||null,delivery_challan_id:a.delivery_challan_id||null};let i;if(y){const{error:c}=await d.from("petty_cash_transactions").update(r).eq("id",y.id);if(c)throw c;i=y.id}else{const{data:c,error:l}=await d.from("petty_cash_transactions").insert([r]).select("id").single();if(l)throw l;if(!c)throw new Error("Failed to create transaction");i=c.id}if(v.length>0){const c=v.map(async l=>{const o=l.name.split(".").pop(),X=`${`${i}_${Date.now()}.${o}`}`,{error:V}=await d.storage.from("petty-cash-receipts").upload(X,l);if(V)throw V;const{data:{publicUrl:qe}}=d.storage.from("petty-cash-receipts").getPublicUrl(X);let $="proof";l.type.startsWith("image/")?$="photo":l.type==="application/pdf"&&($="invoice");const{error:z}=await d.from("petty_cash_documents").insert([{petty_cash_transaction_id:i,file_type:$,file_name:l.name,file_url:qe,file_size:l.size,uploaded_by:F==null?void 0:F.id}]);if(z)throw z});await Promise.all(c)}h({type:"success",title:"Success",message:y?"Petty cash transaction updated successfully!":"Petty cash transaction added successfully!"}),B(),E()}catch(r){console.error("Error saving petty cash transaction:",r),h({type:"error",title:"Error",message:"Failed to save transaction: "+r.message})}},Se=async t=>{if(await H({title:"Confirm",message:"Are you sure you want to delete this transaction?",variant:"danger",confirmLabel:"Delete"}))try{const{data:s}=await d.from("petty_cash_documents").select("file_url").eq("petty_cash_transaction_id",t),{data:r}=await d.from("bank_statement_lines").select("id").eq("matched_petty_cash_id",t);r&&r.length>0&&await d.from("bank_statement_lines").update({matched_petty_cash_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null}).eq("matched_petty_cash_id",t);const{data:i}=await d.from("journal_entries").select("id").eq("source_module","petty_cash").ilike("reference_number",`%${t}%`);if(i&&i.length>0){const l=i.map(o=>o.id);await d.from("bank_statement_lines").update({matched_entry_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null}).in("matched_entry_id",l);for(const o of l)await d.from("journal_entry_lines").delete().eq("journal_entry_id",o),await d.from("journal_entries").delete().eq("id",o)}const{error:c}=await d.from("petty_cash_transactions").delete().eq("id",t);if(c)throw c;if(s&&s.length>0){const l=s.map(o=>o.file_url.split("/").pop()||"").filter(Boolean);l.length>0&&await d.storage.from("petty-cash-receipts").remove(l)}h({type:"success",title:"Success",message:"Transaction deleted successfully!"}),await E()}catch(s){console.error("Error deleting transaction:",s),h({type:"error",title:"Error",message:"Failed to delete transaction: "+s.message})}},Pe=()=>{if(f.length===0){h({type:"info",title:"Notice",message:"No transactions to export"});return}const t=["Date","Number","Type","Category","Description","Amount","Paid To"],s=f.map(o=>{const _=o.expense_category?D(o.expense_category):null;return[o.transaction_date,o.transaction_number,o.transaction_type==="withdraw"?"Withdrawal":"Expense",(_==null?void 0:_.label)||"",o.description,o.amount.toString(),o.paid_to||""]}),r=[t.join(","),...s.map(o=>o.map(_=>`"${_}"`).join(","))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),l=URL.createObjectURL(i);c.setAttribute("href",l),c.setAttribute("download",`petty_cash_${O||"all"}_to_${R||"all"}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},De=t=>{pe(t),Z(!0)},U=t=>{let s="asc";m&&m.key===t&&m.direction==="asc"&&(s="desc"),ge({key:t,direction:s})},f=[...te].sort((t,s)=>{if(!m)return 0;const r=t[m.key],i=s[m.key];return r==null?1:i==null?-1:r<i?m.direction==="asc"?-1:1:r>i?m.direction==="asc"?1:-1:0}).filter(t=>{if(q!=="all"&&t.transaction_type==="expense"){const s=k.find(r=>r.value===t.expense_category);if(!s||s.type!==q)return!1}return!(L!=="all"&&t.expense_category!==L)}),D=t=>k.find(s=>s.value===t),u=D(a.expense_category);if(W)return e.jsx("div",{className:"flex items-center justify-center h-64",children:"Loading petty cash data..."});const Ae=f.filter(t=>t.transaction_type==="expense").reduce((t,s)=>t+Number(s.amount),0),Ie=f.filter(t=>t.transaction_type==="withdraw").reduce((t,s)=>t+Number(s.amount),0),Te=k.reduce((t,s)=>(t[s.group]||(t[s.group]=[]),t[s.group].push(s),t),{});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Petty Cash"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Track cash withdrawals and expenses"})]}),e.jsxs("div",{className:"flex items-center gap-4 ml-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Balance"}),e.jsxs("div",{className:"text-sm font-bold text-green-600",children:["Rp ",xe.toLocaleString()]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Withdrawals"}),e.jsxs("div",{className:"text-sm font-bold text-blue-600",children:["Rp ",Ie.toLocaleString()]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Expenses"}),e.jsxs("div",{className:"text-sm font-bold text-red-600",children:["Rp ",Ae.toLocaleString()]})]})]})]}),C&&e.jsxs("button",{onClick:Ce,className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-white text-blue-600 rounded hover:bg-blue-50 font-medium transition-all shadow-sm text-xs",children:[e.jsx(Re,{className:"w-3.5 h-3.5"}),"New"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-2",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"flex gap-1",children:[{value:"all",label:"All",icon:"ðŸ“‹"},{value:"import",label:"Import",icon:"ðŸ“¦"},{value:"sales",label:"Sales",icon:"ðŸšš"},{value:"staff",label:"Staff",icon:"ðŸ‘¥"},{value:"operations",label:"Ops",icon:"ðŸ¢"},{value:"admin",label:"Admin",icon:"ðŸ“„"},{value:"assets",label:"Assets",icon:"ðŸ¦"}].map(t=>e.jsxs("button",{onClick:()=>be(t.value),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${q===t.value?"bg-blue-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[t.icon," ",t.label]},t.value))}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("select",{value:L,onChange:t=>_e(t.target.value),className:"px-2 py-1 border border-gray-300 rounded-md text-xs",children:[e.jsx("option",{value:"all",children:"All Categories"}),k.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsxs("button",{onClick:Pe,disabled:f.length===0,className:"ml-auto px-3 py-1.5 bg-green-600 text-white rounded-md text-xs hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-1.5 font-medium",children:[e.jsx(Be,{className:"w-3.5 h-3.5"}),"Export (",f.length,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>U("transaction_date"),className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Date",(m==null?void 0:m.key)==="transaction_date"&&e.jsx("span",{className:"text-blue-600 text-sm",children:m.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{onClick:()=>U("transaction_number"),className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Number",(m==null?void 0:m.key)==="transaction_number"&&e.jsx("span",{className:"text-blue-600 text-sm",children:m.direction==="asc"?"â†‘":"â†“"})]})}),e.jsx("th",{className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600",children:"Type"}),e.jsx("th",{className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600",children:"Category"}),e.jsx("th",{className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600",children:"Description"}),e.jsx("th",{className:"px-4 py-2.5 text-left text-xs font-semibold text-gray-600",children:"Linked To"}),e.jsx("th",{onClick:()=>U("amount"),className:"px-4 py-2.5 text-right text-xs font-semibold text-gray-600 cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Amount",(m==null?void 0:m.key)==="amount"&&e.jsx("span",{className:"text-blue-600 text-sm",children:m.direction==="asc"?"â†‘":"â†“"})]})}),C&&e.jsx("th",{className:"px-4 py-2.5 text-center text-xs font-semibold text-gray-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:W?e.jsx("tr",{children:e.jsx("td",{colSpan:C?8:7,className:"px-6 py-8 text-center text-gray-500",children:"Loading..."})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:C?8:7,className:"px-6 py-8 text-center text-gray-500",children:"No transactions found"})}):f.map(t=>{const s=t.expense_category?D(t.expense_category):null,r=s==null?void 0:s.icon;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:J(t.transaction_date)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600",children:t.transaction_number}),t.voucher_number&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.voucher_number})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t.transaction_type==="withdraw"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.transaction_type==="withdraw"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-3 w-3"}),"Withdrawal"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-3 w-3"}),"Expense"]})})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s&&e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx(r,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.label})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"max-w-xs truncate",children:[t.description,t.paid_to&&e.jsxs("div",{className:"text-xs text-gray-500",children:["To: ",t.paid_to]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"space-y-1",children:[t.import_containers&&e.jsxs("div",{className:"flex items-center gap-1 text-purple-600",children:[e.jsx(w,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:t.import_containers.container_ref})]}),t.delivery_challans&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(j,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:t.delivery_challans.challan_number})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:e.jsxs("span",{className:`text-sm font-medium ${t.transaction_type==="withdraw"?"text-blue-600":"text-red-600"}`,children:["Rp ",Number(t.amount).toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>De(t),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:e.jsx(Ue,{className:"h-4 w-4"})}),C&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ee(t),className:"text-yellow-600 hover:text-yellow-900",title:"Edit",children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Se(t.id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(Oe,{className:"h-4 w-4"})})]})]})})]},t.id)})})]})}),e.jsx(G,{isOpen:de,onClose:B,title:y?"Edit Transaction":"Add Petty Cash Transaction",children:e.jsxs("form",{onSubmit:ke,className:"space-y-4",onPaste:ve,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction Type"}),e.jsxs("select",{value:a.transaction_type,onChange:t=>x({...a,transaction_type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"expense",children:"Expense (Cash Out)"}),e.jsx("option",{value:"withdraw",children:"Withdraw from Bank"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:a.transaction_date,onChange:t=>x({...a,transaction_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Rp)"}),e.jsx("input",{type:"number",value:a.amount||"",onChange:t=>x({...a,amount:parseFloat(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,min:"0",step:"0.01"})]})]}),a.transaction_type==="expense"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Expense Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.expense_category,onChange:t=>x({...a,expense_category:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select expense category..."}),Object.entries(Te).map(([t,s])=>e.jsx("optgroup",{label:t,children:s.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))},t))]}),a.expense_category&&u&&e.jsx("p",{className:"mt-1 text-xs text-gray-600",children:u.description})]}),(u==null?void 0:u.requiresContainer)&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-orange-900",children:"Import Container Required"}),e.jsx("div",{className:"text-xs text-orange-700 mt-1",children:"This expense category requires linking to an import container for proper cost allocation"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Link to Container ",(u==null?void 0:u.requiresContainer)&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.import_container_id,onChange:t=>x({...a,import_container_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:u==null?void 0:u.requiresContainer,children:[e.jsx("option",{value:"",children:"None"}),ae.map(t=>e.jsx("option",{value:t.id,children:t.container_ref},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link to Delivery Challan (Sales)"}),e.jsxs("select",{value:a.delivery_challan_id,onChange:t=>x({...a,delivery_challan_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"None"}),ne.map(t=>{var s;return e.jsxs("option",{value:t.id,children:[t.challan_number," - ",(s=t.customers)==null?void 0:s.company_name," (",J(t.challan_date),")"]},t.id)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paid To"}),e.jsx("input",{type:"text",value:a.paid_to,onChange:t=>x({...a,paid_to:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Vendor/Supplier name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paid By (Staff)"}),e.jsx("input",{type:"text",value:a.paid_by_staff_name,onChange:t=>x({...a,paid_by_staff_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Staff member name"})]})]})]}),a.transaction_type==="withdraw"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Account"}),e.jsxs("select",{value:a.bank_account_id,onChange:t=>x({...a,bank_account_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select bank account"}),le.map(t=>e.jsxs("option",{value:t.id,children:[t.alias||t.bank_name," - ",t.account_number," (",t.currency,")"]},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source/Reference"}),e.jsx("input",{type:"text",value:a.source,onChange:t=>x({...a,source:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Check number, transfer ref"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Received By"}),e.jsx("input",{type:"text",value:a.received_by_staff_name,onChange:t=>x({...a,received_by_staff_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Staff member name"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>x({...a,description:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:3,required:!0,placeholder:"Enter transaction details"})]}),y&&T.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Existing Documents (",T.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:T.map(t=>e.jsxs("div",{className:"group relative border border-gray-200 rounded-lg overflow-hidden hover:border-red-500 transition-colors",children:[t.file_type==="photo"?e.jsx("div",{className:"aspect-square bg-gray-100 relative",children:e.jsx("img",{src:t.file_url,alt:t.file_name,className:"w-full h-full object-cover"})}):e.jsxs("div",{className:"aspect-square bg-red-50 flex flex-col items-center justify-center p-3",children:[e.jsx(S,{className:"h-10 w-10 text-red-600 mb-2"}),e.jsx("p",{className:"text-xs text-center text-gray-700 line-clamp-2 px-2",children:t.file_name})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-2 py-1.5 flex items-center justify-between",children:[e.jsxs("span",{children:[(t.file_size/1024).toFixed(0)," KB"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",onClick:s=>s.stopPropagation(),children:e.jsx(ee,{className:"h-3.5 w-3.5"})}),e.jsx("button",{type:"button",onClick:()=>we(t.id),className:"p-1 hover:bg-red-500 rounded",children:e.jsx(K,{className:"h-3.5 w-3.5"})})]})]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:y?"Upload Additional Documents/Receipts":"Upload Documents/Receipts"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[e.jsx("input",{type:"file",onChange:je,accept:"image/*,.pdf",multiple:!0,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx($e,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Images or PDF files"})]}),!ye&&v.length===0&&e.jsx("button",{type:"button",onClick:()=>fe(!0),className:"text-xs text-blue-600 hover:text-blue-700 mt-2",children:"ðŸ’¡ You can also paste images here"})]}),v.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:[v.length," file(s) ready:"]}),e.jsx("div",{className:"space-y-1",children:v.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-3 py-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.type.startsWith("image/")?e.jsx(We,{className:"h-4 w-4 text-blue-600"}):e.jsx(S,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(t.size/1024).toFixed(1)," KB)"]})]}),e.jsx("button",{type:"button",onClick:()=>Ne(s),className:"text-red-600 hover:text-red-800",children:e.jsx(K,{className:"h-4 w-4"})})]},s))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:B,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[y?"Update":"Save"," Transaction"]})]})]})}),e.jsx(G,{isOpen:me,onClose:()=>Z(!1),title:"Petty Cash Receipt",maxWidth:"max-w-lg",children:n&&e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-2 rounded -mt-1 -mx-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs opacity-90",children:"Transaction #"}),e.jsx("p",{className:"text-base font-bold",children:n.transaction_number})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs opacity-90",children:"Date"}),e.jsx("p",{className:"text-base font-semibold",children:new Date(n.transaction_date).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"})})]})]})}),e.jsx("div",{className:"py-2 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Type"}),e.jsx("div",{className:"flex items-center gap-1",children:n.transaction_type==="withdraw"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-3.5 w-3.5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Withdrawal"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-3.5 w-3.5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-900",children:"Expense"})]})})]}),n.expense_category&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Category"}),e.jsx("div",{className:"flex items-center gap-1.5",children:(()=>{const t=D(n.expense_category),s=t==null?void 0:t.icon;return e.jsxs(e.Fragment,{children:[s&&e.jsx(s,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t==null?void 0:t.label})]})})()})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Amount"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Rp ",Number(n.amount).toLocaleString("id-ID")]})]})]})}),e.jsxs("div",{className:"py-2 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:n.description})]}),e.jsxs("div",{className:"py-2 border-b border-gray-200 space-y-1.5",children:[(n.paid_to||n.paid_by_staff_name)&&e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[n.paid_to&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Paid To:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.paid_to})]}),n.paid_by_staff_name&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Paid By:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.paid_by_staff_name})]})]}),n.received_by_staff_name&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Received By:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.received_by_staff_name})]}),n.source&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Source:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.source})]})]}),(n.import_containers||n.delivery_challans||n.bank_accounts)&&e.jsxs("div",{className:"py-2 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Linked To"}),e.jsxs("div",{className:"space-y-1",children:[n.import_containers&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(w,{className:"h-3.5 w-3.5 text-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Container:"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.import_containers.container_ref})]}),n.delivery_challans&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(j,{className:"h-3.5 w-3.5 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Challan:"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.delivery_challans.challan_number})]}),n.bank_accounts&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx(g,{className:"h-3.5 w-3.5 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Bank:"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.bank_accounts.alias||n.bank_accounts.bank_name})]})]})]}),n.petty_cash_documents&&n.petty_cash_documents.length>0&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Attachments (",n.petty_cash_documents.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.petty_cash_documents.map(t=>e.jsxs("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",className:"group relative border border-gray-200 rounded overflow-hidden hover:border-blue-500 transition-colors",children:[t.file_type==="photo"?e.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[e.jsx("img",{src:t.file_url,alt:t.file_name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-opacity flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}):e.jsxs("div",{className:"aspect-square bg-red-50 flex flex-col items-center justify-center p-3",children:[e.jsx(S,{className:"h-8 w-8 text-red-600 mb-2"}),e.jsx("p",{className:"text-xs text-center text-gray-700 line-clamp-2",children:t.file_name})]}),t.file_size&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-2 py-0.5",children:[(t.file_size/1024).toFixed(0)," KB"]})]},t.id))})]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Recording Fixed Assets"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"For Equipment/Asset Purchases:"})}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsx("li",{children:'Use category "Fixed Assets / Equipment"'}),e.jsx("li",{children:"Record the purchase here with full details"}),e.jsx("li",{children:'This creates a debit to "Fixed Assets" account'}),e.jsx("li",{children:"Assets are CAPITALIZED (not expensed immediately)"}),e.jsx("li",{children:"Later: Finance team will set up depreciation schedule"})]}),e.jsx("p",{className:"text-xs mt-2 bg-blue-100 p-2 rounded",children:"ðŸ’¡ Examples: Computers, machinery, furniture, vehicles, AC units, shelving"})]})]})]})})]})}export{lt as PettyCashManager};
