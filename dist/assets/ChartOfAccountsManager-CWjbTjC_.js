import{r as o,s as u,j as e,T as L}from"./index-D377iWu2.js";import{M as T}from"./Modal-XL444I2e.js";import{S as D}from"./search-C8aJjCFC.js";import{P as F}from"./plus-BUV76DvH.js";import{C as G}from"./chevron-down-D_LZ1jaB.js";import{C as O}from"./chevron-right-DdjCJ7xv.js";import{S as P}from"./square-pen-Bq2ioL1R.js";const g=[{value:"asset",label:"Asset",color:"bg-blue-100 text-blue-800"},{value:"liability",label:"Liability",color:"bg-red-100 text-red-800"},{value:"equity",label:"Equity",color:"bg-purple-100 text-purple-800"},{value:"revenue",label:"Revenue",color:"bg-green-100 text-green-800"},{value:"expense",label:"Expense",color:"bg-orange-100 text-orange-800"},{value:"contra",label:"Contra",color:"bg-gray-100 text-gray-800"}];function H({canManage:x}){const[b,j]=o.useState([]),[v,N]=o.useState(!0),[_,c]=o.useState(!1),[d,y]=o.useState(null),[m,w]=o.useState(new Set(["asset","liability","equity","revenue","expense"])),[i,C]=o.useState(""),[s,r]=o.useState({code:"",name:"",name_id:"",account_type:"expense",account_group:"",parent_id:"",is_header:!1,normal_balance:"debit",description:""});o.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:a,error:t}=await u.from("chart_of_accounts").select("*").order("code");if(t)throw t;j(a||[])}catch(a){console.error("Error loading accounts:",a)}finally{N(!1)}},A=async a=>{a.preventDefault();try{const t={...s,parent_id:s.parent_id||null,name_id:s.name_id||null,description:s.description||null};if(d){const{error:l}=await u.from("chart_of_accounts").update(t).eq("id",d.id);if(l)throw l}else{const{error:l}=await u.from("chart_of_accounts").insert([t]);if(l)throw l}c(!1),f(),p()}catch(t){console.error("Error saving account:",t),alert("Failed to save account: "+t.message)}},S=a=>{y(a),r({code:a.code,name:a.name,name_id:a.name_id||"",account_type:a.account_type,account_group:a.account_group||"",parent_id:a.parent_id||"",is_header:a.is_header,normal_balance:a.normal_balance,description:a.description||""}),c(!0)},k=async a=>{if(confirm("Are you sure you want to delete this account?"))try{const{error:t}=await u.from("chart_of_accounts").delete().eq("id",a);if(t)throw t;p()}catch(t){console.error("Error deleting account:",t),alert("Failed to delete account: "+t.message)}},f=()=>{y(null),r({code:"",name:"",name_id:"",account_type:"expense",account_group:"",parent_id:"",is_header:!1,normal_balance:"debit",description:""})},E=a=>{const t=new Set(m);t.has(a)?t.delete(a):t.add(a),w(t)},q=b.filter(a=>a.code.toLowerCase().includes(i.toLowerCase())||a.name.toLowerCase().includes(i.toLowerCase())||a.name_id&&a.name_id.toLowerCase().includes(i.toLowerCase())),h=g.reduce((a,t)=>(a[t.value]=q.filter(l=>l.account_type===t.value),a),{});return v?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search accounts...",value:i,onChange:a=>C(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),x&&e.jsxs("button",{onClick:()=>{f(),c(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(F,{className:"w-5 h-5"}),"Add Account"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:g.map(a=>{var t,l;return e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsx("button",{onClick:()=>E(a.value),className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m.has(a.value)?e.jsx(G,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${a.color}`,children:a.label}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",((t=h[a.value])==null?void 0:t.length)||0," accounts)"]})]})}),m.has(a.value)&&((l=h[a.value])==null?void 0:l.length)>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 text-xs text-gray-500 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Code"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Account Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Indonesian Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Group"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Normal"}),x&&e.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:h[a.value].map(n=>e.jsxs("tr",{className:`hover:bg-gray-50 ${n.is_header?"font-semibold bg-gray-50":""}`,children:[e.jsx("td",{className:"px-4 py-2 font-mono text-sm",children:n.code}),e.jsx("td",{className:"px-4 py-2",children:n.name}),e.jsx("td",{className:"px-4 py-2 text-gray-500",children:n.name_id||"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:n.account_group||"-"}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded ${n.normal_balance==="debit"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:n.normal_balance})}),x&&e.jsxs("td",{className:"px-4 py-2 text-right",children:[e.jsx("button",{onClick:()=>S(n),className:"text-blue-600 hover:text-blue-800 mr-2",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k(n.id),className:"text-red-600 hover:text-red-800",children:e.jsx(L,{className:"w-4 h-4"})})]})]},n.id))})]})]},a.value)})}),e.jsx(T,{isOpen:_,onClose:()=>c(!1),title:d?"Edit Account":"Add Account",children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Code *"}),e.jsx("input",{type:"text",required:!0,value:s.code,onChange:a=>r({...s,code:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., 1101"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Type *"}),e.jsx("select",{required:!0,value:s.account_type,onChange:a=>r({...s,account_type:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:g.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name (English) *"}),e.jsx("input",{type:"text",required:!0,value:s.name,onChange:a=>r({...s,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name (Indonesian)"}),e.jsx("input",{type:"text",value:s.name_id,onChange:a=>r({...s,name_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Group"}),e.jsx("input",{type:"text",value:s.account_group,onChange:a=>r({...s,account_group:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Normal Balance *"}),e.jsxs("select",{required:!0,value:s.normal_balance,onChange:a=>r({...s,normal_balance:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"debit",children:"Debit"}),e.jsx("option",{value:"credit",children:"Credit"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parent Account"}),e.jsxs("select",{value:s.parent_id,onChange:a=>r({...s,parent_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"None (Top Level)"}),b.filter(a=>a.is_header).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.name]},a.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_header",checked:s.is_header,onChange:a=>r({...s,is_header:a.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"is_header",className:"text-sm text-gray-700",children:"This is a header/group account (not for posting)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:a=>r({...s,description:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 text-gray-700 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d?"Update":"Create"," Account"]})]})]})})]})}export{H as ChartOfAccountsManager};
