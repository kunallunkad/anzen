import{r as d,s as o,j as e,T as be,h as je,f as T}from"./index-05MON0zc.js";import{M as U}from"./Modal-DojL8f5j.js";import{S as ve}from"./SearchableSelect-rThwoRtO.js";import{h as Ne,E as we}from"./html2canvas.esm-2-KN9102.js";import{S as Se}from"./search-CGgsAlNq.js";import{A as ke}from"./arrow-down-circle-B8R_Evxa.js";import{E as De}from"./eye-ZtrRT66G.js";import{P as Ae}from"./pen-Q5LbXz1h.js";import{P as Ce}from"./printer-DeVD-0IS.js";import"./chevron-down-C44n7mhs.js";function Le({canManage:F}){var O,V,W,L,P;const N=d.useRef(null),[H,G]=d.useState([]),[I,Y]=d.useState([]),[J,K]=d.useState([]),[w,S]=d.useState([]),[Q,X]=d.useState(!0),[Z,y]=d.useState(!1),[ee,k]=d.useState(!1),[_,B]=d.useState(!1),[i,f]=d.useState(null),[h,D]=d.useState([]),[A,te]=d.useState(""),[g,b]=d.useState([]),[ae,se]=d.useState(""),[E,ne]=d.useState(""),[r,p]=d.useState({voucher_date:new Date().toISOString().split("T")[0],customer_id:"",payment_method:"bank_transfer",bank_account_id:"",reference_number:"",amount:0,description:""});d.useEffect(()=>{C(),ie(),oe(),re()},[]);const re=async()=>{const{data:t}=await o.from("app_settings").select("company_name, company_address").limit(1).maybeSingle();t&&(se(t.company_name||""),ne(t.company_address||""))};d.useEffect(()=>{r.customer_id?z(r.customer_id):(S([]),b([]))},[r.customer_id]);const C=async()=>{try{const{data:t,error:a}=await o.from("receipt_vouchers").select("*, customers(company_name), bank_accounts(account_name, bank_name, alias)").order("voucher_date",{ascending:!1});if(a)throw a;const s=await Promise.all((t||[]).map(async n=>{const{data:m}=await o.from("voucher_allocations").select(`
              allocated_amount,
              sales_invoice_id,
              sales_order_id,
              sales_invoices(invoice_number),
              sales_orders(so_number)
            `).eq("receipt_voucher_id",n.id);let l="-";if(m&&m.length>0){const j=m.map(u=>u.sales_invoice_id&&u.sales_invoices?`${u.sales_invoices.invoice_number} (Invoice)`:u.sales_order_id&&u.sales_orders?`${u.sales_orders.so_number} (Advance)`:null).filter(Boolean);l=j.length>0?j.join(", "):"-"}return{...n,allocated_to:l}}));G(s)}catch(t){console.error("Error loading vouchers:",t)}finally{X(!1)}},ie=async()=>{const{data:t}=await o.from("customers").select("id, company_name").order("company_name");Y(t||[])},oe=async()=>{const{data:t}=await o.from("bank_accounts").select("id, account_name, bank_name, account_number, alias").eq("is_active",!0);K(t||[])},z=async(t,a=!1,s)=>{try{const{data:n}=await o.rpc("get_invoices_with_balance",{customer_uuid:t}),m=(n||[]).filter(c=>c.balance_amount>0),{data:l}=await o.from("sales_orders").select("id, so_number, so_date, total_amount, advance_payment_amount, advance_payment_status, status").eq("customer_id",t).not("status","in","(cancelled,closed)").order("so_date");let j=[],u=[];if(s){const{data:c}=await o.from("voucher_allocations").select("sales_invoice_id, sales_order_id").eq("receipt_voucher_id",s);if(c){const $=c.filter(x=>x.sales_invoice_id).map(x=>x.sales_invoice_id),M=c.filter(x=>x.sales_order_id).map(x=>x.sales_order_id);if($.length>0){const{data:x}=await o.rpc("get_invoices_with_balance",{customer_uuid:t});j=(x||[]).filter(fe=>$.includes(fe.id))}if(M.length>0){const{data:x}=await o.from("sales_orders").select("id, so_number, so_date, total_amount, advance_payment_amount, advance_payment_status, status").in("id",M);u=x||[]}}}const he=[...m||[],...j],ge=Array.from(new Map(he.map(c=>[c.id,c])).values()),_e=[...l||[],...u],ye=[...Array.from(new Map(_e.map(c=>[c.id,c])).values()).filter(c=>c.advance_payment_status!=="full").map(c=>({...c,balance_due:c.total_amount-(c.advance_payment_amount||0),type:"salesorder"})),...ge.map(c=>({...c,type:"invoice"}))];S(ye),a||b([])}catch(n){console.error("Error loading allocation targets:",n)}},le=async()=>{const{data:t,error:a}=await o.rpc("generate_voucher_number",{p_prefix:"RV"});if(a)throw a;return t},ce=(t,a,s)=>{b(n=>n.find(l=>l.targetId===t)?s<=0?n.filter(l=>l.targetId!==t):n.map(l=>l.targetId===t?{...l,amount:s}:l):s>0?[...n,{targetId:t,targetType:a,amount:s}]:n)},R=g.reduce((t,a)=>t+a.amount,0),de=async()=>{if(!(!N.current||!i))try{const t=await Ne(N.current,{scale:2,useCORS:!0,logging:!1}),a=t.toDataURL("image/png"),s=new we("p","mm","a4"),n=s.internal.pageSize.getWidth(),m=t.height*n/t.width;s.addImage(a,"PNG",0,0,n,m),s.save(`Receipt-${i.voucher_number}.pdf`)}catch(t){console.error("Error generating PDF:",t),T({type:"error",title:"Error",message:"Error generating PDF. Please try again."})}},me=async t=>{if(t.preventDefault(),g.length>0&&R>r.amount){T({type:"error",title:"Error",message:"Total allocated amount cannot exceed payment amount"});return}try{const{data:{user:a}}=await o.auth.getUser();if(!a)throw new Error("Not authenticated");let s;if(_&&i){const{data:n,error:m}=await o.from("receipt_vouchers").update({voucher_date:r.voucher_date,payment_method:r.payment_method,bank_account_id:r.bank_account_id||null,reference_number:r.reference_number||null,amount:r.amount,description:r.description||null}).eq("id",i.id).select().single();if(m)throw m;s=n,await o.from("voucher_allocations").delete().eq("receipt_voucher_id",i.id)}else{const n=await le(),{data:m,error:l}=await o.from("receipt_vouchers").insert([{voucher_number:n,voucher_date:r.voucher_date,customer_id:r.customer_id,payment_method:r.payment_method,bank_account_id:r.bank_account_id||null,reference_number:r.reference_number||null,amount:r.amount,description:r.description||null,created_by:a.id}]).select().single();if(l)throw l;s=m}for(const n of g)n.targetType==="invoice"?await o.from("voucher_allocations").insert({voucher_type:"receipt",receipt_voucher_id:s.id,sales_invoice_id:n.targetId,allocated_amount:n.amount}):n.targetType==="salesorder"&&await o.from("voucher_allocations").insert({voucher_type:"receipt",receipt_voucher_id:s.id,sales_order_id:n.targetId,allocated_amount:n.amount});y(!1),v(),C()}catch(a){console.error("Error saving voucher:",a),T({type:"error",title:"Error",message:"Failed to save: "+a.message})}},v=()=>{p({voucher_date:new Date().toISOString().split("T")[0],customer_id:"",payment_method:"bank_transfer",bank_account_id:"",reference_number:"",amount:0,description:""}),b([]),S([]),B(!1),f(null)},xe=async t=>{f(t);const{data:a}=await o.from("voucher_allocations").select(`
        *,
        sales_invoices(invoice_number, total_amount),
        sales_orders(so_number, total_amount)
      `).eq("receipt_voucher_id",t.id);D(a||[]),k(!0)},pe=async t=>{f(t),B(!0),p({voucher_date:t.voucher_date,customer_id:t.customer_id,payment_method:t.payment_method,bank_account_id:t.bank_account_id||"",reference_number:t.reference_number||"",amount:t.amount,description:t.description||""}),await z(t.customer_id,!1,t.id);const{data:a}=await o.from("voucher_allocations").select("*").eq("receipt_voucher_id",t.id);if(a){const s=a.map(n=>({targetId:n.sales_invoice_id||n.sales_order_id,targetType:n.sales_invoice_id?"invoice":"salesorder",amount:Number(n.allocated_amount)}));b(s)}y(!0)},ue=async t=>{if(await je({title:"Confirm",message:`Delete receipt voucher ${t.voucher_number}? This will remove all allocations and cannot be undone.`,variant:"danger",confirmLabel:"Delete"}))try{await o.from("voucher_allocations").delete().eq("receipt_voucher_id",t.id),t.journal_entry_id&&(await o.from("bank_statement_lines").update({matched_entry_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null}).eq("matched_entry_id",t.journal_entry_id),await o.from("journal_entry_lines").delete().eq("journal_entry_id",t.journal_entry_id),await o.from("journal_entries").delete().eq("id",t.journal_entry_id));const{data:a}=await o.from("bank_statement_lines").select("id").eq("matched_receipt_id",t.id);a&&a.length>0&&await o.from("bank_statement_lines").update({matched_receipt_id:null,reconciliation_status:"unmatched",matched_at:null,matched_by:null}).eq("matched_receipt_id",t.id);const{error:s}=await o.from("receipt_vouchers").delete().eq("id",t.id);if(s)throw s;alert("Receipt voucher deleted successfully"),C()}catch(a){console.error("Error deleting voucher:",a),alert("Failed to delete: "+a.message)}},q=H.filter(t=>{var a,s;return t.voucher_number.toLowerCase().includes(A.toLowerCase())||((s=(a=t.customers)==null?void 0:a.company_name)==null?void 0:s.toLowerCase().includes(A.toLowerCase()))});return Q?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search receipts...",value:A,onChange:t=>te(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]}),F&&e.jsxs("button",{onClick:()=>{v(),y(!0)},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(ke,{className:"w-5 h-5"}),"New Receipt"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Voucher No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bank"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Allocated To"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[q.map(t=>{var a,s,n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm",children:t.voucher_number}),e.jsx("td",{className:"px-4 py-3",children:new Date(t.voucher_date).toLocaleDateString("id-ID")}),e.jsx("td",{className:"px-4 py-3",children:(a=t.customers)==null?void 0:a.company_name}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs capitalize",children:t.payment_method.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:((s=t.bank_accounts)==null?void 0:s.alias)||((n=t.bank_accounts)==null?void 0:n.account_name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.allocated_to}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium text-green-600",children:["Rp ",t.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>xe(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"View Details",children:e.jsx(De,{className:"w-4 h-4"})}),F&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>pe(t),className:"p-1 text-amber-600 hover:bg-amber-50 rounded",title:"Edit",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ue(t),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(be,{className:"w-4 h-4"})})]})]})})]},t.id)}),q.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"No receipt vouchers found"})})]})]})}),e.jsx(U,{isOpen:Z,onClose:()=>{y(!1),v()},title:_?"Edit Receipt Voucher":"New Receipt Voucher",children:e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",required:!0,value:r.voucher_date,onChange:t=>p({...r,voucher_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),_?e.jsx("div",{className:"w-full px-3 py-2 border border-gray-200 rounded-lg bg-gray-50",children:((O=I.find(t=>t.id===r.customer_id))==null?void 0:O.company_name)||"Unknown"}):e.jsx(ve,{value:r.customer_id,onChange:t=>p({...r,customer_id:t}),options:I.map(t=>({value:t.id,label:t.company_name})),placeholder:"Select customer"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method *"}),e.jsxs("select",{required:!0,value:r.payment_method,onChange:t=>p({...r,payment_method:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"giro",children:"Giro"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Rp) *"}),e.jsx("input",{type:"number",required:!0,value:r.amount,onChange:t=>p({...r,amount:parseFloat(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),r.payment_method!=="cash"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Account"}),e.jsxs("select",{value:r.bank_account_id,onChange:t=>p({...r,bank_account_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Select account"}),J.map(t=>e.jsx("option",{value:t.id,children:t.alias||`${t.bank_name} - ${t.account_name}`},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference No."}),e.jsx("input",{type:"text",value:r.reference_number,onChange:t=>p({...r,reference_number:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Check/Transfer reference"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>p({...r,description:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:2})]}),(w.length>0||g.length>0||_)&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Allocate Payment"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium mb-1",children:"How to allocate:"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{className:"text-purple-700",children:"SO (Advance)"})," = Record advance payment against Sales Order"]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-blue-700",children:"Invoice"})," = Record payment against Sales Invoice"]}),e.jsx("li",{children:'Enter amount in "Allocate (Rp)" column to link payment to document'}),e.jsx("li",{children:"You can allocate partial amounts to multiple documents"})]})]}),w.length>0?e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Document"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Balance Due"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Allocate (Rp)"})]})}),e.jsx("tbody",{className:"divide-y",children:w.map(t=>{var m;const a=t.type==="invoice"?t.balance_amount:t.balance_due,s=t.type==="invoice"?t.invoice_number:t.so_number,n=t.type==="invoice"?t.invoice_date:t.so_date;return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-3 py-2",children:[e.jsx("div",{className:"font-mono text-xs",children:s}),e.jsx("div",{className:"text-gray-500 text-xs",children:new Date(n).toLocaleDateString("id-ID")})]}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${t.type==="salesorder"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:t.type==="salesorder"?"SO (Advance)":"Invoice"})}),e.jsxs("td",{className:"px-3 py-2 text-right text-red-600 font-medium",children:["Rp ",a.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",min:0,max:a,value:((m=g.find(l=>l.targetId===t.id))==null?void 0:m.amount)||"",onChange:l=>ce(t.id,t.type,parseFloat(l.target.value)||0),className:"w-28 px-2 py-1 border rounded text-right text-xs",placeholder:"0"})})]},`${t.type}-${t.id}`)})})]})}):e.jsxs("div",{className:"border rounded-lg p-4 text-center text-gray-500 text-sm",children:[e.jsx("p",{children:"No unpaid invoices or sales orders found for this customer."}),_&&g.length>0&&e.jsx("p",{className:"mt-2 text-xs",children:"This voucher had allocations that are now fully paid or no longer available."})]}),e.jsxs("div",{className:"mt-3 flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:g.length})," allocation(s)"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-500",children:"Total Allocated:"}),e.jsxs("span",{className:`ml-2 font-bold text-lg ${R>r.amount?"text-red-600":"text-green-600"}`,children:["Rp ",R.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("span",{className:"text-gray-400 ml-1",children:["/ Rp ",r.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{y(!1),v()},className:"px-4 py-2 text-gray-700 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:_?"Update Receipt":"Save Receipt"})]})]})}),e.jsx(U,{isOpen:ee,onClose:()=>{k(!1),f(null),D([])},title:"Receipt Voucher Details",children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Voucher Number"}),e.jsx("p",{className:"font-mono font-medium",children:i.voucher_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Date"}),e.jsx("p",{children:new Date(i.voucher_date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Customer"}),e.jsx("p",{children:(V=i.customers)==null?void 0:V.company_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Payment Method"}),e.jsx("p",{className:"capitalize",children:i.payment_method.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Bank Account"}),e.jsx("p",{children:((W=i.bank_accounts)==null?void 0:W.alias)||(i.bank_accounts?`${i.bank_accounts.bank_name} - ${i.bank_accounts.account_name}`:"-")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Reference"}),e.jsx("p",{children:i.reference_number||"-"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["Rp ",i.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),i.description&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:i.description})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"Allocations"}),h.length>0?e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Document"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y",children:h.map((t,a)=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 font-mono text-xs",children:t.sales_invoices?t.sales_invoices.invoice_number:(s=t.sales_orders)==null?void 0:s.so_number}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${t.sales_order_id?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:t.sales_order_id?"SO (Advance)":"Invoice"})}),e.jsxs("td",{className:"px-3 py-2 text-right font-medium",children:["Rp ",t.allocated_amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},a)})})]})}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No allocations"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsxs("button",{onClick:de,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Print PDF"]}),e.jsx("button",{onClick:()=>{k(!1),f(null),D([])},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Close"})]})]})}),i&&e.jsxs("div",{ref:N,style:{position:"absolute",left:"-9999px",width:"210mm",padding:"15mm",backgroundColor:"#fff"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px",borderBottom:"2px solid #333",paddingBottom:"15px"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 5px 0",color:"#1a1a1a"},children:ae||"Company Name"}),E&&e.jsx("p",{style:{fontSize:"11px",margin:"0",color:"#666"},children:E}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:"bold",margin:"15px 0 0 0",color:"#2563eb"},children:"RECEIPT VOUCHER"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",color:"#666",margin:"0 0 3px 0"},children:"Voucher No:"}),e.jsx("p",{style:{fontSize:"14px",fontWeight:"bold",margin:"0",fontFamily:"monospace"},children:i.voucher_number})]}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",color:"#666",margin:"0 0 3px 0"},children:"Date:"}),e.jsx("p",{style:{fontSize:"14px",fontWeight:"bold",margin:"0"},children:new Date(i.voucher_date).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})})]})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"12px",backgroundColor:"#f3f4f6",borderRadius:"6px"},children:[e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",color:"#666",margin:"0 0 5px 0"},children:"Received From:"}),e.jsx("p",{style:{fontSize:"15px",fontWeight:"bold",margin:"0",color:"#1a1a1a"},children:(L=i.customers)==null?void 0:L.company_name})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"15px",backgroundColor:"#dbeafe",borderRadius:"8px",border:"2px solid #2563eb"},children:[e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",color:"#1e40af",margin:"0 0 5px 0"},children:"Amount Received:"}),e.jsxs("p",{style:{fontSize:"24px",fontWeight:"bold",margin:"0",color:"#1e40af"},children:["Rp ",i.amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("table",{style:{width:"100%",fontSize:"12px",borderCollapse:"collapse"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px 0",fontWeight:"600",color:"#666",width:"35%"},children:"Payment Method:"}),e.jsx("td",{style:{padding:"8px 0",textTransform:"capitalize"},children:i.payment_method.replace("_"," ")})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px 0",fontWeight:"600",color:"#666"},children:"Bank Account:"}),e.jsx("td",{style:{padding:"8px 0"},children:((P=i.bank_accounts)==null?void 0:P.alias)||(i.bank_accounts?`${i.bank_accounts.bank_name} - ${i.bank_accounts.account_name}`:"-")})]}),i.reference_number&&e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px 0",fontWeight:"600",color:"#666"},children:"Reference:"}),e.jsx("td",{style:{padding:"8px 0",fontFamily:"monospace"},children:i.reference_number})]})]})})}),h.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("p",{style:{fontSize:"13px",fontWeight:"bold",margin:"0 0 10px 0",color:"#1a1a1a"},children:"Allocation Details:"}),e.jsxs("table",{style:{width:"100%",fontSize:"11px",borderCollapse:"collapse",border:"1px solid #d1d5db"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f3f4f6"},children:[e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #d1d5db"},children:"Document"}),e.jsx("th",{style:{padding:"8px",textAlign:"center",borderBottom:"1px solid #d1d5db"},children:"Type"}),e.jsx("th",{style:{padding:"8px",textAlign:"right",borderBottom:"1px solid #d1d5db"},children:"Amount"})]})}),e.jsx("tbody",{children:h.map((t,a)=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px",borderBottom:a<h.length-1?"1px solid #e5e7eb":"none",fontFamily:"monospace"},children:t.sales_invoices?t.sales_invoices.invoice_number:(s=t.sales_orders)==null?void 0:s.so_number}),e.jsx("td",{style:{padding:"8px",textAlign:"center",borderBottom:a<h.length-1?"1px solid #e5e7eb":"none"},children:t.sales_order_id?"SO (Advance)":"Invoice"}),e.jsxs("td",{style:{padding:"8px",textAlign:"right",borderBottom:a<h.length-1?"1px solid #e5e7eb":"none",fontWeight:"600"},children:["Rp ",t.allocated_amount.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},a)})})]})]}),i.description&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",color:"#666",margin:"0 0 5px 0"},children:"Description:"}),e.jsx("p",{style:{fontSize:"12px",margin:"0",color:"#1a1a1a"},children:i.description})]}),e.jsxs("div",{style:{marginTop:"40px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"40px"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{height:"60px"}}),e.jsx("div",{style:{borderTop:"1px solid #333",paddingTop:"5px"},children:e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",margin:"0"},children:"Received By"})})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{height:"60px"}}),e.jsx("div",{style:{borderTop:"1px solid #333",paddingTop:"5px"},children:e.jsx("p",{style:{fontSize:"11px",fontWeight:"600",margin:"0"},children:"Approved By"})})]})]}),e.jsx("div",{style:{marginTop:"30px",textAlign:"center",paddingTop:"15px",borderTop:"1px solid #e5e7eb"},children:e.jsx("p",{style:{fontSize:"10px",color:"#999",margin:"0"},children:"This is a computer-generated document. No signature required."})})]})]})}export{Le as ReceiptVoucherManager};
