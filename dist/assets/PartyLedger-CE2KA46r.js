import{m as H,r as g,s as f,j as e}from"./index-05MON0zc.js";import{h as $,E as U}from"./html2canvas.esm-2-KN9102.js";import{U as q}from"./Layout-9pjiZa2A.js";import{B as G}from"./building-2-DBQXKMe1.js";import{R as J}from"./refresh-cw-COiX6GIZ.js";import{D as K}from"./download-DgYIVgez.js";import{M as Y}from"./mail-cPtJJUOl.js";import"./dateFormat-E6B5rKFz.js";function ae(){const{dateRange:o}=H(),w=g.useRef(null),[p,k]=g.useState("customer"),[b,E]=g.useState([]),[r,S]=g.useState(""),[x,C]=g.useState([]),[_,A]=g.useState(!1),[m,I]=g.useState(0),[B,P]=g.useState(!1);g.useEffect(()=>{L()},[p]),g.useEffect(()=>{r?T():(C([]),I(0))},[r,o.startDate,o.endDate]);const L=async()=>{const t=p==="customer"?"customers":"suppliers",{data:n}=await f.from(t).select("id, company_name, email, phone, address, city, npwp").order("company_name");n&&E(n.map(i=>({...i,name:i.company_name,type:p}))),S("")},T=async()=>{if(r){A(!0);try{const t=[];if(p==="customer"){const{data:i}=await f.from("sales_invoices").select("id, invoice_date, invoice_number, total_amount, payment_status").eq("customer_id",r).gte("invoice_date",o.startDate).lte("invoice_date",o.endDate).order("invoice_date");i&&i.forEach(a=>{t.push({id:a.id,entry_date:a.invoice_date,particulars:`Sales Invoice - ${a.payment_status||"Unpaid"}`,reference:a.invoice_number,debit:a.total_amount,credit:0,running_balance:0,type:"invoice"})});const{data:c}=await f.from("receipt_vouchers").select("id, voucher_date, voucher_number, amount, description").eq("customer_id",r).gte("voucher_date",o.startDate).lte("voucher_date",o.endDate).order("voucher_date");c&&c.forEach(a=>{t.push({id:a.id,entry_date:a.voucher_date,particulars:a.description||"Receipt",reference:a.voucher_number,debit:0,credit:a.amount,running_balance:0,type:"receipt"})});const{data:s}=await f.from("credit_notes").select("id, credit_note_date, credit_note_number, total_amount").eq("customer_id",r).gte("credit_note_date",o.startDate).lte("credit_note_date",o.endDate).eq("status","approved").order("credit_note_date");s&&s.forEach(a=>{t.push({id:a.id,entry_date:a.credit_note_date,particulars:"Credit Note",reference:a.credit_note_number,debit:0,credit:a.total_amount,running_balance:0,type:"receipt"})})}else{const{data:i}=await f.from("purchase_invoices").select("id, invoice_date, invoice_number, total_amount, payment_status").eq("supplier_id",r).gte("invoice_date",o.startDate).lte("invoice_date",o.endDate).order("invoice_date");i&&i.forEach(s=>{t.push({id:s.id,entry_date:s.invoice_date,particulars:`Purchase Invoice - ${s.payment_status||"Unpaid"}`,reference:s.invoice_number,debit:0,credit:s.total_amount,running_balance:0,type:"invoice"})});const{data:c}=await f.from("payment_vouchers").select("id, voucher_date, voucher_number, amount, description").eq("supplier_id",r).gte("voucher_date",o.startDate).lte("voucher_date",o.endDate).order("voucher_date");c&&c.forEach(s=>{t.push({id:s.id,entry_date:s.voucher_date,particulars:s.description||"Payment",reference:s.voucher_number,debit:s.amount,credit:0,running_balance:0,type:"payment"})})}t.sort((i,c)=>new Date(i.entry_date).getTime()-new Date(c.entry_date).getTime());let n=m;t.forEach(i=>{n+=i.debit-i.credit,i.running_balance=n}),C(t)}catch(t){console.error("Error loading ledger:",t),alert("Failed to load ledger data. Please check console for details.")}finally{A(!1)}}},d=t=>t===0?"-":`Rp ${t.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}`,h=t=>{const n=Math.abs(t),i=t>=0?"Dr":"Cr";return`${d(n)} ${i}`},u=x.reduce((t,n)=>t+n.debit,0),y=x.reduce((t,n)=>t+n.credit,0),N=m+u-y,R=Math.abs(N),W=async()=>{if(w.current)try{const t=await $(w.current,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff"}),n=t.toDataURL("image/png",1),i=new U("p","mm","a4"),c=i.internal.pageSize.getWidth(),s=i.internal.pageSize.getHeight(),a=t.width,O=t.height,M=c/a,j=O*M;if(j>s){let v=0,z=j;for(;z>0;)i.addImage(n,"PNG",0,v,c,j),z-=s,v-=s,z>0&&i.addPage()}else i.addImage(n,"PNG",0,0,c,j);const D=b.find(v=>v.id===r);i.save(`${p}_Ledger_${D==null?void 0:D.name.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`)}catch(t){console.error("Error generating PDF:",t),alert("Failed to generate PDF. Please try again.")}},F=async()=>{const t=b.find(n=>n.id===r);if(!t||!t.email){alert("No email address found for this party");return}confirm(`Send Statement of Account to ${t.email}?`)&&(P(!0),await W(),alert(`PDF downloaded. Please attach and send to ${t.email}`),P(!1))},l=b.find(t=>t.id===r);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p==="customer"?e.jsx(q,{className:"w-5 h-5 text-blue-600"}):e.jsx(G,{className:"w-5 h-5 text-purple-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:[p==="customer"?"Customer":"Supplier"," Ledger"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:T,disabled:!r||_,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:`w-4 h-4 ${_?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:W,disabled:!r||x.length===0,className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"w-4 h-4"}),"Export PDF"]}),e.jsxs("button",{onClick:F,disabled:!r||x.length===0||B,className:"flex items-center gap-2 px-3 py-1.5 bg-purple-600 text-white rounded hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Y,{className:"w-4 h-4"}),B?"Sending...":"Email SOA"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Party Type"}),e.jsxs("select",{value:p,onChange:t=>{k(t.target.value),S("")},className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"customer",children:"Customer (Debtor)"}),e.jsx("option",{value:"supplier",children:"Supplier (Creditor)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Select ",p==="customer"?"Customer":"Supplier"]}),e.jsxs("select",{value:r,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"Select Party"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-xs text-gray-500 mt-6",children:"Period is controlled by global date range at top"})})]}),l&&x.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase",children:"Opening Balance"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:h(m)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase",children:"Total Debit"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:d(u)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase",children:"Total Credit"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:d(y)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase",children:"Outstanding"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:d(R)})]})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Particulars"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Ref No"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Debit (Dr)"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Credit (Cr)"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Balance"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",colSpan:3,children:"Opening Balance"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right",children:"-"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right",children:"-"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right font-bold",children:h(m)})]}),_?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-8 text-center text-gray-500",children:"Loading entries..."})}):x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-3 py-8 text-center text-gray-500",children:"No transactions found for this period"})}):x.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:new Date(t.entry_date).toLocaleDateString("id-ID")}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-900",children:t.particulars}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-600 font-mono",children:t.reference}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-red-600 text-right font-medium",children:t.debit>0?d(t.debit):"-"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-green-600 text-right font-medium",children:t.credit>0?d(t.credit):"-"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right font-semibold",children:h(t.running_balance)})]},t.id)),x.length>0&&e.jsxs("tr",{className:"bg-gray-100 font-semibold border-t-2 border-gray-300",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",colSpan:3,children:"Closing Balance"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-red-600 text-right font-bold",children:d(u)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-green-600 text-right font-bold",children:d(y)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right font-bold",children:h(N)})]})]})]})})}),l&&x.length>0&&e.jsx("div",{style:{position:"absolute",left:"-9999px",top:0},children:e.jsxs("div",{ref:w,style:{width:"210mm",padding:"20mm",backgroundColor:"#ffffff"},children:[e.jsx("div",{style:{marginBottom:"15px",borderWidth:"2px",borderColor:"#000",borderStyle:"solid",padding:"15px"},children:e.jsx("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"15px"},children:[e.jsx("div",{style:{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#fff"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",width:"100%",height:"100%",viewBox:"0 0 15686.55 15480.24",children:e.jsxs("g",{children:[e.jsx("path",{fill:"#FDB763",d:"M69.94 10438.12l10353.39 0 0 -1798.67 1665.92 0 0 1868.6 0 320.44 0 4552.28c0,38.48 -31.45,69.94 -69.94,69.94l-11949.38 0c-38.48,0 -69.94,-31.45 -69.94,-69.94l0 -4872.72c0,-38.48 31.45,-69.94 69.94,-69.94zm1605.9 1710.15l8737.57 0c13.58,0 24.68,11.11 24.68,24.68l0 1719.84c0,13.58 -11.11,24.68 -24.68,24.68l-8737.57 0c-13.58,0 -24.68,-11.11 -24.68,-24.68l0 -1719.84c0,-13.58 11.11,-24.68 24.68,-24.68z"}),e.jsx("path",{fill:"#FDB763",d:"M15587.15 5136.67l-10353.49 0 0 1822.07 -1665.92 0 0 -1892.9 0 -324.61 0 -4611.43c0,-39 31.45,-70.87 69.94,-70.87l11949.47 0c38.48,0 69.94,31.87 69.94,70.87l0 4936.04c0,39 -31.45,70.83 -69.94,70.83zm-1605.9 -1732.36l-8737.67 0c-13.58,0 -24.68,-11.27 -24.68,-25l0 -1742.21c0,-13.74 11.11,-25 24.68,-25l8737.67 0c13.58,0 24.68,11.27 24.68,25l0 1742.21c0,13.74 -11.11,25 -24.68,25z"}),e.jsx("polygon",{fill:"#FD6D26",points:"-0,0 1651.16,0 1651.16,6929.27 15657.09,6929.27 15657.09,6958.74 15686.55,6958.74 15686.55,15480.24 14022.85,15480.24 14022.85,8639.45 1651.16,8639.45 -0,8639.45 -0,6929.27"})]})})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"5px"},children:"PT. SHUBHAM ANZEN PHARMA JAYA"}),e.jsx("p",{style:{fontSize:"11px",margin:"2px 0"},children:"Komplek Ruko Metro Sunter Blok A1 NO.15, Jl. Metro Indah Raya,"}),e.jsx("p",{style:{fontSize:"11px",margin:"2px 0"},children:"Kelurahan Papanggo, Kec. Tanjung Priok, Jakarta Utara - 14340"}),e.jsx("p",{style:{fontSize:"11px",margin:"2px 0"},children:"Telp: (+62 21) 65832426"}),e.jsx("p",{style:{fontSize:"11px",margin:"2px 0"},children:"NPWP: 03.174.071.8-093.000"})]})]})})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"5px"},children:"STATEMENT OF ACCOUNT"}),e.jsxs("p",{style:{fontSize:"12px",color:"#666"},children:["Period: ",new Date(o.startDate).toLocaleDateString("id-ID")," to ",new Date(o.endDate).toLocaleDateString("id-ID")]})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"12px",backgroundColor:"#f3f4f6",borderRadius:"8px"},children:[e.jsxs("p",{style:{fontSize:"13px",fontWeight:"bold",marginBottom:"5px"},children:[p==="customer"?"Customer:":"Supplier:"," ",l.name]}),l.address&&e.jsx("p",{style:{fontSize:"11px",margin:"2px 0"},children:l.address}),l.city&&e.jsx("p",{style:{fontSize:"11px",margin:"2px 0"},children:l.city}),l.phone&&e.jsxs("p",{style:{fontSize:"11px",margin:"2px 0"},children:["Phone: ",l.phone]}),l.npwp&&e.jsxs("p",{style:{fontSize:"11px",margin:"2px 0"},children:["NPWP: ",l.npwp]})]}),e.jsxs("div",{style:{marginBottom:"15px",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"10px"},children:[e.jsxs("div",{style:{padding:"10px",backgroundColor:"#eff6ff",borderRadius:"6px"},children:[e.jsx("p",{style:{fontSize:"10px",fontWeight:"600",color:"#666",marginBottom:"3px"},children:"OPENING BALANCE"}),e.jsx("p",{style:{fontSize:"13px",fontWeight:"bold"},children:h(m)})]}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#fef2f2",borderRadius:"6px"},children:[e.jsx("p",{style:{fontSize:"10px",fontWeight:"600",color:"#666",marginBottom:"3px"},children:"TOTAL DEBIT"}),e.jsx("p",{style:{fontSize:"13px",fontWeight:"bold",color:"#dc2626"},children:d(u)})]}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#f0fdf4",borderRadius:"6px"},children:[e.jsx("p",{style:{fontSize:"10px",fontWeight:"600",color:"#666",marginBottom:"3px"},children:"TOTAL CREDIT"}),e.jsx("p",{style:{fontSize:"13px",fontWeight:"bold",color:"#16a34a"},children:d(y)})]}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#fff7ed",borderRadius:"6px"},children:[e.jsx("p",{style:{fontSize:"10px",fontWeight:"600",color:"#666",marginBottom:"3px"},children:"OUTSTANDING"}),e.jsx("p",{style:{fontSize:"13px",fontWeight:"bold",color:"#ea580c"},children:d(R)})]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"20px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f9fafb",borderBottom:"2px solid #000"},children:[e.jsx("th",{style:{padding:"8px",textAlign:"left",fontSize:"10px",fontWeight:"600",borderRight:"1px solid #e5e7eb"},children:"Date"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",fontSize:"10px",fontWeight:"600",borderRight:"1px solid #e5e7eb"},children:"Particulars"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",fontSize:"10px",fontWeight:"600",borderRight:"1px solid #e5e7eb"},children:"Ref No"}),e.jsx("th",{style:{padding:"8px",textAlign:"right",fontSize:"10px",fontWeight:"600",borderRight:"1px solid #e5e7eb"},children:"Debit (Dr)"}),e.jsx("th",{style:{padding:"8px",textAlign:"right",fontSize:"10px",fontWeight:"600",borderRight:"1px solid #e5e7eb"},children:"Credit (Cr)"}),e.jsx("th",{style:{padding:"8px",textAlign:"right",fontSize:"10px",fontWeight:"600"},children:"Balance"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{backgroundColor:"#eff6ff",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{colSpan:3,style:{padding:"6px 8px",fontSize:"11px",fontWeight:"600"},children:"Opening Balance"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"11px"},children:"-"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"11px"},children:"-"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"11px",fontWeight:"bold"},children:h(m)})]}),x.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"6px 8px",fontSize:"10px"},children:new Date(t.entry_date).toLocaleDateString("id-ID")}),e.jsx("td",{style:{padding:"6px 8px",fontSize:"10px"},children:t.particulars}),e.jsx("td",{style:{padding:"6px 8px",fontSize:"10px",fontFamily:"monospace"},children:t.reference}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"10px",color:t.debit>0?"#dc2626":"#000"},children:t.debit>0?d(t.debit):"-"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"10px",color:t.credit>0?"#16a34a":"#000"},children:t.credit>0?d(t.credit):"-"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"10px",fontWeight:"600"},children:h(t.running_balance)})]},t.id)),e.jsxs("tr",{style:{backgroundColor:"#f3f4f6",borderTop:"2px solid #000",borderBottom:"2px solid #000"},children:[e.jsx("td",{colSpan:3,style:{padding:"8px",fontSize:"11px",fontWeight:"bold"},children:"Closing Balance"}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontSize:"11px",fontWeight:"bold",color:"#dc2626"},children:d(u)}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontSize:"11px",fontWeight:"bold",color:"#16a34a"},children:d(y)}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontSize:"11px",fontWeight:"bold"},children:h(N)})]})]})]}),e.jsxs("div",{style:{marginTop:"30px",padding:"12px",backgroundColor:"#f9fafb",borderRadius:"8px"},children:[e.jsxs("p",{style:{fontSize:"11px",color:"#666",marginBottom:"8px"},children:[e.jsx("strong",{children:"Note:"})," This is a computer-generated statement of account."]}),e.jsx("p",{style:{fontSize:"11px",color:"#666"},children:"Please review the above transactions and confirm. If you have any questions or discrepancies, please contact us immediately."})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center",borderTop:"1px solid #e5e7eb",paddingTop:"10px"},children:[e.jsxs("p",{style:{fontSize:"10px",color:"#999"},children:["Generated on ",new Date().toLocaleString("id-ID")]}),e.jsx("p",{style:{fontSize:"10px",color:"#999"},children:"PT. SHUBHAM ANZEN PHARMA JAYA"})]})]})})]})]})}export{ae as default};
