import{c as Ae,k as Le,g as Dn,r as Z,b as Rn,s as fe,j as e,X as He,T as Bt,a as In,A as Ge,F as Qe,i as Ve,u as gt,C as tt,l as qn,f as xe,h as rr,d as on}from"./index-Bqpro8KL.js";import{U as rt,C as Ke,T as Mn,b as wr,P as Bn,D as Fn,M as $n,G as Un,L as zn}from"./Layout-BToEj-kL.js";import{M as Te,P as Ft}from"./Modal-BJLUH_oV.js";import{S as Xe}from"./send-D9f3kKKL.js";import{M as nr,P as yt,C as Hn,T as Kn,F as Gn,A as Nr}from"./TaskFormModal-D7kWACKU.js";import{L as st}from"./loader-DedE0Rkj.js";import{E as Vn,L as Wn,C as Yn}from"./CompactInquiryForm-BzCuPY_C.js";import{M as Ze}from"./mail-DIUGsPAJ.js";import{R as Zn}from"./refresh-cw-g3Wrktxg.js";import{S as ur}from"./search-DVwgCoyq.js";import{C as dr}from"./chevron-right-Bjt9Hp4f.js";import{u as qe,w as ar,r as Qn,P as Xn,B as Jn}from"./xlsx-BKqCObK9.js";import{f as $t}from"./dateFormat-E6B5rKFz.js";import{S as ea}from"./sparkles-Bn5OGA23.js";import{C as it}from"./chevron-down-D3Q6seEY.js";import{X as Je}from"./x-circle-K7VLDYoM.js";import{D as Lt}from"./download-Pvi4C3Ra.js";import{P as vt}from"./phone-BpTcxkBq.js";import{C as ta}from"./check-B-KgjlX4.js";import{U as ra}from"./upload-BtYYMBu6.js";import{S as na}from"./SearchableSelect-BogjG1Fk.js";import{E as aa}from"./eye-BAIwIpS3.js";import{R as jr}from"./rotate-ccw-8pX9fvWE.js";import{i as ia}from"./indonesiaCities-DOiA6JTu.js";import{U as sa}from"./user-C20dTtR4.js";import{A as oa}from"./arrow-right-BRT0kyw0.js";import"./purify.es-B6FQ9oRL.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=Ae("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=Ae("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=Ae("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=Ae("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=Ae("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=Ae("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=Ae("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=Ae("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=Ae("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=Ae("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=Ae("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=Ae("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Ae("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Ae("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=Ae("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=Ae("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=Ae("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=Ae("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=Ae("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=Ae("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);function va(){this.__data__=[],this.size=0}var xa=va;function ba(b,A){return b===A||b!==b&&A!==A}var dn=ba,_a=dn;function wa(b,A){for(var v=b.length;v--;)if(_a(b[v][0],A))return v;return-1}var Ut=wa,Na=Ut,ja=Array.prototype,Sa=ja.splice;function Ea(b){var A=this.__data__,v=Na(A,b);if(v<0)return!1;var c=A.length-1;return v==c?A.pop():Sa.call(A,v,1),--this.size,!0}var Oa=Ea,ka=Ut;function Aa(b){var A=this.__data__,v=ka(A,b);return v<0?void 0:A[v][1]}var Ca=Aa,Ta=Ut;function Pa(b){return Ta(this.__data__,b)>-1}var La=Pa,Da=Ut;function Ra(b,A){var v=this.__data__,c=Da(v,b);return c<0?(++this.size,v.push([b,A])):v[c][1]=A,this}var Ia=Ra,qa=xa,Ma=Oa,Ba=Ca,Fa=La,$a=Ia;function ot(b){var A=-1,v=b==null?0:b.length;for(this.clear();++A<v;){var c=b[A];this.set(c[0],c[1])}}ot.prototype.clear=qa;ot.prototype.delete=Ma;ot.prototype.get=Ba;ot.prototype.has=Fa;ot.prototype.set=$a;var zt=ot,Ua=zt;function za(){this.__data__=new Ua,this.size=0}var Ha=za;function Ka(b){var A=this.__data__,v=A.delete(b);return this.size=A.size,v}var Ga=Ka;function Va(b){return this.__data__.get(b)}var Wa=Va;function Ya(b){return this.__data__.has(b)}var Za=Ya,Qa=typeof Le=="object"&&Le&&Le.Object===Object&&Le,fn=Qa,Xa=fn,Ja=typeof self=="object"&&self&&self.Object===Object&&self,ei=Xa||Ja||Function("return this")(),We=ei,ti=We,ri=ti.Symbol,fr=ri,Cr=fr,hn=Object.prototype,ni=hn.hasOwnProperty,ai=hn.toString,mt=Cr?Cr.toStringTag:void 0;function ii(b){var A=ni.call(b,mt),v=b[mt];try{b[mt]=void 0;var c=!0}catch{}var h=ai.call(b);return c&&(A?b[mt]=v:delete b[mt]),h}var si=ii,oi=Object.prototype,li=oi.toString;function ci(b){return li.call(b)}var ui=ci,Tr=fr,di=si,fi=ui,hi="[object Null]",mi="[object Undefined]",Pr=Tr?Tr.toStringTag:void 0;function pi(b){return b==null?b===void 0?mi:hi:Pr&&Pr in Object(b)?di(b):fi(b)}var Ht=pi;function yi(b){var A=typeof b;return b!=null&&(A=="object"||A=="function")}var mn=yi,gi=Ht,vi=mn,xi="[object AsyncFunction]",bi="[object Function]",_i="[object GeneratorFunction]",wi="[object Proxy]";function Ni(b){if(!vi(b))return!1;var A=gi(b);return A==bi||A==_i||A==xi||A==wi}var pn=Ni,ji=We,Si=ji["__core-js_shared__"],Ei=Si,Xt=Ei,Lr=function(){var b=/[^.]+$/.exec(Xt&&Xt.keys&&Xt.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}();function Oi(b){return!!Lr&&Lr in b}var ki=Oi,Ai=Function.prototype,Ci=Ai.toString;function Ti(b){if(b!=null){try{return Ci.call(b)}catch{}try{return b+""}catch{}}return""}var yn=Ti,Pi=pn,Li=ki,Di=mn,Ri=yn,Ii=/[\\^$.*+?()[\]{}|]/g,qi=/^\[object .+?Constructor\]$/,Mi=Function.prototype,Bi=Object.prototype,Fi=Mi.toString,$i=Bi.hasOwnProperty,Ui=RegExp("^"+Fi.call($i).replace(Ii,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function zi(b){if(!Di(b)||Li(b))return!1;var A=Pi(b)?Ui:qi;return A.test(Ri(b))}var Hi=zi;function Ki(b,A){return b==null?void 0:b[A]}var Gi=Ki,Vi=Hi,Wi=Gi;function Yi(b,A){var v=Wi(b,A);return Vi(v)?v:void 0}var lt=Yi,Zi=lt,Qi=We,Xi=Zi(Qi,"Map"),hr=Xi,Ji=lt,es=Ji(Object,"create"),Kt=es,Dr=Kt;function ts(){this.__data__=Dr?Dr(null):{},this.size=0}var rs=ts;function ns(b){var A=this.has(b)&&delete this.__data__[b];return this.size-=A?1:0,A}var as=ns,is=Kt,ss="__lodash_hash_undefined__",os=Object.prototype,ls=os.hasOwnProperty;function cs(b){var A=this.__data__;if(is){var v=A[b];return v===ss?void 0:v}return ls.call(A,b)?A[b]:void 0}var us=cs,ds=Kt,fs=Object.prototype,hs=fs.hasOwnProperty;function ms(b){var A=this.__data__;return ds?A[b]!==void 0:hs.call(A,b)}var ps=ms,ys=Kt,gs="__lodash_hash_undefined__";function vs(b,A){var v=this.__data__;return this.size+=this.has(b)?0:1,v[b]=ys&&A===void 0?gs:A,this}var xs=vs,bs=rs,_s=as,ws=us,Ns=ps,js=xs;function ct(b){var A=-1,v=b==null?0:b.length;for(this.clear();++A<v;){var c=b[A];this.set(c[0],c[1])}}ct.prototype.clear=bs;ct.prototype.delete=_s;ct.prototype.get=ws;ct.prototype.has=Ns;ct.prototype.set=js;var Ss=ct,Rr=Ss,Es=zt,Os=hr;function ks(){this.size=0,this.__data__={hash:new Rr,map:new(Os||Es),string:new Rr}}var As=ks;function Cs(b){var A=typeof b;return A=="string"||A=="number"||A=="symbol"||A=="boolean"?b!=="__proto__":b===null}var Ts=Cs,Ps=Ts;function Ls(b,A){var v=b.__data__;return Ps(A)?v[typeof A=="string"?"string":"hash"]:v.map}var Gt=Ls,Ds=Gt;function Rs(b){var A=Ds(this,b).delete(b);return this.size-=A?1:0,A}var Is=Rs,qs=Gt;function Ms(b){return qs(this,b).get(b)}var Bs=Ms,Fs=Gt;function $s(b){return Fs(this,b).has(b)}var Us=$s,zs=Gt;function Hs(b,A){var v=zs(this,b),c=v.size;return v.set(b,A),this.size+=v.size==c?0:1,this}var Ks=Hs,Gs=As,Vs=Is,Ws=Bs,Ys=Us,Zs=Ks;function ut(b){var A=-1,v=b==null?0:b.length;for(this.clear();++A<v;){var c=b[A];this.set(c[0],c[1])}}ut.prototype.clear=Gs;ut.prototype.delete=Vs;ut.prototype.get=Ws;ut.prototype.has=Ys;ut.prototype.set=Zs;var gn=ut,Qs=zt,Xs=hr,Js=gn,eo=200;function to(b,A){var v=this.__data__;if(v instanceof Qs){var c=v.__data__;if(!Xs||c.length<eo-1)return c.push([b,A]),this.size=++v.size,this;v=this.__data__=new Js(c)}return v.set(b,A),this.size=v.size,this}var ro=to,no=zt,ao=Ha,io=Ga,so=Wa,oo=Za,lo=ro;function dt(b){var A=this.__data__=new no(b);this.size=A.size}dt.prototype.clear=ao;dt.prototype.delete=io;dt.prototype.get=so;dt.prototype.has=oo;dt.prototype.set=lo;var co=dt,uo="__lodash_hash_undefined__";function fo(b){return this.__data__.set(b,uo),this}var ho=fo;function mo(b){return this.__data__.has(b)}var po=mo,yo=gn,go=ho,vo=po;function Dt(b){var A=-1,v=b==null?0:b.length;for(this.__data__=new yo;++A<v;)this.add(b[A])}Dt.prototype.add=Dt.prototype.push=go;Dt.prototype.has=vo;var xo=Dt;function bo(b,A){for(var v=-1,c=b==null?0:b.length;++v<c;)if(A(b[v],v,b))return!0;return!1}var _o=bo;function wo(b,A){return b.has(A)}var No=wo,jo=xo,So=_o,Eo=No,Oo=1,ko=2;function Ao(b,A,v,c,h,x){var N=v&Oo,w=b.length,g=A.length;if(w!=g&&!(N&&g>w))return!1;var f=x.get(b),p=x.get(A);if(f&&p)return f==A&&p==b;var i=-1,t=!0,r=v&ko?new jo:void 0;for(x.set(b,A),x.set(A,b);++i<w;){var d=b[i],s=A[i];if(c)var l=N?c(s,d,i,A,b,x):c(d,s,i,b,A,x);if(l!==void 0){if(l)continue;t=!1;break}if(r){if(!So(A,function(o,n){if(!Eo(r,n)&&(d===o||h(d,o,v,c,x)))return r.push(n)})){t=!1;break}}else if(!(d===s||h(d,s,v,c,x))){t=!1;break}}return x.delete(b),x.delete(A),t}var vn=Ao,Co=We,To=Co.Uint8Array,Po=To;function Lo(b){var A=-1,v=Array(b.size);return b.forEach(function(c,h){v[++A]=[h,c]}),v}var Do=Lo;function Ro(b){var A=-1,v=Array(b.size);return b.forEach(function(c){v[++A]=c}),v}var Io=Ro,Ir=fr,qr=Po,qo=dn,Mo=vn,Bo=Do,Fo=Io,$o=1,Uo=2,zo="[object Boolean]",Ho="[object Date]",Ko="[object Error]",Go="[object Map]",Vo="[object Number]",Wo="[object RegExp]",Yo="[object Set]",Zo="[object String]",Qo="[object Symbol]",Xo="[object ArrayBuffer]",Jo="[object DataView]",Mr=Ir?Ir.prototype:void 0,Jt=Mr?Mr.valueOf:void 0;function el(b,A,v,c,h,x,N){switch(v){case Jo:if(b.byteLength!=A.byteLength||b.byteOffset!=A.byteOffset)return!1;b=b.buffer,A=A.buffer;case Xo:return!(b.byteLength!=A.byteLength||!x(new qr(b),new qr(A)));case zo:case Ho:case Vo:return qo(+b,+A);case Ko:return b.name==A.name&&b.message==A.message;case Wo:case Zo:return b==A+"";case Go:var w=Bo;case Yo:var g=c&$o;if(w||(w=Fo),b.size!=A.size&&!g)return!1;var f=N.get(b);if(f)return f==A;c|=Uo,N.set(b,A);var p=Mo(w(b),w(A),c,h,x,N);return N.delete(b),p;case Qo:if(Jt)return Jt.call(b)==Jt.call(A)}return!1}var tl=el;function rl(b,A){for(var v=-1,c=A.length,h=b.length;++v<c;)b[h+v]=A[v];return b}var nl=rl,al=Array.isArray,mr=al,il=nl,sl=mr;function ol(b,A,v){var c=A(b);return sl(b)?c:il(c,v(b))}var ll=ol;function cl(b,A){for(var v=-1,c=b==null?0:b.length,h=0,x=[];++v<c;){var N=b[v];A(N,v,b)&&(x[h++]=N)}return x}var ul=cl;function dl(){return[]}var fl=dl,hl=ul,ml=fl,pl=Object.prototype,yl=pl.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,gl=Br?function(b){return b==null?[]:(b=Object(b),hl(Br(b),function(A){return yl.call(b,A)}))}:ml,vl=gl;function xl(b,A){for(var v=-1,c=Array(b);++v<b;)c[v]=A(v);return c}var bl=xl;function _l(b){return b!=null&&typeof b=="object"}var Vt=_l,wl=Ht,Nl=Vt,jl="[object Arguments]";function Sl(b){return Nl(b)&&wl(b)==jl}var El=Sl,Fr=El,Ol=Vt,xn=Object.prototype,kl=xn.hasOwnProperty,Al=xn.propertyIsEnumerable,Cl=Fr(function(){return arguments}())?Fr:function(b){return Ol(b)&&kl.call(b,"callee")&&!Al.call(b,"callee")},Tl=Cl,Rt={exports:{}};function Pl(){return!1}var Ll=Pl;Rt.exports;(function(b,A){var v=We,c=Ll,h=A&&!A.nodeType&&A,x=h&&!0&&b&&!b.nodeType&&b,N=x&&x.exports===h,w=N?v.Buffer:void 0,g=w?w.isBuffer:void 0,f=g||c;b.exports=f})(Rt,Rt.exports);var bn=Rt.exports,Dl=9007199254740991,Rl=/^(?:0|[1-9]\d*)$/;function Il(b,A){var v=typeof b;return A=A??Dl,!!A&&(v=="number"||v!="symbol"&&Rl.test(b))&&b>-1&&b%1==0&&b<A}var ql=Il,Ml=9007199254740991;function Bl(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=Ml}var _n=Bl,Fl=Ht,$l=_n,Ul=Vt,zl="[object Arguments]",Hl="[object Array]",Kl="[object Boolean]",Gl="[object Date]",Vl="[object Error]",Wl="[object Function]",Yl="[object Map]",Zl="[object Number]",Ql="[object Object]",Xl="[object RegExp]",Jl="[object Set]",ec="[object String]",tc="[object WeakMap]",rc="[object ArrayBuffer]",nc="[object DataView]",ac="[object Float32Array]",ic="[object Float64Array]",sc="[object Int8Array]",oc="[object Int16Array]",lc="[object Int32Array]",cc="[object Uint8Array]",uc="[object Uint8ClampedArray]",dc="[object Uint16Array]",fc="[object Uint32Array]",Ee={};Ee[ac]=Ee[ic]=Ee[sc]=Ee[oc]=Ee[lc]=Ee[cc]=Ee[uc]=Ee[dc]=Ee[fc]=!0;Ee[zl]=Ee[Hl]=Ee[rc]=Ee[Kl]=Ee[nc]=Ee[Gl]=Ee[Vl]=Ee[Wl]=Ee[Yl]=Ee[Zl]=Ee[Ql]=Ee[Xl]=Ee[Jl]=Ee[ec]=Ee[tc]=!1;function hc(b){return Ul(b)&&$l(b.length)&&!!Ee[Fl(b)]}var mc=hc;function pc(b){return function(A){return b(A)}}var yc=pc,It={exports:{}};It.exports;(function(b,A){var v=fn,c=A&&!A.nodeType&&A,h=c&&!0&&b&&!b.nodeType&&b,x=h&&h.exports===c,N=x&&v.process,w=function(){try{var g=h&&h.require&&h.require("util").types;return g||N&&N.binding&&N.binding("util")}catch{}}();b.exports=w})(It,It.exports);var gc=It.exports,vc=mc,xc=yc,$r=gc,Ur=$r&&$r.isTypedArray,bc=Ur?xc(Ur):vc,wn=bc,_c=bl,wc=Tl,Nc=mr,jc=bn,Sc=ql,Ec=wn,Oc=Object.prototype,kc=Oc.hasOwnProperty;function Ac(b,A){var v=Nc(b),c=!v&&wc(b),h=!v&&!c&&jc(b),x=!v&&!c&&!h&&Ec(b),N=v||c||h||x,w=N?_c(b.length,String):[],g=w.length;for(var f in b)(A||kc.call(b,f))&&!(N&&(f=="length"||h&&(f=="offset"||f=="parent")||x&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||Sc(f,g)))&&w.push(f);return w}var Cc=Ac,Tc=Object.prototype;function Pc(b){var A=b&&b.constructor,v=typeof A=="function"&&A.prototype||Tc;return b===v}var Lc=Pc;function Dc(b,A){return function(v){return b(A(v))}}var Rc=Dc,Ic=Rc,qc=Ic(Object.keys,Object),Mc=qc,Bc=Lc,Fc=Mc,$c=Object.prototype,Uc=$c.hasOwnProperty;function zc(b){if(!Bc(b))return Fc(b);var A=[];for(var v in Object(b))Uc.call(b,v)&&v!="constructor"&&A.push(v);return A}var Hc=zc,Kc=pn,Gc=_n;function Vc(b){return b!=null&&Gc(b.length)&&!Kc(b)}var Wc=Vc,Yc=Cc,Zc=Hc,Qc=Wc;function Xc(b){return Qc(b)?Yc(b):Zc(b)}var Jc=Xc,eu=ll,tu=vl,ru=Jc;function nu(b){return eu(b,ru,tu)}var au=nu,zr=au,iu=1,su=Object.prototype,ou=su.hasOwnProperty;function lu(b,A,v,c,h,x){var N=v&iu,w=zr(b),g=w.length,f=zr(A),p=f.length;if(g!=p&&!N)return!1;for(var i=g;i--;){var t=w[i];if(!(N?t in A:ou.call(A,t)))return!1}var r=x.get(b),d=x.get(A);if(r&&d)return r==A&&d==b;var s=!0;x.set(b,A),x.set(A,b);for(var l=N;++i<g;){t=w[i];var o=b[t],n=A[t];if(c)var m=N?c(n,o,t,A,b,x):c(o,n,t,b,A,x);if(!(m===void 0?o===n||h(o,n,v,c,x):m)){s=!1;break}l||(l=t=="constructor")}if(s&&!l){var a=b.constructor,u=A.constructor;a!=u&&"constructor"in b&&"constructor"in A&&!(typeof a=="function"&&a instanceof a&&typeof u=="function"&&u instanceof u)&&(s=!1)}return x.delete(b),x.delete(A),s}var cu=lu,uu=lt,du=We,fu=uu(du,"DataView"),hu=fu,mu=lt,pu=We,yu=mu(pu,"Promise"),gu=yu,vu=lt,xu=We,bu=vu(xu,"Set"),_u=bu,wu=lt,Nu=We,ju=wu(Nu,"WeakMap"),Su=ju,ir=hu,sr=hr,or=gu,lr=_u,cr=Su,Nn=Ht,ft=yn,Hr="[object Map]",Eu="[object Object]",Kr="[object Promise]",Gr="[object Set]",Vr="[object WeakMap]",Wr="[object DataView]",Ou=ft(ir),ku=ft(sr),Au=ft(or),Cu=ft(lr),Tu=ft(cr),et=Nn;(ir&&et(new ir(new ArrayBuffer(1)))!=Wr||sr&&et(new sr)!=Hr||or&&et(or.resolve())!=Kr||lr&&et(new lr)!=Gr||cr&&et(new cr)!=Vr)&&(et=function(b){var A=Nn(b),v=A==Eu?b.constructor:void 0,c=v?ft(v):"";if(c)switch(c){case Ou:return Wr;case ku:return Hr;case Au:return Kr;case Cu:return Gr;case Tu:return Vr}return A});var Pu=et,er=co,Lu=vn,Du=tl,Ru=cu,Yr=Pu,Zr=mr,Qr=bn,Iu=wn,qu=1,Xr="[object Arguments]",Jr="[object Array]",Tt="[object Object]",Mu=Object.prototype,en=Mu.hasOwnProperty;function Bu(b,A,v,c,h,x){var N=Zr(b),w=Zr(A),g=N?Jr:Yr(b),f=w?Jr:Yr(A);g=g==Xr?Tt:g,f=f==Xr?Tt:f;var p=g==Tt,i=f==Tt,t=g==f;if(t&&Qr(b)){if(!Qr(A))return!1;N=!0,p=!1}if(t&&!p)return x||(x=new er),N||Iu(b)?Lu(b,A,v,c,h,x):Du(b,A,g,v,c,h,x);if(!(v&qu)){var r=p&&en.call(b,"__wrapped__"),d=i&&en.call(A,"__wrapped__");if(r||d){var s=r?b.value():b,l=d?A.value():A;return x||(x=new er),h(s,l,v,c,x)}}return t?(x||(x=new er),Ru(b,A,v,c,h,x)):!1}var Fu=Bu,$u=Fu,tn=Vt;function jn(b,A,v,c,h){return b===A?!0:b==null||A==null||!tn(b)&&!tn(A)?b!==b&&A!==A:$u(b,A,v,c,jn,h)}var Uu=jn,zu=Uu;function Hu(b,A){return zu(b,A)}var Ku=Hu,Sn={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */(function(b,A){(function(c,h){b.exports=h()})(typeof self<"u"?self:Le,function(){return function(v){var c={};function h(x){if(c[x])return c[x].exports;var N=c[x]={i:x,l:!1,exports:{}};return v[x].call(N.exports,N,N.exports,h),N.l=!0,N.exports}return h.m=v,h.c=c,h.d=function(x,N,w){h.o(x,N)||Object.defineProperty(x,N,{configurable:!1,enumerable:!0,get:w})},h.n=function(x){var N=x&&x.__esModule?function(){return x.default}:function(){return x};return h.d(N,"a",N),N},h.o=function(x,N){return Object.prototype.hasOwnProperty.call(x,N)},h.p="",h(h.s=109)}([function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(17),N=h(18),w=h(19),g=h(45),f=h(46),p=h(47),i=h(48),t=h(49),r=h(12),d=h(32),s=h(33),l=h(31),o=h(1),n={Scope:o.Scope,create:o.create,find:o.find,query:o.query,register:o.register,Container:x.default,Format:N.default,Leaf:w.default,Embed:i.default,Scroll:g.default,Block:p.default,Inline:f.default,Text:t.default,Attributor:{Attribute:r.default,Class:d.default,Style:s.default,Store:l.default}};c.default=n},function(v,c,h){var x=this&&this.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var m in n)n.hasOwnProperty(m)&&(o[m]=n[m])};return function(o,n){l(o,n);function m(){this.constructor=o}o.prototype=n===null?Object.create(n):(m.prototype=n.prototype,new m)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=function(l){x(o,l);function o(n){var m=this;return n="[Parchment] "+n,m=l.call(this,n)||this,m.message=n,m.name=m.constructor.name,m}return o}(Error);c.ParchmentError=N;var w={},g={},f={},p={};c.DATA_KEY="__blot";var i;(function(l){l[l.TYPE=3]="TYPE",l[l.LEVEL=12]="LEVEL",l[l.ATTRIBUTE=13]="ATTRIBUTE",l[l.BLOT=14]="BLOT",l[l.INLINE=7]="INLINE",l[l.BLOCK=11]="BLOCK",l[l.BLOCK_BLOT=10]="BLOCK_BLOT",l[l.INLINE_BLOT=6]="INLINE_BLOT",l[l.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",l[l.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",l[l.ANY=15]="ANY"})(i=c.Scope||(c.Scope={}));function t(l,o){var n=d(l);if(n==null)throw new N("Unable to create "+l+" blot");var m=n,a=l instanceof Node||l.nodeType===Node.TEXT_NODE?l:m.create(o);return new m(a,o)}c.create=t;function r(l,o){return o===void 0&&(o=!1),l==null?null:l[c.DATA_KEY]!=null?l[c.DATA_KEY].blot:o?r(l.parentNode,o):null}c.find=r;function d(l,o){o===void 0&&(o=i.ANY);var n;if(typeof l=="string")n=p[l]||w[l];else if(l instanceof Text||l.nodeType===Node.TEXT_NODE)n=p.text;else if(typeof l=="number")l&i.LEVEL&i.BLOCK?n=p.block:l&i.LEVEL&i.INLINE&&(n=p.inline);else if(l instanceof HTMLElement){var m=(l.getAttribute("class")||"").split(/\s+/);for(var a in m)if(n=g[m[a]],n)break;n=n||f[l.tagName]}return n==null?null:o&i.LEVEL&n.scope&&o&i.TYPE&n.scope?n:null}c.query=d;function s(){for(var l=[],o=0;o<arguments.length;o++)l[o]=arguments[o];if(l.length>1)return l.map(function(a){return s(a)});var n=l[0];if(typeof n.blotName!="string"&&typeof n.attrName!="string")throw new N("Invalid definition");if(n.blotName==="abstract")throw new N("Cannot register abstract class");if(p[n.blotName||n.attrName]=n,typeof n.keyName=="string")w[n.keyName]=n;else if(n.className!=null&&(g[n.className]=n),n.tagName!=null){Array.isArray(n.tagName)?n.tagName=n.tagName.map(function(a){return a.toUpperCase()}):n.tagName=n.tagName.toUpperCase();var m=Array.isArray(n.tagName)?n.tagName:[n.tagName];m.forEach(function(a){(f[a]==null||n.className==null)&&(f[a]=n)})}return n}c.register=s},function(v,c,h){var x=h(51),N=h(11),w=h(3),g=h(20),f="\0",p=function(i){Array.isArray(i)?this.ops=i:i!=null&&Array.isArray(i.ops)?this.ops=i.ops:this.ops=[]};p.prototype.insert=function(i,t){var r={};return i.length===0?this:(r.insert=i,t!=null&&typeof t=="object"&&Object.keys(t).length>0&&(r.attributes=t),this.push(r))},p.prototype.delete=function(i){return i<=0?this:this.push({delete:i})},p.prototype.retain=function(i,t){if(i<=0)return this;var r={retain:i};return t!=null&&typeof t=="object"&&Object.keys(t).length>0&&(r.attributes=t),this.push(r)},p.prototype.push=function(i){var t=this.ops.length,r=this.ops[t-1];if(i=w(!0,{},i),typeof r=="object"){if(typeof i.delete=="number"&&typeof r.delete=="number")return this.ops[t-1]={delete:r.delete+i.delete},this;if(typeof r.delete=="number"&&i.insert!=null&&(t-=1,r=this.ops[t-1],typeof r!="object"))return this.ops.unshift(i),this;if(N(i.attributes,r.attributes)){if(typeof i.insert=="string"&&typeof r.insert=="string")return this.ops[t-1]={insert:r.insert+i.insert},typeof i.attributes=="object"&&(this.ops[t-1].attributes=i.attributes),this;if(typeof i.retain=="number"&&typeof r.retain=="number")return this.ops[t-1]={retain:r.retain+i.retain},typeof i.attributes=="object"&&(this.ops[t-1].attributes=i.attributes),this}}return t===this.ops.length?this.ops.push(i):this.ops.splice(t,0,i),this},p.prototype.chop=function(){var i=this.ops[this.ops.length-1];return i&&i.retain&&!i.attributes&&this.ops.pop(),this},p.prototype.filter=function(i){return this.ops.filter(i)},p.prototype.forEach=function(i){this.ops.forEach(i)},p.prototype.map=function(i){return this.ops.map(i)},p.prototype.partition=function(i){var t=[],r=[];return this.forEach(function(d){var s=i(d)?t:r;s.push(d)}),[t,r]},p.prototype.reduce=function(i,t){return this.ops.reduce(i,t)},p.prototype.changeLength=function(){return this.reduce(function(i,t){return t.insert?i+g.length(t):t.delete?i-t.delete:i},0)},p.prototype.length=function(){return this.reduce(function(i,t){return i+g.length(t)},0)},p.prototype.slice=function(i,t){i=i||0,typeof t!="number"&&(t=1/0);for(var r=[],d=g.iterator(this.ops),s=0;s<t&&d.hasNext();){var l;s<i?l=d.next(i-s):(l=d.next(t-s),r.push(l)),s+=g.length(l)}return new p(r)},p.prototype.compose=function(i){var t=g.iterator(this.ops),r=g.iterator(i.ops),d=[],s=r.peek();if(s!=null&&typeof s.retain=="number"&&s.attributes==null){for(var l=s.retain;t.peekType()==="insert"&&t.peekLength()<=l;)l-=t.peekLength(),d.push(t.next());s.retain-l>0&&r.next(s.retain-l)}for(var o=new p(d);t.hasNext()||r.hasNext();)if(r.peekType()==="insert")o.push(r.next());else if(t.peekType()==="delete")o.push(t.next());else{var n=Math.min(t.peekLength(),r.peekLength()),m=t.next(n),a=r.next(n);if(typeof a.retain=="number"){var u={};typeof m.retain=="number"?u.retain=n:u.insert=m.insert;var j=g.attributes.compose(m.attributes,a.attributes,typeof m.retain=="number");if(j&&(u.attributes=j),o.push(u),!r.hasNext()&&N(o.ops[o.ops.length-1],u)){var E=new p(t.rest());return o.concat(E).chop()}}else typeof a.delete=="number"&&typeof m.retain=="number"&&o.push(a)}return o.chop()},p.prototype.concat=function(i){var t=new p(this.ops.slice());return i.ops.length>0&&(t.push(i.ops[0]),t.ops=t.ops.concat(i.ops.slice(1))),t},p.prototype.diff=function(i,t){if(this.ops===i.ops)return new p;var r=[this,i].map(function(n){return n.map(function(m){if(m.insert!=null)return typeof m.insert=="string"?m.insert:f;var a=n===i?"on":"with";throw new Error("diff() called "+a+" non-document")}).join("")}),d=new p,s=x(r[0],r[1],t),l=g.iterator(this.ops),o=g.iterator(i.ops);return s.forEach(function(n){for(var m=n[1].length;m>0;){var a=0;switch(n[0]){case x.INSERT:a=Math.min(o.peekLength(),m),d.push(o.next(a));break;case x.DELETE:a=Math.min(m,l.peekLength()),l.next(a),d.delete(a);break;case x.EQUAL:a=Math.min(l.peekLength(),o.peekLength(),m);var u=l.next(a),j=o.next(a);N(u.insert,j.insert)?d.retain(a,g.attributes.diff(u.attributes,j.attributes)):d.push(j).delete(a);break}m-=a}}),d.chop()},p.prototype.eachLine=function(i,t){t=t||`
`;for(var r=g.iterator(this.ops),d=new p,s=0;r.hasNext();){if(r.peekType()!=="insert")return;var l=r.peek(),o=g.length(l)-r.peekLength(),n=typeof l.insert=="string"?l.insert.indexOf(t,o)-o:-1;if(n<0)d.push(r.next());else if(n>0)d.push(r.next(n));else{if(i(d,r.next(1).attributes||{},s)===!1)return;s+=1,d=new p}}d.length()>0&&i(d,{},s)},p.prototype.transform=function(i,t){if(t=!!t,typeof i=="number")return this.transformPosition(i,t);for(var r=g.iterator(this.ops),d=g.iterator(i.ops),s=new p;r.hasNext()||d.hasNext();)if(r.peekType()==="insert"&&(t||d.peekType()!=="insert"))s.retain(g.length(r.next()));else if(d.peekType()==="insert")s.push(d.next());else{var l=Math.min(r.peekLength(),d.peekLength()),o=r.next(l),n=d.next(l);if(o.delete)continue;n.delete?s.push(n):s.retain(l,g.attributes.transform(o.attributes,n.attributes,t))}return s.chop()},p.prototype.transformPosition=function(i,t){t=!!t;for(var r=g.iterator(this.ops),d=0;r.hasNext()&&d<=i;){var s=r.peekLength(),l=r.peekType();if(r.next(),l==="delete"){i-=Math.min(s,i-d);continue}else l==="insert"&&(d<i||!t)&&(i+=s);d+=s}return i},v.exports=p},function(v,c){var h=Object.prototype.hasOwnProperty,x=Object.prototype.toString,N=Object.defineProperty,w=Object.getOwnPropertyDescriptor,g=function(r){return typeof Array.isArray=="function"?Array.isArray(r):x.call(r)==="[object Array]"},f=function(r){if(!r||x.call(r)!=="[object Object]")return!1;var d=h.call(r,"constructor"),s=r.constructor&&r.constructor.prototype&&h.call(r.constructor.prototype,"isPrototypeOf");if(r.constructor&&!d&&!s)return!1;var l;for(l in r);return typeof l>"u"||h.call(r,l)},p=function(r,d){N&&d.name==="__proto__"?N(r,d.name,{enumerable:!0,configurable:!0,value:d.newValue,writable:!0}):r[d.name]=d.newValue},i=function(r,d){if(d==="__proto__")if(h.call(r,d)){if(w)return w(r,d).value}else return;return r[d]};v.exports=function t(){var r,d,s,l,o,n,m=arguments[0],a=1,u=arguments.length,j=!1;for(typeof m=="boolean"&&(j=m,m=arguments[1]||{},a=2),(m==null||typeof m!="object"&&typeof m!="function")&&(m={});a<u;++a)if(r=arguments[a],r!=null)for(d in r)s=i(m,d),l=i(r,d),m!==l&&(j&&l&&(f(l)||(o=g(l)))?(o?(o=!1,n=s&&g(s)?s:[]):n=s&&f(s)?s:{},p(m,{name:d,newValue:t(j,n,l)})):typeof l<"u"&&p(m,{name:d,newValue:l}));return m}},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.BlockEmbed=c.bubbleFormats=void 0;var x=function(){function _(y,C){for(var T=0;T<C.length;T++){var q=C[T];q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(y,q.key,q)}}return function(y,C,T){return C&&_(y.prototype,C),T&&_(y,T),y}}(),N=function _(y,C,T){y===null&&(y=Function.prototype);var q=Object.getOwnPropertyDescriptor(y,C);if(q===void 0){var G=Object.getPrototypeOf(y);return G===null?void 0:_(G,C,T)}else{if("value"in q)return q.value;var Y=q.get;return Y===void 0?void 0:Y.call(T)}},w=h(3),g=m(w),f=h(2),p=m(f),i=h(0),t=m(i),r=h(16),d=m(r),s=h(6),l=m(s),o=h(7),n=m(o);function m(_){return _&&_.__esModule?_:{default:_}}function a(_,y){if(!(_ instanceof y))throw new TypeError("Cannot call a class as a function")}function u(_,y){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:_}function j(_,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);_.prototype=Object.create(y&&y.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(_,y):_.__proto__=y)}var E=1,S=function(_){j(y,_);function y(){return a(this,y),u(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}return x(y,[{key:"attach",value:function(){N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"attach",this).call(this),this.attributes=new t.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new p.default().insert(this.value(),(0,g.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(T,q){var G=t.default.query(T,t.default.Scope.BLOCK_ATTRIBUTE);G!=null&&this.attributes.attribute(G,q)}},{key:"formatAt",value:function(T,q,G,Y){this.format(G,Y)}},{key:"insertAt",value:function(T,q,G){if(typeof q=="string"&&q.endsWith(`
`)){var Y=t.default.create(D.blotName);this.parent.insertBefore(Y,T===0?this:this.next),Y.insertAt(0,q.slice(0,-1))}else N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"insertAt",this).call(this,T,q,G)}}]),y}(t.default.Embed);S.scope=t.default.Scope.BLOCK_BLOT;var D=function(_){j(y,_);function y(C){a(this,y);var T=u(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,C));return T.cache={},T}return x(y,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(t.default.Leaf).reduce(function(T,q){return q.length()===0?T:T.insert(q.value(),k(q))},new p.default).insert(`
`,k(this))),this.cache.delta}},{key:"deleteAt",value:function(T,q){N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"deleteAt",this).call(this,T,q),this.cache={}}},{key:"formatAt",value:function(T,q,G,Y){q<=0||(t.default.query(G,t.default.Scope.BLOCK)?T+q===this.length()&&this.format(G,Y):N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"formatAt",this).call(this,T,Math.min(q,this.length()-T-1),G,Y),this.cache={})}},{key:"insertAt",value:function(T,q,G){if(G!=null)return N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"insertAt",this).call(this,T,q,G);if(q.length!==0){var Y=q.split(`
`),te=Y.shift();te.length>0&&(T<this.length()-1||this.children.tail==null?N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"insertAt",this).call(this,Math.min(T,this.length()-1),te):this.children.tail.insertAt(this.children.tail.length(),te),this.cache={});var K=this;Y.reduce(function(M,P){return K=K.split(M,!0),K.insertAt(0,P),P.length},T+te.length)}}},{key:"insertBefore",value:function(T,q){var G=this.children.head;N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"insertBefore",this).call(this,T,q),G instanceof d.default&&G.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"length",this).call(this)+E),this.cache.length}},{key:"moveChildren",value:function(T,q){N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"moveChildren",this).call(this,T,q),this.cache={}}},{key:"optimize",value:function(T){N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"optimize",this).call(this,T),this.cache={}}},{key:"path",value:function(T){return N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"path",this).call(this,T,!0)}},{key:"removeChild",value:function(T){N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"removeChild",this).call(this,T),this.cache={}}},{key:"split",value:function(T){var q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(q&&(T===0||T>=this.length()-E)){var G=this.clone();return T===0?(this.parent.insertBefore(G,this),this):(this.parent.insertBefore(G,this.next),G)}else{var Y=N(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"split",this).call(this,T,q);return this.cache={},Y}}}]),y}(t.default.Block);D.blotName="block",D.tagName="P",D.defaultChild="break",D.allowedChildren=[l.default,t.default.Embed,n.default];function k(_){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _==null||(typeof _.formats=="function"&&(y=(0,g.default)(y,_.formats())),_.parent==null||_.parent.blotName=="scroll"||_.parent.statics.scope!==_.statics.scope)?y:k(_.parent,y)}c.bubbleFormats=k,c.BlockEmbed=S,c.default=D},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.overload=c.expandConfig=void 0;var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},N=function(){function K(M,P){var O=[],I=!0,$=!1,F=void 0;try{for(var R=M[Symbol.iterator](),L;!(I=(L=R.next()).done)&&(O.push(L.value),!(P&&O.length===P));I=!0);}catch(U){$=!0,F=U}finally{try{!I&&R.return&&R.return()}finally{if($)throw F}}return O}return function(M,P){if(Array.isArray(M))return M;if(Symbol.iterator in Object(M))return K(M,P);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=function(){function K(M,P){for(var O=0;O<P.length;O++){var I=P[O];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,I.key,I)}}return function(M,P,O){return P&&K(M.prototype,P),O&&K(M,O),M}}();h(50);var g=h(2),f=k(g),p=h(14),i=k(p),t=h(8),r=k(t),d=h(9),s=k(d),l=h(0),o=k(l),n=h(15),m=k(n),a=h(3),u=k(a),j=h(10),E=k(j),S=h(34),D=k(S);function k(K){return K&&K.__esModule?K:{default:K}}function _(K,M,P){return M in K?Object.defineProperty(K,M,{value:P,enumerable:!0,configurable:!0,writable:!0}):K[M]=P,K}function y(K,M){if(!(K instanceof M))throw new TypeError("Cannot call a class as a function")}var C=(0,E.default)("quill"),T=function(){w(K,null,[{key:"debug",value:function(P){P===!0&&(P="log"),E.default.level(P)}},{key:"find",value:function(P){return P.__quill||o.default.find(P)}},{key:"import",value:function(P){return this.imports[P]==null&&C.error("Cannot import "+P+". Are you sure it was registered?"),this.imports[P]}},{key:"register",value:function(P,O){var I=this,$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof P!="string"){var F=P.attrName||P.blotName;typeof F=="string"?this.register("formats/"+F,P,O):Object.keys(P).forEach(function(R){I.register(R,P[R],O)})}else this.imports[P]!=null&&!$&&C.warn("Overwriting "+P+" with",O),this.imports[P]=O,(P.startsWith("blots/")||P.startsWith("formats/"))&&O.blotName!=="abstract"?o.default.register(O):P.startsWith("modules")&&typeof O.register=="function"&&O.register()}}]);function K(M){var P=this,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(y(this,K),this.options=q(M,O),this.container=this.options.container,this.container==null)return C.error("Invalid Quill container",M);this.options.debug&&K.debug(this.options.debug);var I=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new r.default,this.scroll=o.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new i.default(this.scroll),this.selection=new m.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(r.default.events.EDITOR_CHANGE,function(F){F===r.default.events.TEXT_CHANGE&&P.root.classList.toggle("ql-blank",P.editor.isBlank())}),this.emitter.on(r.default.events.SCROLL_UPDATE,function(F,R){var L=P.selection.lastRange,U=L&&L.length===0?L.index:void 0;G.call(P,function(){return P.editor.update(null,R,U)},F)});var $=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+I+"<p><br></p></div>");this.setContents($),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return w(K,[{key:"addContainer",value:function(P){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof P=="string"){var I=P;P=document.createElement("div"),P.classList.add(I)}return this.container.insertBefore(P,O),P}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(P,O,I){var $=this,F=Y(P,O,I),R=N(F,4);return P=R[0],O=R[1],I=R[3],G.call(this,function(){return $.editor.deleteText(P,O)},I,P,-1*O)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(P),this.container.classList.toggle("ql-disabled",!P)}},{key:"focus",value:function(){var P=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=P,this.scrollIntoView()}},{key:"format",value:function(P,O){var I=this,$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:r.default.sources.API;return G.call(this,function(){var F=I.getSelection(!0),R=new f.default;if(F==null)return R;if(o.default.query(P,o.default.Scope.BLOCK))R=I.editor.formatLine(F.index,F.length,_({},P,O));else{if(F.length===0)return I.selection.format(P,O),R;R=I.editor.formatText(F.index,F.length,_({},P,O))}return I.setSelection(F,r.default.sources.SILENT),R},$)}},{key:"formatLine",value:function(P,O,I,$,F){var R=this,L=void 0,U=Y(P,O,I,$,F),B=N(U,4);return P=B[0],O=B[1],L=B[2],F=B[3],G.call(this,function(){return R.editor.formatLine(P,O,L)},F,P,0)}},{key:"formatText",value:function(P,O,I,$,F){var R=this,L=void 0,U=Y(P,O,I,$,F),B=N(U,4);return P=B[0],O=B[1],L=B[2],F=B[3],G.call(this,function(){return R.editor.formatText(P,O,L)},F,P,0)}},{key:"getBounds",value:function(P){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,I=void 0;typeof P=="number"?I=this.selection.getBounds(P,O):I=this.selection.getBounds(P.index,P.length);var $=this.container.getBoundingClientRect();return{bottom:I.bottom-$.top,height:I.height,left:I.left-$.left,right:I.right-$.left,top:I.top-$.top,width:I.width}}},{key:"getContents",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-P,I=Y(P,O),$=N(I,2);return P=$[0],O=$[1],this.editor.getContents(P,O)}},{key:"getFormat",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof P=="number"?this.editor.getFormat(P,O):this.editor.getFormat(P.index,P.length)}},{key:"getIndex",value:function(P){return P.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(P){return this.scroll.leaf(P)}},{key:"getLine",value:function(P){return this.scroll.line(P)}},{key:"getLines",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof P!="number"?this.scroll.lines(P.index,P.length):this.scroll.lines(P,O)}},{key:"getModule",value:function(P){return this.theme.modules[P]}},{key:"getSelection",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return P&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-P,I=Y(P,O),$=N(I,2);return P=$[0],O=$[1],this.editor.getText(P,O)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(P,O,I){var $=this,F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:K.sources.API;return G.call(this,function(){return $.editor.insertEmbed(P,O,I)},F,P)}},{key:"insertText",value:function(P,O,I,$,F){var R=this,L=void 0,U=Y(P,0,I,$,F),B=N(U,4);return P=B[0],L=B[2],F=B[3],G.call(this,function(){return R.editor.insertText(P,O,L)},F,P,O.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(P,O,I){this.clipboard.dangerouslyPasteHTML(P,O,I)}},{key:"removeFormat",value:function(P,O,I){var $=this,F=Y(P,O,I),R=N(F,4);return P=R[0],O=R[1],I=R[3],G.call(this,function(){return $.editor.removeFormat(P,O)},I,P)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(P){var O=this,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:r.default.sources.API;return G.call(this,function(){P=new f.default(P);var $=O.getLength(),F=O.editor.deleteText(0,$),R=O.editor.applyDelta(P),L=R.ops[R.ops.length-1];L!=null&&typeof L.insert=="string"&&L.insert[L.insert.length-1]===`
`&&(O.editor.deleteText(O.getLength()-1,1),R.delete(1));var U=F.compose(R);return U},I)}},{key:"setSelection",value:function(P,O,I){if(P==null)this.selection.setRange(null,O||K.sources.API);else{var $=Y(P,O,I),F=N($,4);P=F[0],O=F[1],I=F[3],this.selection.setRange(new n.Range(P,O),I),I!==r.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(P){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:r.default.sources.API,I=new f.default().insert(P);return this.setContents(I,O)}},{key:"update",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r.default.sources.USER,O=this.scroll.update(P);return this.selection.update(P),O}},{key:"updateContents",value:function(P){var O=this,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:r.default.sources.API;return G.call(this,function(){return P=new f.default(P),O.editor.applyDelta(P,I)},I,!0)}}]),K}();T.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},T.events=r.default.events,T.sources=r.default.sources,T.version="1.3.7",T.imports={delta:f.default,parchment:o.default,"core/module":s.default,"core/theme":D.default};function q(K,M){if(M=(0,u.default)(!0,{container:K,modules:{clipboard:!0,keyboard:!0,history:!0}},M),!M.theme||M.theme===T.DEFAULTS.theme)M.theme=D.default;else if(M.theme=T.import("themes/"+M.theme),M.theme==null)throw new Error("Invalid theme "+M.theme+". Did you register it?");var P=(0,u.default)(!0,{},M.theme.DEFAULTS);[P,M].forEach(function($){$.modules=$.modules||{},Object.keys($.modules).forEach(function(F){$.modules[F]===!0&&($.modules[F]={})})});var O=Object.keys(P.modules).concat(Object.keys(M.modules)),I=O.reduce(function($,F){var R=T.import("modules/"+F);return R==null?C.error("Cannot load "+F+" module. Are you sure you registered it?"):$[F]=R.DEFAULTS||{},$},{});return M.modules!=null&&M.modules.toolbar&&M.modules.toolbar.constructor!==Object&&(M.modules.toolbar={container:M.modules.toolbar}),M=(0,u.default)(!0,{},T.DEFAULTS,{modules:I},P,M),["bounds","container","scrollingContainer"].forEach(function($){typeof M[$]=="string"&&(M[$]=document.querySelector(M[$]))}),M.modules=Object.keys(M.modules).reduce(function($,F){return M.modules[F]&&($[F]=M.modules[F]),$},{}),M}function G(K,M,P,O){if(this.options.strict&&!this.isEnabled()&&M===r.default.sources.USER)return new f.default;var I=P==null?null:this.getSelection(),$=this.editor.delta,F=K();if(I!=null&&(P===!0&&(P=I.index),O==null?I=te(I,F,M):O!==0&&(I=te(I,P,O,M)),this.setSelection(I,r.default.sources.SILENT)),F.length()>0){var R,L=[r.default.events.TEXT_CHANGE,F,$,M];if((R=this.emitter).emit.apply(R,[r.default.events.EDITOR_CHANGE].concat(L)),M!==r.default.sources.SILENT){var U;(U=this.emitter).emit.apply(U,L)}}return F}function Y(K,M,P,O,I){var $={};return typeof K.index=="number"&&typeof K.length=="number"?typeof M!="number"?(I=O,O=P,P=M,M=K.length,K=K.index):(M=K.length,K=K.index):typeof M!="number"&&(I=O,O=P,P=M,M=0),(typeof P>"u"?"undefined":x(P))==="object"?($=P,I=O):typeof P=="string"&&(O!=null?$[P]=O:I=P),I=I||r.default.sources.API,[K,M,$,I]}function te(K,M,P,O){if(K==null)return null;var I=void 0,$=void 0;if(M instanceof f.default){var F=[K.index,K.index+K.length].map(function(B){return M.transformPosition(B,O!==r.default.sources.USER)}),R=N(F,2);I=R[0],$=R[1]}else{var L=[K.index,K.index+K.length].map(function(B){return B<M||B===M&&O===r.default.sources.USER?B:P>=0?B+P:Math.max(M,B+P)}),U=N(L,2);I=U[0],$=U[1]}return new n.Range(I,$-I)}c.expandConfig=q,c.overload=Y,c.default=T},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function l(o,n){for(var m=0;m<n.length;m++){var a=n[m];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}return function(o,n,m){return n&&l(o.prototype,n),m&&l(o,m),o}}(),N=function l(o,n,m){o===null&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,n);if(a===void 0){var u=Object.getPrototypeOf(o);return u===null?void 0:l(u,n,m)}else{if("value"in a)return a.value;var j=a.get;return j===void 0?void 0:j.call(m)}},w=h(7),g=i(w),f=h(0),p=i(f);function i(l){return l&&l.__esModule?l:{default:l}}function t(l,o){if(!(l instanceof o))throw new TypeError("Cannot call a class as a function")}function r(l,o){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:l}function d(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);l.prototype=Object.create(o&&o.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(l,o):l.__proto__=o)}var s=function(l){d(o,l);function o(){return t(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return x(o,[{key:"formatAt",value:function(m,a,u,j){if(o.compare(this.statics.blotName,u)<0&&p.default.query(u,p.default.Scope.BLOT)){var E=this.isolate(m,a);j&&E.wrap(u,j)}else N(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"formatAt",this).call(this,m,a,u,j)}},{key:"optimize",value:function(m){if(N(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"optimize",this).call(this,m),this.parent instanceof o&&o.compare(this.statics.blotName,this.parent.statics.blotName)>0){var a=this.parent.isolate(this.offset(),this.length());this.moveChildren(a),a.wrap(this)}}}],[{key:"compare",value:function(m,a){var u=o.order.indexOf(m),j=o.order.indexOf(a);return u>=0||j>=0?u-j:m===a?0:m<a?-1:1}}]),o}(p.default.Inline);s.allowedChildren=[s,p.default.Embed,g.default],s.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],c.default=s},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(0),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}function g(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function f(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function p(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var i=function(t){p(r,t);function r(){return g(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return r}(N.default.Text);c.default=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function n(m,a){for(var u=0;u<a.length;u++){var j=a[u];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(m,j.key,j)}}return function(m,a,u){return a&&n(m.prototype,a),u&&n(m,u),m}}(),N=function n(m,a,u){m===null&&(m=Function.prototype);var j=Object.getOwnPropertyDescriptor(m,a);if(j===void 0){var E=Object.getPrototypeOf(m);return E===null?void 0:n(E,a,u)}else{if("value"in j)return j.value;var S=j.get;return S===void 0?void 0:S.call(u)}},w=h(54),g=i(w),f=h(10),p=i(f);function i(n){return n&&n.__esModule?n:{default:n}}function t(n,m){if(!(n instanceof m))throw new TypeError("Cannot call a class as a function")}function r(n,m){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:n}function d(n,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);n.prototype=Object.create(m&&m.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(n,m):n.__proto__=m)}var s=(0,p.default)("quill:events"),l=["selectionchange","mousedown","mouseup","click"];l.forEach(function(n){document.addEventListener(n,function(){for(var m=arguments.length,a=Array(m),u=0;u<m;u++)a[u]=arguments[u];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(j){if(j.__quill&&j.__quill.emitter){var E;(E=j.__quill.emitter).handleDOM.apply(E,a)}})})});var o=function(n){d(m,n);function m(){t(this,m);var a=r(this,(m.__proto__||Object.getPrototypeOf(m)).call(this));return a.listeners={},a.on("error",s.error),a}return x(m,[{key:"emit",value:function(){s.log.apply(s,arguments),N(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function(u){for(var j=arguments.length,E=Array(j>1?j-1:0),S=1;S<j;S++)E[S-1]=arguments[S];(this.listeners[u.type]||[]).forEach(function(D){var k=D.node,_=D.handler;(u.target===k||k.contains(u.target))&&_.apply(void 0,[u].concat(E))})}},{key:"listenDOM",value:function(u,j,E){this.listeners[u]||(this.listeners[u]=[]),this.listeners[u].push({node:j,handler:E})}}]),m}(g.default);o.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},o.sources={API:"api",SILENT:"silent",USER:"user"},c.default=o},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});function x(w,g){if(!(w instanceof g))throw new TypeError("Cannot call a class as a function")}var N=function w(g){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};x(this,w),this.quill=g,this.options=f};N.DEFAULTS={},c.default=N},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=["error","warn","log","info"],N="warn";function w(f){if(x.indexOf(f)<=x.indexOf(N)){for(var p,i=arguments.length,t=Array(i>1?i-1:0),r=1;r<i;r++)t[r-1]=arguments[r];(p=console)[f].apply(p,t)}}function g(f){return x.reduce(function(p,i){return p[i]=w.bind(console,i,f),p},{})}w.level=g.level=function(f){N=f},c.default=g},function(v,c,h){var x=Array.prototype.slice,N=h(52),w=h(53),g=v.exports=function(t,r,d){return d||(d={}),t===r?!0:t instanceof Date&&r instanceof Date?t.getTime()===r.getTime():!t||!r||typeof t!="object"&&typeof r!="object"?d.strict?t===r:t==r:i(t,r,d)};function f(t){return t==null}function p(t){return!(!t||typeof t!="object"||typeof t.length!="number"||typeof t.copy!="function"||typeof t.slice!="function"||t.length>0&&typeof t[0]!="number")}function i(t,r,d){var s,l;if(f(t)||f(r)||t.prototype!==r.prototype)return!1;if(w(t))return w(r)?(t=x.call(t),r=x.call(r),g(t,r,d)):!1;if(p(t)){if(!p(r)||t.length!==r.length)return!1;for(s=0;s<t.length;s++)if(t[s]!==r[s])return!1;return!0}try{var o=N(t),n=N(r)}catch{return!1}if(o.length!=n.length)return!1;for(o.sort(),n.sort(),s=o.length-1;s>=0;s--)if(o[s]!=n[s])return!1;for(s=o.length-1;s>=0;s--)if(l=o[s],!g(t[l],r[l],d))return!1;return typeof t==typeof r}},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(1),N=function(){function w(g,f,p){p===void 0&&(p={}),this.attrName=g,this.keyName=f;var i=x.Scope.TYPE&x.Scope.ATTRIBUTE;p.scope!=null?this.scope=p.scope&x.Scope.LEVEL|i:this.scope=x.Scope.ATTRIBUTE,p.whitelist!=null&&(this.whitelist=p.whitelist)}return w.keys=function(g){return[].map.call(g.attributes,function(f){return f.name})},w.prototype.add=function(g,f){return this.canAdd(g,f)?(g.setAttribute(this.keyName,f),!0):!1},w.prototype.canAdd=function(g,f){var p=x.query(g,x.Scope.BLOT&(this.scope|x.Scope.TYPE));return p==null?!1:this.whitelist==null?!0:typeof f=="string"?this.whitelist.indexOf(f.replace(/["']/g,""))>-1:this.whitelist.indexOf(f)>-1},w.prototype.remove=function(g){g.removeAttribute(this.keyName)},w.prototype.value=function(g){var f=g.getAttribute(this.keyName);return this.canAdd(g,f)&&f?f:""},w}();c.default=N},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.Code=void 0;var x=function(){function S(D,k){var _=[],y=!0,C=!1,T=void 0;try{for(var q=D[Symbol.iterator](),G;!(y=(G=q.next()).done)&&(_.push(G.value),!(k&&_.length===k));y=!0);}catch(Y){C=!0,T=Y}finally{try{!y&&q.return&&q.return()}finally{if(C)throw T}}return _}return function(D,k){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return S(D,k);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(){function S(D,k){for(var _=0;_<k.length;_++){var y=k[_];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(D,y.key,y)}}return function(D,k,_){return k&&S(D.prototype,k),_&&S(D,_),D}}(),w=function S(D,k,_){D===null&&(D=Function.prototype);var y=Object.getOwnPropertyDescriptor(D,k);if(y===void 0){var C=Object.getPrototypeOf(D);return C===null?void 0:S(C,k,_)}else{if("value"in y)return y.value;var T=y.get;return T===void 0?void 0:T.call(_)}},g=h(2),f=n(g),p=h(0),i=n(p),t=h(4),r=n(t),d=h(6),s=n(d),l=h(7),o=n(l);function n(S){return S&&S.__esModule?S:{default:S}}function m(S,D){if(!(S instanceof D))throw new TypeError("Cannot call a class as a function")}function a(S,D){if(!S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:S}function u(S,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);S.prototype=Object.create(D&&D.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(S,D):S.__proto__=D)}var j=function(S){u(D,S);function D(){return m(this,D),a(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return D}(s.default);j.blotName="code",j.tagName="CODE";var E=function(S){u(D,S);function D(){return m(this,D),a(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return N(D,[{key:"delta",value:function(){var _=this,y=this.domNode.textContent;return y.endsWith(`
`)&&(y=y.slice(0,-1)),y.split(`
`).reduce(function(C,T){return C.insert(T).insert(`
`,_.formats())},new f.default)}},{key:"format",value:function(_,y){if(!(_===this.statics.blotName&&y)){var C=this.descendant(o.default,this.length()-1),T=x(C,1),q=T[0];q!=null&&q.deleteAt(q.length()-1,1),w(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"format",this).call(this,_,y)}}},{key:"formatAt",value:function(_,y,C,T){if(y!==0&&!(i.default.query(C,i.default.Scope.BLOCK)==null||C===this.statics.blotName&&T===this.statics.formats(this.domNode))){var q=this.newlineIndex(_);if(!(q<0||q>=_+y)){var G=this.newlineIndex(_,!0)+1,Y=q-G+1,te=this.isolate(G,Y),K=te.next;te.format(C,T),K instanceof D&&K.formatAt(0,_-G+y-Y,C,T)}}}},{key:"insertAt",value:function(_,y,C){if(C==null){var T=this.descendant(o.default,_),q=x(T,2),G=q[0],Y=q[1];G.insertAt(Y,y)}}},{key:"length",value:function(){var _=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?_:_+1}},{key:"newlineIndex",value:function(_){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(y)return this.domNode.textContent.slice(0,_).lastIndexOf(`
`);var C=this.domNode.textContent.slice(_).indexOf(`
`);return C>-1?_+C:-1}},{key:"optimize",value:function(_){this.domNode.textContent.endsWith(`
`)||this.appendChild(i.default.create("text",`
`)),w(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"optimize",this).call(this,_);var y=this.next;y!=null&&y.prev===this&&y.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===y.statics.formats(y.domNode)&&(y.optimize(_),y.moveChildren(this),y.remove())}},{key:"replace",value:function(_){w(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"replace",this).call(this,_),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(y){var C=i.default.find(y);C==null?y.parentNode.removeChild(y):C instanceof i.default.Embed?C.remove():C.unwrap()})}}],[{key:"create",value:function(_){var y=w(D.__proto__||Object.getPrototypeOf(D),"create",this).call(this,_);return y.setAttribute("spellcheck",!1),y}},{key:"formats",value:function(){return!0}}]),D}(r.default);E.blotName="code-block",E.tagName="PRE",E.TAB="  ",c.Code=j,c.default=E},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},N=function(){function K(M,P){var O=[],I=!0,$=!1,F=void 0;try{for(var R=M[Symbol.iterator](),L;!(I=(L=R.next()).done)&&(O.push(L.value),!(P&&O.length===P));I=!0);}catch(U){$=!0,F=U}finally{try{!I&&R.return&&R.return()}finally{if($)throw F}}return O}return function(M,P){if(Array.isArray(M))return M;if(Symbol.iterator in Object(M))return K(M,P);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=function(){function K(M,P){for(var O=0;O<P.length;O++){var I=P[O];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,I.key,I)}}return function(M,P,O){return P&&K(M.prototype,P),O&&K(M,O),M}}(),g=h(2),f=y(g),p=h(20),i=y(p),t=h(0),r=y(t),d=h(13),s=y(d),l=h(24),o=y(l),n=h(4),m=y(n),a=h(16),u=y(a),j=h(21),E=y(j),S=h(11),D=y(S),k=h(3),_=y(k);function y(K){return K&&K.__esModule?K:{default:K}}function C(K,M,P){return M in K?Object.defineProperty(K,M,{value:P,enumerable:!0,configurable:!0,writable:!0}):K[M]=P,K}function T(K,M){if(!(K instanceof M))throw new TypeError("Cannot call a class as a function")}var q=/^[ -~]*$/,G=function(){function K(M){T(this,K),this.scroll=M,this.delta=this.getDelta()}return w(K,[{key:"applyDelta",value:function(P){var O=this,I=!1;this.scroll.update();var $=this.scroll.length();return this.scroll.batchStart(),P=te(P),P.reduce(function(F,R){var L=R.retain||R.delete||R.insert.length||1,U=R.attributes||{};if(R.insert!=null){if(typeof R.insert=="string"){var B=R.insert;B.endsWith(`
`)&&I&&(I=!1,B=B.slice(0,-1)),F>=$&&!B.endsWith(`
`)&&(I=!0),O.scroll.insertAt(F,B);var W=O.scroll.line(F),ie=N(W,2),ue=ie[0],ee=ie[1],V=(0,_.default)({},(0,n.bubbleFormats)(ue));if(ue instanceof m.default){var ne=ue.descendant(r.default.Leaf,ee),de=N(ne,1),he=de[0];V=(0,_.default)(V,(0,n.bubbleFormats)(he))}U=i.default.attributes.diff(V,U)||{}}else if(x(R.insert)==="object"){var Q=Object.keys(R.insert)[0];if(Q==null)return F;O.scroll.insertAt(F,Q,R.insert[Q])}$+=L}return Object.keys(U).forEach(function(X){O.scroll.formatAt(F,L,X,U[X])}),F+L},0),P.reduce(function(F,R){return typeof R.delete=="number"?(O.scroll.deleteAt(F,R.delete),F):F+(R.retain||R.insert.length||1)},0),this.scroll.batchEnd(),this.update(P)}},{key:"deleteText",value:function(P,O){return this.scroll.deleteAt(P,O),this.update(new f.default().retain(P).delete(O))}},{key:"formatLine",value:function(P,O){var I=this,$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys($).forEach(function(F){if(!(I.scroll.whitelist!=null&&!I.scroll.whitelist[F])){var R=I.scroll.lines(P,Math.max(O,1)),L=O;R.forEach(function(U){var B=U.length();if(!(U instanceof s.default))U.format(F,$[F]);else{var W=P-U.offset(I.scroll),ie=U.newlineIndex(W+L)-W+1;U.formatAt(W,ie,F,$[F])}L-=B})}}),this.scroll.optimize(),this.update(new f.default().retain(P).retain(O,(0,E.default)($)))}},{key:"formatText",value:function(P,O){var I=this,$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys($).forEach(function(F){I.scroll.formatAt(P,O,F,$[F])}),this.update(new f.default().retain(P).retain(O,(0,E.default)($)))}},{key:"getContents",value:function(P,O){return this.delta.slice(P,P+O)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function(P,O){return P.concat(O.delta())},new f.default)}},{key:"getFormat",value:function(P){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,I=[],$=[];O===0?this.scroll.path(P).forEach(function(R){var L=N(R,1),U=L[0];U instanceof m.default?I.push(U):U instanceof r.default.Leaf&&$.push(U)}):(I=this.scroll.lines(P,O),$=this.scroll.descendants(r.default.Leaf,P,O));var F=[I,$].map(function(R){if(R.length===0)return{};for(var L=(0,n.bubbleFormats)(R.shift());Object.keys(L).length>0;){var U=R.shift();if(U==null)return L;L=Y((0,n.bubbleFormats)(U),L)}return L});return _.default.apply(_.default,F)}},{key:"getText",value:function(P,O){return this.getContents(P,O).filter(function(I){return typeof I.insert=="string"}).map(function(I){return I.insert}).join("")}},{key:"insertEmbed",value:function(P,O,I){return this.scroll.insertAt(P,O,I),this.update(new f.default().retain(P).insert(C({},O,I)))}},{key:"insertText",value:function(P,O){var I=this,$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return O=O.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(P,O),Object.keys($).forEach(function(F){I.scroll.formatAt(P,O.length,F,$[F])}),this.update(new f.default().retain(P).insert(O,(0,E.default)($)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var P=this.scroll.children.head;return P.statics.blotName!==m.default.blotName||P.children.length>1?!1:P.children.head instanceof u.default}},{key:"removeFormat",value:function(P,O){var I=this.getText(P,O),$=this.scroll.line(P+O),F=N($,2),R=F[0],L=F[1],U=0,B=new f.default;R!=null&&(R instanceof s.default?U=R.newlineIndex(L)-L+1:U=R.length()-L,B=R.delta().slice(L,L+U-1).insert(`
`));var W=this.getContents(P,O+U),ie=W.diff(new f.default().insert(I).concat(B)),ue=new f.default().retain(P).concat(ie);return this.applyDelta(ue)}},{key:"update",value:function(P){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,$=this.delta;if(O.length===1&&O[0].type==="characterData"&&O[0].target.data.match(q)&&r.default.find(O[0].target)){var F=r.default.find(O[0].target),R=(0,n.bubbleFormats)(F),L=F.offset(this.scroll),U=O[0].oldValue.replace(o.default.CONTENTS,""),B=new f.default().insert(U),W=new f.default().insert(F.value()),ie=new f.default().retain(L).concat(B.diff(W,I));P=ie.reduce(function(ue,ee){return ee.insert?ue.insert(ee.insert,R):ue.push(ee)},new f.default),this.delta=$.compose(P)}else this.delta=this.getDelta(),(!P||!(0,D.default)($.compose(P),this.delta))&&(P=$.diff(this.delta,I));return P}}]),K}();function Y(K,M){return Object.keys(M).reduce(function(P,O){return K[O]==null||(M[O]===K[O]?P[O]=M[O]:Array.isArray(M[O])?M[O].indexOf(K[O])<0&&(P[O]=M[O].concat([K[O]])):P[O]=[M[O],K[O]]),P},{})}function te(K){return K.reduce(function(M,P){if(P.insert===1){var O=(0,E.default)(P.attributes);return delete O.image,M.insert({image:P.attributes.image},O)}if(P.attributes!=null&&(P.attributes.list===!0||P.attributes.bullet===!0)&&(P=(0,E.default)(P),P.attributes.list?P.attributes.list="ordered":(P.attributes.list="bullet",delete P.attributes.bullet)),typeof P.insert=="string"){var I=P.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return M.insert(I,P.attributes)}return M.push(P)},new f.default)}c.default=G},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.Range=void 0;var x=function(){function S(D,k){var _=[],y=!0,C=!1,T=void 0;try{for(var q=D[Symbol.iterator](),G;!(y=(G=q.next()).done)&&(_.push(G.value),!(k&&_.length===k));y=!0);}catch(Y){C=!0,T=Y}finally{try{!y&&q.return&&q.return()}finally{if(C)throw T}}return _}return function(D,k){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return S(D,k);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(){function S(D,k){for(var _=0;_<k.length;_++){var y=k[_];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(D,y.key,y)}}return function(D,k,_){return k&&S(D.prototype,k),_&&S(D,_),D}}(),w=h(0),g=o(w),f=h(21),p=o(f),i=h(11),t=o(i),r=h(8),d=o(r),s=h(10),l=o(s);function o(S){return S&&S.__esModule?S:{default:S}}function n(S){if(Array.isArray(S)){for(var D=0,k=Array(S.length);D<S.length;D++)k[D]=S[D];return k}else return Array.from(S)}function m(S,D){if(!(S instanceof D))throw new TypeError("Cannot call a class as a function")}var a=(0,l.default)("quill:selection"),u=function S(D){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;m(this,S),this.index=D,this.length=k},j=function(){function S(D,k){var _=this;m(this,S),this.emitter=k,this.scroll=D,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=g.default.create("cursor",this),this.lastRange=this.savedRange=new u(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){_.mouseDown||setTimeout(_.update.bind(_,d.default.sources.USER),1)}),this.emitter.on(d.default.events.EDITOR_CHANGE,function(y,C){y===d.default.events.TEXT_CHANGE&&C.length()>0&&_.update(d.default.sources.SILENT)}),this.emitter.on(d.default.events.SCROLL_BEFORE_UPDATE,function(){if(_.hasFocus()){var y=_.getNativeRange();y!=null&&y.start.node!==_.cursor.textNode&&_.emitter.once(d.default.events.SCROLL_UPDATE,function(){try{_.setNativeRange(y.start.node,y.start.offset,y.end.node,y.end.offset)}catch{}})}}),this.emitter.on(d.default.events.SCROLL_OPTIMIZE,function(y,C){if(C.range){var T=C.range,q=T.startNode,G=T.startOffset,Y=T.endNode,te=T.endOffset;_.setNativeRange(q,G,Y,te)}}),this.update(d.default.sources.SILENT)}return N(S,[{key:"handleComposition",value:function(){var k=this;this.root.addEventListener("compositionstart",function(){k.composing=!0}),this.root.addEventListener("compositionend",function(){if(k.composing=!1,k.cursor.parent){var _=k.cursor.restore();if(!_)return;setTimeout(function(){k.setNativeRange(_.startNode,_.startOffset,_.endNode,_.endOffset)},1)}})}},{key:"handleDragging",value:function(){var k=this;this.emitter.listenDOM("mousedown",document.body,function(){k.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){k.mouseDown=!1,k.update(d.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(k,_){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[k])){this.scroll.update();var y=this.getNativeRange();if(!(y==null||!y.native.collapsed||g.default.query(k,g.default.Scope.BLOCK))){if(y.start.node!==this.cursor.textNode){var C=g.default.find(y.start.node,!1);if(C==null)return;if(C instanceof g.default.Leaf){var T=C.split(y.start.offset);C.parent.insertBefore(this.cursor,T)}else C.insertBefore(this.cursor,y.start.node);this.cursor.attach()}this.cursor.format(k,_),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(k){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=this.scroll.length();k=Math.min(k,y-1),_=Math.min(k+_,y-1)-k;var C=void 0,T=this.scroll.leaf(k),q=x(T,2),G=q[0],Y=q[1];if(G==null)return null;var te=G.position(Y,!0),K=x(te,2);C=K[0],Y=K[1];var M=document.createRange();if(_>0){M.setStart(C,Y);var P=this.scroll.leaf(k+_),O=x(P,2);if(G=O[0],Y=O[1],G==null)return null;var I=G.position(Y,!0),$=x(I,2);return C=$[0],Y=$[1],M.setEnd(C,Y),M.getBoundingClientRect()}else{var F="left",R=void 0;return C instanceof Text?(Y<C.data.length?(M.setStart(C,Y),M.setEnd(C,Y+1)):(M.setStart(C,Y-1),M.setEnd(C,Y),F="right"),R=M.getBoundingClientRect()):(R=G.domNode.getBoundingClientRect(),Y>0&&(F="right")),{bottom:R.top+R.height,height:R.height,left:R[F],right:R[F],top:R.top,width:0}}}},{key:"getNativeRange",value:function(){var k=document.getSelection();if(k==null||k.rangeCount<=0)return null;var _=k.getRangeAt(0);if(_==null)return null;var y=this.normalizeNative(_);return a.info("getNativeRange",y),y}},{key:"getRange",value:function(){var k=this.getNativeRange();if(k==null)return[null,null];var _=this.normalizedToRange(k);return[_,k]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(k){var _=this,y=[[k.start.node,k.start.offset]];k.native.collapsed||y.push([k.end.node,k.end.offset]);var C=y.map(function(G){var Y=x(G,2),te=Y[0],K=Y[1],M=g.default.find(te,!0),P=M.offset(_.scroll);return K===0?P:M instanceof g.default.Container?P+M.length():P+M.index(te,K)}),T=Math.min(Math.max.apply(Math,n(C)),this.scroll.length()-1),q=Math.min.apply(Math,[T].concat(n(C)));return new u(q,T-q)}},{key:"normalizeNative",value:function(k){if(!E(this.root,k.startContainer)||!k.collapsed&&!E(this.root,k.endContainer))return null;var _={start:{node:k.startContainer,offset:k.startOffset},end:{node:k.endContainer,offset:k.endOffset},native:k};return[_.start,_.end].forEach(function(y){for(var C=y.node,T=y.offset;!(C instanceof Text)&&C.childNodes.length>0;)if(C.childNodes.length>T)C=C.childNodes[T],T=0;else if(C.childNodes.length===T)C=C.lastChild,T=C instanceof Text?C.data.length:C.childNodes.length+1;else break;y.node=C,y.offset=T}),_}},{key:"rangeToNative",value:function(k){var _=this,y=k.collapsed?[k.index]:[k.index,k.index+k.length],C=[],T=this.scroll.length();return y.forEach(function(q,G){q=Math.min(T-1,q);var Y=void 0,te=_.scroll.leaf(q),K=x(te,2),M=K[0],P=K[1],O=M.position(P,G!==0),I=x(O,2);Y=I[0],P=I[1],C.push(Y,P)}),C.length<2&&(C=C.concat(C)),C}},{key:"scrollIntoView",value:function(k){var _=this.lastRange;if(_!=null){var y=this.getBounds(_.index,_.length);if(y!=null){var C=this.scroll.length()-1,T=this.scroll.line(Math.min(_.index,C)),q=x(T,1),G=q[0],Y=G;if(_.length>0){var te=this.scroll.line(Math.min(_.index+_.length,C)),K=x(te,1);Y=K[0]}if(!(G==null||Y==null)){var M=k.getBoundingClientRect();y.top<M.top?k.scrollTop-=M.top-y.top:y.bottom>M.bottom&&(k.scrollTop+=y.bottom-M.bottom)}}}}},{key:"setNativeRange",value:function(k,_){var y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k,C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:_,T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(a.info("setNativeRange",k,_,y,C),!(k!=null&&(this.root.parentNode==null||k.parentNode==null||y.parentNode==null))){var q=document.getSelection();if(q!=null)if(k!=null){this.hasFocus()||this.root.focus();var G=(this.getNativeRange()||{}).native;if(G==null||T||k!==G.startContainer||_!==G.startOffset||y!==G.endContainer||C!==G.endOffset){k.tagName=="BR"&&(_=[].indexOf.call(k.parentNode.childNodes,k),k=k.parentNode),y.tagName=="BR"&&(C=[].indexOf.call(y.parentNode.childNodes,y),y=y.parentNode);var Y=document.createRange();Y.setStart(k,_),Y.setEnd(y,C),q.removeAllRanges(),q.addRange(Y)}}else q.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(k){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:d.default.sources.API;if(typeof _=="string"&&(y=_,_=!1),a.info("setRange",k),k!=null){var C=this.rangeToNative(k);this.setNativeRange.apply(this,n(C).concat([_]))}else this.setNativeRange(null);this.update(y)}},{key:"update",value:function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d.default.sources.USER,_=this.lastRange,y=this.getRange(),C=x(y,2),T=C[0],q=C[1];if(this.lastRange=T,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,t.default)(_,this.lastRange)){var G;!this.composing&&q!=null&&q.native.collapsed&&q.start.node!==this.cursor.textNode&&this.cursor.restore();var Y=[d.default.events.SELECTION_CHANGE,(0,p.default)(this.lastRange),(0,p.default)(_),k];if((G=this.emitter).emit.apply(G,[d.default.events.EDITOR_CHANGE].concat(Y)),k!==d.default.sources.SILENT){var te;(te=this.emitter).emit.apply(te,Y)}}}}]),S}();function E(S,D){try{D.parentNode}catch{return!1}return D instanceof Text&&(D=D.parentNode),S.contains(D)}c.Range=u,c.default=j},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function d(s,l){for(var o=0;o<l.length;o++){var n=l[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(s,l,o){return l&&d(s.prototype,l),o&&d(s,o),s}}(),N=function d(s,l,o){s===null&&(s=Function.prototype);var n=Object.getOwnPropertyDescriptor(s,l);if(n===void 0){var m=Object.getPrototypeOf(s);return m===null?void 0:d(m,l,o)}else{if("value"in n)return n.value;var a=n.get;return a===void 0?void 0:a.call(o)}},w=h(0),g=f(w);function f(d){return d&&d.__esModule?d:{default:d}}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function i(d,s){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:d}function t(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(d,s):d.__proto__=s)}var r=function(d){t(s,d);function s(){return p(this,s),i(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return x(s,[{key:"insertInto",value:function(o,n){o.children.length===0?N(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"insertInto",this).call(this,o,n):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),s}(g.default.Embed);r.blotName="break",r.tagName="BR",c.default=r},function(v,c,h){var x=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var d in r)r.hasOwnProperty(d)&&(t[d]=r[d])};return function(t,r){i(t,r);function d(){this.constructor=t}t.prototype=r===null?Object.create(r):(d.prototype=r.prototype,new d)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(44),w=h(30),g=h(1),f=function(i){x(t,i);function t(r){var d=i.call(this,r)||this;return d.build(),d}return t.prototype.appendChild=function(r){this.insertBefore(r)},t.prototype.attach=function(){i.prototype.attach.call(this),this.children.forEach(function(r){r.attach()})},t.prototype.build=function(){var r=this;this.children=new N.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(d){try{var s=p(d);r.insertBefore(s,r.children.head||void 0)}catch(l){if(l instanceof g.ParchmentError)return;throw l}})},t.prototype.deleteAt=function(r,d){if(r===0&&d===this.length())return this.remove();this.children.forEachAt(r,d,function(s,l,o){s.deleteAt(l,o)})},t.prototype.descendant=function(r,d){var s=this.children.find(d),l=s[0],o=s[1];return r.blotName==null&&r(l)||r.blotName!=null&&l instanceof r?[l,o]:l instanceof t?l.descendant(r,o):[null,-1]},t.prototype.descendants=function(r,d,s){d===void 0&&(d=0),s===void 0&&(s=Number.MAX_VALUE);var l=[],o=s;return this.children.forEachAt(d,s,function(n,m,a){(r.blotName==null&&r(n)||r.blotName!=null&&n instanceof r)&&l.push(n),n instanceof t&&(l=l.concat(n.descendants(r,m,o))),o-=a}),l},t.prototype.detach=function(){this.children.forEach(function(r){r.detach()}),i.prototype.detach.call(this)},t.prototype.formatAt=function(r,d,s,l){this.children.forEachAt(r,d,function(o,n,m){o.formatAt(n,m,s,l)})},t.prototype.insertAt=function(r,d,s){var l=this.children.find(r),o=l[0],n=l[1];if(o)o.insertAt(n,d,s);else{var m=s==null?g.create("text",d):g.create(d,s);this.appendChild(m)}},t.prototype.insertBefore=function(r,d){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(s){return r instanceof s}))throw new g.ParchmentError("Cannot insert "+r.statics.blotName+" into "+this.statics.blotName);r.insertInto(this,d)},t.prototype.length=function(){return this.children.reduce(function(r,d){return r+d.length()},0)},t.prototype.moveChildren=function(r,d){this.children.forEach(function(s){r.insertBefore(s,d)})},t.prototype.optimize=function(r){if(i.prototype.optimize.call(this,r),this.children.length===0)if(this.statics.defaultChild!=null){var d=g.create(this.statics.defaultChild);this.appendChild(d),d.optimize(r)}else this.remove()},t.prototype.path=function(r,d){d===void 0&&(d=!1);var s=this.children.find(r,d),l=s[0],o=s[1],n=[[this,r]];return l instanceof t?n.concat(l.path(o,d)):(l!=null&&n.push([l,o]),n)},t.prototype.removeChild=function(r){this.children.remove(r)},t.prototype.replace=function(r){r instanceof t&&r.moveChildren(this),i.prototype.replace.call(this,r)},t.prototype.split=function(r,d){if(d===void 0&&(d=!1),!d){if(r===0)return this;if(r===this.length())return this.next}var s=this.clone();return this.parent.insertBefore(s,this.next),this.children.forEachAt(r,this.length(),function(l,o,n){l=l.split(o,d),s.appendChild(l)}),s},t.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},t.prototype.update=function(r,d){var s=this,l=[],o=[];r.forEach(function(n){n.target===s.domNode&&n.type==="childList"&&(l.push.apply(l,n.addedNodes),o.push.apply(o,n.removedNodes))}),o.forEach(function(n){if(!(n.parentNode!=null&&n.tagName!=="IFRAME"&&document.body.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var m=g.find(n);m!=null&&(m.domNode.parentNode==null||m.domNode.parentNode===s.domNode)&&m.detach()}}),l.filter(function(n){return n.parentNode==s.domNode}).sort(function(n,m){return n===m?0:n.compareDocumentPosition(m)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(n){var m=null;n.nextSibling!=null&&(m=g.find(n.nextSibling));var a=p(n);(a.next!=m||a.next==null)&&(a.parent!=null&&a.parent.removeChild(s),s.insertBefore(a,m||void 0))})},t}(w.default);function p(i){var t=g.find(i);if(t==null)try{t=g.create(i)}catch{t=g.create(g.Scope.INLINE),[].slice.call(i.childNodes).forEach(function(d){t.domNode.appendChild(d)}),i.parentNode&&i.parentNode.replaceChild(t.domNode,i),t.attach()}return t}c.default=f},function(v,c,h){var x=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var d in r)r.hasOwnProperty(d)&&(t[d]=r[d])};return function(t,r){i(t,r);function d(){this.constructor=t}t.prototype=r===null?Object.create(r):(d.prototype=r.prototype,new d)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(12),w=h(31),g=h(17),f=h(1),p=function(i){x(t,i);function t(r){var d=i.call(this,r)||this;return d.attributes=new w.default(d.domNode),d}return t.formats=function(r){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return r.tagName.toLowerCase()},t.prototype.format=function(r,d){var s=f.query(r);s instanceof N.default?this.attributes.attribute(s,d):d&&s!=null&&(r!==this.statics.blotName||this.formats()[r]!==d)&&this.replaceWith(r,d)},t.prototype.formats=function(){var r=this.attributes.values(),d=this.statics.formats(this.domNode);return d!=null&&(r[this.statics.blotName]=d),r},t.prototype.replaceWith=function(r,d){var s=i.prototype.replaceWith.call(this,r,d);return this.attributes.copy(s),s},t.prototype.update=function(r,d){var s=this;i.prototype.update.call(this,r,d),r.some(function(l){return l.target===s.domNode&&l.type==="attributes"})&&this.attributes.build()},t.prototype.wrap=function(r,d){var s=i.prototype.wrap.call(this,r,d);return s instanceof t&&s.statics.scope===this.statics.scope&&this.attributes.move(s),s},t}(g.default);c.default=p},function(v,c,h){var x=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,i){p.__proto__=i}||function(p,i){for(var t in i)i.hasOwnProperty(t)&&(p[t]=i[t])};return function(p,i){f(p,i);function t(){this.constructor=p}p.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(30),w=h(1),g=function(f){x(p,f);function p(){return f!==null&&f.apply(this,arguments)||this}return p.value=function(i){return!0},p.prototype.index=function(i,t){return this.domNode===i||this.domNode.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(t,1):-1},p.prototype.position=function(i,t){var r=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return i>0&&(r+=1),[this.parent.domNode,r]},p.prototype.value=function(){var i;return i={},i[this.statics.blotName]=this.statics.value(this.domNode)||!0,i},p.scope=w.Scope.INLINE_BLOT,p}(N.default);c.default=g},function(v,c,h){var x=h(11),N=h(3),w={attributes:{compose:function(f,p,i){typeof f!="object"&&(f={}),typeof p!="object"&&(p={});var t=N(!0,{},p);i||(t=Object.keys(t).reduce(function(d,s){return t[s]!=null&&(d[s]=t[s]),d},{}));for(var r in f)f[r]!==void 0&&p[r]===void 0&&(t[r]=f[r]);return Object.keys(t).length>0?t:void 0},diff:function(f,p){typeof f!="object"&&(f={}),typeof p!="object"&&(p={});var i=Object.keys(f).concat(Object.keys(p)).reduce(function(t,r){return x(f[r],p[r])||(t[r]=p[r]===void 0?null:p[r]),t},{});return Object.keys(i).length>0?i:void 0},transform:function(f,p,i){if(typeof f!="object")return p;if(typeof p=="object"){if(!i)return p;var t=Object.keys(p).reduce(function(r,d){return f[d]===void 0&&(r[d]=p[d]),r},{});return Object.keys(t).length>0?t:void 0}}},iterator:function(f){return new g(f)},length:function(f){return typeof f.delete=="number"?f.delete:typeof f.retain=="number"?f.retain:typeof f.insert=="string"?f.insert.length:1}};function g(f){this.ops=f,this.index=0,this.offset=0}g.prototype.hasNext=function(){return this.peekLength()<1/0},g.prototype.next=function(f){f||(f=1/0);var p=this.ops[this.index];if(p){var i=this.offset,t=w.length(p);if(f>=t-i?(f=t-i,this.index+=1,this.offset=0):this.offset+=f,typeof p.delete=="number")return{delete:f};var r={};return p.attributes&&(r.attributes=p.attributes),typeof p.retain=="number"?r.retain=f:typeof p.insert=="string"?r.insert=p.insert.substr(i,f):r.insert=p.insert,r}else return{retain:1/0}},g.prototype.peek=function(){return this.ops[this.index]},g.prototype.peekLength=function(){return this.ops[this.index]?w.length(this.ops[this.index])-this.offset:1/0},g.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},g.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var f=this.offset,p=this.index,i=this.next(),t=this.ops.slice(this.index);return this.offset=f,this.index=p,[i].concat(t)}else return[]},v.exports=w},function(v,c){var h=function(){function x(s,l){return l!=null&&s instanceof l}var N;try{N=Map}catch{N=function(){}}var w;try{w=Set}catch{w=function(){}}var g;try{g=Promise}catch{g=function(){}}function f(s,l,o,n,m){typeof l=="object"&&(o=l.depth,n=l.prototype,m=l.includeNonEnumerable,l=l.circular);var a=[],u=[],j=typeof Buffer<"u";typeof l>"u"&&(l=!0),typeof o>"u"&&(o=1/0);function E(S,D){if(S===null)return null;if(D===0)return S;var k,_;if(typeof S!="object")return S;if(x(S,N))k=new N;else if(x(S,w))k=new w;else if(x(S,g))k=new g(function(M,P){S.then(function(O){M(E(O,D-1))},function(O){P(E(O,D-1))})});else if(f.__isArray(S))k=[];else if(f.__isRegExp(S))k=new RegExp(S.source,d(S)),S.lastIndex&&(k.lastIndex=S.lastIndex);else if(f.__isDate(S))k=new Date(S.getTime());else{if(j&&Buffer.isBuffer(S))return Buffer.allocUnsafe?k=Buffer.allocUnsafe(S.length):k=new Buffer(S.length),S.copy(k),k;x(S,Error)?k=Object.create(S):typeof n>"u"?(_=Object.getPrototypeOf(S),k=Object.create(_)):(k=Object.create(n),_=n)}if(l){var y=a.indexOf(S);if(y!=-1)return u[y];a.push(S),u.push(k)}x(S,N)&&S.forEach(function(M,P){var O=E(P,D-1),I=E(M,D-1);k.set(O,I)}),x(S,w)&&S.forEach(function(M){var P=E(M,D-1);k.add(P)});for(var C in S){var T;_&&(T=Object.getOwnPropertyDescriptor(_,C)),!(T&&T.set==null)&&(k[C]=E(S[C],D-1))}if(Object.getOwnPropertySymbols)for(var q=Object.getOwnPropertySymbols(S),C=0;C<q.length;C++){var G=q[C],Y=Object.getOwnPropertyDescriptor(S,G);Y&&!Y.enumerable&&!m||(k[G]=E(S[G],D-1),Y.enumerable||Object.defineProperty(k,G,{enumerable:!1}))}if(m)for(var te=Object.getOwnPropertyNames(S),C=0;C<te.length;C++){var K=te[C],Y=Object.getOwnPropertyDescriptor(S,K);Y&&Y.enumerable||(k[K]=E(S[K],D-1),Object.defineProperty(k,K,{enumerable:!1}))}return k}return E(s,o)}f.clonePrototype=function(l){if(l===null)return null;var o=function(){};return o.prototype=l,new o};function p(s){return Object.prototype.toString.call(s)}f.__objToStr=p;function i(s){return typeof s=="object"&&p(s)==="[object Date]"}f.__isDate=i;function t(s){return typeof s=="object"&&p(s)==="[object Array]"}f.__isArray=t;function r(s){return typeof s=="object"&&p(s)==="[object RegExp]"}f.__isRegExp=r;function d(s){var l="";return s.global&&(l+="g"),s.ignoreCase&&(l+="i"),s.multiline&&(l+="m"),l}return f.__getRegExpFlags=d,f}();typeof v=="object"&&v.exports&&(v.exports=h)},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function k(_,y){var C=[],T=!0,q=!1,G=void 0;try{for(var Y=_[Symbol.iterator](),te;!(T=(te=Y.next()).done)&&(C.push(te.value),!(y&&C.length===y));T=!0);}catch(K){q=!0,G=K}finally{try{!T&&Y.return&&Y.return()}finally{if(q)throw G}}return C}return function(_,y){if(Array.isArray(_))return _;if(Symbol.iterator in Object(_))return k(_,y);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(){function k(_,y){for(var C=0;C<y.length;C++){var T=y[C];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}return function(_,y,C){return y&&k(_.prototype,y),C&&k(_,C),_}}(),w=function k(_,y,C){_===null&&(_=Function.prototype);var T=Object.getOwnPropertyDescriptor(_,y);if(T===void 0){var q=Object.getPrototypeOf(_);return q===null?void 0:k(q,y,C)}else{if("value"in T)return T.value;var G=T.get;return G===void 0?void 0:G.call(C)}},g=h(0),f=a(g),p=h(8),i=a(p),t=h(4),r=a(t),d=h(16),s=a(d),l=h(13),o=a(l),n=h(25),m=a(n);function a(k){return k&&k.__esModule?k:{default:k}}function u(k,_){if(!(k instanceof _))throw new TypeError("Cannot call a class as a function")}function j(k,_){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _&&(typeof _=="object"||typeof _=="function")?_:k}function E(k,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof _);k.prototype=Object.create(_&&_.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),_&&(Object.setPrototypeOf?Object.setPrototypeOf(k,_):k.__proto__=_)}function S(k){return k instanceof r.default||k instanceof t.BlockEmbed}var D=function(k){E(_,k);function _(y,C){u(this,_);var T=j(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,y));return T.emitter=C.emitter,Array.isArray(C.whitelist)&&(T.whitelist=C.whitelist.reduce(function(q,G){return q[G]=!0,q},{})),T.domNode.addEventListener("DOMNodeInserted",function(){}),T.optimize(),T.enable(),T}return N(_,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(C,T){var q=this.line(C),G=x(q,2),Y=G[0],te=G[1],K=this.line(C+T),M=x(K,1),P=M[0];if(w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"deleteAt",this).call(this,C,T),P!=null&&Y!==P&&te>0){if(Y instanceof t.BlockEmbed||P instanceof t.BlockEmbed){this.optimize();return}if(Y instanceof o.default){var O=Y.newlineIndex(Y.length(),!0);if(O>-1&&(Y=Y.split(O+1),Y===P)){this.optimize();return}}else if(P instanceof o.default){var I=P.newlineIndex(0);I>-1&&P.split(I+1)}var $=P.children.head instanceof s.default?null:P.children.head;Y.moveChildren(P,$),Y.remove()}this.optimize()}},{key:"enable",value:function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",C)}},{key:"formatAt",value:function(C,T,q,G){this.whitelist!=null&&!this.whitelist[q]||(w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"formatAt",this).call(this,C,T,q,G),this.optimize())}},{key:"insertAt",value:function(C,T,q){if(!(q!=null&&this.whitelist!=null&&!this.whitelist[T])){if(C>=this.length())if(q==null||f.default.query(T,f.default.Scope.BLOCK)==null){var G=f.default.create(this.statics.defaultChild);this.appendChild(G),q==null&&T.endsWith(`
`)&&(T=T.slice(0,-1)),G.insertAt(0,T,q)}else{var Y=f.default.create(T,q);this.appendChild(Y)}else w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"insertAt",this).call(this,C,T,q);this.optimize()}}},{key:"insertBefore",value:function(C,T){if(C.statics.scope===f.default.Scope.INLINE_BLOT){var q=f.default.create(this.statics.defaultChild);q.appendChild(C),C=q}w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"insertBefore",this).call(this,C,T)}},{key:"leaf",value:function(C){return this.path(C).pop()||[null,-1]}},{key:"line",value:function(C){return C===this.length()?this.line(C-1):this.descendant(S,C)}},{key:"lines",value:function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,q=function G(Y,te,K){var M=[],P=K;return Y.children.forEachAt(te,K,function(O,I,$){S(O)?M.push(O):O instanceof f.default.Container&&(M=M.concat(G(O,I,P))),P-=$}),M};return q(this,C,T)}},{key:"optimize",value:function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"optimize",this).call(this,C,T),C.length>0&&this.emitter.emit(i.default.events.SCROLL_OPTIMIZE,C,T))}},{key:"path",value:function(C){return w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"path",this).call(this,C).slice(1)}},{key:"update",value:function(C){if(this.batch!==!0){var T=i.default.sources.USER;typeof C=="string"&&(T=C),Array.isArray(C)||(C=this.observer.takeRecords()),C.length>0&&this.emitter.emit(i.default.events.SCROLL_BEFORE_UPDATE,T,C),w(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"update",this).call(this,C.concat([])),C.length>0&&this.emitter.emit(i.default.events.SCROLL_UPDATE,T,C)}}}]),_}(f.default.Scroll);D.blotName="scroll",D.className="ql-editor",D.tagName="DIV",D.defaultChild="block",D.allowedChildren=[r.default,t.BlockEmbed,m.default],c.default=D},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.SHORTKEY=c.default=void 0;var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},N=function(){function R(L,U){var B=[],W=!0,ie=!1,ue=void 0;try{for(var ee=L[Symbol.iterator](),V;!(W=(V=ee.next()).done)&&(B.push(V.value),!(U&&B.length===U));W=!0);}catch(ne){ie=!0,ue=ne}finally{try{!W&&ee.return&&ee.return()}finally{if(ie)throw ue}}return B}return function(L,U){if(Array.isArray(L))return L;if(Symbol.iterator in Object(L))return R(L,U);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=function(){function R(L,U){for(var B=0;B<U.length;B++){var W=U[B];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(L,W.key,W)}}return function(L,U,B){return U&&R(L.prototype,U),B&&R(L,B),L}}(),g=h(21),f=k(g),p=h(11),i=k(p),t=h(3),r=k(t),d=h(2),s=k(d),l=h(20),o=k(l),n=h(0),m=k(n),a=h(5),u=k(a),j=h(10),E=k(j),S=h(9),D=k(S);function k(R){return R&&R.__esModule?R:{default:R}}function _(R,L,U){return L in R?Object.defineProperty(R,L,{value:U,enumerable:!0,configurable:!0,writable:!0}):R[L]=U,R}function y(R,L){if(!(R instanceof L))throw new TypeError("Cannot call a class as a function")}function C(R,L){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L&&(typeof L=="object"||typeof L=="function")?L:R}function T(R,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);R.prototype=Object.create(L&&L.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(R,L):R.__proto__=L)}var q=(0,E.default)("quill:keyboard"),G=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",Y=function(R){T(L,R),w(L,null,[{key:"match",value:function(B,W){return W=F(W),["altKey","ctrlKey","metaKey","shiftKey"].some(function(ie){return!!W[ie]!==B[ie]&&W[ie]!==null})?!1:W.key===(B.which||B.keyCode)}}]);function L(U,B){y(this,L);var W=C(this,(L.__proto__||Object.getPrototypeOf(L)).call(this,U,B));return W.bindings={},Object.keys(W.options.bindings).forEach(function(ie){ie==="list autofill"&&U.scroll.whitelist!=null&&!U.scroll.whitelist.list||W.options.bindings[ie]&&W.addBinding(W.options.bindings[ie])}),W.addBinding({key:L.keys.ENTER,shiftKey:null},O),W.addBinding({key:L.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(W.addBinding({key:L.keys.BACKSPACE},{collapsed:!0},K),W.addBinding({key:L.keys.DELETE},{collapsed:!0},M)):(W.addBinding({key:L.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},K),W.addBinding({key:L.keys.DELETE},{collapsed:!0,suffix:/^.?$/},M)),W.addBinding({key:L.keys.BACKSPACE},{collapsed:!1},P),W.addBinding({key:L.keys.DELETE},{collapsed:!1},P),W.addBinding({key:L.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},K),W.listen(),W}return w(L,[{key:"addBinding",value:function(B){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},ue=F(B);if(ue==null||ue.key==null)return q.warn("Attempted to add invalid keyboard binding",ue);typeof W=="function"&&(W={handler:W}),typeof ie=="function"&&(ie={handler:ie}),ue=(0,r.default)(ue,W,ie),this.bindings[ue.key]=this.bindings[ue.key]||[],this.bindings[ue.key].push(ue)}},{key:"listen",value:function(){var B=this;this.quill.root.addEventListener("keydown",function(W){if(!W.defaultPrevented){var ie=W.which||W.keyCode,ue=(B.bindings[ie]||[]).filter(function(be){return L.match(W,be)});if(ue.length!==0){var ee=B.quill.getSelection();if(!(ee==null||!B.quill.hasFocus())){var V=B.quill.getLine(ee.index),ne=N(V,2),de=ne[0],he=ne[1],Q=B.quill.getLeaf(ee.index),X=N(Q,2),se=X[0],le=X[1],z=ee.length===0?[se,le]:B.quill.getLeaf(ee.index+ee.length),ae=N(z,2),ce=ae[0],oe=ae[1],pe=se instanceof m.default.Text?se.value().slice(0,le):"",ve=ce instanceof m.default.Text?ce.value().slice(oe):"",we={collapsed:ee.length===0,empty:ee.length===0&&de.length()<=1,format:B.quill.getFormat(ee),offset:he,prefix:pe,suffix:ve},$e=ue.some(function(be){if(be.collapsed!=null&&be.collapsed!==we.collapsed||be.empty!=null&&be.empty!==we.empty||be.offset!=null&&be.offset!==we.offset)return!1;if(Array.isArray(be.format)){if(be.format.every(function(ke){return we.format[ke]==null}))return!1}else if(x(be.format)==="object"&&!Object.keys(be.format).every(function(ke){return be.format[ke]===!0?we.format[ke]!=null:be.format[ke]===!1?we.format[ke]==null:(0,i.default)(be.format[ke],we.format[ke])}))return!1;return be.prefix!=null&&!be.prefix.test(we.prefix)||be.suffix!=null&&!be.suffix.test(we.suffix)?!1:be.handler.call(B,ee,we)!==!0});$e&&W.preventDefault()}}}})}}]),L}(D.default);Y.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},Y.DEFAULTS={bindings:{bold:$("bold"),italic:$("italic"),underline:$("underline"),indent:{key:Y.keys.TAB,format:["blockquote","indent","list"],handler:function(L,U){if(U.collapsed&&U.offset!==0)return!0;this.quill.format("indent","+1",u.default.sources.USER)}},outdent:{key:Y.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(L,U){if(U.collapsed&&U.offset!==0)return!0;this.quill.format("indent","-1",u.default.sources.USER)}},"outdent backspace":{key:Y.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(L,U){U.format.indent!=null?this.quill.format("indent","-1",u.default.sources.USER):U.format.list!=null&&this.quill.format("list",!1,u.default.sources.USER)}},"indent code-block":I(!0),"outdent code-block":I(!1),"remove tab":{key:Y.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(L){this.quill.deleteText(L.index-1,1,u.default.sources.USER)}},tab:{key:Y.keys.TAB,handler:function(L){this.quill.history.cutoff();var U=new s.default().retain(L.index).delete(L.length).insert("	");this.quill.updateContents(U,u.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(L.index+1,u.default.sources.SILENT)}},"list empty enter":{key:Y.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(L,U){this.quill.format("list",!1,u.default.sources.USER),U.format.indent&&this.quill.format("indent",!1,u.default.sources.USER)}},"checklist enter":{key:Y.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(L){var U=this.quill.getLine(L.index),B=N(U,2),W=B[0],ie=B[1],ue=(0,r.default)({},W.formats(),{list:"checked"}),ee=new s.default().retain(L.index).insert(`
`,ue).retain(W.length()-ie-1).retain(1,{list:"unchecked"});this.quill.updateContents(ee,u.default.sources.USER),this.quill.setSelection(L.index+1,u.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:Y.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(L,U){var B=this.quill.getLine(L.index),W=N(B,2),ie=W[0],ue=W[1],ee=new s.default().retain(L.index).insert(`
`,U.format).retain(ie.length()-ue-1).retain(1,{header:null});this.quill.updateContents(ee,u.default.sources.USER),this.quill.setSelection(L.index+1,u.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(L,U){var B=U.prefix.length,W=this.quill.getLine(L.index),ie=N(W,2),ue=ie[0],ee=ie[1];if(ee>B)return!0;var V=void 0;switch(U.prefix.trim()){case"[]":case"[ ]":V="unchecked";break;case"[x]":V="checked";break;case"-":case"*":V="bullet";break;default:V="ordered"}this.quill.insertText(L.index," ",u.default.sources.USER),this.quill.history.cutoff();var ne=new s.default().retain(L.index-ee).delete(B+1).retain(ue.length()-2-ee).retain(1,{list:V});this.quill.updateContents(ne,u.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(L.index-B,u.default.sources.SILENT)}},"code exit":{key:Y.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(L){var U=this.quill.getLine(L.index),B=N(U,2),W=B[0],ie=B[1],ue=new s.default().retain(L.index+W.length()-ie-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(ue,u.default.sources.USER)}},"embed left":te(Y.keys.LEFT,!1),"embed left shift":te(Y.keys.LEFT,!0),"embed right":te(Y.keys.RIGHT,!1),"embed right shift":te(Y.keys.RIGHT,!0)}};function te(R,L){var U,B=R===Y.keys.LEFT?"prefix":"suffix";return U={key:R,shiftKey:L,altKey:null},_(U,B,/^$/),_(U,"handler",function(ie){var ue=ie.index;R===Y.keys.RIGHT&&(ue+=ie.length+1);var ee=this.quill.getLeaf(ue),V=N(ee,1),ne=V[0];return ne instanceof m.default.Embed?(R===Y.keys.LEFT?L?this.quill.setSelection(ie.index-1,ie.length+1,u.default.sources.USER):this.quill.setSelection(ie.index-1,u.default.sources.USER):L?this.quill.setSelection(ie.index,ie.length+1,u.default.sources.USER):this.quill.setSelection(ie.index+ie.length+1,u.default.sources.USER),!1):!0}),U}function K(R,L){if(!(R.index===0||this.quill.getLength()<=1)){var U=this.quill.getLine(R.index),B=N(U,1),W=B[0],ie={};if(L.offset===0){var ue=this.quill.getLine(R.index-1),ee=N(ue,1),V=ee[0];if(V!=null&&V.length()>1){var ne=W.formats(),de=this.quill.getFormat(R.index-1,1);ie=o.default.attributes.diff(ne,de)||{}}}var he=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(L.prefix)?2:1;this.quill.deleteText(R.index-he,he,u.default.sources.USER),Object.keys(ie).length>0&&this.quill.formatLine(R.index-he,he,ie,u.default.sources.USER),this.quill.focus()}}function M(R,L){var U=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(L.suffix)?2:1;if(!(R.index>=this.quill.getLength()-U)){var B={},W=0,ie=this.quill.getLine(R.index),ue=N(ie,1),ee=ue[0];if(L.offset>=ee.length()-1){var V=this.quill.getLine(R.index+1),ne=N(V,1),de=ne[0];if(de){var he=ee.formats(),Q=this.quill.getFormat(R.index,1);B=o.default.attributes.diff(he,Q)||{},W=de.length()}}this.quill.deleteText(R.index,U,u.default.sources.USER),Object.keys(B).length>0&&this.quill.formatLine(R.index+W-1,U,B,u.default.sources.USER)}}function P(R){var L=this.quill.getLines(R),U={};if(L.length>1){var B=L[0].formats(),W=L[L.length-1].formats();U=o.default.attributes.diff(W,B)||{}}this.quill.deleteText(R,u.default.sources.USER),Object.keys(U).length>0&&this.quill.formatLine(R.index,1,U,u.default.sources.USER),this.quill.setSelection(R.index,u.default.sources.SILENT),this.quill.focus()}function O(R,L){var U=this;R.length>0&&this.quill.scroll.deleteAt(R.index,R.length);var B=Object.keys(L.format).reduce(function(W,ie){return m.default.query(ie,m.default.Scope.BLOCK)&&!Array.isArray(L.format[ie])&&(W[ie]=L.format[ie]),W},{});this.quill.insertText(R.index,`
`,B,u.default.sources.USER),this.quill.setSelection(R.index+1,u.default.sources.SILENT),this.quill.focus(),Object.keys(L.format).forEach(function(W){B[W]==null&&(Array.isArray(L.format[W])||W!=="link"&&U.quill.format(W,L.format[W],u.default.sources.USER))})}function I(R){return{key:Y.keys.TAB,shiftKey:!R,format:{"code-block":!0},handler:function(U){var B=m.default.query("code-block"),W=U.index,ie=U.length,ue=this.quill.scroll.descendant(B,W),ee=N(ue,2),V=ee[0],ne=ee[1];if(V!=null){var de=this.quill.getIndex(V),he=V.newlineIndex(ne,!0)+1,Q=V.newlineIndex(de+ne+ie),X=V.domNode.textContent.slice(he,Q).split(`
`);ne=0,X.forEach(function(se,le){R?(V.insertAt(he+ne,B.TAB),ne+=B.TAB.length,le===0?W+=B.TAB.length:ie+=B.TAB.length):se.startsWith(B.TAB)&&(V.deleteAt(he+ne,B.TAB.length),ne-=B.TAB.length,le===0?W-=B.TAB.length:ie-=B.TAB.length),ne+=se.length+1}),this.quill.update(u.default.sources.USER),this.quill.setSelection(W,ie,u.default.sources.SILENT)}}}}function $(R){return{key:R[0].toUpperCase(),shortKey:!0,handler:function(U,B){this.quill.format(R,!B.format[R],u.default.sources.USER)}}}function F(R){if(typeof R=="string"||typeof R=="number")return F({key:R});if((typeof R>"u"?"undefined":x(R))==="object"&&(R=(0,f.default)(R,!1)),typeof R.key=="string")if(Y.keys[R.key.toUpperCase()]!=null)R.key=Y.keys[R.key.toUpperCase()];else if(R.key.length===1)R.key=R.key.toUpperCase().charCodeAt(0);else return null;return R.shortKey&&(R[G]=R.shortKey,delete R.shortKey),R}c.default=Y,c.SHORTKEY=G},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function o(n,m){var a=[],u=!0,j=!1,E=void 0;try{for(var S=n[Symbol.iterator](),D;!(u=(D=S.next()).done)&&(a.push(D.value),!(m&&a.length===m));u=!0);}catch(k){j=!0,E=k}finally{try{!u&&S.return&&S.return()}finally{if(j)throw E}}return a}return function(n,m){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return o(n,m);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function o(n,m,a){n===null&&(n=Function.prototype);var u=Object.getOwnPropertyDescriptor(n,m);if(u===void 0){var j=Object.getPrototypeOf(n);return j===null?void 0:o(j,m,a)}else{if("value"in u)return u.value;var E=u.get;return E===void 0?void 0:E.call(a)}},w=function(){function o(n,m){for(var a=0;a<m.length;a++){var u=m[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}return function(n,m,a){return m&&o(n.prototype,m),a&&o(n,a),n}}(),g=h(0),f=t(g),p=h(7),i=t(p);function t(o){return o&&o.__esModule?o:{default:o}}function r(o,n){if(!(o instanceof n))throw new TypeError("Cannot call a class as a function")}function d(o,n){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&(typeof n=="object"||typeof n=="function")?n:o}function s(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof n);o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(o,n):o.__proto__=n)}var l=function(o){s(n,o),w(n,null,[{key:"value",value:function(){}}]);function n(m,a){r(this,n);var u=d(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,m));return u.selection=a,u.textNode=document.createTextNode(n.CONTENTS),u.domNode.appendChild(u.textNode),u._length=0,u}return w(n,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(a,u){if(this._length!==0)return N(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"format",this).call(this,a,u);for(var j=this,E=0;j!=null&&j.statics.scope!==f.default.Scope.BLOCK_BLOT;)E+=j.offset(j.parent),j=j.parent;j!=null&&(this._length=n.CONTENTS.length,j.optimize(),j.formatAt(E,n.CONTENTS.length,a,u),this._length=0)}},{key:"index",value:function(a,u){return a===this.textNode?0:N(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"index",this).call(this,a,u)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){N(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var a=this.textNode,u=this.selection.getNativeRange(),j=void 0,E=void 0,S=void 0;if(u!=null&&u.start.node===a&&u.end.node===a){var D=[a,u.start.offset,u.end.offset];j=D[0],E=D[1],S=D[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==n.CONTENTS){var k=this.textNode.data.split(n.CONTENTS).join("");this.next instanceof i.default?(j=this.next.domNode,this.next.insertAt(0,k),this.textNode.data=n.CONTENTS):(this.textNode.data=k,this.parent.insertBefore(f.default.create(this.textNode),this),this.textNode=document.createTextNode(n.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),E!=null){var _=[E,S].map(function(C){return Math.max(0,Math.min(j.data.length,C-1))}),y=x(_,2);return E=y[0],S=y[1],{startNode:j,startOffset:E,endNode:j,endOffset:S}}}}},{key:"update",value:function(a,u){var j=this;if(a.some(function(S){return S.type==="characterData"&&S.target===j.textNode})){var E=this.restore();E&&(u.range=E)}}},{key:"value",value:function(){return""}}]),n}(f.default.Embed);l.blotName="cursor",l.className="ql-cursor",l.tagName="span",l.CONTENTS="\uFEFF",c.default=l},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(0),N=f(x),w=h(4),g=f(w);function f(d){return d&&d.__esModule?d:{default:d}}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function i(d,s){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:d}function t(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(d,s):d.__proto__=s)}var r=function(d){t(s,d);function s(){return p(this,s),i(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return s}(N.default.Container);r.allowedChildren=[g.default,w.BlockEmbed,r],c.default=r},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.ColorStyle=c.ColorClass=c.ColorAttributor=void 0;var x=function(){function l(o,n){for(var m=0;m<n.length;m++){var a=n[m];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}return function(o,n,m){return n&&l(o.prototype,n),m&&l(o,m),o}}(),N=function l(o,n,m){o===null&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,n);if(a===void 0){var u=Object.getPrototypeOf(o);return u===null?void 0:l(u,n,m)}else{if("value"in a)return a.value;var j=a.get;return j===void 0?void 0:j.call(m)}},w=h(0),g=f(w);function f(l){return l&&l.__esModule?l:{default:l}}function p(l,o){if(!(l instanceof o))throw new TypeError("Cannot call a class as a function")}function i(l,o){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:l}function t(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);l.prototype=Object.create(o&&o.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(l,o):l.__proto__=o)}var r=function(l){t(o,l);function o(){return p(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return x(o,[{key:"value",value:function(m){var a=N(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"value",this).call(this,m);return a.startsWith("rgb(")?(a=a.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+a.split(",").map(function(u){return("00"+parseInt(u).toString(16)).slice(-2)}).join("")):a}}]),o}(g.default.Attributor.Style),d=new g.default.Attributor.Class("color","ql-color",{scope:g.default.Scope.INLINE}),s=new r("color","color",{scope:g.default.Scope.INLINE});c.ColorAttributor=r,c.ColorClass=d,c.ColorStyle=s},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.sanitize=c.default=void 0;var x=function(){function s(l,o){for(var n=0;n<o.length;n++){var m=o[n];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(l,m.key,m)}}return function(l,o,n){return o&&s(l.prototype,o),n&&s(l,n),l}}(),N=function s(l,o,n){l===null&&(l=Function.prototype);var m=Object.getOwnPropertyDescriptor(l,o);if(m===void 0){var a=Object.getPrototypeOf(l);return a===null?void 0:s(a,o,n)}else{if("value"in m)return m.value;var u=m.get;return u===void 0?void 0:u.call(n)}},w=h(6),g=f(w);function f(s){return s&&s.__esModule?s:{default:s}}function p(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}function i(s,l){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l&&(typeof l=="object"||typeof l=="function")?l:s}function t(s,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);s.prototype=Object.create(l&&l.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),l&&(Object.setPrototypeOf?Object.setPrototypeOf(s,l):s.__proto__=l)}var r=function(s){t(l,s);function l(){return p(this,l),i(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}return x(l,[{key:"format",value:function(n,m){if(n!==this.statics.blotName||!m)return N(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"format",this).call(this,n,m);m=this.constructor.sanitize(m),this.domNode.setAttribute("href",m)}}],[{key:"create",value:function(n){var m=N(l.__proto__||Object.getPrototypeOf(l),"create",this).call(this,n);return n=this.sanitize(n),m.setAttribute("href",n),m.setAttribute("rel","noopener noreferrer"),m.setAttribute("target","_blank"),m}},{key:"formats",value:function(n){return n.getAttribute("href")}},{key:"sanitize",value:function(n){return d(n,this.PROTOCOL_WHITELIST)?n:this.SANITIZED_URL}}]),l}(g.default);r.blotName="link",r.tagName="A",r.SANITIZED_URL="about:blank",r.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function d(s,l){var o=document.createElement("a");o.href=s;var n=o.href.slice(0,o.href.indexOf(":"));return l.indexOf(n)>-1}c.default=r,c.sanitize=d},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},N=function(){function l(o,n){for(var m=0;m<n.length;m++){var a=n[m];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}return function(o,n,m){return n&&l(o.prototype,n),m&&l(o,m),o}}(),w=h(23),g=i(w),f=h(107),p=i(f);function i(l){return l&&l.__esModule?l:{default:l}}function t(l,o){if(!(l instanceof o))throw new TypeError("Cannot call a class as a function")}var r=0;function d(l,o){l.setAttribute(o,l.getAttribute(o)!=="true")}var s=function(){function l(o){var n=this;t(this,l),this.select=o,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){n.togglePicker()}),this.label.addEventListener("keydown",function(m){switch(m.keyCode){case g.default.keys.ENTER:n.togglePicker();break;case g.default.keys.ESCAPE:n.escape(),m.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return N(l,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),d(this.label,"aria-expanded"),d(this.options,"aria-hidden")}},{key:"buildItem",value:function(n){var m=this,a=document.createElement("span");return a.tabIndex="0",a.setAttribute("role","button"),a.classList.add("ql-picker-item"),n.hasAttribute("value")&&a.setAttribute("data-value",n.getAttribute("value")),n.textContent&&a.setAttribute("data-label",n.textContent),a.addEventListener("click",function(){m.selectItem(a,!0)}),a.addEventListener("keydown",function(u){switch(u.keyCode){case g.default.keys.ENTER:m.selectItem(a,!0),u.preventDefault();break;case g.default.keys.ESCAPE:m.escape(),u.preventDefault();break}}),a}},{key:"buildLabel",value:function(){var n=document.createElement("span");return n.classList.add("ql-picker-label"),n.innerHTML=p.default,n.tabIndex="0",n.setAttribute("role","button"),n.setAttribute("aria-expanded","false"),this.container.appendChild(n),n}},{key:"buildOptions",value:function(){var n=this,m=document.createElement("span");m.classList.add("ql-picker-options"),m.setAttribute("aria-hidden","true"),m.tabIndex="-1",m.id="ql-picker-options-"+r,r+=1,this.label.setAttribute("aria-controls",m.id),this.options=m,[].slice.call(this.select.options).forEach(function(a){var u=n.buildItem(a);m.appendChild(u),a.selected===!0&&n.selectItem(u)}),this.container.appendChild(m)}},{key:"buildPicker",value:function(){var n=this;[].slice.call(this.select.attributes).forEach(function(m){n.container.setAttribute(m.name,m.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var n=this;this.close(),setTimeout(function(){return n.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(n){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=this.container.querySelector(".ql-selected");if(n!==a&&(a!=null&&a.classList.remove("ql-selected"),n!=null&&(n.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(n.parentNode.children,n),n.hasAttribute("data-value")?this.label.setAttribute("data-value",n.getAttribute("data-value")):this.label.removeAttribute("data-value"),n.hasAttribute("data-label")?this.label.setAttribute("data-label",n.getAttribute("data-label")):this.label.removeAttribute("data-label"),m))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":x(Event))==="object"){var u=document.createEvent("Event");u.initEvent("change",!0,!0),this.select.dispatchEvent(u)}this.close()}}},{key:"update",value:function(){var n=void 0;if(this.select.selectedIndex>-1){var m=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];n=this.select.options[this.select.selectedIndex],this.selectItem(m)}else this.selectItem(null);var a=n!=null&&n!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",a)}}]),l}();c.default=s},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(0),N=q(x),w=h(5),g=q(w),f=h(4),p=q(f),i=h(16),t=q(i),r=h(25),d=q(r),s=h(24),l=q(s),o=h(35),n=q(o),m=h(6),a=q(m),u=h(22),j=q(u),E=h(7),S=q(E),D=h(55),k=q(D),_=h(42),y=q(_),C=h(23),T=q(C);function q(G){return G&&G.__esModule?G:{default:G}}g.default.register({"blots/block":p.default,"blots/block/embed":f.BlockEmbed,"blots/break":t.default,"blots/container":d.default,"blots/cursor":l.default,"blots/embed":n.default,"blots/inline":a.default,"blots/scroll":j.default,"blots/text":S.default,"modules/clipboard":k.default,"modules/history":y.default,"modules/keyboard":T.default}),N.default.register(p.default,t.default,l.default,a.default,j.default,S.default),c.default=g.default},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(1),N=function(){function w(g){this.domNode=g,this.domNode[x.DATA_KEY]={blot:this}}return Object.defineProperty(w.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),w.create=function(g){if(this.tagName==null)throw new x.ParchmentError("Blot definition missing tagName");var f;return Array.isArray(this.tagName)?(typeof g=="string"&&(g=g.toUpperCase(),parseInt(g).toString()===g&&(g=parseInt(g))),typeof g=="number"?f=document.createElement(this.tagName[g-1]):this.tagName.indexOf(g)>-1?f=document.createElement(g):f=document.createElement(this.tagName[0])):f=document.createElement(this.tagName),this.className&&f.classList.add(this.className),f},w.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},w.prototype.clone=function(){var g=this.domNode.cloneNode(!1);return x.create(g)},w.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[x.DATA_KEY]},w.prototype.deleteAt=function(g,f){var p=this.isolate(g,f);p.remove()},w.prototype.formatAt=function(g,f,p,i){var t=this.isolate(g,f);if(x.query(p,x.Scope.BLOT)!=null&&i)t.wrap(p,i);else if(x.query(p,x.Scope.ATTRIBUTE)!=null){var r=x.create(this.statics.scope);t.wrap(r),r.format(p,i)}},w.prototype.insertAt=function(g,f,p){var i=p==null?x.create("text",f):x.create(f,p),t=this.split(g);this.parent.insertBefore(i,t)},w.prototype.insertInto=function(g,f){f===void 0&&(f=null),this.parent!=null&&this.parent.children.remove(this);var p=null;g.children.insertBefore(this,f),f!=null&&(p=f.domNode),(this.domNode.parentNode!=g.domNode||this.domNode.nextSibling!=p)&&g.domNode.insertBefore(this.domNode,p),this.parent=g,this.attach()},w.prototype.isolate=function(g,f){var p=this.split(g);return p.split(f),p},w.prototype.length=function(){return 1},w.prototype.offset=function(g){return g===void 0&&(g=this.parent),this.parent==null||this==g?0:this.parent.children.offset(this)+this.parent.offset(g)},w.prototype.optimize=function(g){this.domNode[x.DATA_KEY]!=null&&delete this.domNode[x.DATA_KEY].mutations},w.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},w.prototype.replace=function(g){g.parent!=null&&(g.parent.insertBefore(this,g.next),g.remove())},w.prototype.replaceWith=function(g,f){var p=typeof g=="string"?x.create(g,f):g;return p.replace(this),p},w.prototype.split=function(g,f){return g===0?this:this.next},w.prototype.update=function(g,f){},w.prototype.wrap=function(g,f){var p=typeof g=="string"?x.create(g,f):g;return this.parent!=null&&this.parent.insertBefore(p,this.next),p.appendChild(this),p},w.blotName="abstract",w}();c.default=N},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(12),N=h(32),w=h(33),g=h(1),f=function(){function p(i){this.attributes={},this.domNode=i,this.build()}return p.prototype.attribute=function(i,t){t?i.add(this.domNode,t)&&(i.value(this.domNode)!=null?this.attributes[i.attrName]=i:delete this.attributes[i.attrName]):(i.remove(this.domNode),delete this.attributes[i.attrName])},p.prototype.build=function(){var i=this;this.attributes={};var t=x.default.keys(this.domNode),r=N.default.keys(this.domNode),d=w.default.keys(this.domNode);t.concat(r).concat(d).forEach(function(s){var l=g.query(s,g.Scope.ATTRIBUTE);l instanceof x.default&&(i.attributes[l.attrName]=l)})},p.prototype.copy=function(i){var t=this;Object.keys(this.attributes).forEach(function(r){var d=t.attributes[r].value(t.domNode);i.format(r,d)})},p.prototype.move=function(i){var t=this;this.copy(i),Object.keys(this.attributes).forEach(function(r){t.attributes[r].remove(t.domNode)}),this.attributes={}},p.prototype.values=function(){var i=this;return Object.keys(this.attributes).reduce(function(t,r){return t[r]=i.attributes[r].value(i.domNode),t},{})},p}();c.default=f},function(v,c,h){var x=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,i){p.__proto__=i}||function(p,i){for(var t in i)i.hasOwnProperty(t)&&(p[t]=i[t])};return function(p,i){f(p,i);function t(){this.constructor=p}p.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(12);function w(f,p){var i=f.getAttribute("class")||"";return i.split(/\s+/).filter(function(t){return t.indexOf(p+"-")===0})}var g=function(f){x(p,f);function p(){return f!==null&&f.apply(this,arguments)||this}return p.keys=function(i){return(i.getAttribute("class")||"").split(/\s+/).map(function(t){return t.split("-").slice(0,-1).join("-")})},p.prototype.add=function(i,t){return this.canAdd(i,t)?(this.remove(i),i.classList.add(this.keyName+"-"+t),!0):!1},p.prototype.remove=function(i){var t=w(i,this.keyName);t.forEach(function(r){i.classList.remove(r)}),i.classList.length===0&&i.removeAttribute("class")},p.prototype.value=function(i){var t=w(i,this.keyName)[0]||"",r=t.slice(this.keyName.length+1);return this.canAdd(i,r)?r:""},p}(N.default);c.default=g},function(v,c,h){var x=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,i){p.__proto__=i}||function(p,i){for(var t in i)i.hasOwnProperty(t)&&(p[t]=i[t])};return function(p,i){f(p,i);function t(){this.constructor=p}p.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(12);function w(f){var p=f.split("-"),i=p.slice(1).map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("");return p[0]+i}var g=function(f){x(p,f);function p(){return f!==null&&f.apply(this,arguments)||this}return p.keys=function(i){return(i.getAttribute("style")||"").split(";").map(function(t){var r=t.split(":");return r[0].trim()})},p.prototype.add=function(i,t){return this.canAdd(i,t)?(i.style[w(this.keyName)]=t,!0):!1},p.prototype.remove=function(i){i.style[w(this.keyName)]="",i.getAttribute("style")||i.removeAttribute("style")},p.prototype.value=function(i){var t=i.style[w(this.keyName)];return this.canAdd(i,t)?t:""},p}(N.default);c.default=g},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function g(f,p){for(var i=0;i<p.length;i++){var t=p[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(f,t.key,t)}}return function(f,p,i){return p&&g(f.prototype,p),i&&g(f,i),f}}();function N(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}var w=function(){function g(f,p){N(this,g),this.quill=f,this.options=p,this.modules={}}return x(g,[{key:"init",value:function(){var p=this;Object.keys(this.options.modules).forEach(function(i){p.modules[i]==null&&p.addModule(i)})}},{key:"addModule",value:function(p){var i=this.quill.constructor.import("modules/"+p);return this.modules[p]=new i(this.quill,this.options.modules[p]||{}),this.modules[p]}}]),g}();w.DEFAULTS={modules:{}},w.themes={default:w},c.default=w},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function o(n,m){for(var a=0;a<m.length;a++){var u=m[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}return function(n,m,a){return m&&o(n.prototype,m),a&&o(n,a),n}}(),N=function o(n,m,a){n===null&&(n=Function.prototype);var u=Object.getOwnPropertyDescriptor(n,m);if(u===void 0){var j=Object.getPrototypeOf(n);return j===null?void 0:o(j,m,a)}else{if("value"in u)return u.value;var E=u.get;return E===void 0?void 0:E.call(a)}},w=h(0),g=i(w),f=h(7),p=i(f);function i(o){return o&&o.__esModule?o:{default:o}}function t(o,n){if(!(o instanceof n))throw new TypeError("Cannot call a class as a function")}function r(o,n){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&(typeof n=="object"||typeof n=="function")?n:o}function d(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof n);o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(o,n):o.__proto__=n)}var s="\uFEFF",l=function(o){d(n,o);function n(m){t(this,n);var a=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,m));return a.contentNode=document.createElement("span"),a.contentNode.setAttribute("contenteditable",!1),[].slice.call(a.domNode.childNodes).forEach(function(u){a.contentNode.appendChild(u)}),a.leftGuard=document.createTextNode(s),a.rightGuard=document.createTextNode(s),a.domNode.appendChild(a.leftGuard),a.domNode.appendChild(a.contentNode),a.domNode.appendChild(a.rightGuard),a}return x(n,[{key:"index",value:function(a,u){return a===this.leftGuard?0:a===this.rightGuard?1:N(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"index",this).call(this,a,u)}},{key:"restore",value:function(a){var u=void 0,j=void 0,E=a.data.split(s).join("");if(a===this.leftGuard)if(this.prev instanceof p.default){var S=this.prev.length();this.prev.insertAt(S,E),u={startNode:this.prev.domNode,startOffset:S+E.length}}else j=document.createTextNode(E),this.parent.insertBefore(g.default.create(j),this),u={startNode:j,startOffset:E.length};else a===this.rightGuard&&(this.next instanceof p.default?(this.next.insertAt(0,E),u={startNode:this.next.domNode,startOffset:E.length}):(j=document.createTextNode(E),this.parent.insertBefore(g.default.create(j),this.next),u={startNode:j,startOffset:E.length}));return a.data=s,u}},{key:"update",value:function(a,u){var j=this;a.forEach(function(E){if(E.type==="characterData"&&(E.target===j.leftGuard||E.target===j.rightGuard)){var S=j.restore(E.target);S&&(u.range=S)}})}}]),n}(g.default.Embed);c.default=l},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.AlignStyle=c.AlignClass=c.AlignAttribute=void 0;var x=h(0),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}var g={scope:N.default.Scope.BLOCK,whitelist:["right","center","justify"]},f=new N.default.Attributor.Attribute("align","align",g),p=new N.default.Attributor.Class("align","ql-align",g),i=new N.default.Attributor.Style("align","text-align",g);c.AlignAttribute=f,c.AlignClass=p,c.AlignStyle=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.BackgroundStyle=c.BackgroundClass=void 0;var x=h(0),N=g(x),w=h(26);function g(i){return i&&i.__esModule?i:{default:i}}var f=new N.default.Attributor.Class("background","ql-bg",{scope:N.default.Scope.INLINE}),p=new w.ColorAttributor("background","background-color",{scope:N.default.Scope.INLINE});c.BackgroundClass=f,c.BackgroundStyle=p},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.DirectionStyle=c.DirectionClass=c.DirectionAttribute=void 0;var x=h(0),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}var g={scope:N.default.Scope.BLOCK,whitelist:["rtl"]},f=new N.default.Attributor.Attribute("direction","dir",g),p=new N.default.Attributor.Class("direction","ql-direction",g),i=new N.default.Attributor.Style("direction","direction",g);c.DirectionAttribute=f,c.DirectionClass=p,c.DirectionStyle=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.FontClass=c.FontStyle=void 0;var x=function(){function o(n,m){for(var a=0;a<m.length;a++){var u=m[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}return function(n,m,a){return m&&o(n.prototype,m),a&&o(n,a),n}}(),N=function o(n,m,a){n===null&&(n=Function.prototype);var u=Object.getOwnPropertyDescriptor(n,m);if(u===void 0){var j=Object.getPrototypeOf(n);return j===null?void 0:o(j,m,a)}else{if("value"in u)return u.value;var E=u.get;return E===void 0?void 0:E.call(a)}},w=h(0),g=f(w);function f(o){return o&&o.__esModule?o:{default:o}}function p(o,n){if(!(o instanceof n))throw new TypeError("Cannot call a class as a function")}function i(o,n){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&(typeof n=="object"||typeof n=="function")?n:o}function t(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof n);o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(o,n):o.__proto__=n)}var r={scope:g.default.Scope.INLINE,whitelist:["serif","monospace"]},d=new g.default.Attributor.Class("font","ql-font",r),s=function(o){t(n,o);function n(){return p(this,n),i(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return x(n,[{key:"value",value:function(a){return N(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"value",this).call(this,a).replace(/["']/g,"")}}]),n}(g.default.Attributor.Style),l=new s("font","font-family",r);c.FontStyle=l,c.FontClass=d},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.SizeStyle=c.SizeClass=void 0;var x=h(0),N=w(x);function w(p){return p&&p.__esModule?p:{default:p}}var g=new N.default.Attributor.Class("size","ql-size",{scope:N.default.Scope.INLINE,whitelist:["small","large","huge"]}),f=new N.default.Attributor.Style("size","font-size",{scope:N.default.Scope.INLINE,whitelist:["10px","18px","32px"]});c.SizeClass=g,c.SizeStyle=f},function(v,c,h){v.exports={align:{"":h(76),center:h(77),right:h(78),justify:h(79)},background:h(80),blockquote:h(81),bold:h(82),clean:h(83),code:h(58),"code-block":h(58),color:h(84),direction:{"":h(85),rtl:h(86)},float:{center:h(87),full:h(88),left:h(89),right:h(90)},formula:h(91),header:{1:h(92),2:h(93)},italic:h(94),image:h(95),indent:{"+1":h(96),"-1":h(97)},link:h(98),list:{ordered:h(99),bullet:h(100),check:h(101)},script:{sub:h(102),super:h(103)},strike:h(104),underline:h(105),video:h(106)}},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.getLastChangeIndex=c.default=void 0;var x=function(){function m(a,u){for(var j=0;j<u.length;j++){var E=u[j];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(a,E.key,E)}}return function(a,u,j){return u&&m(a.prototype,u),j&&m(a,j),a}}(),N=h(0),w=t(N),g=h(5),f=t(g),p=h(9),i=t(p);function t(m){return m&&m.__esModule?m:{default:m}}function r(m,a){if(!(m instanceof a))throw new TypeError("Cannot call a class as a function")}function d(m,a){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:m}function s(m,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);m.prototype=Object.create(a&&a.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(m,a):m.__proto__=a)}var l=function(m){s(a,m);function a(u,j){r(this,a);var E=d(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,u,j));return E.lastRecorded=0,E.ignoreChange=!1,E.clear(),E.quill.on(f.default.events.EDITOR_CHANGE,function(S,D,k,_){S!==f.default.events.TEXT_CHANGE||E.ignoreChange||(!E.options.userOnly||_===f.default.sources.USER?E.record(D,k):E.transform(D))}),E.quill.keyboard.addBinding({key:"Z",shortKey:!0},E.undo.bind(E)),E.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},E.redo.bind(E)),/Win/i.test(navigator.platform)&&E.quill.keyboard.addBinding({key:"Y",shortKey:!0},E.redo.bind(E)),E}return x(a,[{key:"change",value:function(j,E){if(this.stack[j].length!==0){var S=this.stack[j].pop();this.stack[E].push(S),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(S[j],f.default.sources.USER),this.ignoreChange=!1;var D=n(S[j]);this.quill.setSelection(D)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(j,E){if(j.ops.length!==0){this.stack.redo=[];var S=this.quill.getContents().diff(E),D=Date.now();if(this.lastRecorded+this.options.delay>D&&this.stack.undo.length>0){var k=this.stack.undo.pop();S=S.compose(k.undo),j=k.redo.compose(j)}else this.lastRecorded=D;this.stack.undo.push({redo:j,undo:S}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(j){this.stack.undo.forEach(function(E){E.undo=j.transform(E.undo,!0),E.redo=j.transform(E.redo,!0)}),this.stack.redo.forEach(function(E){E.undo=j.transform(E.undo,!0),E.redo=j.transform(E.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),a}(i.default);l.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function o(m){var a=m.ops[m.ops.length-1];return a==null?!1:a.insert!=null?typeof a.insert=="string"&&a.insert.endsWith(`
`):a.attributes!=null?Object.keys(a.attributes).some(function(u){return w.default.query(u,w.default.Scope.BLOCK)!=null}):!1}function n(m){var a=m.reduce(function(j,E){return j+=E.delete||0,j},0),u=m.length()-a;return o(m)&&(u-=1),u}c.default=l,c.getLastChangeIndex=n},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.BaseTooltip=void 0;var x=function(){function O(I,$){for(var F=0;F<$.length;F++){var R=$[F];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(I,R.key,R)}}return function(I,$,F){return $&&O(I.prototype,$),F&&O(I,F),I}}(),N=function O(I,$,F){I===null&&(I=Function.prototype);var R=Object.getOwnPropertyDescriptor(I,$);if(R===void 0){var L=Object.getPrototypeOf(I);return L===null?void 0:O(L,$,F)}else{if("value"in R)return R.value;var U=R.get;return U===void 0?void 0:U.call(F)}},w=h(3),g=D(w),f=h(2),p=D(f),i=h(8),t=D(i),r=h(23),d=D(r),s=h(34),l=D(s),o=h(59),n=D(o),m=h(60),a=D(m),u=h(28),j=D(u),E=h(61),S=D(E);function D(O){return O&&O.__esModule?O:{default:O}}function k(O,I){if(!(O instanceof I))throw new TypeError("Cannot call a class as a function")}function _(O,I){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:O}function y(O,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);O.prototype=Object.create(I&&I.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(O,I):O.__proto__=I)}var C=[!1,"center","right","justify"],T=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],q=[!1,"serif","monospace"],G=["1","2","3",!1],Y=["small",!1,"large","huge"],te=function(O){y(I,O);function I($,F){k(this,I);var R=_(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,$,F)),L=function U(B){if(!document.body.contains($.root))return document.body.removeEventListener("click",U);R.tooltip!=null&&!R.tooltip.root.contains(B.target)&&document.activeElement!==R.tooltip.textbox&&!R.quill.hasFocus()&&R.tooltip.hide(),R.pickers!=null&&R.pickers.forEach(function(W){W.container.contains(B.target)||W.close()})};return $.emitter.listenDOM("click",document.body,L),R}return x(I,[{key:"addModule",value:function(F){var R=N(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"addModule",this).call(this,F);return F==="toolbar"&&this.extendToolbar(R),R}},{key:"buildButtons",value:function(F,R){F.forEach(function(L){var U=L.getAttribute("class")||"";U.split(/\s+/).forEach(function(B){if(B.startsWith("ql-")&&(B=B.slice(3),R[B]!=null))if(B==="direction")L.innerHTML=R[B][""]+R[B].rtl;else if(typeof R[B]=="string")L.innerHTML=R[B];else{var W=L.value||"";W!=null&&R[B][W]&&(L.innerHTML=R[B][W])}})})}},{key:"buildPickers",value:function(F,R){var L=this;this.pickers=F.map(function(B){if(B.classList.contains("ql-align"))return B.querySelector("option")==null&&P(B,C),new a.default(B,R.align);if(B.classList.contains("ql-background")||B.classList.contains("ql-color")){var W=B.classList.contains("ql-background")?"background":"color";return B.querySelector("option")==null&&P(B,T,W==="background"?"#ffffff":"#000000"),new n.default(B,R[W])}else return B.querySelector("option")==null&&(B.classList.contains("ql-font")?P(B,q):B.classList.contains("ql-header")?P(B,G):B.classList.contains("ql-size")&&P(B,Y)),new j.default(B)});var U=function(){L.pickers.forEach(function(W){W.update()})};this.quill.on(t.default.events.EDITOR_CHANGE,U)}}]),I}(l.default);te.DEFAULTS=(0,g.default)(!0,{},l.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var I=this,$=this.container.querySelector("input.ql-image[type=file]");$==null&&($=document.createElement("input"),$.setAttribute("type","file"),$.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),$.classList.add("ql-image"),$.addEventListener("change",function(){if($.files!=null&&$.files[0]!=null){var F=new FileReader;F.onload=function(R){var L=I.quill.getSelection(!0);I.quill.updateContents(new p.default().retain(L.index).delete(L.length).insert({image:R.target.result}),t.default.sources.USER),I.quill.setSelection(L.index+1,t.default.sources.SILENT),$.value=""},F.readAsDataURL($.files[0])}}),this.container.appendChild($)),$.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var K=function(O){y(I,O);function I($,F){k(this,I);var R=_(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,$,F));return R.textbox=R.root.querySelector('input[type="text"]'),R.listen(),R}return x(I,[{key:"listen",value:function(){var F=this;this.textbox.addEventListener("keydown",function(R){d.default.match(R,"enter")?(F.save(),R.preventDefault()):d.default.match(R,"escape")&&(F.cancel(),R.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),R!=null?this.textbox.value=R:F!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+F)||""),this.root.setAttribute("data-mode",F)}},{key:"restoreFocus",value:function(){var F=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=F}},{key:"save",value:function(){var F=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var R=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",F,t.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",F,t.default.sources.USER)),this.quill.root.scrollTop=R;break}case"video":F=M(F);case"formula":{if(!F)break;var L=this.quill.getSelection(!0);if(L!=null){var U=L.index+L.length;this.quill.insertEmbed(U,this.root.getAttribute("data-mode"),F,t.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(U+1," ",t.default.sources.USER),this.quill.setSelection(U+2,t.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),I}(S.default);function M(O){var I=O.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||O.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return I?(I[1]||"https")+"://www.youtube.com/embed/"+I[2]+"?showinfo=0":(I=O.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(I[1]||"https")+"://player.vimeo.com/video/"+I[2]+"/":O}function P(O,I){var $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;I.forEach(function(F){var R=document.createElement("option");F===$?R.setAttribute("selected","selected"):R.setAttribute("value",F),O.appendChild(R)})}c.BaseTooltip=K,c.default=te},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function N(){this.head=this.tail=null,this.length=0}return N.prototype.append=function(){for(var w=[],g=0;g<arguments.length;g++)w[g]=arguments[g];this.insertBefore(w[0],null),w.length>1&&this.append.apply(this,w.slice(1))},N.prototype.contains=function(w){for(var g,f=this.iterator();g=f();)if(g===w)return!0;return!1},N.prototype.insertBefore=function(w,g){w&&(w.next=g,g!=null?(w.prev=g.prev,g.prev!=null&&(g.prev.next=w),g.prev=w,g===this.head&&(this.head=w)):this.tail!=null?(this.tail.next=w,w.prev=this.tail,this.tail=w):(w.prev=null,this.head=this.tail=w),this.length+=1)},N.prototype.offset=function(w){for(var g=0,f=this.head;f!=null;){if(f===w)return g;g+=f.length(),f=f.next}return-1},N.prototype.remove=function(w){this.contains(w)&&(w.prev!=null&&(w.prev.next=w.next),w.next!=null&&(w.next.prev=w.prev),w===this.head&&(this.head=w.next),w===this.tail&&(this.tail=w.prev),this.length-=1)},N.prototype.iterator=function(w){return w===void 0&&(w=this.head),function(){var g=w;return w!=null&&(w=w.next),g}},N.prototype.find=function(w,g){g===void 0&&(g=!1);for(var f,p=this.iterator();f=p();){var i=f.length();if(w<i||g&&w===i&&(f.next==null||f.next.length()!==0))return[f,w];w-=i}return[null,0]},N.prototype.forEach=function(w){for(var g,f=this.iterator();g=f();)w(g)},N.prototype.forEachAt=function(w,g,f){if(!(g<=0))for(var p=this.find(w),i=p[0],t=p[1],r,d=w-t,s=this.iterator(i);(r=s())&&d<w+g;){var l=r.length();w>d?f(r,w-d,Math.min(g,d+l-w)):f(r,0,Math.min(l,w+g-d)),d+=l}},N.prototype.map=function(w){return this.reduce(function(g,f){return g.push(w(f)),g},[])},N.prototype.reduce=function(w,g){for(var f,p=this.iterator();f=p();)g=w(g,f);return g},N}();c.default=x},function(v,c,h){var x=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var d in r)r.hasOwnProperty(d)&&(t[d]=r[d])};return function(t,r){i(t,r);function d(){this.constructor=t}t.prototype=r===null?Object.create(r):(d.prototype=r.prototype,new d)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(17),w=h(1),g={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},f=100,p=function(i){x(t,i);function t(r){var d=i.call(this,r)||this;return d.scroll=d,d.observer=new MutationObserver(function(s){d.update(s)}),d.observer.observe(d.domNode,g),d.attach(),d}return t.prototype.detach=function(){i.prototype.detach.call(this),this.observer.disconnect()},t.prototype.deleteAt=function(r,d){this.update(),r===0&&d===this.length()?this.children.forEach(function(s){s.remove()}):i.prototype.deleteAt.call(this,r,d)},t.prototype.formatAt=function(r,d,s,l){this.update(),i.prototype.formatAt.call(this,r,d,s,l)},t.prototype.insertAt=function(r,d,s){this.update(),i.prototype.insertAt.call(this,r,d,s)},t.prototype.optimize=function(r,d){var s=this;r===void 0&&(r=[]),d===void 0&&(d={}),i.prototype.optimize.call(this,d);for(var l=[].slice.call(this.observer.takeRecords());l.length>0;)r.push(l.pop());for(var o=function(u,j){j===void 0&&(j=!0),!(u==null||u===s)&&u.domNode.parentNode!=null&&(u.domNode[w.DATA_KEY].mutations==null&&(u.domNode[w.DATA_KEY].mutations=[]),j&&o(u.parent))},n=function(u){u.domNode[w.DATA_KEY]==null||u.domNode[w.DATA_KEY].mutations==null||(u instanceof N.default&&u.children.forEach(n),u.optimize(d))},m=r,a=0;m.length>0;a+=1){if(a>=f)throw new Error("[Parchment] Maximum optimize iterations reached");for(m.forEach(function(u){var j=w.find(u.target,!0);j!=null&&(j.domNode===u.target&&(u.type==="childList"?(o(w.find(u.previousSibling,!1)),[].forEach.call(u.addedNodes,function(E){var S=w.find(E,!1);o(S,!1),S instanceof N.default&&S.children.forEach(function(D){o(D,!1)})})):u.type==="attributes"&&o(j.prev)),o(j))}),this.children.forEach(n),m=[].slice.call(this.observer.takeRecords()),l=m.slice();l.length>0;)r.push(l.pop())}},t.prototype.update=function(r,d){var s=this;d===void 0&&(d={}),r=r||this.observer.takeRecords(),r.map(function(l){var o=w.find(l.target,!0);return o==null?null:o.domNode[w.DATA_KEY].mutations==null?(o.domNode[w.DATA_KEY].mutations=[l],o):(o.domNode[w.DATA_KEY].mutations.push(l),null)}).forEach(function(l){l==null||l===s||l.domNode[w.DATA_KEY]==null||l.update(l.domNode[w.DATA_KEY].mutations||[],d)}),this.domNode[w.DATA_KEY].mutations!=null&&i.prototype.update.call(this,this.domNode[w.DATA_KEY].mutations,d),this.optimize(r,d)},t.blotName="scroll",t.defaultChild="block",t.scope=w.Scope.BLOCK_BLOT,t.tagName="DIV",t}(N.default);c.default=p},function(v,c,h){var x=this&&this.__extends||function(){var p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r])};return function(i,t){p(i,t);function r(){this.constructor=i}i.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(18),w=h(1);function g(p,i){if(Object.keys(p).length!==Object.keys(i).length)return!1;for(var t in p)if(p[t]!==i[t])return!1;return!0}var f=function(p){x(i,p);function i(){return p!==null&&p.apply(this,arguments)||this}return i.formats=function(t){if(t.tagName!==i.tagName)return p.formats.call(this,t)},i.prototype.format=function(t,r){var d=this;t===this.statics.blotName&&!r?(this.children.forEach(function(s){s instanceof N.default||(s=s.wrap(i.blotName,!0)),d.attributes.copy(s)}),this.unwrap()):p.prototype.format.call(this,t,r)},i.prototype.formatAt=function(t,r,d,s){if(this.formats()[d]!=null||w.query(d,w.Scope.ATTRIBUTE)){var l=this.isolate(t,r);l.format(d,s)}else p.prototype.formatAt.call(this,t,r,d,s)},i.prototype.optimize=function(t){p.prototype.optimize.call(this,t);var r=this.formats();if(Object.keys(r).length===0)return this.unwrap();var d=this.next;d instanceof i&&d.prev===this&&g(r,d.formats())&&(d.moveChildren(this),d.remove())},i.blotName="inline",i.scope=w.Scope.INLINE_BLOT,i.tagName="SPAN",i}(N.default);c.default=f},function(v,c,h){var x=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,i){p.__proto__=i}||function(p,i){for(var t in i)i.hasOwnProperty(t)&&(p[t]=i[t])};return function(p,i){f(p,i);function t(){this.constructor=p}p.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(18),w=h(1),g=function(f){x(p,f);function p(){return f!==null&&f.apply(this,arguments)||this}return p.formats=function(i){var t=w.query(p.blotName).tagName;if(i.tagName!==t)return f.formats.call(this,i)},p.prototype.format=function(i,t){w.query(i,w.Scope.BLOCK)!=null&&(i===this.statics.blotName&&!t?this.replaceWith(p.blotName):f.prototype.format.call(this,i,t))},p.prototype.formatAt=function(i,t,r,d){w.query(r,w.Scope.BLOCK)!=null?this.format(r,d):f.prototype.formatAt.call(this,i,t,r,d)},p.prototype.insertAt=function(i,t,r){if(r==null||w.query(t,w.Scope.INLINE)!=null)f.prototype.insertAt.call(this,i,t,r);else{var d=this.split(i),s=w.create(t,r);d.parent.insertBefore(s,d)}},p.prototype.update=function(i,t){navigator.userAgent.match(/Trident/)?this.build():f.prototype.update.call(this,i,t)},p.blotName="block",p.scope=w.Scope.BLOCK_BLOT,p.tagName="P",p}(N.default);c.default=g},function(v,c,h){var x=this&&this.__extends||function(){var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,p){f.__proto__=p}||function(f,p){for(var i in p)p.hasOwnProperty(i)&&(f[i]=p[i])};return function(f,p){g(f,p);function i(){this.constructor=f}f.prototype=p===null?Object.create(p):(i.prototype=p.prototype,new i)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(19),w=function(g){x(f,g);function f(){return g!==null&&g.apply(this,arguments)||this}return f.formats=function(p){},f.prototype.format=function(p,i){g.prototype.formatAt.call(this,0,this.length(),p,i)},f.prototype.formatAt=function(p,i,t,r){p===0&&i===this.length()?this.format(t,r):g.prototype.formatAt.call(this,p,i,t,r)},f.prototype.formats=function(){return this.statics.formats(this.domNode)},f}(N.default);c.default=w},function(v,c,h){var x=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,i){p.__proto__=i}||function(p,i){for(var t in i)i.hasOwnProperty(t)&&(p[t]=i[t])};return function(p,i){f(p,i);function t(){this.constructor=p}p.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}}();Object.defineProperty(c,"__esModule",{value:!0});var N=h(19),w=h(1),g=function(f){x(p,f);function p(i){var t=f.call(this,i)||this;return t.text=t.statics.value(t.domNode),t}return p.create=function(i){return document.createTextNode(i)},p.value=function(i){var t=i.data;return t.normalize&&(t=t.normalize()),t},p.prototype.deleteAt=function(i,t){this.domNode.data=this.text=this.text.slice(0,i)+this.text.slice(i+t)},p.prototype.index=function(i,t){return this.domNode===i?t:-1},p.prototype.insertAt=function(i,t,r){r==null?(this.text=this.text.slice(0,i)+t+this.text.slice(i),this.domNode.data=this.text):f.prototype.insertAt.call(this,i,t,r)},p.prototype.length=function(){return this.text.length},p.prototype.optimize=function(i){f.prototype.optimize.call(this,i),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof p&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},p.prototype.position=function(i,t){return[this.domNode,i]},p.prototype.split=function(i,t){if(t===void 0&&(t=!1),!t){if(i===0)return this;if(i===this.length())return this.next}var r=w.create(this.domNode.splitText(i));return this.parent.insertBefore(r,this.next),this.text=this.statics.value(this.domNode),r},p.prototype.update=function(i,t){var r=this;i.some(function(d){return d.type==="characterData"&&d.target===r.domNode})&&(this.text=this.statics.value(this.domNode))},p.prototype.value=function(){return this.text},p.blotName="text",p.scope=w.Scope.INLINE_BLOT,p}(N.default);c.default=g},function(v,c,h){var x=document.createElement("div");if(x.classList.toggle("test-class",!1),x.classList.contains("test-class")){var N=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(w,g){return arguments.length>1&&!this.contains(w)==!g?g:N.call(this,w)}}String.prototype.startsWith||(String.prototype.startsWith=function(w,g){return g=g||0,this.substr(g,w.length)===w}),String.prototype.endsWith||(String.prototype.endsWith=function(w,g){var f=this.toString();(typeof g!="number"||!isFinite(g)||Math.floor(g)!==g||g>f.length)&&(g=f.length),g-=w.length;var p=f.indexOf(w,g);return p!==-1&&p===g}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(g){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof g!="function")throw new TypeError("predicate must be a function");for(var f=Object(this),p=f.length>>>0,i=arguments[1],t,r=0;r<p;r++)if(t=f[r],g.call(i,t,r,f))return t}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(v,c){var h=-1,x=1,N=0;function w(a,u,j){if(a==u)return a?[[N,a]]:[];(j<0||a.length<j)&&(j=null);var E=i(a,u),S=a.substring(0,E);a=a.substring(E),u=u.substring(E),E=t(a,u);var D=a.substring(a.length-E);a=a.substring(0,a.length-E),u=u.substring(0,u.length-E);var k=g(a,u);return S&&k.unshift([N,S]),D&&k.push([N,D]),d(k),j!=null&&(k=o(k,j)),k=n(k),k}function g(a,u){var j;if(!a)return[[x,u]];if(!u)return[[h,a]];var E=a.length>u.length?a:u,S=a.length>u.length?u:a,D=E.indexOf(S);if(D!=-1)return j=[[x,E.substring(0,D)],[N,S],[x,E.substring(D+S.length)]],a.length>u.length&&(j[0][0]=j[2][0]=h),j;if(S.length==1)return[[h,a],[x,u]];var k=r(a,u);if(k){var _=k[0],y=k[1],C=k[2],T=k[3],q=k[4],G=w(_,C),Y=w(y,T);return G.concat([[N,q]],Y)}return f(a,u)}function f(a,u){for(var j=a.length,E=u.length,S=Math.ceil((j+E)/2),D=S,k=2*S,_=new Array(k),y=new Array(k),C=0;C<k;C++)_[C]=-1,y[C]=-1;_[D+1]=0,y[D+1]=0;for(var T=j-E,q=T%2!=0,G=0,Y=0,te=0,K=0,M=0;M<S;M++){for(var P=-M+G;P<=M-Y;P+=2){var O=D+P,I;P==-M||P!=M&&_[O-1]<_[O+1]?I=_[O+1]:I=_[O-1]+1;for(var $=I-P;I<j&&$<E&&a.charAt(I)==u.charAt($);)I++,$++;if(_[O]=I,I>j)Y+=2;else if($>E)G+=2;else if(q){var F=D+T-P;if(F>=0&&F<k&&y[F]!=-1){var R=j-y[F];if(I>=R)return p(a,u,I,$)}}}for(var L=-M+te;L<=M-K;L+=2){var F=D+L,R;L==-M||L!=M&&y[F-1]<y[F+1]?R=y[F+1]:R=y[F-1]+1;for(var U=R-L;R<j&&U<E&&a.charAt(j-R-1)==u.charAt(E-U-1);)R++,U++;if(y[F]=R,R>j)K+=2;else if(U>E)te+=2;else if(!q){var O=D+T-L;if(O>=0&&O<k&&_[O]!=-1){var I=_[O],$=D+I-O;if(R=j-R,I>=R)return p(a,u,I,$)}}}}return[[h,a],[x,u]]}function p(a,u,j,E){var S=a.substring(0,j),D=u.substring(0,E),k=a.substring(j),_=u.substring(E),y=w(S,D),C=w(k,_);return y.concat(C)}function i(a,u){if(!a||!u||a.charAt(0)!=u.charAt(0))return 0;for(var j=0,E=Math.min(a.length,u.length),S=E,D=0;j<S;)a.substring(D,S)==u.substring(D,S)?(j=S,D=j):E=S,S=Math.floor((E-j)/2+j);return S}function t(a,u){if(!a||!u||a.charAt(a.length-1)!=u.charAt(u.length-1))return 0;for(var j=0,E=Math.min(a.length,u.length),S=E,D=0;j<S;)a.substring(a.length-S,a.length-D)==u.substring(u.length-S,u.length-D)?(j=S,D=j):E=S,S=Math.floor((E-j)/2+j);return S}function r(a,u){var j=a.length>u.length?a:u,E=a.length>u.length?u:a;if(j.length<4||E.length*2<j.length)return null;function S(Y,te,K){for(var M=Y.substring(K,K+Math.floor(Y.length/4)),P=-1,O="",I,$,F,R;(P=te.indexOf(M,P+1))!=-1;){var L=i(Y.substring(K),te.substring(P)),U=t(Y.substring(0,K),te.substring(0,P));O.length<U+L&&(O=te.substring(P-U,P)+te.substring(P,P+L),I=Y.substring(0,K-U),$=Y.substring(K+L),F=te.substring(0,P-U),R=te.substring(P+L))}return O.length*2>=Y.length?[I,$,F,R,O]:null}var D=S(j,E,Math.ceil(j.length/4)),k=S(j,E,Math.ceil(j.length/2)),_;if(!D&&!k)return null;k?D?_=D[4].length>k[4].length?D:k:_=k:_=D;var y,C,T,q;a.length>u.length?(y=_[0],C=_[1],T=_[2],q=_[3]):(T=_[0],q=_[1],y=_[2],C=_[3]);var G=_[4];return[y,C,T,q,G]}function d(a){a.push([N,""]);for(var u=0,j=0,E=0,S="",D="",k;u<a.length;)switch(a[u][0]){case x:E++,D+=a[u][1],u++;break;case h:j++,S+=a[u][1],u++;break;case N:j+E>1?(j!==0&&E!==0&&(k=i(D,S),k!==0&&(u-j-E>0&&a[u-j-E-1][0]==N?a[u-j-E-1][1]+=D.substring(0,k):(a.splice(0,0,[N,D.substring(0,k)]),u++),D=D.substring(k),S=S.substring(k)),k=t(D,S),k!==0&&(a[u][1]=D.substring(D.length-k)+a[u][1],D=D.substring(0,D.length-k),S=S.substring(0,S.length-k))),j===0?a.splice(u-E,j+E,[x,D]):E===0?a.splice(u-j,j+E,[h,S]):a.splice(u-j-E,j+E,[h,S],[x,D]),u=u-j-E+(j?1:0)+(E?1:0)+1):u!==0&&a[u-1][0]==N?(a[u-1][1]+=a[u][1],a.splice(u,1)):u++,E=0,j=0,S="",D="";break}a[a.length-1][1]===""&&a.pop();var _=!1;for(u=1;u<a.length-1;)a[u-1][0]==N&&a[u+1][0]==N&&(a[u][1].substring(a[u][1].length-a[u-1][1].length)==a[u-1][1]?(a[u][1]=a[u-1][1]+a[u][1].substring(0,a[u][1].length-a[u-1][1].length),a[u+1][1]=a[u-1][1]+a[u+1][1],a.splice(u-1,1),_=!0):a[u][1].substring(0,a[u+1][1].length)==a[u+1][1]&&(a[u-1][1]+=a[u+1][1],a[u][1]=a[u][1].substring(a[u+1][1].length)+a[u+1][1],a.splice(u+1,1),_=!0)),u++;_&&d(a)}var s=w;s.INSERT=x,s.DELETE=h,s.EQUAL=N,v.exports=s;function l(a,u){if(u===0)return[N,a];for(var j=0,E=0;E<a.length;E++){var S=a[E];if(S[0]===h||S[0]===N){var D=j+S[1].length;if(u===D)return[E+1,a];if(u<D){a=a.slice();var k=u-j,_=[S[0],S[1].slice(0,k)],y=[S[0],S[1].slice(k)];return a.splice(E,1,_,y),[E+1,a]}else j=D}}throw new Error("cursor_pos is out of bounds!")}function o(a,u){var j=l(a,u),E=j[1],S=j[0],D=E[S],k=E[S+1];if(D==null)return a;if(D[0]!==N)return a;if(k!=null&&D[1]+k[1]===k[1]+D[1])return E.splice(S,2,k,D),m(E,S,2);if(k!=null&&k[1].indexOf(D[1])===0){E.splice(S,2,[k[0],D[1]],[0,D[1]]);var _=k[1].slice(D[1].length);return _.length>0&&E.splice(S+2,0,[k[0],_]),m(E,S,3)}else return a}function n(a){for(var u=!1,j=function(k){return k.charCodeAt(0)>=56320&&k.charCodeAt(0)<=57343},E=function(k){return k.charCodeAt(k.length-1)>=55296&&k.charCodeAt(k.length-1)<=56319},S=2;S<a.length;S+=1)a[S-2][0]===N&&E(a[S-2][1])&&a[S-1][0]===h&&j(a[S-1][1])&&a[S][0]===x&&j(a[S][1])&&(u=!0,a[S-1][1]=a[S-2][1].slice(-1)+a[S-1][1],a[S][1]=a[S-2][1].slice(-1)+a[S][1],a[S-2][1]=a[S-2][1].slice(0,-1));if(!u)return a;for(var D=[],S=0;S<a.length;S+=1)a[S][1].length>0&&D.push(a[S]);return D}function m(a,u,j){for(var E=u+j-1;E>=0&&E>=u-1;E--)if(E+1<a.length){var S=a[E],D=a[E+1];S[0]===D[1]&&a.splice(E,2,[S[0],S[1]+D[1]])}return a}},function(v,c){c=v.exports=typeof Object.keys=="function"?Object.keys:h,c.shim=h;function h(x){var N=[];for(var w in x)N.push(w);return N}},function(v,c){var h=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";c=v.exports=h?x:N,c.supported=x;function x(w){return Object.prototype.toString.call(w)=="[object Arguments]"}c.unsupported=N;function N(w){return w&&typeof w=="object"&&typeof w.length=="number"&&Object.prototype.hasOwnProperty.call(w,"callee")&&!Object.prototype.propertyIsEnumerable.call(w,"callee")||!1}},function(v,c){var h=Object.prototype.hasOwnProperty,x="~";function N(){}Object.create&&(N.prototype=Object.create(null),new N().__proto__||(x=!1));function w(f,p,i){this.fn=f,this.context=p,this.once=i||!1}function g(){this._events=new N,this._eventsCount=0}g.prototype.eventNames=function(){var p=[],i,t;if(this._eventsCount===0)return p;for(t in i=this._events)h.call(i,t)&&p.push(x?t.slice(1):t);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(i)):p},g.prototype.listeners=function(p,i){var t=x?x+p:p,r=this._events[t];if(i)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var d=0,s=r.length,l=new Array(s);d<s;d++)l[d]=r[d].fn;return l},g.prototype.emit=function(p,i,t,r,d,s){var l=x?x+p:p;if(!this._events[l])return!1;var o=this._events[l],n=arguments.length,m,a;if(o.fn){switch(o.once&&this.removeListener(p,o.fn,void 0,!0),n){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,i),!0;case 3:return o.fn.call(o.context,i,t),!0;case 4:return o.fn.call(o.context,i,t,r),!0;case 5:return o.fn.call(o.context,i,t,r,d),!0;case 6:return o.fn.call(o.context,i,t,r,d,s),!0}for(a=1,m=new Array(n-1);a<n;a++)m[a-1]=arguments[a];o.fn.apply(o.context,m)}else{var u=o.length,j;for(a=0;a<u;a++)switch(o[a].once&&this.removeListener(p,o[a].fn,void 0,!0),n){case 1:o[a].fn.call(o[a].context);break;case 2:o[a].fn.call(o[a].context,i);break;case 3:o[a].fn.call(o[a].context,i,t);break;case 4:o[a].fn.call(o[a].context,i,t,r);break;default:if(!m)for(j=1,m=new Array(n-1);j<n;j++)m[j-1]=arguments[j];o[a].fn.apply(o[a].context,m)}}return!0},g.prototype.on=function(p,i,t){var r=new w(i,t||this),d=x?x+p:p;return this._events[d]?this._events[d].fn?this._events[d]=[this._events[d],r]:this._events[d].push(r):(this._events[d]=r,this._eventsCount++),this},g.prototype.once=function(p,i,t){var r=new w(i,t||this,!0),d=x?x+p:p;return this._events[d]?this._events[d].fn?this._events[d]=[this._events[d],r]:this._events[d].push(r):(this._events[d]=r,this._eventsCount++),this},g.prototype.removeListener=function(p,i,t,r){var d=x?x+p:p;if(!this._events[d])return this;if(!i)return--this._eventsCount===0?this._events=new N:delete this._events[d],this;var s=this._events[d];if(s.fn)s.fn===i&&(!r||s.once)&&(!t||s.context===t)&&(--this._eventsCount===0?this._events=new N:delete this._events[d]);else{for(var l=0,o=[],n=s.length;l<n;l++)(s[l].fn!==i||r&&!s[l].once||t&&s[l].context!==t)&&o.push(s[l]);o.length?this._events[d]=o.length===1?o[0]:o:--this._eventsCount===0?this._events=new N:delete this._events[d]}return this},g.prototype.removeAllListeners=function(p){var i;return p?(i=x?x+p:p,this._events[i]&&(--this._eventsCount===0?this._events=new N:delete this._events[i])):(this._events=new N,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prototype.setMaxListeners=function(){return this},g.prefixed=x,g.EventEmitter=g,typeof v<"u"&&(v.exports=g)},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.matchText=c.matchSpacing=c.matchNewline=c.matchBlot=c.matchAttributor=c.default=void 0;var x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},N=function(){function Q(X,se){var le=[],z=!0,ae=!1,ce=void 0;try{for(var oe=X[Symbol.iterator](),pe;!(z=(pe=oe.next()).done)&&(le.push(pe.value),!(se&&le.length===se));z=!0);}catch(ve){ae=!0,ce=ve}finally{try{!z&&oe.return&&oe.return()}finally{if(ae)throw ce}}return le}return function(X,se){if(Array.isArray(X))return X;if(Symbol.iterator in Object(X))return Q(X,se);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=function(){function Q(X,se){for(var le=0;le<se.length;le++){var z=se[le];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(X,z.key,z)}}return function(X,se,le){return se&&Q(X.prototype,se),le&&Q(X,le),X}}(),g=h(3),f=y(g),p=h(2),i=y(p),t=h(0),r=y(t),d=h(5),s=y(d),l=h(10),o=y(l),n=h(9),m=y(n),a=h(36),u=h(37),j=h(13),E=y(j),S=h(26),D=h(38),k=h(39),_=h(40);function y(Q){return Q&&Q.__esModule?Q:{default:Q}}function C(Q,X,se){return X in Q?Object.defineProperty(Q,X,{value:se,enumerable:!0,configurable:!0,writable:!0}):Q[X]=se,Q}function T(Q,X){if(!(Q instanceof X))throw new TypeError("Cannot call a class as a function")}function q(Q,X){if(!Q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return X&&(typeof X=="object"||typeof X=="function")?X:Q}function G(Q,X){if(typeof X!="function"&&X!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof X);Q.prototype=Object.create(X&&X.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),X&&(Object.setPrototypeOf?Object.setPrototypeOf(Q,X):Q.__proto__=X)}var Y=(0,o.default)("quill:clipboard"),te="__ql-matcher",K=[[Node.TEXT_NODE,he],[Node.TEXT_NODE,V],["br",ie],[Node.ELEMENT_NODE,V],[Node.ELEMENT_NODE,W],[Node.ELEMENT_NODE,ne],[Node.ELEMENT_NODE,B],[Node.ELEMENT_NODE,de],["li",ee],["b",U.bind(U,"bold")],["i",U.bind(U,"italic")],["style",ue]],M=[a.AlignAttribute,D.DirectionAttribute].reduce(function(Q,X){return Q[X.keyName]=X,Q},{}),P=[a.AlignStyle,u.BackgroundStyle,S.ColorStyle,D.DirectionStyle,k.FontStyle,_.SizeStyle].reduce(function(Q,X){return Q[X.keyName]=X,Q},{}),O=function(Q){G(X,Q);function X(se,le){T(this,X);var z=q(this,(X.__proto__||Object.getPrototypeOf(X)).call(this,se,le));return z.quill.root.addEventListener("paste",z.onPaste.bind(z)),z.container=z.quill.addContainer("ql-clipboard"),z.container.setAttribute("contenteditable",!0),z.container.setAttribute("tabindex",-1),z.matchers=[],K.concat(z.options.matchers).forEach(function(ae){var ce=N(ae,2),oe=ce[0],pe=ce[1];!le.matchVisual&&pe===ne||z.addMatcher(oe,pe)}),z}return w(X,[{key:"addMatcher",value:function(le,z){this.matchers.push([le,z])}},{key:"convert",value:function(le){if(typeof le=="string")return this.container.innerHTML=le.replace(/\>\r?\n +\</g,"><"),this.convert();var z=this.quill.getFormat(this.quill.selection.savedRange.index);if(z[E.default.blotName]){var ae=this.container.innerText;return this.container.innerHTML="",new i.default().insert(ae,C({},E.default.blotName,z[E.default.blotName]))}var ce=this.prepareMatching(),oe=N(ce,2),pe=oe[0],ve=oe[1],we=L(this.container,pe,ve);return F(we,`
`)&&we.ops[we.ops.length-1].attributes==null&&(we=we.compose(new i.default().retain(we.length()-1).delete(1))),Y.log("convert",this.container.innerHTML,we),this.container.innerHTML="",we}},{key:"dangerouslyPasteHTML",value:function(le,z){var ae=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s.default.sources.API;if(typeof le=="string")this.quill.setContents(this.convert(le),z),this.quill.setSelection(0,s.default.sources.SILENT);else{var ce=this.convert(z);this.quill.updateContents(new i.default().retain(le).concat(ce),ae),this.quill.setSelection(le+ce.length(),s.default.sources.SILENT)}}},{key:"onPaste",value:function(le){var z=this;if(!(le.defaultPrevented||!this.quill.isEnabled())){var ae=this.quill.getSelection(),ce=new i.default().retain(ae.index),oe=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(s.default.sources.SILENT),setTimeout(function(){ce=ce.concat(z.convert()).delete(ae.length),z.quill.updateContents(ce,s.default.sources.USER),z.quill.setSelection(ce.length()-ae.length,s.default.sources.SILENT),z.quill.scrollingContainer.scrollTop=oe,z.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var le=this,z=[],ae=[];return this.matchers.forEach(function(ce){var oe=N(ce,2),pe=oe[0],ve=oe[1];switch(pe){case Node.TEXT_NODE:ae.push(ve);break;case Node.ELEMENT_NODE:z.push(ve);break;default:[].forEach.call(le.container.querySelectorAll(pe),function(we){we[te]=we[te]||[],we[te].push(ve)});break}}),[z,ae]}}]),X}(m.default);O.DEFAULTS={matchers:[],matchVisual:!0};function I(Q,X,se){return(typeof X>"u"?"undefined":x(X))==="object"?Object.keys(X).reduce(function(le,z){return I(le,z,X[z])},Q):Q.reduce(function(le,z){return z.attributes&&z.attributes[X]?le.push(z):le.insert(z.insert,(0,f.default)({},C({},X,se),z.attributes))},new i.default)}function $(Q){if(Q.nodeType!==Node.ELEMENT_NODE)return{};var X="__ql-computed-style";return Q[X]||(Q[X]=window.getComputedStyle(Q))}function F(Q,X){for(var se="",le=Q.ops.length-1;le>=0&&se.length<X.length;--le){var z=Q.ops[le];if(typeof z.insert!="string")break;se=z.insert+se}return se.slice(-1*X.length)===X}function R(Q){if(Q.childNodes.length===0)return!1;var X=$(Q);return["block","list-item"].indexOf(X.display)>-1}function L(Q,X,se){return Q.nodeType===Q.TEXT_NODE?se.reduce(function(le,z){return z(Q,le)},new i.default):Q.nodeType===Q.ELEMENT_NODE?[].reduce.call(Q.childNodes||[],function(le,z){var ae=L(z,X,se);return z.nodeType===Q.ELEMENT_NODE&&(ae=X.reduce(function(ce,oe){return oe(z,ce)},ae),ae=(z[te]||[]).reduce(function(ce,oe){return oe(z,ce)},ae)),le.concat(ae)},new i.default):new i.default}function U(Q,X,se){return I(se,Q,!0)}function B(Q,X){var se=r.default.Attributor.Attribute.keys(Q),le=r.default.Attributor.Class.keys(Q),z=r.default.Attributor.Style.keys(Q),ae={};return se.concat(le).concat(z).forEach(function(ce){var oe=r.default.query(ce,r.default.Scope.ATTRIBUTE);oe!=null&&(ae[oe.attrName]=oe.value(Q),ae[oe.attrName])||(oe=M[ce],oe!=null&&(oe.attrName===ce||oe.keyName===ce)&&(ae[oe.attrName]=oe.value(Q)||void 0),oe=P[ce],oe!=null&&(oe.attrName===ce||oe.keyName===ce)&&(oe=P[ce],ae[oe.attrName]=oe.value(Q)||void 0))}),Object.keys(ae).length>0&&(X=I(X,ae)),X}function W(Q,X){var se=r.default.query(Q);if(se==null)return X;if(se.prototype instanceof r.default.Embed){var le={},z=se.value(Q);z!=null&&(le[se.blotName]=z,X=new i.default().insert(le,se.formats(Q)))}else typeof se.formats=="function"&&(X=I(X,se.blotName,se.formats(Q)));return X}function ie(Q,X){return F(X,`
`)||X.insert(`
`),X}function ue(){return new i.default}function ee(Q,X){var se=r.default.query(Q);if(se==null||se.blotName!=="list-item"||!F(X,`
`))return X;for(var le=-1,z=Q.parentNode;!z.classList.contains("ql-clipboard");)(r.default.query(z)||{}).blotName==="list"&&(le+=1),z=z.parentNode;return le<=0?X:X.compose(new i.default().retain(X.length()-1).retain(1,{indent:le}))}function V(Q,X){return F(X,`
`)||(R(Q)||X.length()>0&&Q.nextSibling&&R(Q.nextSibling))&&X.insert(`
`),X}function ne(Q,X){if(R(Q)&&Q.nextElementSibling!=null&&!F(X,`

`)){var se=Q.offsetHeight+parseFloat($(Q).marginTop)+parseFloat($(Q).marginBottom);Q.nextElementSibling.offsetTop>Q.offsetTop+se*1.5&&X.insert(`
`)}return X}function de(Q,X){var se={},le=Q.style||{};return le.fontStyle&&$(Q).fontStyle==="italic"&&(se.italic=!0),le.fontWeight&&($(Q).fontWeight.startsWith("bold")||parseInt($(Q).fontWeight)>=700)&&(se.bold=!0),Object.keys(se).length>0&&(X=I(X,se)),parseFloat(le.textIndent||0)>0&&(X=new i.default().insert("	").concat(X)),X}function he(Q,X){var se=Q.data;if(Q.parentNode.tagName==="O:P")return X.insert(se.trim());if(se.trim().length===0&&Q.parentNode.classList.contains("ql-clipboard"))return X;if(!$(Q.parentNode).whiteSpace.startsWith("pre")){var le=function(ae,ce){return ce=ce.replace(/[^\u00a0]/g,""),ce.length<1&&ae?" ":ce};se=se.replace(/\r\n/g," ").replace(/\n/g," "),se=se.replace(/\s\s+/g,le.bind(le,!0)),(Q.previousSibling==null&&R(Q.parentNode)||Q.previousSibling!=null&&R(Q.previousSibling))&&(se=se.replace(/^\s+/,le.bind(le,!1))),(Q.nextSibling==null&&R(Q.parentNode)||Q.nextSibling!=null&&R(Q.nextSibling))&&(se=se.replace(/\s+$/,le.bind(le,!1)))}return X.insert(se)}c.default=O,c.matchAttributor=B,c.matchBlot=W,c.matchNewline=V,c.matchSpacing=ne,c.matchText=he},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function d(s,l){for(var o=0;o<l.length;o++){var n=l[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(s,l,o){return l&&d(s.prototype,l),o&&d(s,o),s}}(),N=function d(s,l,o){s===null&&(s=Function.prototype);var n=Object.getOwnPropertyDescriptor(s,l);if(n===void 0){var m=Object.getPrototypeOf(s);return m===null?void 0:d(m,l,o)}else{if("value"in n)return n.value;var a=n.get;return a===void 0?void 0:a.call(o)}},w=h(6),g=f(w);function f(d){return d&&d.__esModule?d:{default:d}}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function i(d,s){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:d}function t(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(d,s):d.__proto__=s)}var r=function(d){t(s,d);function s(){return p(this,s),i(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return x(s,[{key:"optimize",value:function(o){N(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"optimize",this).call(this,o),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return N(s.__proto__||Object.getPrototypeOf(s),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),s}(g.default);r.blotName="bold",r.tagName=["STRONG","B"],c.default=r},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.addControls=c.default=void 0;var x=function(){function _(y,C){var T=[],q=!0,G=!1,Y=void 0;try{for(var te=y[Symbol.iterator](),K;!(q=(K=te.next()).done)&&(T.push(K.value),!(C&&T.length===C));q=!0);}catch(M){G=!0,Y=M}finally{try{!q&&te.return&&te.return()}finally{if(G)throw Y}}return T}return function(y,C){if(Array.isArray(y))return y;if(Symbol.iterator in Object(y))return _(y,C);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(){function _(y,C){for(var T=0;T<C.length;T++){var q=C[T];q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(y,q.key,q)}}return function(y,C,T){return C&&_(y.prototype,C),T&&_(y,T),y}}(),w=h(2),g=o(w),f=h(0),p=o(f),i=h(5),t=o(i),r=h(10),d=o(r),s=h(9),l=o(s);function o(_){return _&&_.__esModule?_:{default:_}}function n(_,y,C){return y in _?Object.defineProperty(_,y,{value:C,enumerable:!0,configurable:!0,writable:!0}):_[y]=C,_}function m(_,y){if(!(_ instanceof y))throw new TypeError("Cannot call a class as a function")}function a(_,y){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:_}function u(_,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);_.prototype=Object.create(y&&y.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(_,y):_.__proto__=y)}var j=(0,d.default)("quill:toolbar"),E=function(_){u(y,_);function y(C,T){m(this,y);var q=a(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,C,T));if(Array.isArray(q.options.container)){var G=document.createElement("div");D(G,q.options.container),C.container.parentNode.insertBefore(G,C.container),q.container=G}else typeof q.options.container=="string"?q.container=document.querySelector(q.options.container):q.container=q.options.container;if(!(q.container instanceof HTMLElement)){var Y;return Y=j.error("Container required for toolbar",q.options),a(q,Y)}return q.container.classList.add("ql-toolbar"),q.controls=[],q.handlers={},Object.keys(q.options.handlers).forEach(function(te){q.addHandler(te,q.options.handlers[te])}),[].forEach.call(q.container.querySelectorAll("button, select"),function(te){q.attach(te)}),q.quill.on(t.default.events.EDITOR_CHANGE,function(te,K){te===t.default.events.SELECTION_CHANGE&&q.update(K)}),q.quill.on(t.default.events.SCROLL_OPTIMIZE,function(){var te=q.quill.selection.getRange(),K=x(te,1),M=K[0];q.update(M)}),q}return N(y,[{key:"addHandler",value:function(T,q){this.handlers[T]=q}},{key:"attach",value:function(T){var q=this,G=[].find.call(T.classList,function(te){return te.indexOf("ql-")===0});if(G){if(G=G.slice(3),T.tagName==="BUTTON"&&T.setAttribute("type","button"),this.handlers[G]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[G]==null){j.warn("ignoring attaching to disabled format",G,T);return}if(p.default.query(G)==null){j.warn("ignoring attaching to nonexistent format",G,T);return}}var Y=T.tagName==="SELECT"?"change":"click";T.addEventListener(Y,function(te){var K=void 0;if(T.tagName==="SELECT"){if(T.selectedIndex<0)return;var M=T.options[T.selectedIndex];M.hasAttribute("selected")?K=!1:K=M.value||!1}else T.classList.contains("ql-active")?K=!1:K=T.value||!T.hasAttribute("value"),te.preventDefault();q.quill.focus();var P=q.quill.selection.getRange(),O=x(P,1),I=O[0];if(q.handlers[G]!=null)q.handlers[G].call(q,K);else if(p.default.query(G).prototype instanceof p.default.Embed){if(K=prompt("Enter "+G),!K)return;q.quill.updateContents(new g.default().retain(I.index).delete(I.length).insert(n({},G,K)),t.default.sources.USER)}else q.quill.format(G,K,t.default.sources.USER);q.update(I)}),this.controls.push([G,T])}}},{key:"update",value:function(T){var q=T==null?{}:this.quill.getFormat(T);this.controls.forEach(function(G){var Y=x(G,2),te=Y[0],K=Y[1];if(K.tagName==="SELECT"){var M=void 0;if(T==null)M=null;else if(q[te]==null)M=K.querySelector("option[selected]");else if(!Array.isArray(q[te])){var P=q[te];typeof P=="string"&&(P=P.replace(/\"/g,'\\"')),M=K.querySelector('option[value="'+P+'"]')}M==null?(K.value="",K.selectedIndex=-1):M.selected=!0}else if(T==null)K.classList.remove("ql-active");else if(K.hasAttribute("value")){var O=q[te]===K.getAttribute("value")||q[te]!=null&&q[te].toString()===K.getAttribute("value")||q[te]==null&&!K.getAttribute("value");K.classList.toggle("ql-active",O)}else K.classList.toggle("ql-active",q[te]!=null)})}}]),y}(l.default);E.DEFAULTS={};function S(_,y,C){var T=document.createElement("button");T.setAttribute("type","button"),T.classList.add("ql-"+y),C!=null&&(T.value=C),_.appendChild(T)}function D(_,y){Array.isArray(y[0])||(y=[y]),y.forEach(function(C){var T=document.createElement("span");T.classList.add("ql-formats"),C.forEach(function(q){if(typeof q=="string")S(T,q);else{var G=Object.keys(q)[0],Y=q[G];Array.isArray(Y)?k(T,G,Y):S(T,G,Y)}}),_.appendChild(T)})}function k(_,y,C){var T=document.createElement("select");T.classList.add("ql-"+y),C.forEach(function(q){var G=document.createElement("option");q!==!1?G.setAttribute("value",q):G.setAttribute("selected","selected"),T.appendChild(G)}),_.appendChild(T)}E.DEFAULTS={container:null,handlers:{clean:function(){var y=this,C=this.quill.getSelection();if(C!=null)if(C.length==0){var T=this.quill.getFormat();Object.keys(T).forEach(function(q){p.default.query(q,p.default.Scope.INLINE)!=null&&y.quill.format(q,!1)})}else this.quill.removeFormat(C,t.default.sources.USER)},direction:function(y){var C=this.quill.getFormat().align;y==="rtl"&&C==null?this.quill.format("align","right",t.default.sources.USER):!y&&C==="right"&&this.quill.format("align",!1,t.default.sources.USER),this.quill.format("direction",y,t.default.sources.USER)},indent:function(y){var C=this.quill.getSelection(),T=this.quill.getFormat(C),q=parseInt(T.indent||0);if(y==="+1"||y==="-1"){var G=y==="+1"?1:-1;T.direction==="rtl"&&(G*=-1),this.quill.format("indent",q+G,t.default.sources.USER)}},link:function(y){y===!0&&(y=prompt("Enter link URL:")),this.quill.format("link",y,t.default.sources.USER)},list:function(y){var C=this.quill.getSelection(),T=this.quill.getFormat(C);y==="check"?T.list==="checked"||T.list==="unchecked"?this.quill.format("list",!1,t.default.sources.USER):this.quill.format("list","unchecked",t.default.sources.USER):this.quill.format("list",y,t.default.sources.USER)}}},c.default=E,c.addControls=D},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function d(s,l){for(var o=0;o<l.length;o++){var n=l[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(s,l,o){return l&&d(s.prototype,l),o&&d(s,o),s}}(),N=function d(s,l,o){s===null&&(s=Function.prototype);var n=Object.getOwnPropertyDescriptor(s,l);if(n===void 0){var m=Object.getPrototypeOf(s);return m===null?void 0:d(m,l,o)}else{if("value"in n)return n.value;var a=n.get;return a===void 0?void 0:a.call(o)}},w=h(28),g=f(w);function f(d){return d&&d.__esModule?d:{default:d}}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function i(d,s){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:d}function t(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(d,s):d.__proto__=s)}var r=function(d){t(s,d);function s(l,o){p(this,s);var n=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,l));return n.label.innerHTML=o,n.container.classList.add("ql-color-picker"),[].slice.call(n.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(m){m.classList.add("ql-primary")}),n}return x(s,[{key:"buildItem",value:function(o){var n=N(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"buildItem",this).call(this,o);return n.style.backgroundColor=o.getAttribute("value")||"",n}},{key:"selectItem",value:function(o,n){N(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"selectItem",this).call(this,o,n);var m=this.label.querySelector(".ql-color-label"),a=o&&o.getAttribute("data-value")||"";m&&(m.tagName==="line"?m.style.stroke=a:m.style.fill=a)}}]),s}(g.default);c.default=r},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function d(s,l){for(var o=0;o<l.length;o++){var n=l[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(s,l,o){return l&&d(s.prototype,l),o&&d(s,o),s}}(),N=function d(s,l,o){s===null&&(s=Function.prototype);var n=Object.getOwnPropertyDescriptor(s,l);if(n===void 0){var m=Object.getPrototypeOf(s);return m===null?void 0:d(m,l,o)}else{if("value"in n)return n.value;var a=n.get;return a===void 0?void 0:a.call(o)}},w=h(28),g=f(w);function f(d){return d&&d.__esModule?d:{default:d}}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function i(d,s){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:d}function t(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(d,s):d.__proto__=s)}var r=function(d){t(s,d);function s(l,o){p(this,s);var n=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,l));return n.container.classList.add("ql-icon-picker"),[].forEach.call(n.container.querySelectorAll(".ql-picker-item"),function(m){m.innerHTML=o[m.getAttribute("data-value")||""]}),n.defaultItem=n.container.querySelector(".ql-selected"),n.selectItem(n.defaultItem),n}return x(s,[{key:"selectItem",value:function(o,n){N(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"selectItem",this).call(this,o,n),o=o||this.defaultItem,this.label.innerHTML=o.innerHTML}}]),s}(g.default);c.default=r},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function g(f,p){for(var i=0;i<p.length;i++){var t=p[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(f,t.key,t)}}return function(f,p,i){return p&&g(f.prototype,p),i&&g(f,i),f}}();function N(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}var w=function(){function g(f,p){var i=this;N(this,g),this.quill=f,this.boundsContainer=p||document.body,this.root=f.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){i.root.style.marginTop=-1*i.quill.root.scrollTop+"px"}),this.hide()}return x(g,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(p){var i=p.left+p.width/2-this.root.offsetWidth/2,t=p.bottom+this.quill.root.scrollTop;this.root.style.left=i+"px",this.root.style.top=t+"px",this.root.classList.remove("ql-flip");var r=this.boundsContainer.getBoundingClientRect(),d=this.root.getBoundingClientRect(),s=0;if(d.right>r.right&&(s=r.right-d.right,this.root.style.left=i+s+"px"),d.left<r.left&&(s=r.left-d.left,this.root.style.left=i+s+"px"),d.bottom>r.bottom){var l=d.bottom-d.top,o=p.bottom-p.top+l;this.root.style.top=t-o+"px",this.root.classList.add("ql-flip")}return s}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),g}();c.default=w},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function k(_,y){var C=[],T=!0,q=!1,G=void 0;try{for(var Y=_[Symbol.iterator](),te;!(T=(te=Y.next()).done)&&(C.push(te.value),!(y&&C.length===y));T=!0);}catch(K){q=!0,G=K}finally{try{!T&&Y.return&&Y.return()}finally{if(q)throw G}}return C}return function(_,y){if(Array.isArray(_))return _;if(Symbol.iterator in Object(_))return k(_,y);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function k(_,y,C){_===null&&(_=Function.prototype);var T=Object.getOwnPropertyDescriptor(_,y);if(T===void 0){var q=Object.getPrototypeOf(_);return q===null?void 0:k(q,y,C)}else{if("value"in T)return T.value;var G=T.get;return G===void 0?void 0:G.call(C)}},w=function(){function k(_,y){for(var C=0;C<y.length;C++){var T=y[C];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}return function(_,y,C){return y&&k(_.prototype,y),C&&k(_,C),_}}(),g=h(3),f=m(g),p=h(8),i=m(p),t=h(43),r=m(t),d=h(27),s=m(d),l=h(15),o=h(41),n=m(o);function m(k){return k&&k.__esModule?k:{default:k}}function a(k,_){if(!(k instanceof _))throw new TypeError("Cannot call a class as a function")}function u(k,_){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _&&(typeof _=="object"||typeof _=="function")?_:k}function j(k,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof _);k.prototype=Object.create(_&&_.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),_&&(Object.setPrototypeOf?Object.setPrototypeOf(k,_):k.__proto__=_)}var E=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],S=function(k){j(_,k);function _(y,C){a(this,_),C.modules.toolbar!=null&&C.modules.toolbar.container==null&&(C.modules.toolbar.container=E);var T=u(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,y,C));return T.quill.container.classList.add("ql-snow"),T}return w(_,[{key:"extendToolbar",value:function(C){C.container.classList.add("ql-snow"),this.buildButtons([].slice.call(C.container.querySelectorAll("button")),n.default),this.buildPickers([].slice.call(C.container.querySelectorAll("select")),n.default),this.tooltip=new D(this.quill,this.options.bounds),C.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(T,q){C.handlers.link.call(C,!q.format.link)})}}]),_}(r.default);S.DEFAULTS=(0,f.default)(!0,{},r.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(_){if(_){var y=this.quill.getSelection();if(y==null||y.length==0)return;var C=this.quill.getText(y);/^\S+@\S+\.\S+$/.test(C)&&C.indexOf("mailto:")!==0&&(C="mailto:"+C);var T=this.quill.theme.tooltip;T.edit("link",C)}else this.quill.format("link",!1)}}}}});var D=function(k){j(_,k);function _(y,C){a(this,_);var T=u(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,y,C));return T.preview=T.root.querySelector("a.ql-preview"),T}return w(_,[{key:"listen",value:function(){var C=this;N(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(T){C.root.classList.contains("ql-editing")?C.save():C.edit("link",C.preview.textContent),T.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(T){if(C.linkRange!=null){var q=C.linkRange;C.restoreFocus(),C.quill.formatText(q,"link",!1,i.default.sources.USER),delete C.linkRange}T.preventDefault(),C.hide()}),this.quill.on(i.default.events.SELECTION_CHANGE,function(T,q,G){if(T!=null){if(T.length===0&&G===i.default.sources.USER){var Y=C.quill.scroll.descendant(s.default,T.index),te=x(Y,2),K=te[0],M=te[1];if(K!=null){C.linkRange=new l.Range(T.index-M,K.length());var P=s.default.formats(K.domNode);C.preview.textContent=P,C.preview.setAttribute("href",P),C.show(),C.position(C.quill.getBounds(C.linkRange));return}}else delete C.linkRange;C.hide()}})}},{key:"show",value:function(){N(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),_}(t.BaseTooltip);D.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),c.default=S},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(29),N=z(x),w=h(36),g=h(38),f=h(64),p=h(65),i=z(p),t=h(66),r=z(t),d=h(67),s=z(d),l=h(37),o=h(26),n=h(39),m=h(40),a=h(56),u=z(a),j=h(68),E=z(j),S=h(27),D=z(S),k=h(69),_=z(k),y=h(70),C=z(y),T=h(71),q=z(T),G=h(72),Y=z(G),te=h(73),K=z(te),M=h(13),P=z(M),O=h(74),I=z(O),$=h(75),F=z($),R=h(57),L=z(R),U=h(41),B=z(U),W=h(28),ie=z(W),ue=h(59),ee=z(ue),V=h(60),ne=z(V),de=h(61),he=z(de),Q=h(108),X=z(Q),se=h(62),le=z(se);function z(ae){return ae&&ae.__esModule?ae:{default:ae}}N.default.register({"attributors/attribute/direction":g.DirectionAttribute,"attributors/class/align":w.AlignClass,"attributors/class/background":l.BackgroundClass,"attributors/class/color":o.ColorClass,"attributors/class/direction":g.DirectionClass,"attributors/class/font":n.FontClass,"attributors/class/size":m.SizeClass,"attributors/style/align":w.AlignStyle,"attributors/style/background":l.BackgroundStyle,"attributors/style/color":o.ColorStyle,"attributors/style/direction":g.DirectionStyle,"attributors/style/font":n.FontStyle,"attributors/style/size":m.SizeStyle},!0),N.default.register({"formats/align":w.AlignClass,"formats/direction":g.DirectionClass,"formats/indent":f.IndentClass,"formats/background":l.BackgroundStyle,"formats/color":o.ColorStyle,"formats/font":n.FontClass,"formats/size":m.SizeClass,"formats/blockquote":i.default,"formats/code-block":P.default,"formats/header":r.default,"formats/list":s.default,"formats/bold":u.default,"formats/code":M.Code,"formats/italic":E.default,"formats/link":D.default,"formats/script":_.default,"formats/strike":C.default,"formats/underline":q.default,"formats/image":Y.default,"formats/video":K.default,"formats/list/item":d.ListItem,"modules/formula":I.default,"modules/syntax":F.default,"modules/toolbar":L.default,"themes/bubble":X.default,"themes/snow":le.default,"ui/icons":B.default,"ui/picker":ie.default,"ui/icon-picker":ne.default,"ui/color-picker":ee.default,"ui/tooltip":he.default},!0),c.default=N.default},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.IndentClass=void 0;var x=function(){function s(l,o){for(var n=0;n<o.length;n++){var m=o[n];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(l,m.key,m)}}return function(l,o,n){return o&&s(l.prototype,o),n&&s(l,n),l}}(),N=function s(l,o,n){l===null&&(l=Function.prototype);var m=Object.getOwnPropertyDescriptor(l,o);if(m===void 0){var a=Object.getPrototypeOf(l);return a===null?void 0:s(a,o,n)}else{if("value"in m)return m.value;var u=m.get;return u===void 0?void 0:u.call(n)}},w=h(0),g=f(w);function f(s){return s&&s.__esModule?s:{default:s}}function p(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}function i(s,l){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l&&(typeof l=="object"||typeof l=="function")?l:s}function t(s,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);s.prototype=Object.create(l&&l.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),l&&(Object.setPrototypeOf?Object.setPrototypeOf(s,l):s.__proto__=l)}var r=function(s){t(l,s);function l(){return p(this,l),i(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}return x(l,[{key:"add",value:function(n,m){if(m==="+1"||m==="-1"){var a=this.value(n)||0;m=m==="+1"?a+1:a-1}return m===0?(this.remove(n),!0):N(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"add",this).call(this,n,m)}},{key:"canAdd",value:function(n,m){return N(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"canAdd",this).call(this,n,m)||N(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"canAdd",this).call(this,n,parseInt(m))}},{key:"value",value:function(n){return parseInt(N(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"value",this).call(this,n))||void 0}}]),l}(g.default.Attributor.Class),d=new r("indent","ql-indent",{scope:g.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});c.IndentClass=d},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(4),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}function g(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function f(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function p(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var i=function(t){p(r,t);function r(){return g(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return r}(N.default);i.blotName="blockquote",i.tagName="blockquote",c.default=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function r(d,s){for(var l=0;l<s.length;l++){var o=s[l];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(d,o.key,o)}}return function(d,s,l){return s&&r(d.prototype,s),l&&r(d,l),d}}(),N=h(4),w=g(N);function g(r){return r&&r.__esModule?r:{default:r}}function f(r,d){if(!(r instanceof d))throw new TypeError("Cannot call a class as a function")}function p(r,d){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&(typeof d=="object"||typeof d=="function")?d:r}function i(r,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);r.prototype=Object.create(d&&d.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(r,d):r.__proto__=d)}var t=function(r){i(d,r);function d(){return f(this,d),p(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments))}return x(d,null,[{key:"formats",value:function(l){return this.tagName.indexOf(l.tagName)+1}}]),d}(w.default);t.blotName="header",t.tagName=["H1","H2","H3","H4","H5","H6"],c.default=t},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.ListItem=void 0;var x=function(){function a(u,j){for(var E=0;E<j.length;E++){var S=j[E];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(u,S.key,S)}}return function(u,j,E){return j&&a(u.prototype,j),E&&a(u,E),u}}(),N=function a(u,j,E){u===null&&(u=Function.prototype);var S=Object.getOwnPropertyDescriptor(u,j);if(S===void 0){var D=Object.getPrototypeOf(u);return D===null?void 0:a(D,j,E)}else{if("value"in S)return S.value;var k=S.get;return k===void 0?void 0:k.call(E)}},w=h(0),g=r(w),f=h(4),p=r(f),i=h(25),t=r(i);function r(a){return a&&a.__esModule?a:{default:a}}function d(a,u,j){return u in a?Object.defineProperty(a,u,{value:j,enumerable:!0,configurable:!0,writable:!0}):a[u]=j,a}function s(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}function l(a,u){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:a}function o(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);a.prototype=Object.create(u&&u.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(a,u):a.__proto__=u)}var n=function(a){o(u,a);function u(){return s(this,u),l(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return x(u,[{key:"format",value:function(E,S){E===m.blotName&&!S?this.replaceWith(g.default.create(this.statics.scope)):N(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"format",this).call(this,E,S)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():N(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(E,S){return this.parent.isolate(this.offset(this.parent),this.length()),E===this.parent.statics.blotName?(this.parent.replaceWith(E,S),this):(this.parent.unwrap(),N(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"replaceWith",this).call(this,E,S))}}],[{key:"formats",value:function(E){return E.tagName===this.tagName?void 0:N(u.__proto__||Object.getPrototypeOf(u),"formats",this).call(this,E)}}]),u}(p.default);n.blotName="list-item",n.tagName="LI";var m=function(a){o(u,a),x(u,null,[{key:"create",value:function(E){var S=E==="ordered"?"OL":"UL",D=N(u.__proto__||Object.getPrototypeOf(u),"create",this).call(this,S);return(E==="checked"||E==="unchecked")&&D.setAttribute("data-checked",E==="checked"),D}},{key:"formats",value:function(E){if(E.tagName==="OL")return"ordered";if(E.tagName==="UL")return E.hasAttribute("data-checked")?E.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function u(j){s(this,u);var E=l(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,j)),S=function(k){if(k.target.parentNode===j){var _=E.statics.formats(j),y=g.default.find(k.target);_==="checked"?y.format("list","unchecked"):_==="unchecked"&&y.format("list","checked")}};return j.addEventListener("touchstart",S),j.addEventListener("mousedown",S),E}return x(u,[{key:"format",value:function(E,S){this.children.length>0&&this.children.tail.format(E,S)}},{key:"formats",value:function(){return d({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(E,S){if(E instanceof n)N(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"insertBefore",this).call(this,E,S);else{var D=S==null?this.length():S.offset(this),k=this.split(D);k.parent.insertBefore(E,k)}}},{key:"optimize",value:function(E){N(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"optimize",this).call(this,E);var S=this.next;S!=null&&S.prev===this&&S.statics.blotName===this.statics.blotName&&S.domNode.tagName===this.domNode.tagName&&S.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(S.moveChildren(this),S.remove())}},{key:"replace",value:function(E){if(E.statics.blotName!==this.statics.blotName){var S=g.default.create(this.statics.defaultChild);E.moveChildren(S),this.appendChild(S)}N(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"replace",this).call(this,E)}}]),u}(t.default);m.blotName="list",m.scope=g.default.Scope.BLOCK_BLOT,m.tagName=["OL","UL"],m.defaultChild="list-item",m.allowedChildren=[n],c.ListItem=n,c.default=m},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(56),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}function g(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function f(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function p(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var i=function(t){p(r,t);function r(){return g(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return r}(N.default);i.blotName="italic",i.tagName=["EM","I"],c.default=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function d(s,l){for(var o=0;o<l.length;o++){var n=l[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(s,l,o){return l&&d(s.prototype,l),o&&d(s,o),s}}(),N=function d(s,l,o){s===null&&(s=Function.prototype);var n=Object.getOwnPropertyDescriptor(s,l);if(n===void 0){var m=Object.getPrototypeOf(s);return m===null?void 0:d(m,l,o)}else{if("value"in n)return n.value;var a=n.get;return a===void 0?void 0:a.call(o)}},w=h(6),g=f(w);function f(d){return d&&d.__esModule?d:{default:d}}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}function i(d,s){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:d}function t(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(d,s):d.__proto__=s)}var r=function(d){t(s,d);function s(){return p(this,s),i(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return x(s,null,[{key:"create",value:function(o){return o==="super"?document.createElement("sup"):o==="sub"?document.createElement("sub"):N(s.__proto__||Object.getPrototypeOf(s),"create",this).call(this,o)}},{key:"formats",value:function(o){if(o.tagName==="SUB")return"sub";if(o.tagName==="SUP")return"super"}}]),s}(g.default);r.blotName="script",r.tagName=["SUB","SUP"],c.default=r},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(6),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}function g(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function f(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function p(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var i=function(t){p(r,t);function r(){return g(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return r}(N.default);i.blotName="strike",i.tagName="S",c.default=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=h(6),N=w(x);function w(t){return t&&t.__esModule?t:{default:t}}function g(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function f(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function p(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var i=function(t){p(r,t);function r(){return g(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return r}(N.default);i.blotName="underline",i.tagName="U",c.default=i},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function l(o,n){for(var m=0;m<n.length;m++){var a=n[m];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}return function(o,n,m){return n&&l(o.prototype,n),m&&l(o,m),o}}(),N=function l(o,n,m){o===null&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,n);if(a===void 0){var u=Object.getPrototypeOf(o);return u===null?void 0:l(u,n,m)}else{if("value"in a)return a.value;var j=a.get;return j===void 0?void 0:j.call(m)}},w=h(0),g=p(w),f=h(27);function p(l){return l&&l.__esModule?l:{default:l}}function i(l,o){if(!(l instanceof o))throw new TypeError("Cannot call a class as a function")}function t(l,o){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:l}function r(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);l.prototype=Object.create(o&&o.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(l,o):l.__proto__=o)}var d=["alt","height","width"],s=function(l){r(o,l);function o(){return i(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return x(o,[{key:"format",value:function(m,a){d.indexOf(m)>-1?a?this.domNode.setAttribute(m,a):this.domNode.removeAttribute(m):N(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"format",this).call(this,m,a)}}],[{key:"create",value:function(m){var a=N(o.__proto__||Object.getPrototypeOf(o),"create",this).call(this,m);return typeof m=="string"&&a.setAttribute("src",this.sanitize(m)),a}},{key:"formats",value:function(m){return d.reduce(function(a,u){return m.hasAttribute(u)&&(a[u]=m.getAttribute(u)),a},{})}},{key:"match",value:function(m){return/\.(jpe?g|gif|png)$/.test(m)||/^data:image\/.+;base64/.test(m)}},{key:"sanitize",value:function(m){return(0,f.sanitize)(m,["http","https","data"])?m:"//:0"}},{key:"value",value:function(m){return m.getAttribute("src")}}]),o}(g.default.Embed);s.blotName="image",s.tagName="IMG",c.default=s},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0});var x=function(){function l(o,n){for(var m=0;m<n.length;m++){var a=n[m];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}return function(o,n,m){return n&&l(o.prototype,n),m&&l(o,m),o}}(),N=function l(o,n,m){o===null&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,n);if(a===void 0){var u=Object.getPrototypeOf(o);return u===null?void 0:l(u,n,m)}else{if("value"in a)return a.value;var j=a.get;return j===void 0?void 0:j.call(m)}},w=h(4),g=h(27),f=p(g);function p(l){return l&&l.__esModule?l:{default:l}}function i(l,o){if(!(l instanceof o))throw new TypeError("Cannot call a class as a function")}function t(l,o){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:l}function r(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);l.prototype=Object.create(o&&o.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(l,o):l.__proto__=o)}var d=["height","width"],s=function(l){r(o,l);function o(){return i(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return x(o,[{key:"format",value:function(m,a){d.indexOf(m)>-1?a?this.domNode.setAttribute(m,a):this.domNode.removeAttribute(m):N(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"format",this).call(this,m,a)}}],[{key:"create",value:function(m){var a=N(o.__proto__||Object.getPrototypeOf(o),"create",this).call(this,m);return a.setAttribute("frameborder","0"),a.setAttribute("allowfullscreen",!0),a.setAttribute("src",this.sanitize(m)),a}},{key:"formats",value:function(m){return d.reduce(function(a,u){return m.hasAttribute(u)&&(a[u]=m.getAttribute(u)),a},{})}},{key:"sanitize",value:function(m){return f.default.sanitize(m)}},{key:"value",value:function(m){return m.getAttribute("src")}}]),o}(w.BlockEmbed);s.blotName="video",s.className="ql-video",s.tagName="IFRAME",c.default=s},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.FormulaBlot=void 0;var x=function(){function m(a,u){for(var j=0;j<u.length;j++){var E=u[j];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(a,E.key,E)}}return function(a,u,j){return u&&m(a.prototype,u),j&&m(a,j),a}}(),N=function m(a,u,j){a===null&&(a=Function.prototype);var E=Object.getOwnPropertyDescriptor(a,u);if(E===void 0){var S=Object.getPrototypeOf(a);return S===null?void 0:m(S,u,j)}else{if("value"in E)return E.value;var D=E.get;return D===void 0?void 0:D.call(j)}},w=h(35),g=r(w),f=h(5),p=r(f),i=h(9),t=r(i);function r(m){return m&&m.__esModule?m:{default:m}}function d(m,a){if(!(m instanceof a))throw new TypeError("Cannot call a class as a function")}function s(m,a){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:m}function l(m,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);m.prototype=Object.create(a&&a.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(m,a):m.__proto__=a)}var o=function(m){l(a,m);function a(){return d(this,a),s(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return x(a,null,[{key:"create",value:function(j){var E=N(a.__proto__||Object.getPrototypeOf(a),"create",this).call(this,j);return typeof j=="string"&&(window.katex.render(j,E,{throwOnError:!1,errorColor:"#f00"}),E.setAttribute("data-value",j)),E}},{key:"value",value:function(j){return j.getAttribute("data-value")}}]),a}(g.default);o.blotName="formula",o.className="ql-formula",o.tagName="SPAN";var n=function(m){l(a,m),x(a,null,[{key:"register",value:function(){p.default.register(o,!0)}}]);function a(){d(this,a);var u=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return u}return a}(t.default);c.FormulaBlot=o,c.default=n},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.CodeToken=c.CodeBlock=void 0;var x=function(){function j(E,S){for(var D=0;D<S.length;D++){var k=S[D];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(E,k.key,k)}}return function(E,S,D){return S&&j(E.prototype,S),D&&j(E,D),E}}(),N=function j(E,S,D){E===null&&(E=Function.prototype);var k=Object.getOwnPropertyDescriptor(E,S);if(k===void 0){var _=Object.getPrototypeOf(E);return _===null?void 0:j(_,S,D)}else{if("value"in k)return k.value;var y=k.get;return y===void 0?void 0:y.call(D)}},w=h(0),g=s(w),f=h(5),p=s(f),i=h(9),t=s(i),r=h(13),d=s(r);function s(j){return j&&j.__esModule?j:{default:j}}function l(j,E){if(!(j instanceof E))throw new TypeError("Cannot call a class as a function")}function o(j,E){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E&&(typeof E=="object"||typeof E=="function")?E:j}function n(j,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);j.prototype=Object.create(E&&E.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(j,E):j.__proto__=E)}var m=function(j){n(E,j);function E(){return l(this,E),o(this,(E.__proto__||Object.getPrototypeOf(E)).apply(this,arguments))}return x(E,[{key:"replaceWith",value:function(D){this.domNode.textContent=this.domNode.textContent,this.attach(),N(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"replaceWith",this).call(this,D)}},{key:"highlight",value:function(D){var k=this.domNode.textContent;this.cachedText!==k&&((k.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=D(k),this.domNode.normalize(),this.attach()),this.cachedText=k)}}]),E}(d.default);m.className="ql-syntax";var a=new g.default.Attributor.Class("token","hljs",{scope:g.default.Scope.INLINE}),u=function(j){n(E,j),x(E,null,[{key:"register",value:function(){p.default.register(a,!0),p.default.register(m,!0)}}]);function E(S,D){l(this,E);var k=o(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,S,D));if(typeof k.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var _=null;return k.quill.on(p.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(_),_=setTimeout(function(){k.highlight(),_=null},k.options.interval)}),k.highlight(),k}return x(E,[{key:"highlight",value:function(){var D=this;if(!this.quill.selection.composing){this.quill.update(p.default.sources.USER);var k=this.quill.getSelection();this.quill.scroll.descendants(m).forEach(function(_){_.highlight(D.options.highlight)}),this.quill.update(p.default.sources.SILENT),k!=null&&this.quill.setSelection(k,p.default.sources.SILENT)}}}]),E}(t.default);u.DEFAULTS={highlight:function(){return window.hljs==null?null:function(j){var E=window.hljs.highlightAuto(j);return E.value}}(),interval:1e3},c.CodeBlock=m,c.CodeToken=a,c.default=u},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(v,c){v.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(v,c){v.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(v,c){v.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(v,c){v.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(v,c){v.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(v,c,h){Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.BubbleTooltip=void 0;var x=function E(S,D,k){S===null&&(S=Function.prototype);var _=Object.getOwnPropertyDescriptor(S,D);if(_===void 0){var y=Object.getPrototypeOf(S);return y===null?void 0:E(y,D,k)}else{if("value"in _)return _.value;var C=_.get;return C===void 0?void 0:C.call(k)}},N=function(){function E(S,D){for(var k=0;k<D.length;k++){var _=D[k];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(S,_.key,_)}}return function(S,D,k){return D&&E(S.prototype,D),k&&E(S,k),S}}(),w=h(3),g=l(w),f=h(8),p=l(f),i=h(43),t=l(i),r=h(15),d=h(41),s=l(d);function l(E){return E&&E.__esModule?E:{default:E}}function o(E,S){if(!(E instanceof S))throw new TypeError("Cannot call a class as a function")}function n(E,S){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S&&(typeof S=="object"||typeof S=="function")?S:E}function m(E,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof S);E.prototype=Object.create(S&&S.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),S&&(Object.setPrototypeOf?Object.setPrototypeOf(E,S):E.__proto__=S)}var a=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],u=function(E){m(S,E);function S(D,k){o(this,S),k.modules.toolbar!=null&&k.modules.toolbar.container==null&&(k.modules.toolbar.container=a);var _=n(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,D,k));return _.quill.container.classList.add("ql-bubble"),_}return N(S,[{key:"extendToolbar",value:function(k){this.tooltip=new j(this.quill,this.options.bounds),this.tooltip.root.appendChild(k.container),this.buildButtons([].slice.call(k.container.querySelectorAll("button")),s.default),this.buildPickers([].slice.call(k.container.querySelectorAll("select")),s.default)}}]),S}(t.default);u.DEFAULTS=(0,g.default)(!0,{},t.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(S){S?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var j=function(E){m(S,E);function S(D,k){o(this,S);var _=n(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,D,k));return _.quill.on(p.default.events.EDITOR_CHANGE,function(y,C,T,q){if(y===p.default.events.SELECTION_CHANGE)if(C!=null&&C.length>0&&q===p.default.sources.USER){_.show(),_.root.style.left="0px",_.root.style.width="",_.root.style.width=_.root.offsetWidth+"px";var G=_.quill.getLines(C.index,C.length);if(G.length===1)_.position(_.quill.getBounds(C));else{var Y=G[G.length-1],te=_.quill.getIndex(Y),K=Math.min(Y.length()-1,C.index+C.length-te),M=_.quill.getBounds(new r.Range(te,K));_.position(M)}}else document.activeElement!==_.textbox&&_.quill.hasFocus()&&_.hide()}),_}return N(S,[{key:"listen",value:function(){var k=this;x(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){k.root.classList.remove("ql-editing")}),this.quill.on(p.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!k.root.classList.contains("ql-hidden")){var _=k.quill.getSelection();_!=null&&k.position(k.quill.getBounds(_))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(k){var _=x(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"position",this).call(this,k),y=this.root.querySelector(".ql-tooltip-arrow");if(y.style.marginLeft="",_===0)return _;y.style.marginLeft=-1*_-y.offsetWidth/2+"px"}}]),S}(i.BaseTooltip);j.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),c.BubbleTooltip=j,c.default=u},function(v,c,h){v.exports=h(63)}]).default})})(Sn);var Gu=Sn.exports,Vu=Le&&Le.__extends||function(){var b=function(A,v){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var x in h)h.hasOwnProperty(x)&&(c[x]=h[x])},b(A,v)};return function(A,v){b(A,v);function c(){this.constructor=A}A.prototype=v===null?Object.create(v):(c.prototype=v.prototype,new c)}}(),qt=Le&&Le.__assign||function(){return qt=Object.assign||function(b){for(var A,v=1,c=arguments.length;v<c;v++){A=arguments[v];for(var h in A)Object.prototype.hasOwnProperty.call(A,h)&&(b[h]=A[h])}return b},qt.apply(this,arguments)},Wu=Le&&Le.__spreadArrays||function(){for(var b=0,A=0,v=arguments.length;A<v;A++)b+=arguments[A].length;for(var c=Array(b),h=0,A=0;A<v;A++)for(var x=arguments[A],N=0,w=x.length;N<w;N++,h++)c[h]=x[N];return c},Wt=Le&&Le.__importDefault||function(b){return b&&b.__esModule?b:{default:b}},Fe=Wt(Z),Yu=Wt(Rn),pt=Wt(Ku),rn=Wt(Gu),Zu=function(b){Vu(A,b);function A(v){var c=b.call(this,v)||this;c.dirtyProps=["modules","formats","bounds","theme","children"],c.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],c.state={generation:0},c.selection=null,c.onEditorChange=function(x,N,w,g){var f,p,i,t;x==="text-change"?(p=(f=c).onEditorChangeText)===null||p===void 0||p.call(f,c.editor.root.innerHTML,N,g,c.unprivilegedEditor):x==="selection-change"&&((t=(i=c).onEditorChangeSelection)===null||t===void 0||t.call(i,N,g,c.unprivilegedEditor))};var h=c.isControlled()?v.value:v.defaultValue;return c.value=h??"",c}return A.prototype.validateProps=function(v){var c;if(Fe.default.Children.count(v.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(Fe.default.Children.count(v.children)){var h=Fe.default.Children.only(v.children);if(((c=h)===null||c===void 0?void 0:c.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&v.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},A.prototype.shouldComponentUpdate=function(v,c){var h=this,x;if(this.validateProps(v),!this.editor||this.state.generation!==c.generation)return!0;if("value"in v){var N=this.getEditorContents(),w=(x=v.value,x??"");this.isEqualValue(w,N)||this.setEditorContents(this.editor,w)}return v.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,v.readOnly),Wu(this.cleanProps,this.dirtyProps).some(function(g){return!pt.default(v[g],h.props[g])})},A.prototype.shouldComponentRegenerate=function(v){var c=this;return this.dirtyProps.some(function(h){return!pt.default(v[h],c.props[h])})},A.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},A.prototype.componentWillUnmount=function(){this.destroyEditor()},A.prototype.componentDidUpdate=function(v,c){var h=this;if(this.editor&&this.shouldComponentRegenerate(v)){var x=this.editor.getContents(),N=this.editor.getSelection();this.regenerationSnapshot={delta:x,selection:N},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==c.generation){var w=this.regenerationSnapshot,x=w.delta,g=w.selection;delete this.regenerationSnapshot,this.instantiateEditor();var f=this.editor;f.setContents(x),nn(function(){return h.setEditorSelection(f,g)})}},A.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},A.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},A.prototype.isControlled=function(){return"value"in this.props},A.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},A.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},A.prototype.createEditor=function(v,c){var h=new rn.default(v,c);return c.tabIndex!=null&&this.setEditorTabIndex(h,c.tabIndex),this.hookEditor(h),h},A.prototype.hookEditor=function(v){this.unprivilegedEditor=this.makeUnprivilegedEditor(v),v.on("editor-change",this.onEditorChange)},A.prototype.unhookEditor=function(v){v.off("editor-change",this.onEditorChange)},A.prototype.getEditorContents=function(){return this.value},A.prototype.getEditorSelection=function(){return this.selection},A.prototype.isDelta=function(v){return v&&v.ops},A.prototype.isEqualValue=function(v,c){return this.isDelta(v)&&this.isDelta(c)?pt.default(v.ops,c.ops):pt.default(v,c)},A.prototype.setEditorContents=function(v,c){var h=this;this.value=c;var x=this.getEditorSelection();typeof c=="string"?v.setContents(v.clipboard.convert(c)):v.setContents(c),nn(function(){return h.setEditorSelection(v,x)})},A.prototype.setEditorSelection=function(v,c){if(this.selection=c,c){var h=v.getLength();c.index=Math.max(0,Math.min(c.index,h-1)),c.length=Math.max(0,Math.min(c.length,h-1-c.index)),v.setSelection(c)}},A.prototype.setEditorTabIndex=function(v,c){var h,x;!((x=(h=v)===null||h===void 0?void 0:h.scroll)===null||x===void 0)&&x.domNode&&(v.scroll.domNode.tabIndex=c)},A.prototype.setEditorReadOnly=function(v,c){c?v.disable():v.enable()},A.prototype.makeUnprivilegedEditor=function(v){var c=v;return{getHTML:function(){return c.root.innerHTML},getLength:c.getLength.bind(c),getText:c.getText.bind(c),getContents:c.getContents.bind(c),getSelection:c.getSelection.bind(c),getBounds:c.getBounds.bind(c)}},A.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var v=Yu.default.findDOMNode(this.editingArea);if(!v)throw new Error("Cannot find element for editing area");if(v.nodeType===3)throw new Error("Editing area cannot be a text node");return v},A.prototype.renderEditingArea=function(){var v=this,c=this.props,h=c.children,x=c.preserveWhitespace,N=this.state.generation,w={key:N,ref:function(g){v.editingArea=g}};return Fe.default.Children.count(h)?Fe.default.cloneElement(Fe.default.Children.only(h),w):x?Fe.default.createElement("pre",qt({},w)):Fe.default.createElement("div",qt({},w))},A.prototype.render=function(){var v;return Fe.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(v=this.props.className,v??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},A.prototype.onEditorChangeText=function(v,c,h,x){var N,w;if(this.editor){var g=this.isDelta(this.value)?x.getContents():x.getHTML();g!==this.getEditorContents()&&(this.lastDeltaChangeSet=c,this.value=g,(w=(N=this.props).onChange)===null||w===void 0||w.call(N,v,c,h,x))}},A.prototype.onEditorChangeSelection=function(v,c,h){var x,N,w,g,f,p;if(this.editor){var i=this.getEditorSelection(),t=!i&&v,r=i&&!v;pt.default(v,i)||(this.selection=v,(N=(x=this.props).onChangeSelection)===null||N===void 0||N.call(x,v,c,h),t?(g=(w=this.props).onFocus)===null||g===void 0||g.call(w,v,c,h):r&&((p=(f=this.props).onBlur)===null||p===void 0||p.call(f,i,c,h)))}},A.prototype.focus=function(){this.editor&&this.editor.focus()},A.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},A.displayName="React Quill",A.Quill=rn.default,A.defaultProps={theme:"snow",modules:{},readOnly:!1},A}(Fe.default.Component);function nn(b){Promise.resolve().then(b)}var Qu=Zu;const Xu=Dn(Qu);function Ju({isOpen:b,onClose:A,mode:v="compose",replyTo:c,onSend:h}){const[x,N]=Z.useState([]),[w,g]=Z.useState([]),[f,p]=Z.useState([]),[i,t]=Z.useState(!1),[r,d]=Z.useState(!1),[s,l]=Z.useState(""),[o,n]=Z.useState(""),[m,a]=Z.useState(""),[u,j]=Z.useState(""),[E,S]=Z.useState(""),[D,k]=Z.useState([]),[_,y]=Z.useState(!1),[C,T]=Z.useState(!1),[q,G]=Z.useState(!1),[Y,te]=Z.useState([]),[K,M]=Z.useState(!1),[P,O]=Z.useState(null),[I,$]=Z.useState(!1),F=Z.useRef(null),R=Z.useRef(null),L=Z.useRef(null),U=Z.useRef(null);Z.useEffect(()=>{if(v==="reply"&&c){j(c.subject.startsWith("Re: ")?c.subject:`Re: ${c.subject}`),N([{name:c.from,email:c.fromEmail}]);const z=B(c);S(z)}else if(v==="forward"&&c){j(c.subject.startsWith("Fwd: ")?c.subject:`Fwd: ${c.subject}`);const z=W(c);S(z)}},[v,c]),Z.useEffect(()=>{const z=ae=>{U.current&&!U.current.contains(ae.target)&&M(!1)};if(K)return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[K]);const B=z=>{var ve;if(!z)return"";const ae=z.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),ce=z.date.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),oe=`<div style="margin-top: 20px; color: #666;">On ${ae} at ${ce}, ${z.from} &lt;${z.fromEmail}&gt; wrote:</div>`,pe=`<blockquote style="margin: 10px 0 0 0; padding-left: 16px; border-left: 4px solid #ccc; color: #666;">${z.htmlBody||((ve=z.body)==null?void 0:ve.replace(/\n/g,"<br>"))||""}</blockquote>`;return`<p><br></p><p><br></p>${oe}${pe}`},W=z=>{var oe;if(!z)return"";const ae=z.date.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"});return`<p><br></p><p><br></p>${`<div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ccc;">
      <div style="color: #666; margin-bottom: 10px;">---------- Forwarded message ---------</div>
      <div style="color: #666;"><strong>From:</strong> ${z.from} &lt;${z.fromEmail}&gt;</div>
      <div style="color: #666;"><strong>Date:</strong> ${ae}</div>
      <div style="color: #666;"><strong>Subject:</strong> ${z.subject}</div>
      <div style="margin-top: 15px;">${z.htmlBody||((oe=z.body)==null?void 0:oe.replace(/\n/g,"<br>"))||""}</div>
    </div>`}`},ie=Z.useCallback(async z=>{if(!z||z.length<2){te([]);return}try{const{data:ae}=await fe.from("customers").select("customer_name, email, company_name").eq("is_active",!0).or(`customer_name.ilike.%${z}%,email.ilike.%${z}%,company_name.ilike.%${z}%`).limit(5),{data:ce}=await fe.from("crm_contacts").select("contact_person, email, company_name").eq("is_active",!0).or(`contact_person.ilike.%${z}%,email.ilike.%${z}%,company_name.ilike.%${z}%`).limit(5),oe=[...(ae||[]).map(pe=>({name:pe.customer_name,email:pe.email,company:pe.company_name})),...(ce||[]).map(pe=>({name:pe.contact_person,email:pe.email,company:pe.company_name}))];te(oe),M(oe.length>0)}catch(ae){console.error("Error searching customers:",ae)}},[]),ue=(z,ae)=>{ae==="to"?l(z):ae==="cc"?n(z):a(z),O(ae),ie(z)},ee=(z,ae)=>{const ce={name:z.name,email:z.email};ae==="to"?(N([...x,ce]),l("")):ae==="cc"?(g([...w,ce]),n("")):(p([...f,ce]),a("")),M(!1),te([])},V=(z,ae)=>{ae==="to"?N(x.filter((ce,oe)=>oe!==z)):ae==="cc"?g(w.filter((ce,oe)=>oe!==z)):p(f.filter((ce,oe)=>oe!==z))},ne=(z,ae)=>{const ce=ae==="to"?s:ae==="cc"?o:m;if((z.key==="Enter"||z.key===","||z.key===" ")&&ce.trim()){if(z.preventDefault(),de(ce.trim())){const oe={name:ce.trim(),email:ce.trim()};ae==="to"?(N([...x,oe]),l("")):ae==="cc"?(g([...w,oe]),n("")):(p([...f,oe]),a("")),M(!1)}}else z.key==="Backspace"&&!ce&&(ae==="to"&&x.length>0?N(x.slice(0,-1)):ae==="cc"&&w.length>0?g(w.slice(0,-1)):ae==="bcc"&&f.length>0&&p(f.slice(0,-1)))},de=z=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(z),he=z=>{const ae=z.target.files;if(!ae)return;const ce=[];for(let oe=0;oe<ae.length;oe++){const pe=ae[oe];if(pe.size>25*1024*1024){alert(`File ${pe.name} is too large. Maximum size is 25MB.`);continue}ce.push({file:pe,name:pe.name,size:pe.size})}k(oe=>[...oe,...ce])},Q=z=>{k(ae=>ae.filter((ce,oe)=>oe!==z))},X=z=>z<1024?z+" B":z<1024*1024?(z/1024).toFixed(1)+" KB":(z/(1024*1024)).toFixed(1)+" MB",se=async()=>{const z=[...x.map(oe=>oe.email)],ae=[...w.map(oe=>oe.email)],ce=[...f.map(oe=>oe.email)];if(s.trim()&&de(s.trim())&&z.push(s.trim()),o.trim()&&de(o.trim())&&ae.push(o.trim()),m.trim()&&de(m.trim())&&ce.push(m.trim()),z.length===0||!u||!E){alert("Please fill in recipient, subject, and message");return}y(!0);try{h&&await h({to:z,cc:ae,bcc:ce,subject:u,body:E,attachments:D.map(oe=>oe.file)}),alert("Email sent successfully!"),A()}catch(oe){console.error("Error sending email:",oe),alert("Failed to send email. Please try again.")}finally{y(!1)}},le={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]]};return b?C?e.jsx("div",{className:"fixed bottom-0 right-4 w-64 bg-gray-800 text-white rounded-t-lg shadow-xl z-50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 cursor-pointer",onClick:()=>T(!1),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium truncate",children:u||"New Message"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:z=>{z.stopPropagation(),T(!1)},className:"p-1 hover:bg-gray-700 rounded",children:e.jsx(kr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:z=>{z.stopPropagation(),A()},className:"p-1 hover:bg-gray-700 rounded",children:e.jsx(He,{className:"w-4 h-4"})})]})]})}):e.jsxs("div",{className:`fixed ${q?"inset-0":"bottom-0 right-6 w-[480px] h-[600px]"} bg-white rounded-t-lg shadow-2xl z-40 flex flex-col`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-50 border-b border-gray-200 rounded-t-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:v==="reply"?"Reply":v==="forward"?"Forward":"New Message"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>T(!0),className:"p-1.5 hover:bg-gray-200 rounded transition",title:"Minimize",children:e.jsx(nr,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>G(!q),className:"p-1.5 hover:bg-gray-200 rounded transition",title:q?"Exit fullscreen":"Fullscreen",children:q?e.jsx(pa,{className:"w-4 h-4 text-gray-600"}):e.jsx(kr,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:A,className:"p-1.5 hover:bg-gray-200 rounded transition",title:"Close",children:e.jsx(He,{className:"w-4 h-4 text-gray-600"})})]})]}),e.jsxs("div",{className:"border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-start px-4 py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600 w-12 pt-1",children:"To"}),e.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-1",children:[x.map((z,ae)=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs",children:[e.jsx("span",{children:z.name}),e.jsx("button",{onClick:()=>V(ae,"to"),className:"hover:text-blue-900",children:e.jsx(He,{className:"w-3 h-3"})})]},ae)),e.jsx("input",{ref:L,type:"text",value:s,onChange:z=>ue(z.target.value,"to"),onKeyDown:z=>ne(z,"to"),onFocus:()=>O("to"),onBlur:()=>{setTimeout(()=>M(!1),200)},placeholder:x.length===0?"Type or search recipients":"",className:"flex-1 min-w-[120px] outline-none text-sm py-1"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs ml-2",children:[!i&&e.jsx("button",{onClick:()=>t(!0),className:"text-blue-600 hover:text-blue-700",children:"Cc"}),!r&&e.jsx("button",{onClick:()=>d(!0),className:"text-blue-600 hover:text-blue-700",children:"Bcc"})]})]}),i&&e.jsxs("div",{className:"flex items-start px-4 py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600 w-12 pt-1",children:"Cc"}),e.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-1",children:[w.map((z,ae)=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs",children:[e.jsx("span",{children:z.name}),e.jsx("button",{onClick:()=>V(ae,"cc"),className:"hover:text-blue-900",children:e.jsx(He,{className:"w-3 h-3"})})]},ae)),e.jsx("input",{type:"text",value:o,onChange:z=>ue(z.target.value,"cc"),onKeyDown:z=>ne(z,"cc"),onFocus:()=>O("cc"),onBlur:()=>{setTimeout(()=>M(!1),200)},placeholder:w.length===0?"Type or search Cc recipients":"",className:"flex-1 min-w-[120px] outline-none text-sm py-1"})]})]}),r&&e.jsxs("div",{className:"flex items-start px-4 py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600 w-12 pt-1",children:"Bcc"}),e.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-1",children:[f.map((z,ae)=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs",children:[e.jsx("span",{children:z.name}),e.jsx("button",{onClick:()=>V(ae,"bcc"),className:"hover:text-blue-900",children:e.jsx(He,{className:"w-3 h-3"})})]},ae)),e.jsx("input",{type:"text",value:m,onChange:z=>ue(z.target.value,"bcc"),onKeyDown:z=>ne(z,"bcc"),onFocus:()=>O("bcc"),onBlur:()=>{setTimeout(()=>M(!1),200)},placeholder:f.length===0?"Type or search Bcc recipients":"",className:"flex-1 min-w-[120px] outline-none text-sm py-1"})]})]}),K&&Y.length>0&&P&&e.jsx("div",{ref:U,className:"absolute bg-white border border-gray-200 shadow-lg rounded-lg mt-1 max-h-48 overflow-y-auto z-50 w-96 ml-16",children:Y.map((z,ae)=>e.jsxs("button",{onMouseDown:ce=>{ce.preventDefault(),ee(z,P)},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:z.name}),e.jsx("div",{className:"text-xs text-gray-500",children:z.email}),z.company&&e.jsx("div",{className:"text-xs text-gray-400",children:z.company})]},ae))}),e.jsx("div",{className:"px-4 pb-2 text-[11px] text-gray-500 italic",children:"Tip: Type email addresses and press Enter, comma, or space to add. Or search from contacts."}),e.jsxs("div",{className:"flex items-center px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 w-12",children:"Subject"}),e.jsx("input",{type:"text",value:u,onChange:z=>j(z.target.value),placeholder:"Subject",className:"flex-1 outline-none text-sm"})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsx("style",{children:`
          .quill-editor-container .ql-container {
            font-size: 14px;
            font-family: Arial, sans-serif;
            overflow-y: auto !important;
            max-height: 100%;
          }
          .quill-editor-container .ql-editor {
            min-height: 200px;
            overflow-y: auto !important;
          }
          .quill-editor-container .ql-editor table {
            border-collapse: collapse;
            width: 100%;
            margin: 12px 0;
          }
          .quill-editor-container .ql-editor table td,
          .quill-editor-container .ql-editor table th {
            border: 1px solid #ddd;
            padding: 8px;
          }
          .quill-editor-container .ql-editor blockquote {
            border-left: 4px solid #ccc;
            padding-left: 16px;
            color: #666;
            margin: 10px 0;
          }
          .quill-editor-container .ql-editor img {
            max-width: 100%;
            height: auto;
          }
        `}),e.jsx(Xu,{ref:R,theme:"snow",value:E,onChange:S,modules:le,className:"quill-editor-container flex-1",style:{display:"flex",flexDirection:"column",height:"100%"}})]}),D.length>0&&e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-gray-50 max-h-32 overflow-y-auto",children:e.jsx("div",{className:"space-y-1",children:D.map((z,ae)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(yt,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 truncate",children:z.name}),e.jsxs("span",{className:"text-xs text-gray-500 flex-shrink-0",children:["(",X(z.size),")"]})]}),e.jsx("button",{onClick:()=>Q(ae),className:"text-red-600 hover:text-red-700 ml-2",children:e.jsx(He,{className:"w-4 h-4"})})]},ae))})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-white rounded-b-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:se,disabled:_||x.length===0&&(!s.trim()||!de(s.trim()))||!u||!E,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:_?e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"}),"Send"]})}),e.jsx("input",{ref:F,type:"file",multiple:!0,onChange:he,className:"hidden"}),e.jsx("button",{onClick:()=>{var z;return(z=F.current)==null?void 0:z.click()},className:"p-2 hover:bg-gray-100 rounded transition",title:"Attach files",children:e.jsx(yt,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 rounded transition",title:"Discard",children:e.jsx(Bt,{className:"w-5 h-5 text-gray-600"})})]})]}):null}function ed(){const{setCurrentPage:b}=In(),[A,v]=Z.useState(null),[c,h]=Z.useState(!0),[x,N]=Z.useState(!1),[w,g]=Z.useState([]),[f,p]=Z.useState(null),[i,t]=Z.useState("INBOX"),[r,d]=Z.useState(""),[s,l]=Z.useState(null),[o,n]=Z.useState(null),[m,a]=Z.useState(!1),[u,j]=Z.useState(!1),[E,S]=Z.useState("compose"),[D,k]=Z.useState(null),[_,y]=Z.useState(null),C=Z.useRef(null);Z.useEffect(()=>{T()},[]),Z.useEffect(()=>{A&&Y()},[A,i]),Z.useEffect(()=>{const V=ne=>{C.current&&!C.current.contains(ne.target)&&y(null)};if(_)return document.addEventListener("mousedown",V),()=>document.removeEventListener("mousedown",V)},[_]);const T=async()=>{try{console.log("[GmailBrowserInbox] === LOADING GMAIL CONNECTION ===");const{data:{user:V},error:ne}=await fe.auth.getUser();if(console.log("[GmailBrowserInbox] Auth user:",V==null?void 0:V.id),console.log("[GmailBrowserInbox] Auth error:",ne),ne||!V){console.error("[GmailBrowserInbox] Auth error:",ne),l("Not authenticated"),h(!1);return}console.log("[GmailBrowserInbox] Querying gmail_connections for user:",V.id);const{data:de,error:he}=await fe.from("gmail_connections").select("*").eq("user_id",V.id).eq("is_connected",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(console.log("[GmailBrowserInbox] Query result - data:",de),console.log("[GmailBrowserInbox] Query result - error:",he),he&&he.code!=="PGRST116")throw console.error("[GmailBrowserInbox] Database error loading connection:",he),he;if(!de){console.error("[GmailBrowserInbox] NO CONNECTION FOUND for user:",V.id),l("No Gmail account connected. Please connect your Gmail account in Settings."),h(!1);return}console.log("[GmailBrowserInbox] Connection loaded successfully:",de.email_address),v(de),l(null)}catch(V){console.error("[GmailBrowserInbox] Error loading Gmail connection:",V),l("Failed to load Gmail connection")}finally{h(!1)}},q=async V=>{if(new Date(V.access_token_expires_at)>new Date)return V.access_token;const de=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:"90568246766-durgkfgje103589m6cuk99sv8kim69ec.apps.googleusercontent.com",client_secret:"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",refresh_token:V.refresh_token,grant_type:"refresh_token"})});if(!de.ok)throw new Error("Failed to refresh token");const he=await de.json(),Q=he.access_token,X=new Date(Date.now()+he.expires_in*1e3).toISOString();return await fe.from("gmail_connections").update({access_token:Q,access_token_expires_at:X}).eq("id",V.id),v({...V,access_token:Q,access_token_expires_at:X}),Q},G=V=>{switch(V){case"INBOX":return"in:inbox";case"SENT":return"in:sent";case"STARRED":return"is:starred";case"TRASH":return"in:trash";case"DRAFT":return"in:drafts";case"ALL":return"in:anywhere";default:return"in:inbox"}},Y=async V=>{if(A){N(!0),l(null);try{const ne=await q(A),de=G(i);let Q=`https://gmail.googleapis.com/gmail/v1/users/me/messages?maxResults=50&q=${encodeURIComponent(de)}`;V&&(Q+=`&pageToken=${V}`);const X=await fetch(Q,{headers:{Authorization:`Bearer ${ne}`}});if(!X.ok)throw new Error("Failed to fetch emails from Gmail");const se=await X.json(),le=se.messages||[];n(se.nextPageToken||null);const z=[],ae=5,ce=100;for(let oe=0;oe<le.length;oe+=ae){const ve=le.slice(oe,oe+ae).map(async be=>{try{const ke=await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${be.id}?format=full`,{headers:{Authorization:`Bearer ${ne}`}});if(!ke.ok)return ke.status===429&&(console.warn("Rate limit hit, slowing down..."),await new Promise(nt=>setTimeout(nt,1e3))),null;const xt=await ke.json();return te(xt)}catch(ke){return console.error("Error fetching message:",ke),null}}),$e=(await Promise.all(ve)).filter(be=>be!==null);z.push(...$e),oe+ae<le.length&&await new Promise(be=>setTimeout(be,ce))}g(V?[...w,...z]:z)}catch(ne){console.error("Error loading emails:",ne),l("Failed to load emails from Gmail")}finally{N(!1)}}},te=V=>{var ne,de,he;try{const Q=V.payload.headers,X=K(Q,"subject")||"(No Subject)",se=K(Q,"from")||"",le=K(Q,"to")||"",z=K(Q,"cc")||"",ae=((ne=se.match(/<(.+?)>/))==null?void 0:ne[1])||se,ce=se.replace(/<.+?>/,"").trim()||ae,oe=new Date(parseInt(V.internalDate)),pe=((de=V.labelIds)==null?void 0:de.includes("UNREAD"))||!1,ve=((he=V.labelIds)==null?void 0:he.includes("STARRED"))||!1,{text:we,html:$e,attachments:be}=P(V.payload);return{id:V.id,threadId:V.threadId,subject:X,from:ce,fromEmail:ae,to:le,cc:z,snippet:V.snippet||"",body:we,htmlBody:$e,date:oe,isUnread:pe,isStarred:ve,labels:V.labelIds||[],attachments:be.length>0?be:void 0}}catch(Q){return console.error("Error parsing email:",Q),null}},K=(V,ne)=>{const de=V.find(he=>he.name.toLowerCase()===ne.toLowerCase());return(de==null?void 0:de.value)||""},M=V=>{const ne=document.createElement("DIV");return ne.innerHTML=V,ne.textContent||ne.innerText||""},P=V=>{var z;let ne="",de="";const he=[],Q=ae=>{try{const ce=ae.replace(/-/g,"+").replace(/_/g,"/"),oe=atob(ce),pe=new Uint8Array(oe.length);for(let ve=0;ve<oe.length;ve++)pe[ve]=oe.charCodeAt(ve);return new TextDecoder("utf-8").decode(pe)}catch{try{return atob(ae.replace(/-/g,"+").replace(/_/g,"/"))}catch{return ae}}},X=ae=>{var ce,oe,pe;for(const ve of ae)ve.filename&&((ce=ve.body)!=null&&ce.attachmentId)&&he.push({filename:ve.filename,mimeType:ve.mimeType,size:ve.body.size,attachmentId:ve.body.attachmentId}),ve.mimeType==="text/html"&&((oe=ve.body)!=null&&oe.data)?de=Q(ve.body.data):ve.mimeType==="text/plain"&&((pe=ve.body)!=null&&pe.data)?ne=Q(ve.body.data):ve.parts&&X(ve.parts)};if((z=V.body)!=null&&z.data){const ae=Q(V.body.data);V.mimeType==="text/html"?de=ae:ne=ae}else V.parts&&X(V.parts);const se=ne||(de?M(de):""),le=de||ne.replace(/\n/g,"<br>");return{text:se,html:le,attachments:he}},O=async V=>{if(p(V),V.isUnread&&I(V.id),!V.body&&A){a(!0);try{const ne=await q(A),de=await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${V.id}?format=full`,{headers:{Authorization:`Bearer ${ne}`}});if(de.ok){const he=await de.json(),{text:Q,html:X,attachments:se}=P(he.payload),le=he.payload.headers,z=K(le,"to")||"",ae=K(le,"cc")||"",ce={...V,body:Q,htmlBody:X,to:z,cc:ae,attachments:se.length>0?se:void 0};p(ce),g(w.map(oe=>oe.id===V.id?ce:oe))}}catch(ne){console.error("Error loading email body:",ne)}finally{a(!1)}}},I=async V=>{if(A)try{const ne=await q(A);await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${V}/modify`,{method:"POST",headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"},body:JSON.stringify({removeLabelIds:["UNREAD"]})}),g(w.map(de=>de.id===V?{...de,isUnread:!1}:de)),(f==null?void 0:f.id)===V&&p({...f,isUnread:!1})}catch(ne){console.error("Error marking as read:",ne)}},$=async(V,ne)=>{if(A)try{const de=await q(A);await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${V}/modify`,{method:"POST",headers:{Authorization:`Bearer ${de}`,"Content-Type":"application/json"},body:JSON.stringify({addLabelIds:ne?[]:["STARRED"],removeLabelIds:ne?["STARRED"]:[]})}),g(w.map(he=>he.id===V?{...he,isStarred:!ne}:he)),(f==null?void 0:f.id)===V&&p({...f,isStarred:!ne})}catch(de){console.error("Error toggling star:",de)}},F=(V,ne=!1)=>{S("reply"),k(V),j(!0),y(null)},R=V=>{S("forward"),k(V),j(!0),y(null)},L=async V=>{if(A)try{const ne=await q(A);await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${V.id}/trash`,{method:"POST",headers:{Authorization:`Bearer ${ne}`}}),g(w.filter(de=>de.id!==V.id)),(f==null?void 0:f.id)===V.id&&p(null),y(null)}catch(ne){console.error("Error deleting email:",ne),alert("Failed to delete email")}},U=async V=>{if(!A)throw new Error("No Gmail connection");const ne=await q(A);let de="";if(V.attachments.length>0){const X="----=_Part_"+Date.now(),se=['Content-Type: multipart/mixed; boundary="'+X+'"',"MIME-Version: 1.0",`To: ${V.to.join(", ")}`];V.cc.length>0&&se.push(`Cc: ${V.cc.join(", ")}`),V.bcc.length>0&&se.push(`Bcc: ${V.bcc.join(", ")}`),se.push(`Subject: ${V.subject}`),de=se.join(`\r
`)+`\r
\r
`,de+=`--${X}\r
`,de+=`Content-Type: text/html; charset="UTF-8"\r
`,de+=`Content-Transfer-Encoding: 7bit\r
\r
`,de+=V.body+`\r
\r
`;for(const le of V.attachments){const z=await B(le);de+=`--${X}\r
`,de+=`Content-Type: ${le.type}; name="${le.name}"\r
`,de+=`Content-Transfer-Encoding: base64\r
`,de+=`Content-Disposition: attachment; filename="${le.name}"\r
\r
`,de+=z+`\r
\r
`}de+=`--${X}--`}else{const X=['Content-Type: text/html; charset="UTF-8"',"MIME-Version: 1.0",`To: ${V.to.join(", ")}`];V.cc.length>0&&X.push(`Cc: ${V.cc.join(", ")}`),V.bcc.length>0&&X.push(`Bcc: ${V.bcc.join(", ")}`),X.push(`Subject: ${V.subject}`),de=X.join(`\r
`)+`\r
\r
`+V.body}const he=btoa(unescape(encodeURIComponent(de))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");if(!(await fetch("https://gmail.googleapis.com/gmail/v1/users/me/messages/send",{method:"POST",headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"},body:JSON.stringify({raw:he})})).ok)throw new Error("Failed to send email")},B=V=>new Promise((ne,de)=>{const he=new FileReader;he.readAsDataURL(V),he.onload=()=>{const Q=he.result.split(",")[1];ne(Q)},he.onerror=Q=>de(Q)}),W=async(V,ne)=>{if(A)try{const de=await q(A),he=await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${V.id}/attachments/${ne.attachmentId}`,{headers:{Authorization:`Bearer ${de}`}});if(!he.ok)throw new Error("Failed to download attachment");const X=(await he.json()).data.replace(/-/g,"+").replace(/_/g,"/"),se=atob(X),le=new Uint8Array(se.length);for(let oe=0;oe<se.length;oe++)le[oe]=se.charCodeAt(oe);const z=new Blob([le],{type:ne.mimeType}),ae=window.URL.createObjectURL(z),ce=document.createElement("a");ce.href=ae,ce.download=ne.filename,document.body.appendChild(ce),ce.click(),document.body.removeChild(ce),window.URL.revokeObjectURL(ae)}catch(de){console.error("Error downloading attachment:",de),alert("Failed to download attachment")}},ie=async V=>{if(!V){alert("No email selected");return}y(null);try{const ne={subject:V.subject||"No Subject",body:V.htmlBody||V.body||V.snippet||"",fromEmail:V.fromEmail||"",fromName:V.from||"",date:V.date?V.date.toISOString():new Date().toISOString()};sessionStorage.setItem("pendingEmailForInquiry",JSON.stringify(ne)),b("command-center")}catch(ne){console.error("Error preparing inquiry:",ne),alert("Failed to prepare inquiry. Please try again.")}},ue=(V,ne)=>{V.preventDefault(),y({x:V.clientX,y:V.clientY,email:ne})},ee=V=>{const de=new Date().getTime()-V.getTime(),he=Math.floor(de/(1e3*60*60*24));return he===0?V.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):he<7?V.toLocaleDateString("en-US",{weekday:"short"}):V.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(st,{className:"w-6 h-6 animate-spin text-blue-500"})}):s?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center max-w-md px-6",children:[e.jsx(Ge,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Gmail Not Connected"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:s}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"To connect Gmail:"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Go to Settings page"}),e.jsx("li",{children:"Navigate to Gmail Settings section"}),e.jsx("li",{children:'Click "Connect Gmail Account"'}),e.jsx("li",{children:"Authorize access to your Gmail account"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>{h(!0),l(null),T()},className:"mt-4 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition",children:"Retry Connection"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition",children:"Refresh Page"})]})]})}):e.jsxs("div",{className:"flex h-[calc(100vh-16rem)] bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"w-[10%] min-w-[140px] border-r border-gray-200 flex flex-col bg-gray-50",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("h3",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Folders"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-1",children:[e.jsxs("button",{onClick:()=>t("INBOX"),className:`w-full flex items-center gap-2 px-3 py-2 text-xs transition ${i==="INBOX"?"bg-blue-100 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(cn,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Inbox"})]}),e.jsxs("button",{onClick:()=>t("STARRED"),className:`w-full flex items-center gap-2 px-3 py-2 text-xs transition ${i==="STARRED"?"bg-blue-100 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Zt,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Starred"})]}),e.jsxs("button",{onClick:()=>t("SENT"),className:`w-full flex items-center gap-2 px-3 py-2 text-xs transition ${i==="SENT"?"bg-blue-100 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Sent"})]}),e.jsxs("button",{onClick:()=>t("DRAFT"),className:`w-full flex items-center gap-2 px-3 py-2 text-xs transition ${i==="DRAFT"?"bg-blue-100 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Ze,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Drafts"})]}),e.jsxs("button",{onClick:()=>t("ALL"),className:`w-full flex items-center gap-2 px-3 py-2 text-xs transition ${i==="ALL"?"bg-blue-100 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(ln,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"All Mail"})]}),e.jsxs("button",{onClick:()=>t("TRASH"),className:`w-full flex items-center gap-2 px-3 py-2 text-xs transition ${i==="TRASH"?"bg-blue-100 text-blue-700 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Qt,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Trash"})]})]}),e.jsx("div",{className:"p-2 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>Y(),disabled:x,className:"w-full flex items-center justify-center gap-1.5 px-2 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition disabled:opacity-50",children:[e.jsx(Zn,{className:`w-3 h-3 ${x?"animate-spin":""}`}),"Refresh"]})})]}),e.jsxs("div",{className:"w-[30%] min-w-[320px] flex flex-col border-r border-gray-200 bg-white",children:[e.jsx("div",{className:"p-3 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"relative",children:[e.jsx(ur,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 w-3.5 h-3.5 text-gray-400"}),e.jsx("input",{type:"text",value:r,onChange:V=>d(V.target.value),placeholder:"Search emails...",className:"w-full pl-8 pr-3 py-1.5 text-xs border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:x&&w.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(st,{className:"w-6 h-6 animate-spin text-blue-500"})}):w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx(Ze,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No emails found"})]}):e.jsxs("div",{children:[w.filter(V=>r===""||V.subject.toLowerCase().includes(r.toLowerCase())||V.from.toLowerCase().includes(r.toLowerCase())||V.snippet.toLowerCase().includes(r.toLowerCase())).map(V=>e.jsxs("div",{onClick:()=>O(V),onContextMenu:ne=>ue(ne,V),className:`flex items-start gap-2 px-3 py-2.5 border-b border-gray-100 cursor-pointer transition ${(f==null?void 0:f.id)===V.id?"bg-blue-50 border-l-2 border-l-blue-500":(V.isUnread,"bg-white hover:bg-gray-50")}`,children:[e.jsx("button",{onClick:ne=>{ne.stopPropagation(),$(V.id,V.isStarred)},className:"mt-0.5 flex-shrink-0",children:e.jsx(Zt,{className:`w-3.5 h-3.5 ${V.isStarred?"fill-yellow-400 text-yellow-400":"text-gray-300"} hover:text-yellow-400 transition`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2 mb-0.5",children:[e.jsx("p",{className:`text-xs truncate ${V.isUnread?"font-bold text-gray-900":"font-medium text-gray-700"}`,children:V.from}),e.jsx("span",{className:"text-[10px] text-gray-500 whitespace-nowrap flex-shrink-0",children:ee(V.date)})]}),e.jsx("p",{className:`text-xs truncate mb-0.5 ${V.isUnread?"font-semibold text-gray-900":"text-gray-600"}`,children:V.subject}),e.jsx("p",{className:"text-[10px] text-gray-500 line-clamp-1",children:V.snippet})]}),V.isUnread&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 mt-1.5 flex-shrink-0"})]},V.id)),o&&e.jsx("div",{className:"p-4 text-center",children:e.jsx("button",{onClick:()=>Y(o),disabled:x,className:"px-4 py-2 text-sm text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50",children:x?"Loading...":"Load More"})})]})})]}),e.jsx("div",{className:"flex-1 w-[60%] flex flex-col bg-white overflow-hidden",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3 leading-tight",children:f.subject}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-semibold text-sm flex-shrink-0",children:f.from.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:f.from}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:f.fromEmail})]})]}),e.jsx("p",{className:"text-xs text-gray-500 whitespace-nowrap",children:f.date.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 bg-gray-50",children:m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(st,{className:"w-6 h-6 animate-spin text-blue-500"})}):e.jsxs(e.Fragment,{children:[f.htmlBody?e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx(Vn,{htmlContent:f.htmlBody})}):f.body?e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:f.body})}):e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:f.snippet})}),f.attachments&&f.attachments.length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm mt-4",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2 uppercase",children:["Attachments (",f.attachments.length,")"]}),e.jsx("div",{className:"space-y-2",children:f.attachments.map((V,ne)=>e.jsxs("button",{onClick:()=>W(f,V),className:"flex items-center gap-3 w-full p-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition",children:[e.jsx(Qe,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:V.filename}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(V.size/1024).toFixed(1)," KB"]})]}),e.jsx(dr,{className:"w-4 h-4 text-gray-400"})]},ne))})]})]})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>F(f,!1),className:"flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition",children:[e.jsx(Ar,{className:"w-4 h-4"}),"Reply"]}),f.cc&&e.jsxs("button",{onClick:()=>F(f,!0),className:"flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition",children:[e.jsx(rt,{className:"w-4 h-4"}),"Reply All"]}),e.jsxs("button",{onClick:()=>R(f),className:"flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition",children:[e.jsx(Or,{className:"w-4 h-4"}),"Forward"]}),e.jsxs("button",{onClick:()=>ie(f),className:"flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Process in Command Center"]}),e.jsxs("button",{onClick:()=>L(f),className:"flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-red-700 bg-red-50 border border-red-200 rounded hover:bg-red-100 transition ml-auto",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Delete"]})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"w-20 h-20 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Select an email to view"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Choose a message from your inbox"})]})})}),_&&e.jsxs("div",{ref:C,className:"fixed bg-white rounded-lg shadow-xl border border-gray-200 py-1 z-50 min-w-[160px]",style:{top:_.y,left:_.x},children:[e.jsxs("button",{onClick:()=>F(_.email,!1),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Ar,{className:"w-4 h-4"}),"Reply"]}),_.email.cc&&e.jsxs("button",{onClick:()=>F(_.email,!0),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4"}),"Reply All"]}),e.jsxs("button",{onClick:()=>R(_.email),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Or,{className:"w-4 h-4"}),"Forward"]}),e.jsxs("button",{onClick:()=>$(_.email.id,_.email.isStarred),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4"}),_.email.isStarred?"Unstar":"Star"]}),e.jsxs("button",{onClick:()=>ie(_.email),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-2 border-t border-gray-100",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Process in Command Center"]}),e.jsxs("button",{onClick:()=>L(_.email),className:"w-full px-4 py-2 text-left text-sm hover:bg-red-50 text-red-700 flex items-center gap-2 border-t border-gray-100",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Delete"]})]}),e.jsx(Ju,{isOpen:u,onClose:()=>{j(!1),k(null),S("compose")},mode:E,replyTo:D?{id:D.id,subject:D.subject,from:D.from,fromEmail:D.fromEmail,body:D.body,htmlBody:D.htmlBody,date:D.date}:void 0,onSend:U})]})}function td({isOpen:b,onClose:A,inquiry:v,replyTo:c}){const[h,x]=Z.useState(v.contact_email||""),[N,w]=Z.useState(""),[g,f]=Z.useState(""),[p,i]=Z.useState(!1),[t,r]=Z.useState(!1),[d,s]=Z.useState(c!=null&&c.subject?c.subject.startsWith("Re:")?c.subject:`Re: ${c.subject}`:`Re: ${v.product_name} - Inquiry ${v.inquiry_number}`),[l,o]=Z.useState(""),[n,m]=Z.useState([]),[a,u]=Z.useState(!1),[j,E]=Z.useState([]),[S,D]=Z.useState(!1),[k,_]=Z.useState(""),y=Z.useRef(null);Z.useEffect(()=>{if(C(),G(),T(),c){const O=`
        <br><br>
        <div style="border-left: 3px solid #ccc; padding-left: 15px; margin-left: 10px; color: #666;">
          <p><strong>On ${$t(new Date)}, ${c.from_email} wrote:</strong></p>
          ${c.body}
        </div>
      `;o(O)}else q()},[c]);const C=async()=>{try{const{data:O,error:I}=await fe.from("crm_email_templates").select("*").eq("is_active",!0).order("template_name");if(I)throw I;E(O||[])}catch(O){console.error("Error loading templates:",O)}},T=async()=>{try{const{data:O,error:I}=await fe.storage.from("crm-documents").list(`inquiry-${v.id}`,{limit:100,offset:0});if(I)throw I;if(O&&O.length>0){const F=(await Promise.all(O.map(async R=>{const{data:L}=await fe.storage.from("crm-documents").download(`inquiry-${v.id}/${R.name}`);return L?{file:new File([L],R.name,{type:L.type}),name:R.name,size:L.size}:null}))).filter(R=>R!==null);m(F)}}catch(O){console.error("Error loading existing documents:",O)}},q=()=>{let O=`<p>Dear ${v.contact_person||"Sir/Madam"},</p><br>`;if(O+=`<p>Thank you for your inquiry regarding <strong>${v.product_name}</strong>.</p><br>`,v.specification&&(O+=`<p><strong>Specification:</strong> ${v.specification}</p>`),O+=`<p><strong>Quantity:</strong> ${v.quantity}</p><br>`,v.offered_price&&v.offered_price>0){const I=v.offered_price_currency||"USD";O+=`<p><strong>Our Price:</strong> ${I} ${v.offered_price.toLocaleString()}</p><br>`}v.supplier_name&&(O+=`<p><strong>Origin:</strong> ${v.supplier_name}${v.supplier_country?`, ${v.supplier_country}`:""}</p><br>`),O+="<p>Please find the attached documents for your reference.</p><br>",O+="<p>Should you have any questions or require additional information, please feel free to contact us.</p><br>",O+="<p>Best regards,</p>",o(O)},G=async()=>{try{const{data:{user:O}}=await fe.auth.getUser();if(O){const{data:I}=await fe.from("user_profiles").select("full_name").eq("id",O.id).single();_((I==null?void 0:I.full_name)||"")}}catch(O){console.error("Error loading user name:",O)}},Y=O=>{const I={"{{contact_person}}":v.contact_person||"","{{company_name}}":v.company_name,"{{product_name}}":v.product_name,"{{specification}}":v.specification||"-","{{quantity}}":v.quantity,"{{supplier_name}}":v.supplier_name||"-","{{supplier_country}}":v.supplier_country||"-","{{inquiry_number}}":v.inquiry_number,"{{user_name}}":k,"{{offered_price}}":v.offered_price?`${v.offered_price_currency||"USD"} ${v.offered_price.toLocaleString()}`:"Please contact us for pricing","{{purchase_price}}":v.purchase_price?`${v.purchase_price_currency||"USD"} ${v.purchase_price.toLocaleString()}`:"-"};let $=O.subject,F=O.body;Object.entries(I).forEach(([R,L])=>{const U=new RegExp(R.replace(/[{}]/g,"\\$&"),"g");$=$.replace(U,L),F=F.replace(U,L)}),s($),o(F),D(!1),fe.from("crm_email_templates").update({use_count:O.use_count+1,last_used:new Date().toISOString()}).eq("id",O.id).then(()=>{})},te=O=>{const I=O.target.files;if(!I)return;const $=[];for(let F=0;F<I.length;F++){const R=I[F];if(R.size>25*1024*1024){alert(`File ${R.name} is too large. Maximum size is 25MB.`);continue}$.push({file:R,name:R.name,size:R.size})}m(F=>[...F,...$])},K=O=>{m(I=>I.filter(($,F)=>F!==O))},M=O=>O<1024?O+" B":O<1024*1024?(O/1024).toFixed(1)+" KB":(O/(1024*1024)).toFixed(1)+" MB",P=async()=>{if(!h||!d||!l){alert("Please fill in all required fields");return}u(!0);try{const{data:{user:O}}=await fe.auth.getUser();if(!O)throw new Error("Not authenticated");const I=[];for(const L of n){const U=`${Date.now()}_${L.name}`,B=`email-attachments/${O.id}/${U}`,{error:W}=await fe.storage.from("crm-documents").upload(B,L.file);W||I.push(B)}const $={inquiry_id:v.id,email_type:"sent",from_email:O.email,to_email:[h,...N?N.split(",").map(L=>L.trim()):[]],cc_email:N?N.split(",").map(L=>L.trim()):null,bcc_email:g?g.split(",").map(L=>L.trim()):null,subject:d,body:l,attachment_urls:I.length>0?I:null,sent_date:new Date().toISOString(),created_by:O.id},{error:F}=await fe.from("crm_email_activities").insert([$]);if(F)throw F;const R={};d.toLowerCase().includes("price")||d.toLowerCase().includes("quote")?(R.price_quoted=!0,R.price_quoted_date=new Date().toISOString().split("T")[0],R.status="price_quoted"):(d.toLowerCase().includes("coa")||d.toLowerCase().includes("msds"))&&(R.coa_sent=!0,R.coa_sent_date=new Date().toISOString().split("T")[0]),Object.keys(R).length>0&&await fe.from("crm_inquiries").update(R).eq("id",v.id),alert("Email sent successfully!"),A()}catch(O){console.error("Error sending email:",O),alert("Failed to send email. Please try again.")}finally{u(!1)}};return b?e.jsx(Te,{isOpen:b,onClose:A,title:"",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),c?"Reply to Email":"New Message"]}),e.jsxs("button",{onClick:()=>D(!S),className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded transition",children:[e.jsx(ea,{className:"w-4 h-4"}),"Templates",e.jsx(it,{className:"w-3 h-3"})]})]}),S&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Choose a template:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:j.map(O=>e.jsxs("button",{onClick:()=>Y(O),className:"px-3 py-2 text-left text-sm bg-white hover:bg-blue-50 border border-gray-200 rounded transition",children:[e.jsx("div",{className:"font-medium text-gray-900",children:O.template_name}),e.jsx("div",{className:"text-xs text-gray-500",children:O.category})]},O.id))})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 w-12",children:"To:"}),e.jsx("input",{type:"email",value:h,onChange:O=>x(O.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"recipient@example.com",required:!0}),e.jsx("button",{onClick:()=>i(!p),className:"text-sm text-blue-600 hover:text-blue-700",children:"Cc"}),e.jsx("button",{onClick:()=>r(!t),className:"text-sm text-blue-600 hover:text-blue-700",children:"Bcc"})]})}),p&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 w-12",children:"Cc:"}),e.jsx("input",{type:"text",value:N,onChange:O=>w(O.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"cc@example.com (comma separated)"})]}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 w-12",children:"Bcc:"}),e.jsx("input",{type:"text",value:g,onChange:O=>f(O.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"bcc@example.com (comma separated)"})]}),e.jsx("div",{children:e.jsx("input",{type:"text",value:d,onChange:O=>s(O.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Subject",required:!0})}),e.jsx("div",{children:e.jsx("textarea",{value:l.replace(/<[^>]*>/g,""),onChange:O=>o(O.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:15,placeholder:"Compose your email..."})}),n.length>0&&e.jsx("div",{className:"space-y-2",children:n.map((O,I)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:O.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",M(O.size),")"]})]}),e.jsx("button",{onClick:()=>K(I),className:"text-red-600 hover:text-red-700",children:e.jsx(He,{className:"w-4 h-4"})})]},I))}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("input",{ref:y,type:"file",multiple:!0,onChange:te,className:"hidden"}),e.jsxs("button",{onClick:()=>{var O;return(O=y.current)==null?void 0:O.click()},className:"flex items-center gap-2 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition",children:[e.jsx(yt,{className:"w-4 h-4"}),"Attach Files"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:A,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:a||!h||!d||!l,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"}),"Send"]})})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[e.jsx("strong",{children:"Inquiry:"})," ",v.inquiry_number," | ",v.company_name," | ",v.product_name]})]})}):null}function rd({inquiry:b,compact:A=!1,onMarkSent:v}){const c=[{type:"price",letter:"P",required:b.price_required??!0,sent:b.price_sent_at,label:"Price"},{type:"coa",letter:"C",required:b.coa_required??!0,sent:b.coa_sent_at,label:"COA"},{type:"sample",letter:"S",required:b.sample_required,sent:b.sample_sent_at,label:"Sample"},{type:"agency_letter",letter:"A",required:b.agency_letter_required,sent:b.agency_letter_sent_at,label:"Agency Letter"},{type:"others",letter:"O",required:b.others_required,sent:b.others_sent_at,label:"Others"}];return c.some(x=>x.required)?e.jsx("div",{className:"flex flex-wrap gap-1.5",children:c.filter(x=>x.required).map(x=>e.jsx("button",{onClick:()=>v==null?void 0:v(x.type),disabled:!v,className:`
            inline-flex items-center justify-center
            w-6 h-6 rounded text-xs font-bold
            transition-colors duration-150
            ${x.sent?"bg-green-100 text-green-700 hover:bg-green-200 cursor-pointer":"bg-red-100 text-red-700 hover:bg-red-200 cursor-pointer"}
            ${v?"":"cursor-default"}
          `,title:`${x.label}${x.sent?" - Sent (Click to unmark)":" - Pending (Click to mark as sent)"}`,children:x.letter},x.type))}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-500",children:[e.jsx(nd,{className:"w-3 h-3"}),!A&&"Nothing required"]})}function nd({className:b}){return e.jsx("svg",{className:b,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}const an={new:{label:"New",color:"bg-gray-100 text-gray-700 border-gray-300",icon:Hn},in_progress:{label:"In Progress",color:"bg-blue-100 text-blue-700 border-blue-300",icon:Mn},follow_up:{label:"Follow Up",color:"bg-purple-100 text-purple-700 border-purple-300",icon:Ke},won:{label:"Won",color:"bg-green-100 text-green-700 border-green-300",icon:Ve},lost:{label:"Lost",color:"bg-red-100 text-red-700 border-red-300",icon:Je},on_hold:{label:"On Hold",color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:ya}};function En({status:b,compact:A=!1}){const v=an[b]||an.new,c=v.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${v.color}`,children:[e.jsx(c,{className:"w-3 h-3"}),!A&&v.label]})}const Pt=[{value:"new",label:"New"},{value:"in_progress",label:"In Progress"},{value:"follow_up",label:"Follow Up"},{value:"won",label:"Won"},{value:"lost",label:"Lost"},{value:"on_hold",label:"On Hold"}];function ad({isOpen:b,onClose:A,inquiryId:v,inquiryNumber:c,onSuccess:h}){const[x,N]=Z.useState(""),[w,g]=Z.useState(""),[f,p]=Z.useState(""),[i,t]=Z.useState(!1),r=async l=>{if(l.preventDefault(),x.trim().length<10){alert("Please provide a detailed reason (at least 10 characters)");return}t(!0);try{const o={pipeline_status:"lost",lost_reason:x.trim(),lost_at:new Date().toISOString()};w.trim()&&(o.competitor_name=w.trim()),f.trim()&&(o.competitor_price=parseFloat(f));const{error:n}=await fe.from("crm_inquiries").update(o).eq("id",v);if(n)throw n;h(),A(),d()}catch(o){console.error("Error marking inquiry as lost:",o),alert("Failed to mark inquiry as lost. Please try again.")}finally{t(!1)}},d=()=>{N(""),g(""),p("")},s=()=>{i||(A(),d())};return e.jsx(Te,{isOpen:b,onClose:s,title:`Mark Inquiry #${c} as Lost`,children:e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Je,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"You are about to mark this inquiry as lost."}),e.jsx("p",{className:"mt-1 text-red-700",children:"This will move it to the Archive. Please provide details below."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Lost Reason ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{value:x,onChange:l=>N(l.target.value),placeholder:"e.g., Competitor offered lower price, Customer chose local supplier, Budget constraints...",rows:4,required:!0,minLength:10,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 10 characters. Be specific to help improve future quotes."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Competitor Name ",e.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),e.jsx("input",{type:"text",value:w,onChange:l=>g(l.target.value),placeholder:"e.g., ABC Trading Co.",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Competitor Price (USD) ",e.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),e.jsx("input",{type:"number",step:"0.01",value:f,onChange:l=>p(l.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:s,disabled:i,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i||x.trim().length<10,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4"}),"Mark as Lost"]})})]})]})})}function id({inquiries:b,onRefresh:A,canManage:v,onAddInquiry:c}){const{profile:h}=gt(),[x,N]=Z.useState(new Set),[w,g]=Z.useState([]),[f,p]=Z.useState(null),[i,t]=Z.useState(b),[r,d]=Z.useState({column:"inquiry_date",direction:"desc"}),[s,l]=Z.useState(null),[o,n]=Z.useState(""),[m,a]=Z.useState(!1),[u,j]=Z.useState(null),[E,S]=Z.useState(!1),[D,k]=Z.useState(""),[_,y]=Z.useState(!1),[C,T]=Z.useState(""),[q,G]=Z.useState(""),[Y,te]=Z.useState(!1),[K,M]=Z.useState(!1),[P,O]=Z.useState(!1),[I,$]=Z.useState(null),[F,R]=Z.useState(!1),[L,U]=Z.useState(null),[B,W]=Z.useState(""),[ie,ue]=Z.useState(!1),[ee,V]=Z.useState({price_required:!1,coa_required:!1,sample_required:!1,agency_letter_required:!1,others_required:!1}),[ne,de]=Z.useState(new Set),[he,Q]=Z.useState(new Map),X=Z.useRef(null),[se,le]=Z.useState({checkbox:50,inquiry_number:120,inquiry_date:120,product_name:200,specification:200,quantity:100,supplier_name:150,company_name:180,mail_subject:200,aceerp_no:120,status:130,pipeline_status:130,our_side:130,purchase_price:100,offered_price:100,delivery_date:120,priority:100,remarks:200}),[z,ae]=Z.useState(null),ce=[{value:"urgent",label:"Urgent",icon:e.jsx(Gn,{className:"w-3 h-3 text-red-600"})},{value:"high",label:"High",icon:e.jsx(Nr,{className:"w-3 h-3 text-orange-600"})},{value:"medium",label:"Medium",icon:e.jsx(nr,{className:"w-3 h-3 text-gray-400"})},{value:"low",label:"Low",icon:e.jsx(nr,{className:"w-3 h-3 text-gray-300"})}];Z.useEffect(()=>{ve()},[b,w,r]),Z.useEffect(()=>{function H(re){X.current&&!X.current.contains(re.target)&&p(null)}return document.addEventListener("mousedown",H),()=>document.removeEventListener("mousedown",H)},[]),Z.useEffect(()=>{const H=J=>{if(!z)return;const _e=J.clientX-z.startX,me=Math.max(50,z.startWidth+_e);le(Ne=>({...Ne,[z.column]:me}))},re=()=>{ae(null)};if(z)return document.addEventListener("mousemove",H),document.addEventListener("mouseup",re),()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",re)}},[z]);const oe=(H,re)=>{re.preventDefault(),re.stopPropagation(),ae({column:H,startX:re.clientX,startWidth:se[H]||150})},pe=({column:H,label:re,sortable:J=!0,className:_e=""})=>e.jsxs("th",{style:{width:se[H],minWidth:se[H]},className:`relative px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300 ${J?"cursor-pointer hover:bg-gray-100 select-none":""} ${_e}`,onClick:J?()=>we(H):void 0,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:re}),J&&$e(H)]}),e.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-400 group",onMouseDown:me=>oe(H,me),onClick:me=>me.stopPropagation(),children:e.jsx("div",{className:"absolute top-0 right-0 w-1 h-full bg-transparent group-hover:bg-blue-400"})})]}),ve=()=>{let H=[...b];w.forEach(re=>{re.values.length>0&&(H=H.filter(J=>{const _e=J[re.column];return re.values.includes(String(_e||""))}))}),r.column&&r.direction&&H.sort((re,J)=>{const _e=re[r.column],me=J[r.column];if(_e==null&&me==null)return 0;if(_e==null)return r.direction==="asc"?1:-1;if(me==null)return r.direction==="asc"?-1:1;const Ne=String(_e).toLowerCase(),ye=String(me).toLowerCase();return r.direction==="asc"?Ne>ye?1:Ne<ye?-1:0:Ne<ye?1:Ne>ye?-1:0}),t(H)},we=H=>{let re="asc";r.column===H&&(r.direction==="asc"?re="desc":r.direction==="desc"&&(re=null)),d({column:H,direction:re})},$e=H=>r.column!==H?e.jsx(Sr,{className:"w-3 h-3 text-gray-400"}):r.direction==="asc"?e.jsx(Nr,{className:"w-3 h-3 text-blue-600"}):r.direction==="desc"?e.jsx(ca,{className:"w-3 h-3 text-blue-600"}):e.jsx(Sr,{className:"w-3 h-3 text-gray-400"}),be=()=>{M(!0);try{const H=i.map(me=>{var Ne,ye;return{"No.":me.inquiry_number,Date:new Date(me.inquiry_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),Product:me.product_name,Specification:me.specification||"-",Qty:me.quantity,Supplier:me.supplier_name||"-",Country:me.supplier_country||"-",Company:me.company_name,"Mail Subject":me.mail_subject||"-","ACE ERP#":me.aceerp_no||"-",Pipeline:((Ne=Pt.find(Ue=>Ue.value===me.pipeline_status))==null?void 0:Ne.label)||"-","Price Needed":me.price_required?"Yes":"No","COA Needed":me.coa_required?"Yes":"No","Sample Needed":me.sample_required?"Yes":"No","Agency Letter Needed":me.agency_letter_required?"Yes":"No","Others Needed":me.others_required?"Yes":"No","Price Sent":me.price_sent_at?"Yes":"No","COA Sent":me.coa_sent_at?"Yes":"No","Sample Sent":me.sample_sent_at?"Yes":"No","Agency Letter Sent":me.agency_letter_sent_at?"Yes":"No","Purchase Price":me.purchase_price?`${me.purchase_price} ${me.purchase_price_currency||"USD"}`:"-","Offered Price":me.offered_price?`${me.offered_price} ${me.offered_price_currency||"USD"}`:"-","Delivery Date":me.delivery_date?new Date(me.delivery_date).toLocaleDateString("en-GB"):"-","Delivery Terms":me.delivery_terms||"-",Priority:((ye=ce.find(Ue=>Ue.value===me.priority))==null?void 0:ye.label)||me.priority,Remarks:me.remarks||"-"}}),re=qe.json_to_sheet(H);re["!cols"]=[{wch:15},{wch:12},{wch:30},{wch:20},{wch:10},{wch:20},{wch:12},{wch:25},{wch:30},{wch:12},{wch:15},{wch:13},{wch:12},{wch:15},{wch:20},{wch:12},{wch:11},{wch:13},{wch:19},{wch:18},{wch:18},{wch:15},{wch:18},{wch:10},{wch:30}];const J=qe.book_new();qe.book_append_sheet(J,re,"CRM Inquiries");const _e=`CRM-Inquiries-${new Date().toISOString().split("T")[0]}.xlsx`;ar(J,_e),xe({type:"success",title:"Success",message:`Exported ${H.length} inquiries to ${_e}`})}catch(H){console.error("Export error:",H),xe({type:"error",title:"Error",message:"Failed to export data. Please try again."})}finally{M(!1)}},ke=()=>{M(!0);try{const H=i.map(ye=>{var Ue,At;return{"No.":ye.inquiry_number,Date:new Date(ye.inquiry_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),Product:ye.product_name,Specification:ye.specification||"-",Qty:ye.quantity,Supplier:ye.supplier_name||"-",Country:ye.supplier_country||"-",Company:ye.company_name,"Mail Subject":ye.mail_subject||"-","ACE ERP#":ye.aceerp_no||"-",Pipeline:((Ue=Pt.find(at=>at.value===ye.pipeline_status))==null?void 0:Ue.label)||"-","Price Needed":ye.price_required?"Yes":"No","COA Needed":ye.coa_required?"Yes":"No","Sample Needed":ye.sample_required?"Yes":"No","Agency Letter Needed":ye.agency_letter_required?"Yes":"No","Others Needed":ye.others_required?"Yes":"No","Price Sent":ye.price_sent_at?"Yes":"No","COA Sent":ye.coa_sent_at?"Yes":"No","Sample Sent":ye.sample_sent_at?"Yes":"No","Agency Letter Sent":ye.agency_letter_sent_at?"Yes":"No","Purchase Price":ye.purchase_price?`${ye.purchase_price} ${ye.purchase_price_currency||"USD"}`:"-","Offered Price":ye.offered_price?`${ye.offered_price} ${ye.offered_price_currency||"USD"}`:"-","Delivery Date":ye.delivery_date?new Date(ye.delivery_date).toLocaleDateString("en-GB"):"-","Delivery Terms":ye.delivery_terms||"-",Priority:((At=ce.find(at=>at.value===ye.priority))==null?void 0:At.label)||ye.priority,Remarks:ye.remarks||"-"}}),re=qe.json_to_sheet(H),J=qe.sheet_to_csv(re),_e=new Blob([J],{type:"text/csv;charset=utf-8;"}),me=document.createElement("a"),Ne=URL.createObjectURL(_e);me.setAttribute("href",Ne),me.setAttribute("download",`CRM-Inquiries-${new Date().toISOString().split("T")[0]}.csv`),me.style.visibility="hidden",document.body.appendChild(me),me.click(),document.body.removeChild(me),xe({type:"success",title:"Success",message:`Exported ${H.length} inquiries to CSV. You can import this file to Google Sheets.`})}catch(H){console.error("Export error:",H),xe({type:"error",title:"Error",message:"Failed to export data. Please try again."})}finally{M(!1)}},xt=()=>{const H=[{Date:"02-12-2024",Product:"Example Product Name",Specification:"BP / USP / EP",Qty:"500 KG",Supplier:"Manufacturer Name",Country:"Japan",Company:"Customer Company Name","Mail Subject":"Inquiry for Product","ACE ERP#":"ACE-123","Price Needed":"Yes","COA Needed":"Yes","Sample Needed":"No","Agency Letter Needed":"No","Others Needed":"No","Purchase Price":"100","Purchase Price Currency":"USD","Offered Price":"150","Offered Price Currency":"USD","Delivery Date":"2025-12-31","Delivery Terms":"FOB Shanghai",Priority:"Medium",Remarks:"Additional notes"}],re=qe.json_to_sheet(H),J=qe.book_new();qe.book_append_sheet(J,re,"Import Template"),ar(J,"CRM-Import-Template.xlsx"),xe({type:"info",title:"Notice",message:"Template downloaded! Fill in your data and use the Import button to upload."})},nt=H=>{var _e;const re=(_e=H.target.files)==null?void 0:_e[0];if(!re)return;const J=new FileReader;J.onload=async me=>{var Ne;try{const ye=new Uint8Array((Ne=me.target)==null?void 0:Ne.result),Ue=Qn(ye,{type:"array"}),At=Ue.Sheets[Ue.SheetNames[0]],at=qe.sheet_to_json(At);if(at.length===0){xe({type:"error",title:"Error",message:"No data found in the file"});return}const{data:{user:Yt}}=await fe.auth.getUser();if(!Yt)throw new Error("Not authenticated");const Pn=je=>{if(!je)return new Date().toISOString().split("T")[0];if(typeof je=="number"){const ze=new Date(1899,11,30),Me=new Date(ze.getTime()+je*864e5),Be=Me.getFullYear(),_r=(Me.getMonth()+1).toString().padStart(2,"0"),Ln=Me.getDate().toString().padStart(2,"0");return`${Be}-${_r}-${Ln}`}const Ct=je.toString().trim(),gr=Ct.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2})$/);if(gr){let[,ze,Me,Be]=gr;return`${parseInt(Be)<30?`20${Be}`:`19${Be}`}-${Me.padStart(2,"0")}-${ze.padStart(2,"0")}`}const vr=Ct.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(vr){const[,ze,Me,Be]=vr;return`${Be}-${Me.padStart(2,"0")}-${ze.padStart(2,"0")}`}const xr=Ct.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(xr){const[,ze,Me,Be]=xr;return`${Be}-${Me.padStart(2,"0")}-${ze.padStart(2,"0")}`}const br=Ct.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(br){const[,ze,Me,Be]=br;return`${ze}-${Me.padStart(2,"0")}-${Be.padStart(2,"0")}`}return new Date().toISOString().split("T")[0]},pr=at.map(je=>({product_name:je.Product||"",specification:je.Specification||null,quantity:je.Qty||"",supplier_name:je.Supplier||null,supplier_country:je.Country||null,company_name:je.Company||"",mail_subject:je["Mail Subject"]||null,aceerp_no:je["ACE ERP#"]||null,price_required:(je["Price Needed"]||"").toLowerCase()==="yes",coa_required:(je["COA Needed"]||"").toLowerCase()==="yes",sample_required:(je["Sample Needed"]||"").toLowerCase()==="yes",agency_letter_required:(je["Agency Letter Needed"]||"").toLowerCase()==="yes",others_required:(je["Others Needed"]||"").toLowerCase()==="yes",purchase_price:je["Purchase Price"]?parseFloat(je["Purchase Price"]):null,purchase_price_currency:je["Purchase Price Currency"]||"USD",offered_price:je["Offered Price"]?parseFloat(je["Offered Price"]):null,offered_price_currency:je["Offered Price Currency"]||"USD",delivery_date:je["Delivery Date"]||null,delivery_terms:je["Delivery Terms"]||null,priority:(je.Priority||"medium").toLowerCase(),remarks:je.Remarks||null,inquiry_date:Pn(je.Date),pipeline_status:"new",status:"new",inquiry_source:"other",assigned_to:Yt.id,created_by:Yt.id})),{error:yr}=await fe.from("crm_inquiries").insert(pr);if(yr)throw yr;xe({type:"success",title:"Success",message:`Successfully imported ${pr.length} inquiries!`}),A(),H.target.value=""}catch(ye){console.error("Import error:",ye),xe({type:"error",title:"Error",message:"Failed to import data. Please check the file format and try again."}),H.target.value=""}},J.readAsArrayBuffer(re)},ge=(H,re)=>{g(J=>{const _e=J.find(me=>me.column===H);if(_e){const me=_e.values.includes(re)?_e.values.filter(Ne=>Ne!==re):[..._e.values,re];return me.length===0?J.filter(Ne=>Ne.column!==H):J.map(Ne=>Ne.column===H?{...Ne,values:me}:Ne)}return[...J,{column:H,values:[re]}]})},Se=H=>{g(re=>re.filter(J=>J.column!==H))},De=H=>{const re=b.map(J=>J[H]);return[...new Set(re)].filter(Boolean).sort()},Ce=H=>w.some(re=>re.column===H&&re.values.length>0),Re=H=>{N(re=>{const J=new Set(re);return J.has(H)?J.delete(H):J.add(H),J})},Ie=()=>{x.size===i.length?N(new Set):N(new Set(i.map(H=>H.id)))},Ye=async H=>{const re=new Set(ne);if(re.has(H))re.delete(H);else if(re.add(H),!he.has(H))try{const{data:J,error:_e}=await fe.from("crm_inquiry_items").select("*").eq("parent_inquiry_id",H).order("inquiry_number",{ascending:!0});if(_e)throw _e;const me=new Map(he);me.set(H,J||[]),Q(me)}catch(J){console.error("Error fetching inquiry items:",J)}de(re)},Pe=(H,re)=>{v&&(l({id:H.id,field:re}),n(String(H[re]||"")))},Oe=async()=>{if(s)try{const{error:H}=await fe.from("crm_inquiries").update({[s.field]:o||null}).eq("id",s.id);if(H)throw H;l(null),A()}catch(H){console.error("Error updating field:",H),xe({type:"error",title:"Error",message:"Failed to update. Please try again."})}},bt=async(H,re)=>{try{const{error:J}=await fe.from("crm_inquiries").update({priority:re}).eq("id",H.id);if(J)throw J;A()}catch(J){console.error("Error updating priority:",J)}},_t=async(H,re)=>{if(re==="lost"){$(H),O(!0);return}try{const{error:J}=await fe.from("crm_inquiries").update({pipeline_status:re}).eq("id",H.id);if(J)throw J;A()}catch(J){console.error("Error updating pipeline status:",J)}},wt=async(H,re)=>{var me;const J=`${re}_sent_at`;if(H[J]){if(!await rr({title:"Confirm",message:`Are you sure you want to unmark ${re.toUpperCase()} as sent?`,variant:"warning"}))return;try{const Ne={[J]:null},{error:ye}=await fe.from("crm_inquiries").update(Ne).eq("id",H.id);if(ye)throw ye;A(),xe({type:"success",title:"Success",message:`${re.toUpperCase()} unmarked!`})}catch(Ne){console.error("Error unmarking requirement:",Ne),xe({type:"error",title:"Error",message:"Failed to unmark. Please try again."})}return}if(re==="price"){U(H),W(((me=H.offered_price)==null?void 0:me.toString())||""),R(!0);return}try{const{error:Ne}=await fe.rpc("mark_requirement_sent",{inquiry_id:H.id,requirement_type:re});if(Ne)throw Ne;A(),xe({type:"success",title:"Success",message:`${re.toUpperCase()} marked as sent!`})}catch(Ne){console.error("Error marking requirement as sent:",Ne),xe({type:"error",title:"Error",message:"Failed to mark as sent. Please try again."})}},Nt=async()=>{if(!L)return;const H=B.trim()?parseFloat(B):null;try{const{error:re}=await fe.from("crm_inquiries").update({offered_price:H}).eq("id",L.id);if(re)throw re;const{error:J}=await fe.rpc("mark_requirement_sent",{inquiry_id:L.id,requirement_type:"price"});if(J)throw J;R(!1),U(null),W(""),A(),xe({type:"success",title:"Success",message:"Price marked as sent with offered price updated!"})}catch(re){console.error("Error saving offered price and marking sent:",re),xe({type:"error",title:"Error",message:"Failed to save. Please try again."})}},jt=()=>{const H=i.find(re=>x.has(re.id));H&&(j(H),a(!0))},St=async()=>{const H=i.find(re=>x.has(re.id));H&&(j(H),a(!0))},Et=()=>{S(!0)},Ot=async()=>{const H=i.find(re=>x.has(re.id));if(H)try{const{data:{user:re}}=await fe.auth.getUser();if(!re)throw new Error("Not authenticated");await fe.from("crm_activities").insert({inquiry_id:H.id,activity_type:"call",description:D,activity_date:new Date().toISOString().split("T")[0],is_completed:!0,created_by:re.id}),S(!1),k(""),xe({type:"success",title:"Success",message:"Call logged successfully!"}),A()}catch(re){console.error("Error logging call:",re),xe({type:"error",title:"Error",message:"Failed to log call. Please try again."})}},kt=async()=>{if(x.size===0)return;const H=x.size;if(await rr({title:"Confirm",message:`Are you sure you want to delete ${H} selected ${H===1?"inquiry":"inquiries"}? This action cannot be undone.`,variant:"danger",confirmLabel:"Delete"}))try{const re=Array.from(x),{error:J}=await fe.from("crm_inquiries").delete().in("id",re);if(J)throw J;N(new Set),xe({type:"success",title:"Success",message:`Successfully deleted ${H} ${H===1?"inquiry":"inquiries"}`}),A()}catch(re){console.error("Error deleting inquiries:",re),xe({type:"error",title:"Error",message:"Failed to delete inquiries. Please try again."})}},kn=()=>{y(!0)},An=async()=>{const H=i.find(re=>x.has(re.id));if(H)try{const{data:{user:re}}=await fe.auth.getUser();if(!re)throw new Error("Not authenticated");await fe.from("crm_activities").insert({inquiry_id:H.id,activity_type:"follow_up",description:q,activity_date:new Date().toISOString().split("T")[0],follow_up_date:C,is_completed:!1,created_by:re.id}),y(!1),T(""),G(""),xe({type:"success",title:"Success",message:"Follow-up scheduled successfully!"}),A()}catch(re){console.error("Error scheduling follow-up:",re),xe({type:"error",title:"Error",message:"Failed to schedule follow-up. Please try again."})}},Cn=()=>{const H=i.find(re=>x.has(re.id));H&&(V({price_required:H.price_required??!1,coa_required:H.coa_required??!1,sample_required:H.sample_required??!1,agency_letter_required:H.agency_letter_required??!1,others_required:H.others_required??!1}),ue(!0))},Tn=async()=>{const H=i.find(re=>x.has(re.id));if(H)try{const{error:re}=await fe.from("crm_inquiries").update(ee).eq("id",H.id);if(re)throw re;ue(!1),xe({type:"success",title:"Success",message:"Customer requirements updated successfully!"}),A()}catch(re){console.error("Error updating requirements:",re),xe({type:"error",title:"Error",message:"Failed to update requirements. Please try again."})}},ht=i.find(H=>x.has(H.id));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:be,disabled:K||i.length===0,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed",title:"Export to Excel (.xlsx)",children:[e.jsx(Er,{className:"w-3.5 h-3.5"}),K?"Exporting...":"Export Excel"]}),e.jsxs("button",{onClick:ke,disabled:K||i.length===0,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed",title:"Export to CSV for Google Sheets",children:[e.jsx(Lt,{className:"w-3.5 h-3.5"}),K?"Exporting...":"Export CSV"]}),v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-8 bg-gray-300 mx-2"}),e.jsxs("button",{onClick:xt,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition",title:"Download Excel template for bulk import",children:[e.jsx(Lt,{className:"w-3.5 h-3.5"}),"Download Template"]}),e.jsxs("label",{className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition cursor-pointer",children:[e.jsx(Er,{className:"w-3.5 h-3.5"}),"Import Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:nt,className:"hidden"})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-8 bg-gray-300 mx-2"}),e.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 transition",children:[e.jsx(Ft,{className:"w-3.5 h-3.5"}),"Add Inquiry"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 ml-2",children:[i.length," ",i.length===1?"inquiry":"inquiries",w.length>0&&" (filtered)",r.direction&&" (sorted)"]})]})}),x.size>0&&v&&ht&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Selected: ",e.jsx("span",{className:"font-bold",children:ht.inquiry_number})," - ",ht.product_name]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:jt,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 transition",children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),"Send Price"]}),e.jsxs("button",{onClick:St,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-green-700 bg-green-50 border border-green-200 rounded-md hover:bg-green-100 transition",children:[e.jsx(Qe,{className:"w-3.5 h-3.5"}),"Send COA/MSDS"]}),e.jsxs("button",{onClick:Et,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition",children:[e.jsx(vt,{className:"w-3.5 h-3.5"}),"Log Call"]}),e.jsxs("button",{onClick:kn,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition",children:[e.jsx(tt,{className:"w-3.5 h-3.5"}),"Schedule Follow-up"]}),e.jsxs("button",{onClick:()=>te(!0),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition",children:[e.jsx(wr,{className:"w-3.5 h-3.5"}),"Create Task"]}),e.jsxs("button",{onClick:Cn,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-50 border border-purple-200 rounded-md hover:bg-purple-100 transition",title:"Edit Customer Requirements",children:[e.jsx(wr,{className:"w-3.5 h-3.5"}),"Edit Requirements"]}),e.jsxs("button",{onClick:kt,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 transition",title:"Delete Selected",children:[e.jsx(He,{className:"w-3.5 h-3.5"}),"Delete"]}),e.jsx("button",{onClick:()=>N(new Set),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md transition",title:"Deselect",children:e.jsx(He,{className:"w-3.5 h-3.5"})})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden border border-gray-200",children:e.jsx("div",{className:"overflow-x-auto overflow-y-auto",style:{maxHeight:"calc(100vh - 280px)"},children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"px-3 py-2 border-r border-gray-300",children:e.jsx("input",{type:"checkbox",checked:x.size===i.length&&i.length>0,onChange:Ie,className:"rounded border-gray-300"})}),e.jsx(pe,{column:"inquiry_number",label:"No.",className:"whitespace-nowrap"}),e.jsx(pe,{column:"inquiry_date",label:"Date",className:"whitespace-nowrap"}),e.jsx(pe,{column:"product_name",label:"Product"}),e.jsx(pe,{column:"specification",label:"Specification"}),e.jsx(pe,{column:"quantity",label:"Qty"}),e.jsx(pe,{column:"supplier_name",label:"Supplier"}),e.jsxs("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300 min-w-[150px] relative",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Company"}),e.jsx("button",{onClick:()=>p(f==="company_name"?null:"company_name"),className:`p-0.5 rounded hover:bg-gray-200 ${Ce("company_name")?"text-blue-600":""}`,children:e.jsx(it,{className:"w-4 h-4"})})]}),f==="company_name"&&e.jsxs("div",{ref:X,className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 w-64",children:[e.jsxs("div",{className:"p-2 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:"Filter Company"}),Ce("company_name")&&e.jsx("button",{onClick:()=>Se("company_name"),className:"text-xs text-blue-600 hover:text-blue-700",children:"Clear"})]}),e.jsx("div",{className:"p-2 max-h-64 overflow-y-auto",children:De("company_name").map(H=>{var J;const re=(J=w.find(_e=>_e.column==="company_name"))==null?void 0:J.values.includes(String(H));return e.jsxs("label",{className:"flex items-center gap-2 p-1.5 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:()=>ge("company_name",String(H)),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:String(H)})]},String(H))})})]})]}),e.jsx(pe,{column:"mail_subject",label:"Mail Subject"}),e.jsx(pe,{column:"aceerp_no",label:"ACE ERP#"}),e.jsxs("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300 relative min-w-[130px]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Pipeline"}),e.jsx("button",{onClick:()=>p(f==="pipeline_status"?null:"pipeline_status"),className:`p-0.5 rounded hover:bg-gray-200 ${Ce("pipeline_status")?"text-blue-600":""}`,children:e.jsx(it,{className:"w-4 h-4"})})]}),f==="pipeline_status"&&e.jsxs("div",{ref:X,className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 w-56",children:[e.jsxs("div",{className:"p-2 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:"Filter Pipeline"}),Ce("pipeline_status")&&e.jsx("button",{onClick:()=>Se("pipeline_status"),className:"text-xs text-blue-600 hover:text-blue-700",children:"Clear"})]}),e.jsx("div",{className:"p-2 max-h-64 overflow-y-auto",children:Pt.map(H=>{var J;const re=(J=w.find(_e=>_e.column==="pipeline_status"))==null?void 0:J.values.includes(H.value);return e.jsxs("label",{className:"flex items-center gap-2 p-1.5 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:()=>ge("pipeline_status",H.value),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:H.label})]},H.value)})})]})]}),e.jsxs("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300 min-w-[120px] relative",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Our Side"}),e.jsx("button",{onClick:()=>p(f==="our_side"?null:"our_side"),className:`p-0.5 rounded hover:bg-gray-200 ${Ce("our_side")?"text-blue-600":""}`,children:e.jsx(it,{className:"w-4 h-4"})})]}),f==="our_side"&&e.jsxs("div",{ref:X,className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 w-56",children:[e.jsxs("div",{className:"p-2 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:"Filter Our Side"}),Ce("our_side")&&e.jsx("button",{onClick:()=>Se("our_side"),className:"text-xs text-blue-600 hover:text-blue-700",children:"Clear"})]}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:()=>{const H=b.filter(re=>(re.price_required??!0)&&!re.price_sent_at);t(H),p(null)},className:"w-full flex items-center gap-2 p-2 hover:bg-red-50 rounded text-left text-sm",children:[e.jsx("span",{className:"w-5 h-5 rounded bg-red-100 text-red-700 flex items-center justify-center font-bold text-xs",children:"P"}),e.jsx("span",{children:"Price Pending"})]}),e.jsxs("button",{onClick:()=>{const H=b.filter(re=>(re.coa_required??!0)&&!re.coa_sent_at);t(H),p(null)},className:"w-full flex items-center gap-2 p-2 hover:bg-red-50 rounded text-left text-sm",children:[e.jsx("span",{className:"w-5 h-5 rounded bg-red-100 text-red-700 flex items-center justify-center font-bold text-xs",children:"C"}),e.jsx("span",{children:"COA Pending"})]}),e.jsxs("button",{onClick:()=>{const H=b.filter(re=>(re.price_required??!0)&&re.price_sent_at);t(H),p(null)},className:"w-full flex items-center gap-2 p-2 hover:bg-green-50 rounded text-left text-sm",children:[e.jsx("span",{className:"w-5 h-5 rounded bg-green-100 text-green-700 flex items-center justify-center font-bold text-xs",children:"P"}),e.jsx("span",{children:"Price Sent"})]}),e.jsxs("button",{onClick:()=>{const H=b.filter(re=>(re.coa_required??!0)&&re.coa_sent_at);t(H),p(null)},className:"w-full flex items-center gap-2 p-2 hover:bg-green-50 rounded text-left text-sm",children:[e.jsx("span",{className:"w-5 h-5 rounded bg-green-100 text-green-700 flex items-center justify-center font-bold text-xs",children:"C"}),e.jsx("span",{children:"COA Sent"})]})]})]})]}),(h==null?void 0:h.role)==="admin"&&e.jsxs("th",{style:{width:se.purchase_price,minWidth:se.purchase_price},className:"relative px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300",children:[e.jsx("span",{children:"P.Price"}),e.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-400",onMouseDown:H=>oe("purchase_price",H)})]}),e.jsxs("th",{style:{width:se.offered_price,minWidth:se.offered_price},className:"relative px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300",children:[e.jsx("span",{children:"O.Price"}),e.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-400",onMouseDown:H=>oe("offered_price",H)})]}),e.jsxs("th",{style:{width:se.delivery_date,minWidth:se.delivery_date},className:"relative px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300",children:[e.jsx("span",{children:"Delivery"}),e.jsx("div",{className:"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-400",onMouseDown:H=>oe("delivery_date",H)})]}),e.jsxs("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300 relative",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Priority"}),e.jsx("button",{onClick:()=>p(f==="priority"?null:"priority"),className:`p-0.5 rounded hover:bg-gray-200 ${Ce("priority")?"text-blue-600":""}`,children:e.jsx(it,{className:"w-4 h-4"})})]}),f==="priority"&&e.jsxs("div",{ref:X,className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 w-48",children:[e.jsxs("div",{className:"p-2 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:"Filter Priority"}),Ce("priority")&&e.jsx("button",{onClick:()=>Se("priority"),className:"text-xs text-blue-600 hover:text-blue-700",children:"Clear"})]}),e.jsx("div",{className:"p-2",children:ce.map(H=>{var J;const re=(J=w.find(_e=>_e.column==="priority"))==null?void 0:J.values.includes(H.value);return e.jsxs("label",{className:"flex items-center gap-2 p-1.5 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:()=>ge("priority",H.value),className:"rounded border-gray-300"}),H.icon,e.jsx("span",{className:"text-sm",children:H.label})]},H.value)})})]})]}),e.jsx(pe,{column:"remarks",label:"Remarks"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:18,className:"px-3 py-8 text-center text-gray-500",children:"No inquiries found"})}):i.map(H=>{var re;return e.jsxs(qn.Fragment,{children:[e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-blue-50 transition ${x.has(H.id)?"bg-blue-100":""}`,children:[e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:e.jsx("input",{type:"checkbox",checked:x.has(H.id),onChange:()=>Re(H.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 font-medium text-blue-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[H.has_items&&e.jsx("button",{onClick:()=>Ye(H.id),className:"hover:bg-blue-100 rounded p-0.5 transition",title:ne.has(H.id)?"Collapse products":"Expand products",children:ne.has(H.id)?e.jsx(it,{className:"w-4 h-4"}):e.jsx(dr,{className:"w-4 h-4"})}),H.is_multi_product&&e.jsx(Wn,{className:"w-3.5 h-3.5 text-blue-500",title:"Multi-product inquiry"}),e.jsx("span",{children:H.inquiry_number})]})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-gray-600 whitespace-nowrap",children:new Date(H.inquiry_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="product_name"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>Pe(H,"product_name"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded",children:H.product_name})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-gray-600 text-xs",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="specification"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none text-xs",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>Pe(H,"specification"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded",children:H.specification||"-"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="quantity"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>Pe(H,"quantity"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded",children:H.quantity})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="supplier_name"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",autoFocus:!0}):e.jsxs("div",{onDoubleClick:()=>Pe(H,"supplier_name"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded",children:[e.jsx("div",{children:H.supplier_name||"-"}),H.supplier_country&&e.jsx("div",{className:"text-xs text-gray-500",children:H.supplier_country})]})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:e.jsx("div",{className:"font-medium",children:H.company_name})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="mail_subject"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none text-xs",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>Pe(H,"mail_subject"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded text-xs",title:H.mail_subject||"",children:H.mail_subject?e.jsx("div",{className:"line-clamp-2",children:H.mail_subject}):e.jsx("span",{className:"text-gray-400",children:"-"})})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="aceerp_no"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>v&&Pe(H,"aceerp_no"),className:v?"cursor-text hover:bg-yellow-50 px-2 py-1 rounded":"px-2 py-1",children:H.aceerp_no||(v?e.jsx("span",{className:"text-gray-400 text-xs",children:"Click to add"}):"-")})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:e.jsx("select",{value:H.pipeline_status||"new",onChange:J=>_t(H,J.target.value),disabled:!v,className:"w-full px-2 py-1 border border-gray-300 rounded text-xs focus:border-blue-500 focus:outline-none cursor-pointer bg-white",children:Pt.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(rd,{inquiry:H,onMarkSent:v?J=>wt(H,J):void 0})})}),(h==null?void 0:h.role)==="admin"&&e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="purchase_price"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none text-xs",autoFocus:!0,placeholder:"Click to add"}):e.jsx("div",{onDoubleClick:()=>Pe(H,"purchase_price"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded text-xs",children:H.purchase_price?`$${H.purchase_price.toLocaleString("en-US",{minimumFractionDigits:2})}`:e.jsx("span",{className:"text-gray-400",children:"Click to add"})})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="offered_price"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none text-xs",autoFocus:!0,placeholder:"Click to add"}):e.jsx("div",{onDoubleClick:()=>v&&Pe(H,"offered_price"),className:v?"cursor-text hover:bg-yellow-50 px-2 py-1 rounded text-xs":"px-2 py-1 text-xs",children:H.offered_price?`$${H.offered_price.toLocaleString("en-US",{minimumFractionDigits:2})}`:v?e.jsx("span",{className:"text-gray-400",children:"Click to add"}):"-"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="delivery_date"?e.jsx("input",{type:"date",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none text-xs",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>v&&Pe(H,"delivery_date"),className:v?"cursor-text hover:bg-yellow-50 px-2 py-1 rounded text-xs whitespace-nowrap":"px-2 py-1 text-xs whitespace-nowrap",children:H.delivery_date?new Date(H.delivery_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):v?e.jsx("span",{className:"text-gray-400",children:"Click to add"}):"-"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:e.jsx("select",{value:H.priority,onChange:J=>bt(H,J.target.value),disabled:!v,className:"w-full px-2 py-1 border border-gray-300 rounded text-xs focus:border-blue-500 focus:outline-none cursor-pointer",children:ce.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:(s==null?void 0:s.id)===H.id&&(s==null?void 0:s.field)==="remarks"?e.jsx("input",{type:"text",value:o,onChange:J=>n(J.target.value),onBlur:Oe,onKeyDown:J=>{J.key==="Enter"&&Oe(),J.key==="Escape"&&l(null)},className:"w-full px-2 py-1 border-2 border-blue-500 rounded focus:outline-none",autoFocus:!0}):e.jsx("div",{onDoubleClick:()=>Pe(H,"remarks"),className:"cursor-text hover:bg-yellow-50 px-2 py-1 rounded text-gray-600",children:H.remarks||"-"})})]}),H.has_items&&ne.has(H.id)&&((re=he.get(H.id))==null?void 0:re.map(J=>e.jsxs("tr",{className:"bg-blue-50 border-b border-blue-100",children:[e.jsx("td",{className:"px-3 py-2 border-r border-gray-200"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-sm text-blue-700 pl-8",children:J.inquiry_number}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-500",children:"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-sm",children:J.product_name}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-600",children:J.specification||"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-sm",children:J.quantity}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-500",children:"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-500",children:"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-500",children:"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-500",children:"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200",children:e.jsx(En,{status:J.pipeline_stage})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-center",children:J.document_sent?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ta,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:J.document_sent_at?new Date(J.document_sent_at).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):""})]}):e.jsx(Je,{className:"w-4 h-4 text-gray-400 mx-auto"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200 text-xs text-gray-600",children:J.notes||"-"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200"}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-200"})]},J.id)))]},H.id)})})]})})}),m&&u&&e.jsx(td,{isOpen:m,onClose:()=>{a(!1),j(null),A()},inquiry:u}),e.jsx(Te,{isOpen:E,onClose:()=>{S(!1),k("")},title:"Log Phone Call",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Call Notes *"}),e.jsx("textarea",{value:D,onChange:H=>k(H.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"What was discussed during the call?",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{S(!1),k("")},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:Ot,disabled:!D.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:"Save Call Log"})]})]})}),e.jsx(Te,{isOpen:_,onClose:()=>{y(!1),T(""),G("")},title:"Schedule Follow-up",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date *"}),e.jsx("input",{type:"date",value:C,onChange:H=>T(H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:q,onChange:H=>G(H.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"What needs to be followed up?"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{y(!1),T(""),G("")},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:An,disabled:!C,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50",children:"Schedule Follow-up"})]})]})}),Y&&ht&&e.jsx(Kn,{isOpen:Y,onClose:()=>te(!1),onSuccess:()=>{te(!1),A()},initialData:{inquiry_id:ht.id}}),I&&e.jsx(ad,{isOpen:P,onClose:()=>{O(!1),$(null)},inquiryId:I.id,inquiryNumber:I.inquiry_number,onSuccess:()=>{A(),$(null)}}),e.jsx(Te,{isOpen:F,onClose:()=>{R(!1),U(null),W("")},title:"Enter Offered Price",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Inquiry: ",(L==null?void 0:L.inquiry_number)||"-"]}),e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product: ",(L==null?void 0:L.product_name)||"-"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Offered Price (O.Price) *"}),e.jsx("input",{type:"number",value:B,onChange:H=>W(H.target.value),placeholder:"Enter offered price",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",step:"0.01",min:"0"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter the price you offered to the customer"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{R(!1),U(null),W("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:Nt,className:"px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:"Save & Mark Price as Sent"})]})]})}),e.jsx(Te,{isOpen:ie,onClose:()=>ue(!1),title:"Edit Customer Requirements",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Check what the customer has requested:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ee.price_required,onChange:H=>V({...ee,price_required:H.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Price"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ee.coa_required,onChange:H=>V({...ee,coa_required:H.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"COA"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ee.sample_required,onChange:H=>V({...ee,sample_required:H.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Sample"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ee.agency_letter_required,onChange:H=>V({...ee,agency_letter_required:H.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Agency Letter"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ee.others_required,onChange:H=>V({...ee,others_required:H.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Others"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6 pt-4 border-t",children:[e.jsx("button",{onClick:()=>ue(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Tn,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition",children:"Save Requirements"})]})]})})]})}function sd({onReminderCreated:b}){const[A,v]=Z.useState([]),[c,h]=Z.useState([]),[x,N]=Z.useState(new Date),[w,g]=Z.useState(null),[f,p]=Z.useState("month"),[i,t]=Z.useState(!0),[r,d]=Z.useState(!1),[s,l]=Z.useState(null),[o,n]=Z.useState(null),[m,a]=Z.useState([]);Z.useEffect(()=>{j(),E()},[x,f]),Z.useEffect(()=>{o!=null&&o.participants&&o.participants.length>0&&u(o.participants)},[o]);const u=async O=>{try{const{data:I,error:$}=await fe.from("user_profiles").select("id, full_name").in("id",O);if($)throw $;a(I||[])}catch(I){console.error("Error loading participants:",I)}},j=async()=>{try{let O=fe.from("crm_reminders").select(`
          *,
          crm_inquiries (
            inquiry_number,
            company_name,
            product_name
          )
        `);if(f==="month"){const F=new Date(x.getFullYear(),x.getMonth(),1),R=new Date(x.getFullYear(),x.getMonth()+1,0);O=O.gte("due_date",F.toISOString()).lte("due_date",R.toISOString())}const{data:I,error:$}=await O.order("due_date",{ascending:!0});if($)throw $;v(I||[])}catch(O){console.error("Error loading reminders:",O)}finally{t(!1)}},E=async()=>{try{const{data:{user:O}}=await fe.auth.getUser();if(!O)return;let I=fe.from("crm_activities").select("*, user_profiles!crm_activities_created_by_fkey(full_name), crm_contacts!crm_activities_customer_id_fkey(company_name)").in("activity_type",["meeting","video_call","phone_call"]).not("follow_up_date","is",null).or(`created_by.eq.${O.id},participants.cs.{${O.id}}`).order("follow_up_date",{ascending:!0});if(f==="month"){const R=new Date(x.getFullYear(),x.getMonth(),1),L=new Date(x.getFullYear(),x.getMonth()+1,0);I=I.gte("follow_up_date",R.toISOString()).lte("follow_up_date",L.toISOString())}const{data:$,error:F}=await I;if(F)throw F;h($||[])}catch(O){console.error("Error loading appointments:",O)}},S=async O=>{try{const{error:I}=await fe.from("crm_reminders").update({is_completed:!O.is_completed,completed_at:O.is_completed?null:new Date().toISOString()}).eq("id",O.id);if(I)throw I;j()}catch(I){console.error("Error updating reminder:",I)}},D=async(O,I)=>{try{const $=new Date(O.due_date);$.setDate($.getDate()+I);const{error:F}=await fe.from("crm_reminders").update({due_date:$.toISOString()}).eq("id",O.id);if(F)throw F;j(),d(!1)}catch($){console.error("Error snoozing reminder:",$)}},k=O=>new Date(O.getFullYear(),O.getMonth()+1,0).getDate(),_=O=>new Date(O.getFullYear(),O.getMonth(),1).getDay(),y=O=>A.filter(I=>{const $=new Date(I.due_date);return $.getDate()===O.getDate()&&$.getMonth()===O.getMonth()&&$.getFullYear()===O.getFullYear()}),C=O=>c.filter(I=>{const $=new Date(I.follow_up_date);return $.getDate()===O.getDate()&&$.getMonth()===O.getMonth()&&$.getFullYear()===O.getFullYear()}),T=()=>{const O=new Date;return O.setHours(0,0,0,0),A.filter(I=>{const $=new Date(I.due_date);return $.setHours(0,0,0,0),$.getTime()===O.getTime()&&!I.is_completed})},q=()=>{const O=new Date;return O.setHours(0,0,0,0),A.filter(I=>{const $=new Date(I.due_date);return $.setHours(0,0,0,0),$<O&&!I.is_completed})},G=()=>{const O=new Date;O.setHours(0,0,0,0);const I=new Date(O);return I.setDate(I.getDate()+7),A.filter($=>{const F=new Date($.due_date);return F.setHours(0,0,0,0),F>O&&F<=I&&!$.is_completed})},Y=()=>{N(new Date(x.getFullYear(),x.getMonth()-1))},te=()=>{N(new Date(x.getFullYear(),x.getMonth()+1))},K={follow_up:"bg-blue-100 text-blue-800 border-blue-200",send_coa:"bg-orange-100 text-orange-800 border-orange-200",send_sample:"bg-green-100 text-green-800 border-green-200",send_price:"bg-purple-100 text-purple-800 border-purple-200",custom:"bg-gray-100 text-gray-800 border-gray-200"},M=()=>{const O=k(x),I=_(x),$=[];for(let F=0;F<I;F++)$.push(e.jsx("div",{className:"min-h-24 p-2 bg-gray-50"},`empty-${F}`));for(let F=1;F<=O;F++){const R=new Date(x.getFullYear(),x.getMonth(),F),L=y(R),U=C(R),B=R.toDateString()===new Date().toDateString();[...L,...U],$.push(e.jsxs("div",{className:`min-h-24 p-2 border border-gray-200 ${B?"bg-blue-50":"bg-white"} hover:bg-gray-50 transition cursor-pointer`,onClick:()=>{g(R),L.length>0?(l(L[0]),d(!0)):U.length>0&&(n(U[0]),d(!0))},children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${B?"text-blue-600":"text-gray-900"}`,children:F}),e.jsxs("div",{className:"space-y-1",children:[U.map(W=>{var ee;const ie=new Date(W.follow_up_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),ue=((ee=W.crm_contacts)==null?void 0:ee.company_name)||"No Customer";return e.jsxs("div",{className:`text-xs p-1 rounded border bg-purple-100 text-purple-800 border-purple-200 truncate ${W.is_completed?"opacity-50 line-through":""}`,title:`${ie} - ${ue}`,children:[" ",ie," - ",ue]},W.id)}),L.map(W=>e.jsx("div",{className:`text-xs p-1 rounded border ${K[W.reminder_type]} truncate ${W.is_completed?"opacity-50 line-through":""}`,title:W.title,children:W.title},W.id))]})]},F))}return $},P=()=>{const O=q(),I=T(),$=G();return e.jsxs("div",{className:"space-y-6",children:[O.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-red-600 mb-2 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Overdue (",O.length,")"]}),e.jsx("div",{className:"space-y-2",children:O.map(F=>e.jsx(tr,{reminder:F,onToggleComplete:S,onViewDetails:()=>{l(F),d(!0)}},F.id))})]}),I.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-600 mb-2 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Today (",I.length,")"]}),e.jsx("div",{className:"space-y-2",children:I.map(F=>e.jsx(tr,{reminder:F,onToggleComplete:S,onViewDetails:()=>{l(F),d(!0)}},F.id))})]}),$.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Upcoming (Next 7 days)"}),e.jsx("div",{className:"space-y-2",children:$.map(F=>e.jsx(tr,{reminder:F,onToggleComplete:S,onViewDetails:()=>{l(F),d(!0)}},F.id))})]}),O.length===0&&I.length===0&&$.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),A.length===0?e.jsx("p",{children:"No reminders found. Create one using the quick actions!"}):e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"No upcoming reminders in the next 7 days"}),e.jsxs("p",{className:"text-sm mt-1",children:["You have ",A.length," reminder",A.length===1?"":"s"," total (all past or completed)"]})]})]})]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-blue-600"}),"Reminders & Tasks"]}),e.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>p("month"),className:`px-3 py-1 rounded text-sm ${f==="month"?"bg-white shadow":"text-gray-600"}`,children:"Month"}),e.jsx("button",{onClick:()=>p("list"),className:`px-3 py-1 rounded text-sm ${f==="list"?"bg-white shadow":"text-gray-600"}`,children:"List"})]})]}),f==="month"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Y,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(da,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-semibold min-w-40 text-center",children:x.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:te,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(dr,{className:"w-5 h-5"})})]})]}),i?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):f==="month"?e.jsxs("div",{className:"space-y-2",children:[A.length===0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800",children:[e.jsxs("p",{className:"font-medium",children:["No reminders for ",x.toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),e.jsx("p",{className:"text-xs mt-1",children:'Use the arrows above to navigate to other months, or switch to "List" view to see all reminders.'})]}),A.length>0&&e.jsxs("div",{className:"text-sm text-gray-600 px-2",children:[A.length," reminder",A.length===1?"":"s"," in ",x.toLocaleDateString("en-US",{month:"long"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(O=>e.jsx("div",{className:"p-2 text-center text-sm font-semibold text-gray-700 bg-gray-50",children:O},O))}),e.jsx("div",{className:"grid grid-cols-7",children:M()})]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:P()}),e.jsxs(Te,{isOpen:r,onClose:()=>{d(!1),l(null),n(null)},title:s?"Reminder Details":"Appointment Details",children:[s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-3 rounded-lg border ${K[s.reminder_type]}`,children:[e.jsx("p",{className:"font-semibold",children:s.title}),e.jsxs("p",{className:"text-sm mt-1",children:["Due: ",$t(s.due_date)]})]}),s.description&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description})]}),s.crm_inquiries&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Related Inquiry"}),e.jsxs("div",{className:"mt-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium",children:["#",s.crm_inquiries.inquiry_number]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.crm_inquiries.company_name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.crm_inquiries.product_name})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(s,1),className:"text-sm px-3 py-1.5 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Snooze 1 day"}),e.jsx("button",{onClick:()=>D(s,3),className:"text-sm px-3 py-1.5 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Snooze 3 days"})]}),e.jsxs("button",{onClick:()=>{S(s),d(!1)},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:[e.jsx(Ve,{className:"w-4 h-4"}),s.is_completed?"Mark Incomplete":"Mark Complete"]})]})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-blue-500 bg-blue-50 p-4 rounded",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:o.subject}),o.crm_contacts&&e.jsx("p",{className:"text-sm font-medium text-blue-600 mt-1",children:o.crm_contacts.company_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 capitalize",children:o.activity_type.replace("_"," ")}),e.jsxs("p",{className:"text-sm font-medium mt-1 flex items-center gap-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),new Date(o.follow_up_date).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),o.description&&e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:o.description}),o.participants&&o.participants.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4 text-gray-500"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:m.map(O=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:O.full_name},O.id))})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"Close"})})]})]})]})}function tr({reminder:b,onToggleComplete:A,onViewDetails:v}){const c={follow_up:"border-blue-200",send_coa:"border-orange-200",send_sample:"border-green-200",send_price:"border-purple-200",custom:"border-gray-200"},h=new Date(b.due_date)<new Date&&!b.is_completed;return e.jsx("div",{className:`p-3 border-l-4 ${c[b.reminder_type]} bg-white rounded-lg shadow-sm hover:shadow-md transition ${b.is_completed?"opacity-60":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:v,children:[e.jsx("p",{className:`font-medium ${b.is_completed?"line-through":""}`,children:b.title}),b.crm_inquiries&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["#",b.crm_inquiries.inquiry_number," - ",b.crm_inquiries.company_name]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs ${h?"text-red-600 font-medium":"text-gray-500"}`,children:$t(b.due_date)}),h&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full",children:"Overdue"})]})]}),e.jsx("button",{onClick:()=>A(b),className:`p-1 rounded ${b.is_completed?"text-green-600":"text-gray-400 hover:text-green-600"}`,children:e.jsx(Ve,{className:"w-5 h-5"})})]})})}function od({canManage:b,onInquiryClick:A}){const[v,c]=Z.useState([]),[h,x]=Z.useState([]),[N,w]=Z.useState(!0),[g,f]=Z.useState(null),[p,i]=Z.useState(null);Z.useEffect(()=>{t(),r()},[]);const t=async()=>{try{f(null);const{data:u,error:j}=await fe.from("crm_pipeline_stages").select("*").eq("is_active",!0).order("stage_order",{ascending:!0});if(j)throw console.error("Database error loading stages:",j),new Error(j.message||"Failed to load pipeline stages");x(u||[])}catch(u){const j=u instanceof Error?u.message:"Failed to load pipeline stages";console.error("Error loading stages:",u),f(j),x([])}},r=async()=>{try{f(null);const{data:u,error:j}=await fe.from("crm_inquiries").select("*").order("created_at",{ascending:!1});if(j)throw console.error("Database error loading inquiries:",j),new Error(j.message||"Failed to load inquiries");c(u||[])}catch(u){const j=u instanceof Error?u.message:"Failed to load inquiries";console.error("Error loading inquiries:",u),f(j),c([])}finally{w(!1)}},d={"New Inquiry":"new","Price Quoted":"price_quoted","COA Pending":"coa_pending","Sample Sent":"sample_sent",Negotiation:"negotiation","PO Received":"po_received",Won:"won",Lost:"lost"},s=u=>{const j=d[u];return v.filter(E=>E.status===j)},l=u=>{b&&i(u)},o=u=>{u.preventDefault()},n=async u=>{if(!p||!b)return;const j=d[u];if(p.status===j){i(null);return}try{const{error:E}=await fe.from("crm_inquiries").update({status:j}).eq("id",p.id);if(E)throw E;r()}catch(E){console.error("Error updating inquiry status:",E),alert("Failed to update inquiry status")}finally{i(null)}},m=u=>{const j=new Date(u.created_at),S=Math.abs(new Date().getTime()-j.getTime());return Math.ceil(S/(1e3*60*60*24))},a={urgent:"border-l-4 border-red-500",high:"border-l-4 border-orange-500",medium:"border-l-4 border-yellow-500",low:"border-l-4 border-gray-400"};return N?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):g?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-red-600 mt-0.5",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Error Loading Pipeline"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:g}),e.jsx("button",{onClick:()=>{t(),r()},className:"mt-3 text-sm font-medium text-red-700 hover:text-red-800 underline",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Pipeline View"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",v.length," inquiries"]})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",children:h.map(u=>{const j=s(u.stage_name),E=j.reduce((S,D)=>S+(D.estimated_value||0),0);return e.jsxs("div",{className:"flex-shrink-0 w-80 bg-gray-50 rounded-lg",onDragOver:o,onDrop:()=>n(u.stage_name),children:[e.jsxs("div",{className:"p-4 rounded-t-lg",style:{backgroundColor:u.color+"20"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:u.stage_name}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:j.length})]}),E>0&&e.jsxs("div",{className:"text-xs text-gray-600",children:["Value: Rp ",E.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx("div",{className:"p-2 space-y-2 max-h-[600px] overflow-y-auto",children:j.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No inquiries"}):j.map(S=>e.jsxs("div",{draggable:b,onDragStart:()=>l(S),onClick:()=>A&&A(S),className:`bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition cursor-pointer ${a[S.priority]||""} ${b?"cursor-move":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["#",S.inquiry_number]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[m(S),"d"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ua,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:S.company_name})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Bn,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:S.product_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:S.quantity}),e.jsx("span",{children:new Date(S.inquiry_date).toLocaleDateString("en-GB")})]}),S.priority==="urgent"&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"URGENT"})]}),S.estimated_value&&S.estimated_value>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 font-medium",children:[e.jsx(Fn,{className:"w-3 h-3"}),e.jsxs("span",{children:["Rp ",S.estimated_value.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]},S.id))})]},u.id)})}),!b&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"You have view-only access to the pipeline. Contact admin to manage inquiries."})]})]})}function ld({inquiry:b,onClose:A,onSent:v}){const[c,h]=Z.useState([]),[x,N]=Z.useState(null),[w,g]=Z.useState(""),[f,p]=Z.useState(""),[i,t]=Z.useState(""),[r,d]=Z.useState(!1),[s,l]=Z.useState(!1);Z.useEffect(()=>{o(),b&&g(b.contact_email||"")},[b]);const o=async()=>{try{const{data:a,error:u}=await fe.from("crm_email_templates").select("*").eq("is_active",!0).order("template_name");if(u)throw u;h(a||[])}catch(a){console.error("Error loading templates:",a)}},n=a=>{let u=a.subject,j=a.body;b&&(u=u.replace(/\{\{company_name\}\}/g,b.company_name).replace(/\{\{contact_person\}\}/g,b.contact_person||"").replace(/\{\{product\}\}/g,b.product_name).replace(/\{\{quantity\}\}/g,b.quantity).replace(/\{\{inquiry_number\}\}/g,b.inquiry_number),j=j.replace(/\{\{company_name\}\}/g,b.company_name).replace(/\{\{contact_person\}\}/g,b.contact_person||"Sir/Madam").replace(/\{\{product\}\}/g,b.product_name).replace(/\{\{quantity\}\}/g,b.quantity).replace(/\{\{inquiry_number\}\}/g,b.inquiry_number)),p(u),t(j),N(a),l(!1)},m=async()=>{if(!w||!f||!i){xe({type:"error",title:"Error",message:"Please fill in all required fields"});return}d(!0);try{const{data:{user:a}}=await fe.auth.getUser();if(!a)throw new Error("Not authenticated");const u=w.split(";").map(S=>S.trim()).filter(S=>S.length>0),j={inquiry_id:(b==null?void 0:b.id)||null,contact_id:null,email_type:"sent",from_email:a.email,to_email:u,subject:f,body:i,template_id:(x==null?void 0:x.id)||null,sent_date:new Date().toISOString(),created_by:a.id},{error:E}=await fe.from("crm_email_activities").insert([j]);if(E)throw E;x&&await fe.from("crm_email_templates").update({use_count:x.use_count+1,last_used:new Date().toISOString()}).eq("id",x.id),xe({type:"success",title:"Success",message:"Email logged successfully! Note: Actual email sending requires SMTP configuration."}),v&&v(),A&&A()}catch(a){console.error("Error sending email:",a),xe({type:"error",title:"Error",message:"Failed to send email. Please try again."})}finally{d(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-blue-600"}),"Compose Email"]}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Use Template"]})]}),b&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Inquiry #",b.inquiry_number," - ",b.company_name]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[b.product_name," - ",b.quantity]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To *"}),e.jsx("input",{type:"text",value:w,onChange:a=>g(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"recipient@example.com; recipient2@example.com",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:w.includes(";")?`Sending to ${w.split(";").filter(a=>a.trim()).length} email addresses`:"Separate multiple emails with semicolon (;)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),e.jsx("input",{type:"text",value:f,onChange:a=>p(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Email subject",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message *"}),e.jsx("textarea",{value:i,onChange:a=>t(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:12,placeholder:"Type your message here...",required:!0})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition",disabled:!0,children:[e.jsx(yt,{className:"w-4 h-4"}),"Attach Files (Coming Soon)"]})}),e.jsxs("div",{className:"flex gap-2",children:[A&&e.jsx("button",{onClick:A,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:r||!w||!f||!i,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"}),"Send Email"]})})]})]}),e.jsx(Te,{isOpen:s,onClose:()=>l(!1),title:"Email Templates",children:e.jsx("div",{className:"space-y-2",children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Qe,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{children:"No templates available"}),e.jsx("p",{className:"text-sm mt-1",children:"Contact admin to create email templates"})]}):c.map(a=>e.jsxs("div",{onClick:()=>n(a),className:"p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.template_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.subject}),a.category&&e.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:a.category})]})}),a.variables&&a.variables.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Variables: ",a.variables.join(", ")]})})]},a.id))})})]})}function cd({selectedCustomers:b,onClose:A,onComplete:v}){var C;const[c,h]=Z.useState([]),[x,N]=Z.useState(null),[w,g]=Z.useState(""),[f,p]=Z.useState(""),[i,t]=Z.useState(30),[r,d]=Z.useState(!1),[s,l]=Z.useState(!1),[o,n]=Z.useState([]),[m,a]=Z.useState(0);Z.useEffect(()=>{j(),u()},[]);const u=()=>{const T=b.map(q=>({customerId:q.id,companyName:q.company_name,email:q.email,status:"pending"}));n(T)},j=async()=>{try{const{data:T,error:q}=await fe.from("crm_email_templates").select("*").eq("is_active",!0).order("template_name");if(q)throw q;h(T||[])}catch(T){console.error("Error loading templates:",T)}},E=T=>{g(T.subject),p(T.body),N(T),l(!1)},S=(T,q)=>T.replace(/\{\{company_name\}\}/g,q.company_name).replace(/\{\{contact_person\}\}/g,q.contact_person||"Sir/Madam"),D=async()=>{if(!w||!f){xe({type:"error",title:"Error",message:"Please fill in subject and message"});return}if(i<10){xe({type:"warning",title:"Warning",message:"Please set interval to at least 10 seconds to avoid blocking"});return}d(!0),a(0);try{const{data:{user:T}}=await fe.auth.getUser();if(!T)throw new Error("Not authenticated");const{data:q}=await fe.from("gmail_connections").select("*").eq("user_id",T.id).eq("is_connected",!0).maybeSingle();if(!q){xe({type:"error",title:"Error",message:"Gmail not connected. Please connect Gmail in Settings first."}),d(!1);return}for(let Y=0;Y<b.length;Y++){const te=b[Y];a(Y),n(K=>K.map((M,P)=>P===Y?{...M,status:"sending"}:M));try{const K=te.email.split(";").map(R=>R.trim()).filter(R=>R.length>0),M=S(w,te),P=S(f,te),$=await fetch("https://dkrtsqienlhpouohmfki.supabase.co/functions/v1/send-bulk-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRrcnRzcWllbmxocG91b2htZmtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MTQxNzQsImV4cCI6MjA3NzQ5MDE3NH0.Kjo9RU0WAfQSSEm2vTWmuN5BIYk_hvanKDQkm5qdCGY"},body:JSON.stringify({userId:T.id,toEmails:K,subject:M,body:P,contactId:te.id})});if(!$.ok)throw new Error("Failed to send email");const F=await $.json();if(F.success){const R={contact_id:te.id,email_type:"sent",from_email:T.email,to_email:K,subject:M,body:P,template_id:(x==null?void 0:x.id)||null,sent_date:new Date().toISOString(),created_by:T.id};await fe.from("crm_email_activities").insert([R]),n(L=>L.map((U,B)=>B===Y?{...U,status:"success"}:U))}else throw new Error(F.error||"Unknown error");Y<b.length-1&&await new Promise(R=>setTimeout(R,i*1e3))}catch(K){console.error(`Error sending to ${te.company_name}:`,K),n(M=>M.map((P,O)=>O===Y?{...P,status:"error",error:K.message}:P))}}x&&await fe.from("crm_email_templates").update({use_count:x.use_count+b.length,last_used:new Date().toISOString()}).eq("id",x.id);const G=o.filter(Y=>Y.status==="success").length;alert(`Bulk email completed!
${G} of ${b.length} emails sent successfully.`),v()}catch(T){console.error("Error in bulk email:",T),alert("Failed to complete bulk email. Please check the results.")}finally{d(!1)}},k=o.filter(T=>T.status==="success").length,_=o.filter(T=>T.status==="error").length,y=o.filter(T=>T.status==="pending").length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-blue-600"}),"Bulk Email to Customers"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Sending to ",b.length," customers"]})]}),e.jsxs("button",{onClick:()=>l(!0),disabled:r,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition disabled:opacity-50",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Use Template"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:"Important: Email Throttling"}),e.jsxs("p",{className:"mt-1",children:["Emails will be sent with ",i,"s intervals to prevent your email account from being blocked. Total time: ~",Math.ceil(b.length*i/60)," minutes"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Interval Between Emails (seconds)"}),e.jsx("input",{type:"number",min:"10",max:"300",value:i,onChange:T=>t(Math.max(10,parseInt(T.target.value)||10)),disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 10 seconds recommended. Higher values are safer for large batches."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),e.jsx("input",{type:"text",value:w,onChange:T=>g(T.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"Email subject (use {{company_name}} and {{contact_person}} for personalization)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message *"}),e.jsx("textarea",{value:f,onChange:T=>p(T.target.value),disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",rows:10,placeholder:"Type your message here... (use {{company_name}} and {{contact_person}} for personalization)"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variables: ","{{company_name}}",", ","{{contact_person}}"]})]}),r&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-blue-900",children:["Sending email ",m+1," of ",b.length]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Current: ",(C=b[m])==null?void 0:C.company_name]})]})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-green-700",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Success: ",k]}),e.jsxs("div",{className:"flex items-center gap-1 text-red-700",children:[e.jsx(Je,{className:"w-4 h-4"}),"Failed: ",_]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Pending: ",y]})]})]}),o.some(T=>T.status!=="pending")&&e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b",children:e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Send Results"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:o.map((T,q)=>e.jsxs("div",{className:`px-4 py-2 border-b last:border-b-0 flex items-center justify-between ${T.status==="success"?"bg-green-50":T.status==="error"?"bg-red-50":T.status==="sending"?"bg-blue-50":""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:T.companyName}),e.jsx("p",{className:"text-xs text-gray-600",children:T.email}),T.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:T.error})]}),e.jsxs("div",{children:[T.status==="success"&&e.jsx(Ve,{className:"w-5 h-5 text-green-600"}),T.status==="error"&&e.jsx(Je,{className:"w-5 h-5 text-red-600"}),T.status==="sending"&&e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),T.status==="pending"&&e.jsx(Ke,{className:"w-5 h-5 text-gray-400"})]})]},q))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{onClick:A,disabled:r,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50",children:r?"Sending...":"Cancel"}),e.jsxs("button",{onClick:D,disabled:r||!w||!f,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Xe,{className:"w-4 h-4"}),r?"Sending...":"Start Bulk Send"]})]}),e.jsx(Te,{isOpen:s,onClose:()=>l(!1),title:"Email Templates",children:e.jsx("div",{className:"space-y-2",children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Qe,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{children:"No templates available"}),e.jsx("p",{className:"text-sm mt-1",children:"Contact admin to create email templates"})]}):c.map(T=>e.jsx("div",{onClick:()=>E(T),className:"p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:T.template_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:T.subject}),T.category&&e.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:T.category})]})})},T.id))})})]})}function ud(){const[b,A]=Z.useState([]),[v,c]=Z.useState([]),[h,x]=Z.useState(!0),[N,w]=Z.useState(null),[g,f]=Z.useState(""),[p,i]=Z.useState(new Set),[t,r]=Z.useState(!1),[d,s]=Z.useState(""),[l,o]=Z.useState(""),[n,m]=Z.useState(""),[a,u]=Z.useState({created_at:110,company_name:200,contact_person:150,designation:120,email:180,mobile:130,landline:130,phone:130,country:120,city:120,address:200,website:150,customer_type:120,notes:200}),[j,E]=Z.useState(null),S=Z.useRef(null);Z.useEffect(()=>{D()},[]),Z.useEffect(()=>{if(j){const L=B=>{const W=B.clientX-j.startX,ie=Math.max(80,j.startWidth+W);u(ue=>({...ue,[j.column]:ie}))},U=()=>{E(null)};return document.addEventListener("mousemove",L),document.addEventListener("mouseup",U),()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",U)}}},[j]);const D=async()=>{try{const{data:L,error:U}=await fe.from("crm_contacts").select("*").order("company_name");if(U)throw U;A(L||[]),c(L||[])}catch(L){console.error("Error loading customers:",L)}finally{x(!1)}};Z.useEffect(()=>{let L=[...b];if(d){const U=d.toLowerCase();L=L.filter(B=>{var W,ie,ue,ee;return((W=B.company_name)==null?void 0:W.toLowerCase().includes(U))||((ie=B.contact_person)==null?void 0:ie.toLowerCase().includes(U))||((ue=B.email)==null?void 0:ue.toLowerCase().includes(U))||((ee=B.city)==null?void 0:ee.toLowerCase().includes(U))})}l&&(L=L.filter(U=>U.city===l)),n&&(L=L.filter(U=>U.customer_type===n)),c(L)},[d,l,n,b]);const k=Array.from(new Set(b.map(L=>L.city).filter(Boolean))).sort(),_=Array.from(new Set(b.map(L=>L.customer_type).filter(Boolean))).sort(),y=(L,U)=>{w({rowId:L.id,field:U}),f(L[U]||"")},C=async()=>{if(N)try{const{error:L}=await fe.from("crm_contacts").update({[N.field]:g||null}).eq("id",N.rowId);if(L)throw L;A(U=>U.map(B=>B.id===N.rowId?{...B,[N.field]:g||null}:B))}catch(L){console.error("Error updating customer:",L),xe({type:"error",title:"Error",message:"Failed to update customer"})}finally{w(null),f("")}},T=L=>{L.key==="Enter"?(L.preventDefault(),C()):L.key==="Escape"&&(w(null),f(""))},q=async()=>{try{const{data:{user:L}}=await fe.auth.getUser();if(!L)throw new Error("Not authenticated");const{data:U,error:B}=await fe.from("crm_contacts").insert({company_name:"New Customer",is_active:!0,created_by:L.id}).select().single();if(B)throw B;A(W=>[U,...W])}catch(L){console.error("Error adding customer:",L),xe({type:"error",title:"Error",message:"Failed to add customer"})}},G=async()=>{if(p.size!==0&&await rr({title:"Confirm",message:`Delete ${p.size} customer(s)?`,variant:"danger",confirmLabel:"Delete"}))try{const{error:L}=await fe.from("crm_contacts").delete().in("id",Array.from(p));if(L)throw L;A(U=>U.filter(B=>!p.has(B.id))),i(new Set)}catch(L){console.error("Error deleting customers:",L),xe({type:"error",title:"Error",message:"Failed to delete customers"})}},Y=L=>{i(U=>{const B=new Set(U);return B.has(L)?B.delete(L):B.add(L),B})},te=()=>{p.size===v.length?i(new Set):i(new Set(v.map(L=>L.id)))},K=L=>{const U=new Date(L),B=U.getDate().toString().padStart(2,"0"),W=(U.getMonth()+1).toString().padStart(2,"0"),ie=U.getFullYear();return`${B}-${W}-${ie}`},M=()=>{const L=["Date","Company Name","Contact Person","Designation","Email","Mobile","Landline","Phone","Country","City","Address","Website","Customer Type","Notes"],U=b.map(ee=>[K(ee.created_at),ee.company_name,ee.contact_person||"",ee.designation||"",ee.email||"",ee.mobile||"",ee.landline||"",ee.phone||"",ee.country||"",ee.city||"",ee.address||"",ee.website||"",ee.customer_type||"",ee.notes||""]),B=[L,...U].map(ee=>ee.map(V=>`"${V}"`).join(",")).join(`
`),W=new Blob([B],{type:"text/csv"}),ie=URL.createObjectURL(W),ue=document.createElement("a");ue.href=ie,ue.download=`customers_${new Date().toISOString().split("T")[0]}.csv`,ue.click()},P=async L=>{var B;const U=(B=L.target.files)==null?void 0:B[0];if(U){try{const{data:{user:W}}=await fe.auth.getUser();if(!W)throw new Error("Not authenticated");const ue=(await U.text()).split(`
`).filter(ge=>ge.trim());if(ue.length<2){xe({type:"error",title:"Error",message:"CSV file is empty or invalid"});return}const ee=ue[0].split(",").map(ge=>ge.replace(/"/g,"").trim()),V=ue.slice(1),ne=ee.findIndex(ge=>ge.toLowerCase()==="date"),de=ee.findIndex(ge=>ge.toLowerCase()==="company name"),he=ee.findIndex(ge=>ge.toLowerCase()==="contact person"),Q=ee.findIndex(ge=>ge.toLowerCase()==="designation"),X=ee.findIndex(ge=>ge.toLowerCase()==="email"),se=ee.findIndex(ge=>ge.toLowerCase()==="mobile"),le=ee.findIndex(ge=>ge.toLowerCase()==="landline"),z=ee.findIndex(ge=>ge.toLowerCase()==="phone"),ae=ee.findIndex(ge=>ge.toLowerCase()==="country"),ce=ee.findIndex(ge=>ge.toLowerCase()==="city"),oe=ee.findIndex(ge=>ge.toLowerCase()==="address"),pe=ee.findIndex(ge=>ge.toLowerCase()==="website"),ve=ee.findIndex(ge=>ge.toLowerCase()==="customer type"),we=ee.findIndex(ge=>ge.toLowerCase()==="notes");if(de===-1){xe({type:"error",title:"Error",message:'CSV must have a "Company Name" column'});return}const $e=ge=>{const Se=[];let De="",Ce=!1;for(let Re=0;Re<ge.length;Re++){const Ie=ge[Re];Ie==='"'?Ce=!Ce:Ie===","&&!Ce?(Se.push(De.trim()),De=""):De+=Ie}return Se.push(De.trim()),Se},be=ge=>{if(!ge)return new Date().toISOString();const Se=[/^(\d{1,2})-(\d{1,2})-(\d{4})$/,/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,/^(\d{4})-(\d{1,2})-(\d{1,2})$/];for(const De of Se){const Ce=ge.match(De);if(Ce){let Re,Ie,Ye;return De.toString().includes("\\d{4}$")?[,Re,Ie,Ye]=Ce:[,Ye,Ie,Re]=Ce,new Date(`${Ye}-${Ie.padStart(2,"0")}-${Re.padStart(2,"0")}`).toISOString()}}return new Date().toISOString()},ke=V.map(ge=>{var Re,Ie,Ye,Pe,Oe,bt,_t,wt,Nt,jt,St,Et,Ot,kt;const Se=$e(ge),De=(Re=Se[de])==null?void 0:Re.replace(/"/g,"").trim();if(!De)return null;const Ce=ne!==-1?be((Ie=Se[ne])==null?void 0:Ie.replace(/"/g,"").trim()):new Date().toISOString();return{company_name:De,contact_person:he!==-1&&((Ye=Se[he])==null?void 0:Ye.replace(/"/g,"").trim())||null,designation:Q!==-1&&((Pe=Se[Q])==null?void 0:Pe.replace(/"/g,"").trim())||null,email:X!==-1&&((Oe=Se[X])==null?void 0:Oe.replace(/"/g,"").trim())||null,mobile:se!==-1&&((bt=Se[se])==null?void 0:bt.replace(/"/g,"").trim())||null,landline:le!==-1&&((_t=Se[le])==null?void 0:_t.replace(/"/g,"").trim())||null,phone:z!==-1&&((wt=Se[z])==null?void 0:wt.replace(/"/g,"").trim())||null,country:ae!==-1&&((Nt=Se[ae])==null?void 0:Nt.replace(/"/g,"").trim())||null,city:ce!==-1&&((jt=Se[ce])==null?void 0:jt.replace(/"/g,"").trim())||null,address:oe!==-1&&((St=Se[oe])==null?void 0:St.replace(/"/g,"").trim())||null,website:pe!==-1&&((Et=Se[pe])==null?void 0:Et.replace(/"/g,"").trim())||null,customer_type:ve!==-1&&((Ot=Se[ve])==null?void 0:Ot.replace(/"/g,"").trim())||null,notes:we!==-1&&((kt=Se[we])==null?void 0:kt.replace(/"/g,"").trim())||null,is_active:!0,created_by:W.id,created_at:Ce}}).filter(Boolean);if(ke.length===0){xe({type:"error",title:"Error",message:"No valid customer data found in CSV"});return}const{data:xt,error:nt}=await fe.from("crm_contacts").insert(ke).select();if(nt)throw nt;xe({type:"success",title:"Success",message:`Successfully imported ${ke.length} customer(s)`}),D()}catch(W){console.error("Error importing CSV:",W),xe({type:"error",title:"Error",message:"Failed to import CSV. Please check the file format."})}L.target.value=""}},O=L=>{const U=new Date(L),B=U.getDate().toString().padStart(2,"0"),W=(U.getMonth()+1).toString().padStart(2,"0"),ie=U.getFullYear();return`${B}-${W}-${ie}`},I=(L,U)=>{const B=(N==null?void 0:N.rowId)===L.id&&(N==null?void 0:N.field)===U,W=L[U];return U==="created_at"?e.jsx("div",{className:"px-2 py-1 h-full flex items-center",children:e.jsx("span",{className:"truncate text-xs",children:O(L.created_at)})}):B?e.jsx("input",{type:"text",value:g,onChange:ie=>f(ie.target.value),onBlur:C,onKeyDown:T,autoFocus:!0,className:"w-full h-full px-2 py-1 border-2 border-blue-500 focus:outline-none bg-white"}):e.jsx("div",{onDoubleClick:()=>y(L,U),className:"px-2 py-1 cursor-cell hover:bg-gray-50 h-full flex items-center",title:"Double-click to edit",children:U==="is_active"?e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${W?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:W?"Active":"Inactive"}):e.jsx("span",{className:"truncate",children:(W==null?void 0:W.toString())||"-"})})},$=(L,U)=>{L.preventDefault(),E({column:U,startX:L.clientX,startWidth:a[U]})},F=()=>{if(Array.from(p).map(U=>b.find(B=>B.id===U)).filter(U=>!!U&&!!U.email).length===0){xe({type:"warning",title:"Warning",message:"Please select customers with email addresses"});return}r(!0)},R=()=>Array.from(p).map(L=>b.find(U=>U.id===L)).filter(L=>!!L&&!!L.email).map(L=>({id:L.id,company_name:L.company_name,email:L.email,contact_person:L.contact_person}));return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:"Loading customers..."}):e.jsxs("div",{className:"flex flex-col h-full bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col gap-3 px-4 py-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:q,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 transition",children:[e.jsx(Ft,{className:"w-3.5 h-3.5"}),"Add Customer"]}),p.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:F,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-green-600 border border-green-700 rounded-md hover:bg-green-700 transition",children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),"Send Email (",p.size,")"]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 transition",children:[e.jsx(Bt,{className:"w-3.5 h-3.5"}),"Delete (",p.size,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition cursor-pointer",children:[e.jsx(ra,{className:"w-3.5 h-3.5"}),"Import CSV",e.jsx("input",{type:"file",accept:".csv",onChange:P,className:"hidden"})]}),e.jsxs("button",{onClick:M,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition",children:[e.jsx(Lt,{className:"w-3.5 h-3.5"}),"Export CSV"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ur,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:L=>s(L.target.value),placeholder:"Search by company, contact person, email, or city...",className:"w-full pl-10 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("select",{value:l,onChange:L=>o(L.target.value),className:"px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Cities"}),k.map(L=>e.jsx("option",{value:L,children:L},L))]}),e.jsxs("select",{value:n,onChange:L=>m(L.target.value),className:"px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Types"}),_.map(L=>e.jsx("option",{value:L,children:L},L))]}),(d||l||n)&&e.jsx("button",{onClick:()=>{s(""),o(""),m("")},className:"px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 transition",children:"Clear Filters"})]})]}),e.jsx("div",{ref:S,className:"flex-1 overflow-auto",style:{maxHeight:"calc(100vh - 250px)"},children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-2 py-2 bg-gray-100 w-10",children:e.jsx("input",{type:"checkbox",checked:p.size===v.length&&v.length>0,onChange:te,className:"rounded"})}),[{key:"created_at",label:"Date"},{key:"company_name",label:"Company Name"},{key:"contact_person",label:"Contact Person"},{key:"designation",label:"Designation"},{key:"email",label:"Email"},{key:"mobile",label:"Mobile"},{key:"landline",label:"Landline"},{key:"phone",label:"Phone"},{key:"country",label:"Country"},{key:"city",label:"City"},{key:"address",label:"Address"},{key:"website",label:"Website"},{key:"customer_type",label:"Type"},{key:"notes",label:"Notes"}].map(({key:L,label:U})=>e.jsx("th",{className:"border border-gray-300 px-2 py-2 bg-gray-100 text-left text-xs font-semibold text-gray-700 relative",style:{width:a[L],minWidth:a[L]},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:U}),e.jsx("div",{onMouseDown:B=>$(B,L),className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 hover:w-1.5 transition-all",style:{touchAction:"none"}})]})},L))]})}),e.jsx("tbody",{children:v.map(L=>e.jsxs("tr",{className:`${p.has(L.id)?"bg-blue-50":"hover:bg-gray-50"} transition`,children:[e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:e.jsx("input",{type:"checkbox",checked:p.has(L.id),onChange:()=>Y(L.id),className:"rounded"})}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.created_at},children:I(L,"created_at")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.company_name},children:I(L,"company_name")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.contact_person},children:I(L,"contact_person")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.designation},children:I(L,"designation")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.email},children:I(L,"email")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.mobile},children:I(L,"mobile")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.landline},children:I(L,"landline")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.phone},children:I(L,"phone")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.country},children:I(L,"country")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.city},children:I(L,"city")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.address},children:I(L,"address")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.website},children:I(L,"website")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.customer_type},children:I(L,"customer_type")}),e.jsx("td",{className:"border border-gray-300 h-8",style:{width:a.notes},children:I(L,"notes")})]},L.id))})]})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-gray-50 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[v.length," customer(s)",v.length!==b.length&&` (filtered from ${b.length} total)`,p.size>0&&`  ${p.size} selected`]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Double-click any cell to edit  Drag column borders to resize"})]})}),e.jsx(Te,{isOpen:t,onClose:()=>{r(!1),i(new Set)},title:"Bulk Email",children:e.jsx(cd,{selectedCustomers:R(),onClose:()=>{r(!1),i(new Set)},onComplete:()=>{r(!1),i(new Set),D()}})})]})}function dd({inquiryId:b,customerId:A,leadId:v,onActivityLogged:c}){const{profile:h}=gt(),{t:x}=on(),[N,w]=Z.useState([]),[g,f]=Z.useState(!0),[p,i]=Z.useState(!1),[t,r]=Z.useState({activity_type:"phone_call",subject:"",description:"",follow_up_date:"",is_completed:!1});Z.useEffect(()=>{d()},[b,A,v]);const d=async()=>{try{let u=fe.from("crm_activities").select("*, user_profiles!crm_activities_created_by_fkey(full_name)").order("created_at",{ascending:!1});v&&(u=u.eq("lead_id",v)),A&&(u=u.eq("customer_id",A));const{data:j,error:E}=await u;if(E)throw E;w(j||[])}catch(u){console.error("Error loading activities:",u)}finally{f(!1)}},s=async u=>{u.preventDefault();try{const{data:{user:j}}=await fe.auth.getUser();if(!j)throw new Error("Not authenticated");const E={...t,created_by:j.id,follow_up_date:t.follow_up_date||null,completed_at:t.is_completed?new Date().toISOString():null};v&&(E.lead_id=v),A&&(E.customer_id=A);const{error:S}=await fe.from("crm_activities").insert([E]);if(S)throw S;i(!1),r({activity_type:"phone_call",subject:"",description:"",follow_up_date:"",is_completed:!1}),d(),c==null||c()}catch(j){console.error("Error logging activity:",j),alert("Failed to log activity. Please try again.")}},l=async u=>{try{const{error:j}=await fe.from("crm_activities").update({is_completed:!0,completed_at:new Date().toISOString()}).eq("id",u);if(j)throw j;d()}catch(j){console.error("Error completing activity:",j),alert("Failed to complete activity. Please try again.")}},o=async u=>{if(confirm("Are you sure you want to delete this activity? This action cannot be undone."))try{const{error:j}=await fe.from("crm_activities").delete().eq("id",u);if(j)throw j;d(),c==null||c()}catch(j){console.error("Error deleting activity:",j),alert("Failed to delete activity. Please try again.")}},n=u=>{switch(u){case"phone_call":return e.jsx(vt,{className:"w-5 h-5"});case"meeting":return e.jsx(tt,{className:"w-5 h-5"});case"email":return e.jsx($n,{className:"w-5 h-5"});case"note":return e.jsx(Qe,{className:"w-5 h-5"});case"video_call":return e.jsx(un,{className:"w-5 h-5"});case"whatsapp":return e.jsx(ma,{className:"w-5 h-5"});default:return e.jsx(Qe,{className:"w-5 h-5"})}},m=u=>{switch(u){case"phone_call":return"bg-blue-50 text-blue-600 border-blue-200";case"meeting":return"bg-purple-50 text-purple-600 border-purple-200";case"email":return"bg-green-50 text-green-600 border-green-200";case"note":return"bg-gray-50 text-gray-600 border-gray-200";case"video_call":return"bg-indigo-50 text-indigo-600 border-indigo-200";case"whatsapp":return"bg-emerald-50 text-emerald-600 border-emerald-200";default:return"bg-gray-50 text-gray-600 border-gray-200"}},a=u=>({phone_call:"Phone Call",meeting:"Meeting",email:"Email",note:"Note",video_call:"Video Call",whatsapp:"WhatsApp"})[u]||u;return g?e.jsx("div",{className:"flex justify-center py-8",children:"Loading activities..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Activity Log"}),e.jsxs("button",{onClick:()=>i(!p),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Log Activity"]})]}),p&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Activity Type *"}),e.jsxs("select",{value:t.activity_type,onChange:u=>r({...t,activity_type:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"phone_call",children:"Phone Call"}),e.jsx("option",{value:"meeting",children:"Meeting"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"note",children:"Note"}),e.jsx("option",{value:"video_call",children:"Video Call"}),e.jsx("option",{value:"whatsapp",children:"WhatsApp (Coming Soon)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),e.jsx("input",{type:"text",value:t.subject,onChange:u=>r({...t,subject:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Brief description",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:u=>r({...t,description:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Detailed notes about the conversation or activity"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date"}),e.jsx("input",{type:"datetime-local",value:t.follow_up_date,onChange:u=>r({...t,follow_up_date:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.is_completed,onChange:u=>r({...t,is_completed:u.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Mark as completed"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Log Activity"})]})]})}),e.jsx("div",{className:"space-y-3",children:N.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No activities logged yet. Start by logging your first activity!"}):N.map(u=>e.jsx("div",{className:`border rounded-lg p-4 ${u.is_completed?"bg-gray-50 border-gray-200":"bg-white border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg border ${m(u.activity_type)}`,children:n(u.activity_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:u.subject}),u.is_completed&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Completed"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a(u.activity_type),"  ",new Date(u.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!u.is_completed&&u.follow_up_date&&e.jsx("button",{onClick:()=>l(u.id),className:"text-sm px-3 py-1 text-green-600 hover:bg-green-50 rounded-lg transition",children:"Mark Complete"}),e.jsx("button",{onClick:()=>o(u.id),className:"p-1 text-red-600 hover:bg-red-50 rounded transition",title:"Delete activity",children:e.jsx(Bt,{className:"w-4 h-4"})})]})]}),u.description&&e.jsx("p",{className:"mt-2 text-sm text-gray-700 whitespace-pre-wrap",children:u.description}),u.follow_up_date&&!u.is_completed&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-orange-600",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Follow-up: ",new Date(u.follow_up_date).toLocaleString()]}),u.user_profiles&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["by ",u.user_profiles.full_name]})]})]})},u.id))})]})}function fd({customerId:b,leadId:A,onAppointmentCreated:v}){const{profile:c}=gt(),[h,x]=Z.useState([]),[N,w]=Z.useState([]),[g,f]=Z.useState([]),[p,i]=Z.useState(!0),[t,r]=Z.useState(!1),[d,s]=Z.useState(null),[l,o]=Z.useState({activity_type:"meeting",subject:"",description:"",follow_up_date:"",location:"",customer_id:b||"",participants:[],auto_create_followup_task:!1});Z.useEffect(()=>{a(),m(),!b&&!A&&n()},[b,A]);const n=async()=>{try{const{data:y,error:C}=await fe.from("crm_contacts").select("id, company_name").order("company_name",{ascending:!0});if(C)throw C;w(y||[])}catch(y){console.error("Error loading contacts:",y)}},m=async()=>{try{const{data:y,error:C}=await fe.from("user_profiles").select("id, full_name").order("full_name",{ascending:!0});if(C)throw C;f(y||[])}catch(y){console.error("Error loading users:",y)}},a=async()=>{try{let y=fe.from("crm_activities").select("*, user_profiles!crm_activities_created_by_fkey(full_name), crm_contacts!crm_activities_customer_id_fkey(company_name)").in("activity_type",["meeting","video_call","phone_call"]).not("follow_up_date","is",null).order("follow_up_date",{ascending:!0});b?y=y.eq("customer_id",b):A&&(y=y.eq("lead_id",A));const{data:C,error:T}=await y;if(T)throw T;x(C||[])}catch(y){console.error("Error loading appointments:",y)}finally{i(!1)}},u=async y=>{y.preventDefault();try{const{data:{user:C}}=await fe.auth.getUser();if(!C)throw new Error("Not authenticated");let T=l.follow_up_date;l.follow_up_date&&l.follow_up_date.length===16&&(T=l.follow_up_date+":00");const q={activity_type:l.activity_type,subject:l.subject,description:l.description||null,follow_up_date:T,is_completed:!1,created_by:C.id,participants:l.participants,auto_create_followup_task:l.auto_create_followup_task};if(b?q.customer_id=b:A?q.lead_id=A:l.customer_id&&(q.customer_id=l.customer_id),d){const{error:G}=await fe.from("crm_activities").update(q).eq("id",d.id);if(G)throw G}else{const{error:G}=await fe.from("crm_activities").insert([q]);if(G)throw G}r(!1),s(null),o({activity_type:"meeting",subject:"",description:"",follow_up_date:"",location:"",customer_id:b||"",participants:[],auto_create_followup_task:!1}),a(),v==null||v()}catch(C){console.error("Error saving appointment:",C),alert("Failed to save appointment. Please try again.")}},j=y=>{s(y);let C="";y.follow_up_date&&(C=y.follow_up_date.substring(0,16)),o({activity_type:y.activity_type,subject:y.subject,description:y.description||"",follow_up_date:C,location:"",customer_id:y.customer_id||b||"",participants:y.participants||[],auto_create_followup_task:y.auto_create_followup_task||!1}),r(!0)},E=async y=>{if(confirm("Are you sure you want to delete this appointment?"))try{const{error:C}=await fe.from("crm_activities").delete().eq("id",y);if(C)throw C;a()}catch(C){console.error("Error deleting appointment:",C),alert("Failed to delete appointment. Please try again.")}},S=async y=>{try{const{error:C}=await fe.from("crm_activities").update({is_completed:!0,completed_at:new Date().toISOString()}).eq("id",y);if(C)throw C;a()}catch(C){console.error("Error completing appointment:",C),alert("Failed to complete appointment. Please try again.")}},D=y=>{switch(y){case"meeting":return e.jsx(tt,{className:"w-5 h-5"});case"video_call":return e.jsx(un,{className:"w-5 h-5"});case"phone_call":return e.jsx(vt,{className:"w-5 h-5"});default:return e.jsx(tt,{className:"w-5 h-5"})}},k=y=>{if(y.is_completed)return"bg-gray-50 border-gray-200 text-gray-600";const C=new Date,T=new Date(y.follow_up_date);return T<C?"bg-red-50 border-red-200 text-red-700":T<new Date(C.getTime()+24*60*60*1e3)?"bg-orange-50 border-orange-200 text-orange-700":"bg-blue-50 border-blue-200 text-blue-700"},_=y=>({meeting:"In-Person Meeting",video_call:"Video Call",phone_call:"Phone Call"})[y]||y;return p?e.jsx("div",{className:"flex justify-center py-8",children:"Loading appointments..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Appointments & Meetings"}),e.jsxs("button",{onClick:()=>{s(null),o({activity_type:"meeting",subject:"",description:"",follow_up_date:"",location:"",customer_id:b||"",participants:[],auto_create_followup_task:!1}),!b&&!A&&n(),r(!t)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Schedule Appointment"]})]}),t&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[!b&&!A&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsx(na,{value:l.customer_id,onChange:y=>o({...l,customer_id:y}),options:N.map(y=>({value:y.id,label:y.company_name})),placeholder:"Select a customer..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Appointment Type *"}),e.jsxs("select",{value:l.activity_type,onChange:y=>o({...l,activity_type:y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"meeting",children:"In-Person Meeting"}),e.jsx("option",{value:"video_call",children:"Video Call"}),e.jsx("option",{value:"phone_call",children:"Phone Call"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date & Time *"}),e.jsx("input",{type:"datetime-local",value:l.follow_up_date,onChange:y=>o({...l,follow_up_date:y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),e.jsx("input",{type:"text",value:l.subject,onChange:y=>o({...l,subject:y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Product demonstration, Price negotiation",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description / Agenda"}),e.jsx("textarea",{value:l.description,onChange:y=>o({...l,description:y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Meeting agenda, discussion points, etc."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Participants"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-3 max-h-40 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:g.map(y=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:l.participants.includes(y.id),onChange:C=>{C.target.checked?o({...l,participants:[...l.participants,y.id]}):o({...l,participants:l.participants.filter(T=>T!==y.id)})},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:y.full_name})]},y.id))})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tagged participants will receive notifications and can see this appointment"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.auto_create_followup_task,onChange:y=>o({...l,auto_create_followup_task:y.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Auto-create follow-up task after meeting"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"A task will be created 2 days after the meeting for follow-up"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{r(!1),s(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:d?"Update Appointment":"Schedule Appointment"})]})]})}),e.jsx("div",{className:"space-y-3",children:h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No appointments scheduled. Create your first appointment!"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Upcoming Appointments"}),h.filter(y=>!y.is_completed&&new Date(y.follow_up_date)>=new Date).map(y=>e.jsx("div",{className:`border rounded-lg p-4 ${k(y)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:D(y.activity_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:y.subject}),y.crm_contacts&&e.jsx("p",{className:"text-sm font-medium text-blue-600 mt-1",children:y.crm_contacts.company_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:_(y.activity_type)}),e.jsxs("p",{className:"text-sm font-medium mt-1 flex items-center gap-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),new Date(y.follow_up_date).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(y),className:"p-1 hover:bg-white rounded transition",title:"Edit",children:e.jsx(Xn,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(y.id),className:"p-1 hover:bg-white rounded transition",title:"Delete",children:e.jsx(Bt,{className:"w-4 h-4"})})]})]}),y.description&&e.jsx("p",{className:"mt-2 text-sm text-gray-700 whitespace-pre-wrap",children:y.description}),y.participants&&y.participants.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4 text-gray-500"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:y.participants.map(C=>{const T=g.find(q=>q.id===C);return T?e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:T.full_name},C):null})})]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx("button",{onClick:()=>S(y.id),className:"text-xs px-3 py-1 bg-white border border-current rounded hover:bg-gray-50 transition",children:"Mark as Completed"})})]})]})},y.id))]}),h.filter(y=>y.is_completed||new Date(y.follow_up_date)<new Date).length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Past Appointments"}),h.filter(y=>y.is_completed||new Date(y.follow_up_date)<new Date).map(y=>e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50 border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 text-gray-400",children:D(y.activity_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-700",children:y.subject}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[_(y.activity_type),"  ",$t(y.follow_up_date)]})]})]})},y.id))]})]})})]})}function hd({canManage:b,onRefresh:A}){const{profile:v}=gt(),[c,h]=Z.useState([]),[x,N]=Z.useState([]),[w,g]=Z.useState(!0),[f,p]=Z.useState(""),[i,t]=Z.useState(null),[r,d]=Z.useState(!1);Z.useEffect(()=>{s()},[]),Z.useEffect(()=>{if(f){const n=c.filter(m=>m.inquiry_number.toLowerCase().includes(f.toLowerCase())||m.company_name.toLowerCase().includes(f.toLowerCase())||m.product_name.toLowerCase().includes(f.toLowerCase())||m.lost_reason&&m.lost_reason.toLowerCase().includes(f.toLowerCase()));N(n)}else N(c)},[f,c]);const s=async()=>{try{const{data:n,error:m}=await fe.from("crm_inquiries").select("*").eq("pipeline_status","lost").order("lost_at",{ascending:!1});if(m)throw m;h(n||[]),N(n||[])}catch(n){console.error("Error loading archived inquiries:",n)}finally{g(!1)}},l=async n=>{if(confirm(`Reopen inquiry #${n.inquiry_number} and move it back to active deals?`))try{const{error:m}=await fe.from("crm_inquiries").update({pipeline_status:"in_progress",lost_reason:null,lost_at:null,competitor_name:null,competitor_price:null}).eq("id",n.id);if(m)throw m;alert("Inquiry reopened and moved to active deals!"),s(),A()}catch(m){console.error("Error reopening inquiry:",m),alert("Failed to reopen inquiry. Please try again.")}},o=()=>{try{const n=x.map(j=>({"Inquiry No.":j.inquiry_number,Date:new Date(j.inquiry_date).toLocaleDateString("en-GB"),Company:j.company_name,Product:j.product_name,Qty:j.quantity,"Offered Price":j.offered_price?`${j.offered_price} ${j.offered_price_currency}`:"-",Supplier:j.supplier_name||"-","Lost Reason":j.lost_reason||"-",Competitor:j.competitor_name||"-","Competitor Price":j.competitor_price?`$${j.competitor_price}`:"-","Lost Date":j.lost_at?new Date(j.lost_at).toLocaleDateString("en-GB"):"-",Remarks:j.remarks||"-"})),m=qe.json_to_sheet(n);m["!cols"]=[{wch:12},{wch:12},{wch:25},{wch:30},{wch:12},{wch:15},{wch:20},{wch:40},{wch:20},{wch:15},{wch:12},{wch:30}];const a=qe.book_new();qe.book_append_sheet(a,m,"Lost Deals Archive");const u=`Archive-Lost-Deals-${new Date().toISOString().split("T")[0]}.xlsx`;ar(a,u),alert(`Exported ${n.length} archived inquiries to ${u}`)}catch(n){console.error("Export error:",n),alert("Failed to export data. Please try again.")}};return w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Je,{className:"w-6 h-6 text-red-600"}),"Lost Deals Archive"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View history of lost inquiries and analyze reasons for improvement"})]}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:[e.jsx(Lt,{className:"w-4 h-4"}),"Export to Excel"]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ur,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:f,onChange:n=>p(n.target.value),placeholder:"Search by inquiry no, company, product, or lost reason...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:x.length})," archived inquiries"]})]})}),x.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(Je,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:f?"No archived inquiries match your search.":"No archived inquiries yet."})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"No."}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Company"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Qty"}),(v==null?void 0:v.role)==="admin"&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Offered"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Supplier"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lost Reason"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lost Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:n.inquiry_number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(n.inquiry_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:n.company_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:n.product_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:n.quantity}),(v==null?void 0:v.role)==="admin"&&e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:n.offered_price?`$${n.offered_price.toLocaleString("en-US",{minimumFractionDigits:2})}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:n.supplier_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"text-gray-900 line-clamp-2",children:n.lost_reason||"-"}),n.competitor_name&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Competitor: ",n.competitor_name,n.competitor_price&&` ($${n.competitor_price})`]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:n.lost_at?new Date(n.lost_at).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{t(n),d(!0)},className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition",title:"View Details",children:e.jsx(aa,{className:"w-4 h-4"})}),b&&e.jsx("button",{onClick:()=>l(n),className:"p-1 text-green-600 hover:bg-green-50 rounded transition",title:"Reopen Deal",children:e.jsx(jr,{className:"w-4 h-4"})})]})})]},n.id))})]})})}),i&&e.jsx(Te,{isOpen:r,onClose:()=>{d(!1),t(null)},title:`Inquiry #${i.inquiry_number} - Details`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 border-b",children:[e.jsx(En,{status:"lost"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Lost on ",i.lost_at?new Date(i.lost_at).toLocaleDateString("en-GB"):"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Company"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.company_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Product"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.product_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Quantity"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Supplier"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.supplier_name||"-"})]}),(v==null?void 0:v.role)==="admin"&&i.offered_price&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Offered Price"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["$",i.offered_price.toLocaleString("en-US",{minimumFractionDigits:2})," ",i.offered_price_currency]})]})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-red-900 mb-1",children:"Lost Reason"}),e.jsx("p",{className:"text-sm text-red-800",children:i.lost_reason||"No reason provided"}),i.competitor_name&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-200",children:[e.jsx("p",{className:"text-xs font-medium text-red-900 mb-1",children:"Competitor Information"}),e.jsxs("p",{className:"text-sm text-red-800",children:[i.competitor_name,i.competitor_price&&` - $${i.competitor_price.toLocaleString("en-US",{minimumFractionDigits:2})}`]})]})]})]})}),i.remarks&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Remarks"}),e.jsx("p",{className:"text-sm text-gray-900 bg-gray-50 rounded p-3",children:i.remarks})]}),b&&e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs("button",{onClick:()=>{l(i),d(!1)},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:[e.jsx(jr,{className:"w-4 h-4"}),"Reopen This Deal"]})})]})})]})}function md({isOpen:b,matches:A,searchTerm:v,onSelect:c,onCreateNew:h,onCancel:x,inquiryCounts:N={}}){const[w,g]=Z.useState(null),f=()=>{const t=A.find(r=>r.customer.id===w);t&&c(t.customer)},p=t=>{switch(t){case"high":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},i=t=>{switch(t){case"exact":return"Exact Match";case"startsWith":return"Starts With";case"contains":return"Contains";case"fuzzy":return"Similar Name";default:return"Match"}};return e.jsx(Te,{isOpen:b,onClose:x,title:"Select Existing Customer",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ge,{className:"h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-blue-900 font-medium",children:["We found ",A.length," existing customer",A.length!==1?"s":"",' similar to "',v,'"']}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Please select the correct customer or create a new one"})]})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:A.map(t=>{const r=N[t.customer.id]||0,d=w===t.customer.id;return e.jsx("div",{onClick:()=>g(t.customer.id),className:`border rounded-lg p-4 cursor-pointer transition-all ${d?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"radio",checked:d,onChange:()=>g(t.customer.id),className:"h-4 w-4 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.customer.company_name}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${p(t.confidence)}`,children:[i(t.matchType)," (",t.score,"%)"]})]}),e.jsxs("div",{className:"ml-6 space-y-1",children:[t.customer.contact_person&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),t.customer.contact_person]}),t.customer.email&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),t.customer.email]}),t.customer.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(vt,{className:"h-4 w-4 mr-2"}),t.customer.phone]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),r," ",r===1?"inquiry":"inquiries"," on record"]})]})]}),d&&e.jsx(Ve,{className:"h-6 w-6 text-blue-600 flex-shrink-0"})]})},t.customer.id)})}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("button",{onClick:h,className:"w-full text-left px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(rt,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"None of these - Create New Customer"})]}),e.jsxs("p",{className:"text-xs text-gray-500 ml-7 mt-1",children:['Create a new customer record for "',v,'"']})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:f,disabled:!w,className:`px-4 py-2 rounded-lg text-white ${w?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed"}`,children:"Select Customer"})]})]})})}function pd({isOpen:b,initialData:A,onConfirm:v,onCancel:c}){const[h,x]=Z.useState({company_name:A.company_name||"",contact_person:A.contact_person||"",email:A.email||"",phone:A.phone||"",address:A.address||"",city:A.city||"Jakarta Pusat",country:A.country||"Indonesia",pbf_license:A.pbf_license||"",npwp:A.npwp||""}),[N,w]=Z.useState(!1),[g,f]=Z.useState({}),p=()=>{const r={};return h.company_name.trim()||(r.company_name="Company name is required"),h.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.email)&&(r.email="Invalid email format"),f(r),Object.keys(r).length===0},i=async()=>{if(p()){w(!0);try{await v(h)}catch(r){console.error("Error creating customer:",r),alert("Failed to create customer. Please try again.")}finally{w(!1)}}},t=(r,d)=>{x(s=>({...s,[r]:d})),g[r]&&f(s=>{const l={...s};return delete l[r],l})};return e.jsx(Te,{isOpen:b,onClose:c,title:"Create New Customer",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ge,{className:"h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium",children:"Creating a new customer record"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Please verify the information below before creating"})]})]})}),e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Jn,{className:"inline h-4 w-4 mr-1"}),"Company Name *"]}),e.jsx("input",{type:"text",value:h.company_name,onChange:r=>t("company_name",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${g.company_name?"border-red-500":"border-gray-300"}`,placeholder:"Enter company name"}),g.company_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:g.company_name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(sa,{className:"inline h-4 w-4 mr-1"}),"Contact Person"]}),e.jsx("input",{type:"text",value:h.contact_person,onChange:r=>t("contact_person",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter contact person name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ze,{className:"inline h-4 w-4 mr-1"}),"Email"]}),e.jsx("input",{type:"email",value:h.email,onChange:r=>t("email",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${g.email?"border-red-500":"border-gray-300"}`,placeholder:"Enter email address"}),g.email&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:g.email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(vt,{className:"inline h-4 w-4 mr-1"}),"Phone"]}),e.jsx("input",{type:"text",value:h.phone,onChange:r=>t("phone",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ha,{className:"inline h-4 w-4 mr-1"}),"Address"]}),e.jsx("textarea",{value:h.address,onChange:r=>t("address",r.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("select",{value:h.city,onChange:r=>t("city",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:ia.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Un,{className:"inline h-4 w-4 mr-1"}),"Country"]}),e.jsx("input",{type:"text",value:h.country,onChange:r=>t("country",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter country"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PBF License"}),e.jsx("input",{type:"text",value:h.pbf_license,onChange:r=>t("pbf_license",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter PBF license number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NPWP"}),e.jsx("input",{type:"text",value:h.npwp,onChange:r=>t("npwp",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter NPWP number"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:c,disabled:N,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:i,disabled:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:N?"Creating...":"Create Customer"})]})]})})}function yd({isOpen:b,customerName:A,changedFields:v,oldValues:c,newValues:h,onUpdateCustomer:x,onKeepExisting:N,onCancel:w}){const g=f=>({email:"Email",phone:"Phone",contact_person:"Contact Person",address:"Address",city:"City",country:"Country"})[f]||f;return e.jsx(Te,{isOpen:b,onClose:w,title:"Update Customer Information?",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ge,{className:"h-5 w-5 text-yellow-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-900 font-medium",children:"Contact details differ from master record"}),e.jsxs("p",{className:"text-xs text-yellow-700 mt-1",children:["The information you entered for ",e.jsx("span",{className:"font-semibold",children:A})," differs from what's stored in the customer database."]})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Changes Detected"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:v.map(f=>e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:g(f)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 bg-red-50 border border-red-200 rounded px-3 py-2",children:[e.jsx("div",{className:"text-xs text-red-600 font-medium mb-0.5",children:"Current"}),e.jsx("div",{className:"text-sm text-gray-900",children:c[f]||e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})]}),e.jsx(oa,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 bg-green-50 border border-green-200 rounded px-3 py-2",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium mb-0.5",children:"New"}),e.jsx("div",{className:"text-sm text-gray-900",children:h[f]||e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})]})]})]},f))})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-900",children:[e.jsx("strong",{children:"Tip:"})," Updating the customer record will apply these changes to all future inquiries for this customer."]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Keep Existing"}),e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Update Customer Record"})]})]})})}function Mt(b){return b?b.toLowerCase().trim().replace(/\s+/g," ").replace(/\b(ltd|limited|inc|incorporated|pvt|private|llc|corp|corporation|co|company|pte|sdn bhd|tbk|pt)\b\.?/gi,"").replace(/[^\w\s]/g,"").trim():""}function gd(b,A){const v=b.length,c=A.length,h=[];if(v===0)return c;if(c===0)return v;for(let x=0;x<=v;x++)h[x]=[x];for(let x=0;x<=c;x++)h[0][x]=x;for(let x=1;x<=v;x++)for(let N=1;N<=c;N++){const w=b[x-1]===A[N-1]?0:1;h[x][N]=Math.min(h[x-1][N]+1,h[x][N-1]+1,h[x-1][N-1]+w)}return h[v][c]}function vd(b,A){const v=Mt(b),c=Mt(A);if(v===c)return 1;const h=Math.max(v.length,c.length);return h===0?1:1-gd(v,c)/h}function sn(b){if(!b)return"";const A=b.match(/@(.+)$/);return A?A[1].toLowerCase():""}function On(b,A){if(!b||!A.length)return[];const v=Mt(b),c=b.toLowerCase().trim(),h=[];for(const x of A){const N=Mt(x.company_name),w=x.company_name.toLowerCase().trim();let g="fuzzy",f=0;if(N===v)g="exact",f=100;else if(w.startsWith(c))g="startsWith",f=90-(w.length-c.length);else if(w.includes(c))g="contains",f=75-w.indexOf(c)*2;else{const t=vd(b,x.company_name);if(t>=.6)f=Math.round(t*70);else continue}(x.email&&b.includes("@")?sn(x.email)===sn(b):!1)&&(f+=15);let i;f>=90?i="high":f>=70?i="medium":i="low",h.push({customer:x,score:Math.min(f,100),matchType:g,confidence:i})}return h.sort((x,N)=>N.score-x.score)}function xd(b,A){const v=On(b,A);return v.length>0&&v[0].score>=90?v[0]:null}function bd(b,A){const v=[],c={},h={},x=g=>(g==null?void 0:g.toLowerCase().trim())||"",N=g=>(g==null?void 0:g.replace(/\D/g,""))||"",w=g=>(g==null?void 0:g.trim())||"";if(b.contact_email&&A.email){const g=x(b.contact_email),f=x(A.email);g!==f&&g!==""&&(v.push("email"),c.email=A.email,h.email=b.contact_email)}if(b.contact_phone&&A.phone){const g=N(b.contact_phone),f=N(A.phone);g!==f&&g!==""&&(v.push("phone"),c.phone=A.phone,h.phone=b.contact_phone)}if(b.contact_person&&A.contact_person){const g=w(b.contact_person),f=w(A.contact_person);g!==f&&g!==""&&(v.push("contact_person"),c.contact_person=A.contact_person,h.contact_person=b.contact_person)}return{hasChanges:v.length>0,changedFields:v,oldValues:c,newValues:h}}function Wd(){var U;const{profile:b}=gt(),{t:A}=on(),[v,c]=Z.useState([]),[h,x]=Z.useState(!0),[N,w]=Z.useState(null),[g,f]=Z.useState("table"),[p,i]=Z.useState(!1),[t,r]=Z.useState(null),[d,s]=Z.useState(!1),[l,o]=Z.useState(null),[n,m]=Z.useState(null),[a,u]=Z.useState([]),[j,E]=Z.useState(!1),[S,D]=Z.useState(!1),[k,_]=Z.useState(!1),[y,C]=Z.useState(null),[T,q]=Z.useState({});Z.useEffect(()=>{G()},[]);const G=async()=>{try{w(null);const{data:B,error:W}=await fe.from("crm_inquiries").select("*, user_profiles!assigned_to(full_name)").neq("pipeline_status","lost").order("created_at",{ascending:!1});if(W)throw W;c(B||[])}catch{w(A("errors.failedToLoadInquiries"))}finally{x(!1)}},Y=async()=>{try{const{data:B,error:W}=await fe.from("customers").select("id, company_name, contact_person, email, phone, country, address, city").eq("is_active",!0);if(W)throw W;return B||[]}catch(B){return console.error("Error loading customers:",B),[]}},te=async B=>{try{const{data:W,error:ie}=await fe.from("crm_inquiries").select("customer_id").in("customer_id",B);if(ie)throw ie;const ue={};W==null||W.forEach(ee=>{ee.customer_id&&(ue[ee.customer_id]=(ue[ee.customer_id]||0)+1)}),q(ue)}catch(W){console.error("Error loading inquiry counts:",W)}},K=async B=>{if(B.customer_id){const ee=(await Y()).find(V=>V.id===B.customer_id);if(ee){const V=bd({contact_email:B.contact_email,contact_phone:B.contact_phone,contact_person:B.contact_person},ee);if(V.hasChanges)return C({...V,customer:ee}),m(B),_(!0),!1}return!0}const W=await Y(),ie=On(B.company_name,W);if(ie.length>0){const ue=xd(B.company_name,W);return ue&&ue.score>=95?(B.customer_id=ue.customer.id,K(B)):(u(ie),m(B),await te(ie.map(ee=>ee.customer.id)),E(!0),!1)}else return m(B),D(!0),!1},M=B=>{const W={...B},ie=["delivery_date","inquiry_date"],ue=["purchase_price","offered_price"];return ie.forEach(ee=>{(W[ee]===""||W[ee]===void 0)&&(W[ee]=null)}),ue.forEach(ee=>{W[ee]===""||W[ee]===void 0?W[ee]=null:W[ee]!==null&&(W[ee]=parseFloat(W[ee]))}),W},P=async B=>{try{const{data:{user:W}}=await fe.auth.getUser();if(!W)throw new Error("Not authenticated");if(!t){if(!await K(B))return;if(!B.customer_id){alert(A("validation.customerSelectionRequired"));return}}if(t){const{products:ie,is_multi_product:ue,...ee}=B,V=M({...ee,specification:B.specification||null,purchase_price:B.purchase_price?parseFloat(B.purchase_price):null,offered_price:B.offered_price?parseFloat(B.offered_price):null}),{error:ne}=await fe.from("crm_inquiries").update(V).eq("id",t.id);if(ne)throw ne}else{const{products:ie,is_multi_product:ue,...ee}=B;if(ue&&ie&&ie.length>0){const V=ie.map(he=>M({...ee,product_name:he.productName||he.product_name,specification:he.specification||null,quantity:he.quantity,supplier_name:he.supplierName||ee.supplier_name||null,supplier_country:he.supplierCountry||ee.supplier_country||null,delivery_date:he.deliveryDate||null,delivery_terms:he.deliveryTerms||null,inquiry_date:new Date().toISOString().split("T")[0],assigned_to:W.id,created_by:W.id,purchase_price:null,offered_price:null,is_multi_product:!1,has_items:!1})),{data:ne,error:de}=await fe.from("crm_inquiries").insert(V).select();if(de)throw de;if(ne&&ne.length>0){const he=ne[0].inquiry_number;for(let Q=0;Q<ne.length;Q++)await fe.from("crm_inquiries").update({inquiry_number:`${he}.${Q+1}`}).eq("id",ne[Q].id)}}else{const V=M({...ee,specification:B.specification||null,inquiry_date:new Date().toISOString().split("T")[0],assigned_to:W.id,created_by:W.id,purchase_price:B.purchase_price?parseFloat(B.purchase_price):null,offered_price:B.offered_price?parseFloat(B.offered_price):null,is_multi_product:!1,has_items:!1}),{error:ne}=await fe.from("crm_inquiries").insert([V]);if(ne)throw ne}}i(!1),r(null),G()}catch(W){throw console.error("Error saving inquiry:",W),alert(A("errors.failedToSaveInquiry")),W}},O=B=>{r(B),i(!0)},I=B=>{n&&(n.customer_id=B.id,E(!1),P(n))},$=async B=>{try{const{data:W,error:ie}=await fe.from("customers").insert({...B,is_active:!0}).select().single();if(ie)throw ie;n&&(n.customer_id=W.id,D(!1),P(n))}catch(W){throw console.error("Error creating customer:",W),W}},F=async()=>{if(!(!y||!y.customer))try{const B={};y.changedFields.forEach(ie=>{B[ie]=y.newValues[ie]});const{error:W}=await fe.from("customers").update(B).eq("id",y.customer.id);if(W)throw W;_(!1),n&&P(n)}catch(B){console.error("Error updating customer:",B),alert(A("errors.failedToUpdateCustomer"))}},R=()=>{_(!1),n&&P(n)},L=(b==null?void 0:b.role)==="admin"||(b==null?void 0:b.role)==="sales";return e.jsx(zn,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:A("crm.title")})}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex overflow-x-auto",children:[e.jsxs("button",{onClick:()=>f("email"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="email"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(cn,{className:"w-5 h-5"}),A("crm.emailInbox")]}),e.jsxs("button",{onClick:()=>f("table"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="table"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ga,{className:"w-5 h-5"}),A("crm.inquiries")]}),e.jsxs("button",{onClick:()=>f("pipeline"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="pipeline"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(fa,{className:"w-5 h-5"}),A("crm.pipeline")]}),e.jsxs("button",{onClick:()=>f("calendar"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="calendar"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(tt,{className:"w-5 h-5"}),"Calendar"]}),e.jsxs("button",{onClick:()=>f("customers"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="customers"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(rt,{className:"w-5 h-5"}),"Customers"]}),e.jsxs("button",{onClick:()=>f("activities"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="activities"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(la,{className:"w-5 h-5"}),"Activities"]}),e.jsxs("button",{onClick:()=>f("appointments"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="appointments"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Ke,{className:"w-5 h-5"}),"Appointments"]}),e.jsxs("button",{onClick:()=>f("archive"),className:`flex items-center gap-2 px-6 py-4 border-b-2 transition whitespace-nowrap ${g==="archive"?"border-blue-500 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ln,{className:"w-5 h-5"}),"Archive"]})]})}),e.jsxs("div",{className:"p-6",children:[N&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-red-700",children:N}),e.jsx("button",{onClick:G,className:"px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm",children:"Retry"})]}),g==="email"&&e.jsx(ed,{}),g==="table"&&e.jsx(id,{inquiries:v,onRefresh:G,canManage:L,onAddInquiry:()=>{r(null),i(!0)}}),g==="pipeline"&&e.jsx(od,{canManage:L,onInquiryClick:B=>O(B)}),g==="calendar"&&e.jsx(sd,{onReminderCreated:G}),g==="customers"&&e.jsx(ud,{}),g==="activities"&&e.jsx(dd,{onActivityLogged:G}),g==="appointments"&&e.jsx(fd,{onAppointmentCreated:G}),g==="archive"&&e.jsx(hd,{canManage:L,onRefresh:G})]})]}),e.jsx(Te,{isOpen:p,onClose:()=>{i(!1),r(null)},title:t?"Edit Inquiry":"Add New Inquiry",children:e.jsx(Yn,{onSubmit:P,onCancel:()=>{i(!1),r(null)},initialData:t,isEditing:!!t})}),e.jsx(Te,{isOpen:d,onClose:()=>{s(!1),o(null)},title:"Send Email",children:e.jsx(ld,{inquiry:l,onClose:()=>{s(!1),o(null)},onSent:()=>{G()}})}),e.jsx(md,{isOpen:j,matches:a,searchTerm:(n==null?void 0:n.company_name)||"",onSelect:I,onCreateNew:()=>{E(!1),D(!0)},onCancel:()=>{E(!1),m(null)},inquiryCounts:T}),e.jsx(pd,{isOpen:S,initialData:{company_name:(n==null?void 0:n.company_name)||"",contact_person:(n==null?void 0:n.contact_person)||"",email:(n==null?void 0:n.contact_email)||"",phone:(n==null?void 0:n.contact_phone)||"",country:(n==null?void 0:n.supplier_country)||"Indonesia"},onConfirm:$,onCancel:()=>{D(!1),m(null)}}),e.jsx(yd,{isOpen:k,customerName:((U=y==null?void 0:y.customer)==null?void 0:U.company_name)||"",changedFields:(y==null?void 0:y.changedFields)||[],oldValues:(y==null?void 0:y.oldValues)||{},newValues:(y==null?void 0:y.newValues)||{},onUpdateCustomer:F,onKeepExisting:R,onCancel:()=>{_(!1),m(null)}})]})})}export{Wd as CRM};
